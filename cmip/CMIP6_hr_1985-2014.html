

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Example with CMIP6 models (100 - 500 km) &#8212; globalsnow</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'cmip/CMIP6_hr_1985-2014';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Cloudsat" href="../cloudsat.html" />
    <link rel="prev" title="Analysis of CMIP6, ERA5, and CloudSat" href="../CMIP6_ERA5_CloudSat/plt_seasonal_mean.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to Global Snow project website
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../ERA5/ERA5_1985-2014.html">Example with ERA5 high-resolution (~0.25deg) monthly means</a></li>






<li class="toctree-l1"><a class="reference internal" href="../CMIP6_ERA5_CloudSat/plt_seasonal_mean.html">Analysis of CMIP6, ERA5, and CloudSat</a></li>








<li class="toctree-l1 current active"><a class="current reference internal" href="#">Example with CMIP6 models (100 - 500 km)</a></li>








<li class="toctree-l1 has-children"><a class="reference internal" href="../cloudsat.html">Cloudsat</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../CloudSat/get_pressure_grid.html">Example to get CloudSat mean pressure level profile</a></li>



<li class="toctree-l2"><a class="reference internal" href="../CloudSat/read_2C_snow.html">Regrid CloudSat data to horizontal grid</a></li>



</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/franzihe/CloudSat_ERA5_CMIP6_analysis" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/franzihe/CloudSat_ERA5_CMIP6_analysis/issues/new?title=Issue%20on%20page%20%2Fcmip/CMIP6_hr_1985-2014.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/cmip/CMIP6_hr_1985-2014.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Example with CMIP6 models (100 - 500 km)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Example with CMIP6 models (100 - 500 km)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-a-id-introduction-a">1. Introduction <a id="introduction"></a></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-wrangling-a-id-data-wrangling-a">2. Data Wrangling <a id="data_wrangling"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#organize-my-data">Organize my data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-python-packages">Import python packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#open-cmip6-variables">Open CMIP6 variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#search-corresponding-data">Search corresponding data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#convert-calender-from-dtype-object-to-datetime64">Convert Calender from dtype=object to datetime64</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#count-the-days-in-one-season-over-year-range">Count the days in one season over year range</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#supercooled-liquid-water-fraction">Supercooled liquid water fraction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statistics">Statistics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-often-do-we-have-slc-with-thresholds-for-surface-snowfall-liquid-water-path-and-temperature">How often do we have SLC with thresholds for surface snowfall, liquid water path, and temperature</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#liquid-containing-cloud-frequency">Liquid containing cloud frequency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#masked-and-weighted-average">Masked and weighted average</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annual-cycle-of-frequency-of-liquid-containing-clouds">Annual cycle of frequency of liquid containing clouds</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#frequency-of-snowfall-from-lccs">Frequency of snowfall from LCCs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annual-cycle-of-frequency-of-snowfall-from-lccs">Annual cycle of frequency of snowfall from LCCs</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relative-snowfall-efficency">Relative snowfall efficency</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annual-cycle-of-relative-snowfall-efficency">Annual cycle of relative snowfall efficency</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relative-precipitation-efficency">Relative precipitation efficency</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annual-cycle-of-relative-supercooled-precipitation-efficency">Annual cycle of relative supercooled precipitation efficency</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#frequency-of-freezing-rain">Frequency of freezing rain</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-bin-and-bin-sizes">Calculating bin and bin sizes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#precipitation-efficency-spatial">Precipitation efficency - spatial</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relative-frequency">Relative frequency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-annual-cycle-of-lcc-frequency-precipitaiton-frequency-in-lccs-relative-snowfall-efficeny">Plot annual cycle of LCC frequency, precipitaiton frequency in LCCs, relative snowfall efficeny</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#load-era5-data-in-model-resolutions">Load ERA5 data in model resolutions</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#differences-model-era5">Differences Model - ERA5</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#difference-cummulative-snowfall-days">Difference Cummulative snowfall days</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#difference-frequencys">Difference Frequencys</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#difference-total-water-path">Difference total water path</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calendar">Calendar</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#show-attributes-and-individual-identifier">Show attributes and individual identifier</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assign-attributes-to-the-variables">Assign attributes to the variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interpolate-from-cmip6-hybrid-sigma-pressure-levels-to-era5-isobaric-pressure-levels">Interpolate from CMIP6 hybrid sigma-pressure levels to ERA5 isobaric pressure levels</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-liquid-water-path-from-content">Calculate liquid water path from content</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Open CMIP6 variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Search corresponding data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-dictionary-from-the-list-of-datasets-we-found">Create dictionary from the list of datasets we found</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Calendar</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Show attributes and individual identifier</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Assign attributes to the variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Interpolate from CMIP6 hybrid sigma-pressure levels to ERA5 isobaric pressure levels</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regrid-cmip6-data-to-noresm2-mm-grid-a-id-regrid-hz-a">Regrid CMIP6 data to NorESM2-MM grid <a id="regrid_hz"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#connect-all-models-into-one-dataset-with-new-coordinate-model">Connect all models into one Dataset with new coordinate ‘model’</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Supercooled liquid water fraction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Statistics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#find-mixed-phase-clouds">Find mixed-phase clouds</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-dictionary-from-the-list-of-datasets-we-want-to-use-for-the-iwc-lwc-statistics">Create dictionary from the list of datasets we want to use for the IWC/LWC statistics</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exploratory-data-analysis-a-id-exploratory-a">3. Exploratory Data Analysis <a id="exploratory"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-seasonal-mean-of-all-regridded-models">Create seasonal mean of all regridded models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-model-mean-spread-of-seasonal-mean-of-all-regridded-models">Create model mean/spread of seasonal mean of all regridded models</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#references-a-id-references-a">References <a id="references"></a></a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="example-with-cmip6-models-100-500-km">
<h1>Example with CMIP6 models (100 - 500 km)<a class="headerlink" href="#example-with-cmip6-models-100-500-km" title="Permalink to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="table-of-contents">
<h1>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this heading">#</a></h1>
<ul>
<li><a href="#introduction">1. Introduction</a></li>
<li><a href="#data_wrangling">2. Data Wrangling</a></li>
<li><a href="#exploratory">3. Exploratory Data Analysis</a></li>
<li><a href="#conclusion">4. Conclusion</a></li>
<li><a href="#references">5. References</a></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introduction-a-id-introduction-a">
<h1>1. Introduction <a id='introduction'></a><a class="headerlink" href="#introduction-a-id-introduction-a" title="Permalink to this heading">#</a></h1>
<p>Cloud feedbacks are a major contributor to the spread of climate sensitivity in global climate models (GCMs) <a class="reference external" href="https://doi-org.ezproxy.uio.no/10.1029/2019GL085782">Zelinka et al. (2020)</a>. Among the most poorly understood cloud feedbacks is the one associated with the cloud phase, which is expected to be modified with climate change <a class="reference external" href="https://doi-org.ezproxy.uio.no/10.1038/s41561-020-00649-1">Bjordal et al. (2020)</a>. Cloud phase bias, in addition, has significant implications for the simulation of radiative properties and glacier and ice sheet mass balances in climate models.</p>
<p>In this context, this work aims to expand our knowledge on how the representation of the cloud phase affects snow formation in GCMs. Better understanding this aspect is necessary to develop climate models further and improve future climate predictions.</p>
<ul class="simple">
<li><p>Retrieve CMIP6 data through <a class="reference external" href="https://esgf-node.llnl.gov/search/cmip6/">ESGF</a></p></li>
<li><p>Hybrid sigma-pressure coordinates to isobaric pressure levels of the European Centre for Medium-Range Weather Forecast Re-Analysis 5 (ERA5) with <a class="reference external" href="https://geocat-comp.readthedocs.io/en/latest/index.html">GeoCAT-comb</a></p></li>
<li><p>Regridd the CMIP6 variables to the exact horizontal resolution with <a class="reference external" href="https://xesmf.readthedocs.io/en/latest/"><code class="docutils literal notranslate"><span class="pre">xesmf</span></code></a></p></li>
<li><p>Calculate an ensemble mean of all used models</p></li>
<li><p>Calculate and plot the seasonal mean of the ensemble mean</p></li>
</ul>
<p><strong>Questions</strong></p>
<ul class="simple">
<li><p>How is the cloud phase and snowfall varying between 2007 and 2010?</p></li>
</ul>
<blockquote>
<div><p><strong><em>NOTE:</em></strong> We answer questions related to the comparison of CMIP models to ERA5 in another <a class="reference internal" href="../CMIP6_ERA5_CloudSat/plt_seasonal_mean.html"><span class="doc std std-doc">Jupyter Notebook</span></a>.</p>
</div></blockquote>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-wrangling-a-id-data-wrangling-a">
<h1>2. Data Wrangling <a id='data_wrangling'></a><a class="headerlink" href="#data-wrangling-a-id-data-wrangling-a" title="Permalink to this heading">#</a></h1>
<p>This study will compare surface snowfall, ice, and liquid water content from the Coupled Model Intercomparison Project Phase 6 (<a class="reference external" href="https://esgf-node.llnl.gov/projects/cmip6/">CMIP6</a>) climate models to the European Centre for Medium-Range Weather Forecast Re-Analysis 5 (<a class="reference external" href="https://www.ecmwf.int/en/forecasts/datasets/reanalysis-datasets/era5">ERA5</a>) data from <strong>2006 to 2009</strong>. We conduct statistical analysis at the annual and seasonal timescales to determine the biases in cloud phase and precipitation (liquid and solid) in the CMIP6 models and their potential connection between them.</p>
<ul class="simple">
<li><p>Time period: 2006 to 2009</p></li>
<li><p>horizonal resolution: ~100km</p></li>
<li><p>time resolution: monthly atmospheric data (Amon, AERmon)</p></li>
<li><p>Variables:</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>shortname</p></th>
<th class="head text-center"><p>Long name</p></th>
<th class="head text-right"><p>Units</p></th>
<th class="head text-right"><p>levels</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>prsn</p></td>
<td class="text-center"><p>Snowfall Flux</p></td>
<td class="text-right"><p>[kg m-2 s-1]</p></td>
<td class="text-right"><p>surface</p></td>
</tr>
<tr class="row-odd"><td><p>clw</p></td>
<td class="text-center"><p>Mass Fraction of Cloud Liquid Water</p></td>
<td class="text-right"><p>[kg kg-1]</p></td>
<td class="text-right"><p>ml</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-right"><p>to calculate lwp use integral clw -dp/dg</p></td>
<td class="text-right"><p></p></td>
</tr>
<tr class="row-odd"><td><p>tas</p></td>
<td class="text-center"><p>Near-Surface Air Temperature</p></td>
<td class="text-right"><p>[K]</p></td>
<td class="text-right"><p>surface</p></td>
</tr>
<tr class="row-even"><td><p>clivi</p></td>
<td class="text-center"><p>Ice Water Path</p></td>
<td class="text-right"><p>[kg m-2]</p></td>
<td class="text-right"><p></p></td>
</tr>
<tr class="row-odd"><td><p>lwp</p></td>
<td class="text-center"><p>Liquid Water Path</p></td>
<td class="text-right"><p>[kg m-2]</p></td>
<td class="text-right"><p></p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>CMIP6 models:</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Institution</p></th>
<th class="head text-center"><p>Model name</p></th>
<th class="head text-right"><p>Reference</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="xref myst">MIROC</span></p></td>
<td class="text-center"><p>MIROC6</p></td>
<td class="text-right"><p><span class="xref myst">Tatebe et al. (2019)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="xref myst">NCAR</span></p></td>
<td class="text-center"><p>CESM2</p></td>
<td class="text-right"><p><span class="xref myst">Danabasoglu et al. (2020)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="xref myst">CCCma</span></p></td>
<td class="text-center"><p>CanESM5</p></td>
<td class="text-right"><p><span class="xref myst">Swart et al. (2019)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="xref myst">AWI</span></p></td>
<td class="text-center"><p>AWI-ESM-1-1-LR</p></td>
<td class="text-right"><p><span class="xref myst"></span></p></td>
</tr>
<tr class="row-even"><td><p><span class="xref myst">MOHC</span></p></td>
<td class="text-center"><p>UKESM1-0-LL</p></td>
<td class="text-right"><p><span class="xref myst"></span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="xref myst">MOHC</span></p></td>
<td class="text-center"><p>HadGem3-GC31-LL</p></td>
<td class="text-right"><p><span class="xref myst">Roberts et al. (2019)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="xref myst">CNRM-CERFACS</span></p></td>
<td class="text-center"><p>CNRM-CM6-1</p></td>
<td class="text-right"><p><span class="xref myst">Voldoire et al. (2019)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="xref myst">CNRM-CERFACS</span></p></td>
<td class="text-center"><p>CNRM-ESM2-1</p></td>
<td class="text-right"><p><span class="xref myst">Seferian et al. (2019)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="xref myst">IPSL</span></p></td>
<td class="text-center"><p>IPSL-CM6A-LR</p></td>
<td class="text-right"><p><span class="xref myst">Boucher et al. (2020)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="xref myst">IPSL</span></p></td>
<td class="text-center"><p>IPSL-CM5A2-INCA</p></td>
<td class="text-right"><p><span class="xref myst"></span></p></td>
</tr>
</tbody>
</table>
<section id="organize-my-data">
<h2>Organize my data<a class="headerlink" href="#organize-my-data" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Define a prefix for my project (you may need to adjust it for your own usage on your infrastructure).</p>
<ul>
<li><p>input folder where all the data used as input to my Jupyter Notebook is stored (and eventually shared)</p></li>
<li><p>output folder where all the results to keep are stored</p></li>
<li><p>tool folder where all the tools</p></li>
</ul>
</li>
</ul>
<p>The ERA5 0.25deg data is located in the folder <code class="docutils literal notranslate"><span class="pre">/input/cmip6_hist/daily_means</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="n">hostname</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>

<span class="n">abs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>
<span class="n">WORKDIR</span> <span class="o">=</span> <span class="n">abs_path</span><span class="p">[:</span><span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">abs_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">abs_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>


<span class="k">if</span> <span class="s2">&quot;mimi&quot;</span> <span class="ow">in</span> <span class="n">hostname</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
    <span class="n">DATA_DIR</span> <span class="o">=</span> <span class="s2">&quot;/scratch/franzihe/&quot;</span>
    <span class="c1"># FIG_DIR = &quot;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6/&quot;</span>
    <span class="n">FIG_DIR</span> <span class="o">=</span> <span class="s2">&quot;/uio/kant/geo-metos-u1/franzihe/Documents/Python/globalsnow/CloudSat_ERA5_CMIP6_analysis/Figures/CMIP6/&quot;</span>

<span class="k">elif</span> <span class="s2">&quot;glefsekaldt&quot;</span> <span class="ow">in</span> <span class="n">hostname</span><span class="p">:</span> 
    <span class="n">DATA_DIR</span> <span class="o">=</span> <span class="s2">&quot;/home/franzihe/Data/&quot;</span>
    <span class="n">FIG_DIR</span> <span class="o">=</span> <span class="s2">&quot;/home/franzihe/Documents/Figures/CMIP6/&quot;</span>

<span class="n">INPUT_DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">)</span>
<span class="n">OUTPUT_DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">)</span>
<span class="n">UTILS_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">WORKDIR</span><span class="p">,</span> <span class="s1">&#39;utils&#39;</span><span class="p">)</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">UTILS_DIR</span><span class="p">)</span>
<span class="c1"># make figure directory</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">FIG_DIR</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mimi.uio.no
</pre></div>
</div>
</div>
</div>
</section>
<section id="import-python-packages">
<h2>Import python packages<a class="headerlink" href="#import-python-packages" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Python</span></code> environment requirements: file <a class="reference download internal" download="" href="../_downloads/06f3f4f78bf14ffb9f9cfdf395203c3c/requirements_globalsnow.txt"><span class="xref download myst">requirements_globalsnow.txt</span></a></p></li>
<li><p>load <code class="docutils literal notranslate"><span class="pre">python</span></code> packages from <a class="reference download internal" download="" href="../_downloads/5eb7796ec8541cded4dcee2282ad687a/imports.py"><span class="xref download myst">imports.py</span></a></p></li>
<li><p>load <code class="docutils literal notranslate"><span class="pre">functions</span></code> from <a class="reference download internal" download="" href="../_downloads/3afa0d66b1ce4f3999c315ad3a2e691d/functions.py"><span class="xref download myst">functions.py</span></a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># supress warnings</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span> <span class="c1"># don&#39;t output warnings</span>

<span class="c1"># import packages</span>
<span class="kn">from</span> <span class="nn">imports</span> <span class="kn">import</span> <span class="p">(</span><span class="n">xr</span><span class="p">,</span> <span class="n">intake</span><span class="p">,</span> <span class="n">cftime</span><span class="p">,</span> <span class="n">xe</span><span class="p">,</span> <span class="n">glob</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">cm</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">fct</span><span class="p">,</span><span class="n">ccrs</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">plt</span><span class="p">,</span> <span class="n">da</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">LogNorm</span><span class="p">)</span>
<span class="n">xr</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">display_style</span><span class="o">=</span><span class="s2">&quot;html&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.core.options.set_options at 0x7fe9825ad450&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># reload imports</span>
<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ### Create dask cluster to work parallel in large datasets</span>

<span class="c1"># from dask.distributed import Client</span>
<span class="c1"># client = Client(n_workers=4, </span>
<span class="c1">#                 threads_per_worker=2, </span>
<span class="c1">#                 memory_limit=&#39;100GB&#39;,</span>
<span class="c1">#                 processes=False)</span>
<span class="c1"># client</span>
<span class="c1"># chunks={&#39;time&#39; : 10,}</span>
<span class="c1"># client </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # These are the usual ipython objects, including this one you are creating</span>
<span class="c1"># ipython_vars = [&#39;In&#39;, &#39;Out&#39;, &#39;exit&#39;, &#39;quit&#39;, &#39;get_ipython&#39;, &#39;ipython_vars&#39;]</span>

<span class="c1"># # Get a sorted list of the objects and their sizes</span>
<span class="c1"># sorted([(x, sys.getsizeof(globals().get(x))) for x in dir() if not x.startswith(&#39;_&#39;) and x not in sys.modules and x not in ipython_vars], key=lambda x: x[1], reverse=True)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="open-cmip6-variables">
<h2>Open CMIP6 variables<a class="headerlink" href="#open-cmip6-variables" title="Permalink to this heading">#</a></h2>
<p>Get the data required for the analysis. Beforehand we downloaded the daily averaged data on single levels and model levels via.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmip_in</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;cmip6_hist/daily_means/single_model&#39;</span><span class="p">)</span>
<span class="n">cmip_out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;cmip6_hist/daily_means/common_grid&#39;</span><span class="p">)</span>

<span class="c1"># make output data directory</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">cmip_out</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">variable_id</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;clw&#39;</span><span class="p">,</span> <span class="s1">&#39;cli&#39;</span><span class="p">,</span> <span class="s1">&#39;clivi&#39;</span><span class="p">,</span> <span class="s1">&#39;tas&#39;</span><span class="p">,</span> <span class="s1">&#39;prsn&#39;</span><span class="p">,</span> <span class="s1">&#39;pr&#39;</span><span class="p">,</span> <span class="s1">&#39;areacella&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>At the moment we have downloaded the end of the historical simulations for CMIP6 models. We define start and end year to ensure to only extract the 4-year period between 2007 and 2010.</p>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> Define a start and end year</p>
<p>We will load all available models into one dictonary, which includes an xarray dataset with <code class="docutils literal notranslate"><span class="pre">xarray.open_mfdataset(file)</span></code> and select the time range <a class="reference external" href="https://xarray.pydata.org/en/stable/user-guide/indexing.html">by name</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># source_id</span>
<span class="n">list_models</span> <span class="o">=</span> <span class="p">[</span>
               <span class="s1">&#39;MIROC6&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;CESM2&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;CanESM5&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;AWI-ESM-1-1-LR&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;MPI-ESM1-2-LR&#39;</span><span class="p">,</span> 
            <span class="c1"># # #    &#39;UKESM1-0-LL&#39;, </span>
            <span class="c1"># # #    &#39;HadGEM3-GC31-LL&#39;,</span>
            <span class="c1">#    # &#39;CNRM-CM6-1&#39;,</span>
            <span class="c1">#    # &#39;CNRM-ESM2-1&#39;,</span>
               <span class="c1"># &#39;IPSL-CM6A-LR&#39;,</span>
               <span class="s1">&#39;IPSL-CM5A2-INCA&#39;</span>
            <span class="p">]</span>

<span class="c1">## experiment</span>
<span class="n">experiment_id</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;historical&#39;</span><span class="p">]</span>

<span class="c1">## time resolution</span>
<span class="n">t_res</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">,]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="search-corresponding-data">
<h2>Search corresponding data<a class="headerlink" href="#search-corresponding-data" title="Permalink to this heading">#</a></h2>
<p>Get the data required for the analysis. Define variables, models, experiment, and time resolution as defined in <a href="#data_wrangling">2. Data Wrangling</a>
.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">starty</span> <span class="o">=</span> <span class="mi">2006</span><span class="p">;</span> <span class="n">endy</span> <span class="o">=</span> <span class="mi">2009</span>
<span class="n">year_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="n">dset_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="c1"># for model in list_models:</span>
<span class="c1">#     cmip_file_in = glob(&#39;{}/*{}_{}_{}*&#39;.format(cmip_in, t_res[0], model, experiment_id[0]))</span>
<span class="c1">#     if len(cmip_file_in) != 0:</span>
<span class="c1">#         dset_dict[model] = xr.open_mfdataset(sorted(cmip_file_in), combine=&#39;nested&#39;, compat=&#39;override&#39;, use_cftime=True)</span>
<span class="c1">#         # select only years needed for analysis</span>
<span class="c1">#         dset_dict[model] = dset_dict[model].sel(time = dset_dict[model][&#39;time&#39;].dt.year.isin(year_range)).squeeze()</span>
<span class="c1">#         # shift longitude to be from -180 to 180</span>
<span class="c1">#         dset_dict[model] = dset_dict[model].assign_coords(lon=(((dset_dict[model][&#39;lon&#39;] + 180) % 360) - 180)).sortby(&#39;lon&#39;).sortby(&#39;time&#39;)</span>
<span class="c1">#     else:</span>
<span class="c1">#         continue</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">list_models</span><span class="p">:</span>
    <span class="n">cmip_file_in</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/*</span><span class="si">{}</span><span class="s1">*45*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmip_in</span><span class="p">,</span> <span class="n">model</span><span class="p">))</span>
    <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">cmip_file_in</span><span class="p">)</span>

    <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">year_range</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    
    <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;clivi&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="convert-calender-from-dtype-object-to-datetime64">
<h2>Convert Calender from dtype=object to datetime64<a class="headerlink" href="#convert-calender-from-dtype-object-to-datetime64" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">to_ERA5_date</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_datetimeindex</span><span class="p">()</span>
    
    <span class="c1"># remove leap day from dataset  </span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=~</span><span class="p">((</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="mi">29</span><span class="p">)))</span>
    
    <span class="n">dates</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span>
    <span class="n">years</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[Y]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">+</span><span class="mi">1971</span> <span class="c1"># add a year to be similar to ERA5</span>
    <span class="n">months</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[M]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">%</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">days</span> <span class="o">=</span> <span class="p">(</span><span class="n">dates</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[D]&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">dates</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[M]&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">years</span><span class="p">),</span><span class="nb">list</span><span class="p">(</span><span class="n">months</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">days</span><span class="p">),[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">years</span><span class="p">))</span> <span class="p">])</span>
    <span class="c1"># Transpose the data so that columns become rows.</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">T</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="c1"># A simple list comprehension does the trick, &#39;*&#39; making sure</span>
    <span class="c1"># the values are unpacked for &#39;datetime.datetime&#39;.</span>
    <span class="n">new_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
    <span class="c1"># We assign the new time coordinate</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="n">new_data</span><span class="p">})</span>
    
    <span class="k">return</span> <span class="n">ds</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

    <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_ERA5_date</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">],</span> <span class="n">model</span><span class="p">)</span>
    <span class="c1">#remove leap day from dataset</span>
    <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=~</span><span class="p">((</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="mi">29</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MIROC6 2006-01-01T12:00:00.000000000
CESM2 2006-01-01 00:00:00
CanESM5 2006-01-01 12:00:00
AWI-ESM-1-1-LR 2006-01-01T12:00:00.000000000
MPI-ESM1-2-LR 2006-01-01T12:00:00.000000000
IPSL-CM5A2-INCA 2006-01-01 12:00:00
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">var_id</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">var_id</span><span class="p">,</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">var_id</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MIROC6 areacella m2
MIROC6 clivi kg m-2
MIROC6 lwp kg m-2
MIROC6 pr kg m-2 h-1
MIROC6 prsn kg m-2 h-1
MIROC6 tas K
MIROC6 twp kg m-2
CESM2 areacella m2
CESM2 clivi kg m-2
CESM2 lwp kg m-2
CESM2 pr kg m-2 h-1
CESM2 prsn kg m-2 h-1
CESM2 tas K
CESM2 twp kg m-2
CanESM5 areacella m2
CanESM5 clivi kg m-2
CanESM5 lwp kg m-2
CanESM5 pr kg m-2 h-1
CanESM5 prsn kg m-2 h-1
CanESM5 tas K
CanESM5 twp kg m-2
AWI-ESM-1-1-LR areacella m2
AWI-ESM-1-1-LR clivi kg m-2
AWI-ESM-1-1-LR lwp kg m-2
AWI-ESM-1-1-LR pr kg m-2 h-1
AWI-ESM-1-1-LR prsn kg m-2 h-1
AWI-ESM-1-1-LR tas K
AWI-ESM-1-1-LR twp kg m-2
MPI-ESM1-2-LR areacella m2
MPI-ESM1-2-LR clivi kg m-2
MPI-ESM1-2-LR lwp kg m-2
MPI-ESM1-2-LR pr kg m-2 h-1
MPI-ESM1-2-LR prsn kg m-2 h-1
MPI-ESM1-2-LR tas K
MPI-ESM1-2-LR twp kg m-2
IPSL-CM5A2-INCA areacella m2
IPSL-CM5A2-INCA clivi kg m-2
IPSL-CM5A2-INCA lwp kg m-2
IPSL-CM5A2-INCA pr kg m-2 h-1
IPSL-CM5A2-INCA prsn kg m-2 h-1
IPSL-CM5A2-INCA tas K
IPSL-CM5A2-INCA twp kg m-2
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="count-the-days-in-one-season-over-year-range">
<h1>Count the days in one season over year range<a class="headerlink" href="#count-the-days-in-one-season-over-year-range" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">is_season</span><span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">lower_val</span><span class="p">,</span> <span class="n">upper_val</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">month</span><span class="o">&gt;=</span><span class="n">lower_val</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">month</span> <span class="o">&lt;=</span> <span class="n">upper_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">days_season</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
                                   <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
                                   <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
                                   <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],],</span> 
                           <span class="n">dims</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;season&#39;</span><span class="p">},</span> 
                           <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;season&#39;</span><span class="p">:[</span><span class="s1">&#39;DJF&#39;</span><span class="p">,</span> <span class="s1">&#39;JJA&#39;</span><span class="p">,</span> <span class="s1">&#39;MAM&#39;</span><span class="p">,</span> <span class="s1">&#39;SON&#39;</span><span class="p">]})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_days</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">):</span>
    <span class="n">_days</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="n">month</span><span class="p">,</span> <span class="n">month</span><span class="p">))</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
    <span class="c1"># print(month, )</span>
<span class="n">days_month</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_days</span><span class="p">),</span>
                          <span class="n">dims</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;month&#39;</span><span class="p">},</span> 
                          <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;month&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">)}</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="supercooled-liquid-water-fraction">
<h2>Supercooled liquid water fraction<a class="headerlink" href="#supercooled-liquid-water-fraction" title="Permalink to this heading">#</a></h2>
<div class="math notranslate nohighlight">
\[SLF = \frac{\text{cloud liquid water content}}{\text{cloud liquid water content} + \text{cloud ice water content}}\]</div>
</section>
<section id="statistics">
<h2>Statistics<a class="headerlink" href="#statistics" title="Permalink to this heading">#</a></h2>
<p>For variables:</p>
<ul class="simple">
<li><p>Snowfall [sf]</p></li>
<li><p>Total column cloud liquid, supercooled liqid, and rain water [tclslrw]</p></li>
<li><p>Total column cloud ice, snow water [tcisw]</p></li>
<li><p>2m-Temperature [2t]</p></li>
</ul>
<ol class="arabic simple">
<li><p>Find where liquid water path is <span class="math notranslate nohighlight">\(\ge\)</span> 5 g m-2</p></li>
<li><p>Find where snowfall is <span class="math notranslate nohighlight">\(\ge\)</span> 0.01mm h-1</p></li>
<li><p>Find where 2m-temperature <span class="math notranslate nohighlight">\(\le\)</span> 0 <span class="math notranslate nohighlight">\(^o\)</span> C</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:    (lat: 48, lon: 96, time: 1460)
Coordinates:
  * lat        (lat) float32 -90.0 -88.11 -86.21 -84.32 ... 86.21 88.11 90.0
  * lon        (lon) float32 -180.0 -176.2 -172.5 -168.8 ... 168.8 172.5 176.2
    height     float64 2.0
  * time       (time) datetime64[ns] 2007-01-01 2007-01-02 ... 2010-12-31
Data variables:
    areacella  (lat, lon) float32 dask.array&lt;chunksize=(24, 96), meta=np.ndarray&gt;
    clivi      (time, lat, lon) float32 dask.array&lt;chunksize=(1460, 24, 96), meta=np.ndarray&gt;
    lwp        (time, lat, lon) float64 dask.array&lt;chunksize=(1460, 24, 96), meta=np.ndarray&gt;
    pr         (time, lat, lon) float32 dask.array&lt;chunksize=(1460, 24, 96), meta=np.ndarray&gt;
    prsn       (time, lat, lon) float32 dask.array&lt;chunksize=(1460, 24, 96), meta=np.ndarray&gt;
    tas        (time, lat, lon) float32 dask.array&lt;chunksize=(1460, 24, 96), meta=np.ndarray&gt;
    twp        (time, lat, lon) float64 dask.array&lt;chunksize=(1460, 24, 96), meta=np.ndarray&gt;</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-8f892b21-dff1-4d02-99c7-f24b790f7de3' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-8f892b21-dff1-4d02-99c7-f24b790f7de3' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>lat</span>: 48</li><li><span class='xr-has-index'>lon</span>: 96</li><li><span class='xr-has-index'>time</span>: 1460</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-d9a6e9c1-1129-4c0d-a957-ce82b4496502' class='xr-section-summary-in' type='checkbox'  checked><label for='section-d9a6e9c1-1129-4c0d-a957-ce82b4496502' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-90.0 -88.11 -86.21 ... 88.11 90.0</div><input id='attrs-ed6213d8-8874-4203-a391-32cfbcb6686e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ed6213d8-8874-4203-a391-32cfbcb6686e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4e2d3d50-a2e9-4a7c-ac44-0902cff31edd' class='xr-var-data-in' type='checkbox'><label for='data-4e2d3d50-a2e9-4a7c-ac44-0902cff31edd' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>axis :</span></dt><dd>Y</dd><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>long_name :</span></dt><dd>Latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><pre>array([-90.      , -88.10526 , -86.210526, -84.31579 , -82.42105 , -80.52631 ,
       -78.63158 , -76.73684 , -74.8421  , -72.947365, -71.052635, -69.1579  ,
       -67.26316 , -65.36842 , -63.473682, -61.57895 , -59.68421 , -57.789474,
       -55.894737, -54.      , -52.105263, -50.210526, -48.31579 , -46.42105 ,
        46.42105 ,  48.31579 ,  50.210526,  52.105263,  54.      ,  55.894737,
        57.789474,  59.68421 ,  61.57895 ,  63.473682,  65.36842 ,  67.26316 ,
        69.1579  ,  71.052635,  72.947365,  74.8421  ,  76.73684 ,  78.63158 ,
        80.52631 ,  82.42105 ,  84.31579 ,  86.210526,  88.10526 ,  90.      ],
      dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-180.0 -176.2 ... 172.5 176.2</div><input id='attrs-ec663d5a-d3e9-4240-bcee-db263eef9d5b' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ec663d5a-d3e9-4240-bcee-db263eef9d5b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-dcec558f-f304-406f-be9c-871259d935d7' class='xr-var-data-in' type='checkbox'><label for='data-dcec558f-f304-406f-be9c-871259d935d7' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>axis :</span></dt><dd>X</dd><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>long_name :</span></dt><dd>Longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><pre>array([-180.  , -176.25, -172.5 , -168.75, -165.  , -161.25, -157.5 , -153.75,
       -150.  , -146.25, -142.5 , -138.75, -135.  , -131.25, -127.5 , -123.75,
       -120.  , -116.25, -112.5 , -108.75, -105.  , -101.25,  -97.5 ,  -93.75,
        -90.  ,  -86.25,  -82.5 ,  -78.75,  -75.  ,  -71.25,  -67.5 ,  -63.75,
        -60.  ,  -56.25,  -52.5 ,  -48.75,  -45.  ,  -41.25,  -37.5 ,  -33.75,
        -30.  ,  -26.25,  -22.5 ,  -18.75,  -15.  ,  -11.25,   -7.5 ,   -3.75,
          0.  ,    3.75,    7.5 ,   11.25,   15.  ,   18.75,   22.5 ,   26.25,
         30.  ,   33.75,   37.5 ,   41.25,   45.  ,   48.75,   52.5 ,   56.25,
         60.  ,   63.75,   67.5 ,   71.25,   75.  ,   78.75,   82.5 ,   86.25,
         90.  ,   93.75,   97.5 ,  101.25,  105.  ,  108.75,  112.5 ,  116.25,
        120.  ,  123.75,  127.5 ,  131.25,  135.  ,  138.75,  142.5 ,  146.25,
        150.  ,  153.75,  157.5 ,  161.25,  165.  ,  168.75,  172.5 ,  176.25],
      dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>height</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>2.0</div><input id='attrs-6aa52562-f861-4566-a6c1-163d9699376b' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-6aa52562-f861-4566-a6c1-163d9699376b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ee53e181-c76b-4010-8c20-351f6712ef23' class='xr-var-data-in' type='checkbox'><label for='data-ee53e181-c76b-4010-8c20-351f6712ef23' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>name :</span></dt><dd>height</dd><dt><span>standard_name :</span></dt><dd>height</dd><dt><span>long_name :</span></dt><dd>height</dd><dt><span>units :</span></dt><dd>m</dd><dt><span>axis :</span></dt><dd>Z</dd><dt><span>positive :</span></dt><dd>up</dd></dl></div><div class='xr-var-data'><pre>array(2.)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2007-01-01 ... 2010-12-31</div><input id='attrs-247e82bb-c247-4798-b416-2d3091615e49' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-247e82bb-c247-4798-b416-2d3091615e49' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f660d98b-6057-4ab6-8f27-0bcb673a8801' class='xr-var-data-in' type='checkbox'><label for='data-f660d98b-6057-4ab6-8f27-0bcb673a8801' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2007-01-01T00:00:00.000000000&#x27;, &#x27;2007-01-02T00:00:00.000000000&#x27;,
       &#x27;2007-01-03T00:00:00.000000000&#x27;, ..., &#x27;2010-12-29T00:00:00.000000000&#x27;,
       &#x27;2010-12-30T00:00:00.000000000&#x27;, &#x27;2010-12-31T00:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-8085d7d6-d27a-4aaa-aee5-8cae34a9d1cb' class='xr-section-summary-in' type='checkbox'  checked><label for='section-8085d7d6-d27a-4aaa-aee5-8cae34a9d1cb' class='xr-section-summary' >Data variables: <span>(7)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>areacella</span></div><div class='xr-var-dims'>(lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(24, 96), meta=np.ndarray&gt;</div><input id='attrs-cbfc0f87-b494-4926-908d-0711050fad66' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-cbfc0f87-b494-4926-908d-0711050fad66' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ec6ef7fe-561d-458a-9075-54076fccae4d' class='xr-var-data-in' type='checkbox'><label for='data-ec6ef7fe-561d-458a-9075-54076fccae4d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Grid-Cell Area for Atmospheric Variables</dd><dt><span>units :</span></dt><dd>m2</dd><dt><span>online_operation :</span></dt><dd>once</dd><dt><span>cell_methods :</span></dt><dd>area: sum</dd><dt><span>standard_name :</span></dt><dd>cell_area</dd><dt><span>description :</span></dt><dd>Cell areas for any grid used to report atmospheric variables and any other variable using that grid (e.g., soil moisture content). These cell areas should be defined to enable exact calculation of global integrals (e.g., of vertical fluxes of energy at the surface and top of the atmosphere).</dd><dt><span>history :</span></dt><dd>none</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 18.00 kiB </td>
                        <td> 9.00 kiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (48, 96) </td>
                        <td> (24, 96) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 5 Graph Layers </td>
                        <td> 2 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float32 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="110" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="30" x2="120" y2="30" />
  <line x1="0" y1="60" x2="120" y2="60" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="60" style="stroke-width:2" />
  <line x1="120" y1="0" x2="120" y2="60" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,60.0 0.0,60.0" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="80.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" >96</text>
  <text x="140.000000" y="30.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,30.000000)">48</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>clivi</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(1460, 24, 96), meta=np.ndarray&gt;</div><input id='attrs-094bc909-beb2-4e4b-b59b-64c9582effe2' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-094bc909-beb2-4e4b-b59b-64c9582effe2' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-097db11a-cd65-4fdb-8e98-0eeab8d15d04' class='xr-var-data-in' type='checkbox'><label for='data-097db11a-cd65-4fdb-8e98-0eeab8d15d04' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Daily average Ice Water Path</dd><dt><span>units :</span></dt><dd>kg m-2</dd><dt><span>online_operation :</span></dt><dd>average</dd><dt><span>cell_methods :</span></dt><dd>area: time: mean</dd><dt><span>interval_operation :</span></dt><dd>1800 s</dd><dt><span>interval_write :</span></dt><dd>1 d</dd><dt><span>standard_name :</span></dt><dd>atmosphere_mass_content_of_cloud_ice_water</dd><dt><span>description :</span></dt><dd>calculate mass of ice water in the column divided by the area of the column (not just the area of the cloudy portion of the column). This includes precipitating frozen hydrometeors ONLY if the precipitating hydrometeors affect the calculation of radiative transfer in model.</dd><dt><span>history :</span></dt><dd>05/03/2023 19:58:55Z altered by F. Hellmuth: Rename attributes to daily average ice water path</dd><dt><span>cell_measures :</span></dt><dd>area: areacella</dd><dt><span>mipTable :</span></dt><dd></dd><dt><span>out_name :</span></dt><dd>clivi</dd><dt><span>title :</span></dt><dd>Ice Water Path</dd><dt><span>variable_id :</span></dt><dd>clivi</dd><dt><span>original_units :</span></dt><dd>kg/m2</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 25.66 MiB </td>
                        <td> 12.83 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (1460, 48, 96) </td>
                        <td> (1460, 24, 96) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 5 Graph Layers </td>
                        <td> 2 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float32 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="166" height="152" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="15" x2="80" y2="86" />
  <line x1="10" y1="31" x2="80" y2="102" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="31" style="stroke-width:2" />
  <line x1="80" y1="70" x2="80" y2="102" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,102.52923018415719 10.0,31.940994890039534" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="46" y2="0" style="stroke-width:2" />
  <line x1="80" y1="70" x2="116" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="46" y1="0" x2="116" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 46.16508283116066,0.0 116.75331812527831,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="116" y2="70" style="stroke-width:2" />
  <line x1="80" y1="86" x2="116" y2="86" />
  <line x1="80" y1="102" x2="116" y2="102" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="102" style="stroke-width:2" />
  <line x1="116" y1="70" x2="116" y2="102" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 116.75331812527831,70.58823529411765 116.75331812527831,102.52923018415719 80.58823529411765,102.52923018415719" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="98.670777" y="122.529230" font-size="1.0rem" font-weight="100" text-anchor="middle" >96</text>
  <text x="136.753318" y="86.558733" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,136.753318,86.558733)">48</text>
  <text x="35.294118" y="87.235113" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,87.235113)">1460</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>lwp</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(1460, 24, 96), meta=np.ndarray&gt;</div><input id='attrs-9904ecfb-3bcd-4329-8fad-7950dbcae5b8' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-9904ecfb-3bcd-4329-8fad-7950dbcae5b8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6cf77df7-342b-4a85-a5d4-b902437845ae' class='xr-var-data-in' type='checkbox'><label for='data-6cf77df7-342b-4a85-a5d4-b902437845ae' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Daily average Liquid Water Path</dd><dt><span>units :</span></dt><dd>kg m-2</dd><dt><span>online_operation :</span></dt><dd>average</dd><dt><span>cell_methods :</span></dt><dd>area: time: mean</dd><dt><span>interval_operation :</span></dt><dd>1800 s</dd><dt><span>interval_write :</span></dt><dd>1 d</dd><dt><span>standard_name :</span></dt><dd>atmosphere_mass_content_of_cloud_liquid_water</dd><dt><span>description :</span></dt><dd>Calculated as the mass of  cloud liquid water in the grid cell divided by the mass of air (including the water in all phases) in the grid cell.  This includes precipitating hydrometeors ONLY if the precipitating hydrometeors affect the calculation of radiative transfer in model.</dd><dt><span>history :</span></dt><dd>05/03/2023 19:58:55Z altered by F. Hellmuth: Interpolate data from hybrid-sigma levels to isobaric levels with P=a*p0 + b*psfc. Calculate lwp with hydrostatic equation.</dd><dt><span>cell_measures :</span></dt><dd>area: areacella</dd><dt><span>mipTable :</span></dt><dd></dd><dt><span>out_name :</span></dt><dd>lwp</dd><dt><span>title :</span></dt><dd>Liquid Water Path</dd><dt><span>variable_id :</span></dt><dd>lwp</dd><dt><span>original_units :</span></dt><dd>kg/kg</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 51.33 MiB </td>
                        <td> 25.66 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (1460, 48, 96) </td>
                        <td> (1460, 24, 96) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 5 Graph Layers </td>
                        <td> 2 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float64 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="166" height="152" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="15" x2="80" y2="86" />
  <line x1="10" y1="31" x2="80" y2="102" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="31" style="stroke-width:2" />
  <line x1="80" y1="70" x2="80" y2="102" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,102.52923018415719 10.0,31.940994890039534" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="46" y2="0" style="stroke-width:2" />
  <line x1="80" y1="70" x2="116" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="46" y1="0" x2="116" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 46.16508283116066,0.0 116.75331812527831,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="116" y2="70" style="stroke-width:2" />
  <line x1="80" y1="86" x2="116" y2="86" />
  <line x1="80" y1="102" x2="116" y2="102" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="102" style="stroke-width:2" />
  <line x1="116" y1="70" x2="116" y2="102" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 116.75331812527831,70.58823529411765 116.75331812527831,102.52923018415719 80.58823529411765,102.52923018415719" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="98.670777" y="122.529230" font-size="1.0rem" font-weight="100" text-anchor="middle" >96</text>
  <text x="136.753318" y="86.558733" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,136.753318,86.558733)">48</text>
  <text x="35.294118" y="87.235113" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,87.235113)">1460</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>pr</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(1460, 24, 96), meta=np.ndarray&gt;</div><input id='attrs-fe4f0ba6-07de-46ab-8d5c-4157c55ab955' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-fe4f0ba6-07de-46ab-8d5c-4157c55ab955' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1f6c2028-e2c7-4367-bf7d-0af631129125' class='xr-var-data-in' type='checkbox'><label for='data-1f6c2028-e2c7-4367-bf7d-0af631129125' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Precipitation</dd><dt><span>units :</span></dt><dd>kg m-2 h-1</dd><dt><span>online_operation :</span></dt><dd>average</dd><dt><span>cell_methods :</span></dt><dd>area: time: mean</dd><dt><span>interval_operation :</span></dt><dd>1800 s</dd><dt><span>interval_write :</span></dt><dd>1 d</dd><dt><span>standard_name :</span></dt><dd>Precipitation flux per hour</dd><dt><span>description :</span></dt><dd>at surface; includes both liquid and solid phases from all types of clouds (both large-scale and convective)</dd><dt><span>history :</span></dt><dd>05/03/2023 19:58:55Z altered by F. Hellmuth: Converted units from &#x27;kg m-2 s-1&#x27; to &#x27;kg m-2 h-1&#x27;.</dd><dt><span>cell_measures :</span></dt><dd>area: areacella</dd><dt><span>comment :</span></dt><dd>At surface; includes precipitation of all forms of water in the solid phase</dd><dt><span>original_units :</span></dt><dd>kg m-2 s-1</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 25.66 MiB </td>
                        <td> 12.83 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (1460, 48, 96) </td>
                        <td> (1460, 24, 96) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 5 Graph Layers </td>
                        <td> 2 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float32 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="166" height="152" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="15" x2="80" y2="86" />
  <line x1="10" y1="31" x2="80" y2="102" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="31" style="stroke-width:2" />
  <line x1="80" y1="70" x2="80" y2="102" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,102.52923018415719 10.0,31.940994890039534" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="46" y2="0" style="stroke-width:2" />
  <line x1="80" y1="70" x2="116" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="46" y1="0" x2="116" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 46.16508283116066,0.0 116.75331812527831,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="116" y2="70" style="stroke-width:2" />
  <line x1="80" y1="86" x2="116" y2="86" />
  <line x1="80" y1="102" x2="116" y2="102" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="102" style="stroke-width:2" />
  <line x1="116" y1="70" x2="116" y2="102" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 116.75331812527831,70.58823529411765 116.75331812527831,102.52923018415719 80.58823529411765,102.52923018415719" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="98.670777" y="122.529230" font-size="1.0rem" font-weight="100" text-anchor="middle" >96</text>
  <text x="136.753318" y="86.558733" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,136.753318,86.558733)">48</text>
  <text x="35.294118" y="87.235113" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,87.235113)">1460</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>prsn</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(1460, 24, 96), meta=np.ndarray&gt;</div><input id='attrs-e27f6cb2-5cb8-45e6-93ff-8e0e4d6abdcd' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-e27f6cb2-5cb8-45e6-93ff-8e0e4d6abdcd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c7dbf387-3bba-4987-ae53-cb8af41e1bd0' class='xr-var-data-in' type='checkbox'><label for='data-c7dbf387-3bba-4987-ae53-cb8af41e1bd0' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Snowfall Flux</dd><dt><span>units :</span></dt><dd>kg m-2 h-1</dd><dt><span>online_operation :</span></dt><dd>average</dd><dt><span>cell_methods :</span></dt><dd>area: time: mean</dd><dt><span>interval_operation :</span></dt><dd>1800 s</dd><dt><span>interval_write :</span></dt><dd>1 d</dd><dt><span>standard_name :</span></dt><dd>Total snowfall per hour</dd><dt><span>description :</span></dt><dd>at surface; includes precipitation of all forms of water in the solid phase</dd><dt><span>history :</span></dt><dd>05/03/2023 19:58:55Z altered by F. Hellmuth: Converted units from &#x27;kg m-2 s-1&#x27; to &#x27;kg m-2 h-1&#x27;.</dd><dt><span>cell_measures :</span></dt><dd>area: areacella</dd><dt><span>comment :</span></dt><dd>At surface; includes precipitation of all forms of water in the solid phase</dd><dt><span>original_units :</span></dt><dd>kg m-2 s-1</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 25.66 MiB </td>
                        <td> 12.83 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (1460, 48, 96) </td>
                        <td> (1460, 24, 96) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 5 Graph Layers </td>
                        <td> 2 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float32 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="166" height="152" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="15" x2="80" y2="86" />
  <line x1="10" y1="31" x2="80" y2="102" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="31" style="stroke-width:2" />
  <line x1="80" y1="70" x2="80" y2="102" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,102.52923018415719 10.0,31.940994890039534" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="46" y2="0" style="stroke-width:2" />
  <line x1="80" y1="70" x2="116" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="46" y1="0" x2="116" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 46.16508283116066,0.0 116.75331812527831,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="116" y2="70" style="stroke-width:2" />
  <line x1="80" y1="86" x2="116" y2="86" />
  <line x1="80" y1="102" x2="116" y2="102" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="102" style="stroke-width:2" />
  <line x1="116" y1="70" x2="116" y2="102" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 116.75331812527831,70.58823529411765 116.75331812527831,102.52923018415719 80.58823529411765,102.52923018415719" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="98.670777" y="122.529230" font-size="1.0rem" font-weight="100" text-anchor="middle" >96</text>
  <text x="136.753318" y="86.558733" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,136.753318,86.558733)">48</text>
  <text x="35.294118" y="87.235113" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,87.235113)">1460</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>tas</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(1460, 24, 96), meta=np.ndarray&gt;</div><input id='attrs-f0a5c55c-7383-4c86-9a34-af5443e62178' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-f0a5c55c-7383-4c86-9a34-af5443e62178' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-69069fe0-c690-47df-83c4-3490551f76e2' class='xr-var-data-in' type='checkbox'><label for='data-69069fe0-c690-47df-83c4-3490551f76e2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>online_operation :</span></dt><dd>average</dd><dt><span>cell_methods :</span></dt><dd>area: time: mean</dd><dt><span>interval_operation :</span></dt><dd>1800 s</dd><dt><span>interval_write :</span></dt><dd>1 d</dd><dt><span>standard_name :</span></dt><dd>air_temperature</dd><dt><span>description :</span></dt><dd>near-surface (usually, 2 meter) air temperature</dd><dt><span>long_name :</span></dt><dd>Near-Surface Air Temperature</dd><dt><span>history :</span></dt><dd>none</dd><dt><span>units :</span></dt><dd>K</dd><dt><span>cell_measures :</span></dt><dd>area: areacella</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 25.66 MiB </td>
                        <td> 12.83 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (1460, 48, 96) </td>
                        <td> (1460, 24, 96) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 5 Graph Layers </td>
                        <td> 2 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float32 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="166" height="152" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="15" x2="80" y2="86" />
  <line x1="10" y1="31" x2="80" y2="102" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="31" style="stroke-width:2" />
  <line x1="80" y1="70" x2="80" y2="102" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,102.52923018415719 10.0,31.940994890039534" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="46" y2="0" style="stroke-width:2" />
  <line x1="80" y1="70" x2="116" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="46" y1="0" x2="116" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 46.16508283116066,0.0 116.75331812527831,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="116" y2="70" style="stroke-width:2" />
  <line x1="80" y1="86" x2="116" y2="86" />
  <line x1="80" y1="102" x2="116" y2="102" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="102" style="stroke-width:2" />
  <line x1="116" y1="70" x2="116" y2="102" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 116.75331812527831,70.58823529411765 116.75331812527831,102.52923018415719 80.58823529411765,102.52923018415719" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="98.670777" y="122.529230" font-size="1.0rem" font-weight="100" text-anchor="middle" >96</text>
  <text x="136.753318" y="86.558733" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,136.753318,86.558733)">48</text>
  <text x="35.294118" y="87.235113" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,87.235113)">1460</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>twp</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(1460, 24, 96), meta=np.ndarray&gt;</div><input id='attrs-484d985b-b93e-480d-9723-065cfa90af76' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-484d985b-b93e-480d-9723-065cfa90af76' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ba7efac3-17d8-4df1-b29c-e724313b4bab' class='xr-var-data-in' type='checkbox'><label for='data-ba7efac3-17d8-4df1-b29c-e724313b4bab' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Daily average Liquid Water Path</dd><dt><span>units :</span></dt><dd>kg m-2</dd><dt><span>online_operation :</span></dt><dd>average</dd><dt><span>cell_methods :</span></dt><dd>area: time: mean</dd><dt><span>interval_operation :</span></dt><dd>1800 s</dd><dt><span>interval_write :</span></dt><dd>1 d</dd><dt><span>standard_name :</span></dt><dd>atmosphere_mass_content_of_cloud_liquid_water</dd><dt><span>description :</span></dt><dd>Calculated as the mass of  cloud liquid water in the grid cell divided by the mass of air (including the water in all phases) in the grid cell.  This includes precipitating hydrometeors ONLY if the precipitating hydrometeors affect the calculation of radiative transfer in model.</dd><dt><span>history :</span></dt><dd>05/03/2023 19:58:55Z altered by F. Hellmuth: Interpolate data from hybrid-sigma levels to isobaric levels with P=a*p0 + b*psfc. Calculate lwp with hydrostatic equation.</dd><dt><span>cell_measures :</span></dt><dd>area: areacella</dd><dt><span>mipTable :</span></dt><dd></dd><dt><span>out_name :</span></dt><dd>lwp</dd><dt><span>title :</span></dt><dd>Liquid Water Path</dd><dt><span>variable_id :</span></dt><dd>lwp</dd><dt><span>original_units :</span></dt><dd>kg/kg</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 51.33 MiB </td>
                        <td> 25.66 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (1460, 48, 96) </td>
                        <td> (1460, 24, 96) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 11 Graph Layers </td>
                        <td> 2 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float64 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="166" height="152" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="15" x2="80" y2="86" />
  <line x1="10" y1="31" x2="80" y2="102" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="31" style="stroke-width:2" />
  <line x1="80" y1="70" x2="80" y2="102" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,102.52923018415719 10.0,31.940994890039534" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="46" y2="0" style="stroke-width:2" />
  <line x1="80" y1="70" x2="116" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="46" y1="0" x2="116" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 46.16508283116066,0.0 116.75331812527831,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="116" y2="70" style="stroke-width:2" />
  <line x1="80" y1="86" x2="116" y2="86" />
  <line x1="80" y1="102" x2="116" y2="102" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="102" style="stroke-width:2" />
  <line x1="116" y1="70" x2="116" y2="102" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 116.75331812527831,70.58823529411765 116.75331812527831,102.52923018415719 80.58823529411765,102.52923018415719" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="98.670777" y="122.529230" font-size="1.0rem" font-weight="100" text-anchor="middle" >96</text>
  <text x="136.753318" y="86.558733" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,136.753318,86.558733)">48</text>
  <text x="35.294118" y="87.235113" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,87.235113)">1460</text>
</svg>
        </td>
    </tr>
</table></div></li></ul></div></li><li class='xr-section-item'><input id='section-a8c8a923-f506-41f0-ba5c-1393544966f1' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-a8c8a923-f506-41f0-ba5c-1393544966f1' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dset_dict_lcc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">dset_dict_lcc_2t</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">dset_dict_lcc_2t_season</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">dset_dict_lcc_2t_sf</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">th_days_lcc_2t</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">th_days_sf</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">dset_dict_lcc_2t_sf_season</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

    <span class="c1"># 1. find where liquid water &gt;= 0.005 kgm-2 or &gt;= threshold</span>
    <span class="n">th_lcc</span> <span class="o">=</span> <span class="mf">0.005</span>
    <span class="n">dset_dict_lcc</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">th_lcc</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="c1"># find where 2m-temperature &lt;= 0C or &lt;= threshold</span>
    <span class="c1"># This should automatically assume that it is already only snow, but it could include supercooled </span>
    <span class="c1"># rain in the case of total precipitation</span>
    <span class="n">th_2t</span> <span class="o">=</span> <span class="mf">273.15</span>
    <span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset_dict_lcc</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">th_2t</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="c1"># amount of freezing rain</span>
    <span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;pr&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;prsn&#39;</span><span class="p">])</span>
    <span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2 h-1&#39;</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Mean freezing rain rate&#39;</span><span class="p">}</span>

    <span class="c1"># # if we want a precip or snowfall threshold apply here</span>
    <span class="c1"># # find where total precipitation &gt;0 kgm-2h-1 threshold in these liquid containg clouds</span>
    <span class="c1"># # th_tp = 0.01</span>
    <span class="c1"># # dset_dict_lcc_2t = dset_dict_lcc_2t.where(dset_dict[&#39;pr&#39;]&gt;=th_tp, other=np.nan) </span>
    <span class="c1"># # 2.1 find where snowfall &gt;= 0.24 mmday-1 or &gt;= threshold in these liquid containing clouds, but not temperature threshold</span>
    <span class="c1"># # multiply by 24 to make it comparable to McIllhattan et al. As they use 0.01mmh-1 as lower threshold</span>
    <span class="c1"># # applying snowfall days, based on threshold (th_sf). Gives days where snowfall above th_sf and counts days in season and </span>
    <span class="c1"># # devides by season days</span>
    <span class="c1"># th_sf = 0.01</span>
    <span class="c1"># dset_dict_lcc_2t_sf = dset_dict_lcc_2t.where(dset_dict[&#39;msr&#39;]&gt;=th_sf, other=np.nan) </span>
    <span class="c1"># # th_days = (dset_dict_lcc_2t_sf[&#39;twp&#39;].groupby(&#39;time.season&#39;).count(dim=&#39;time&#39;,keep_attrs=False))/days_season</span>


    <span class="c1"># create dataset to use for calculating the precipitation efficency. For the precipitation efficency we want to remove th_frac </span>
    <span class="c1"># days where liquid water content and temperature requirements are met. </span>
    <span class="c1"># assign percent of snowfall days, required in a pixle, which should be included in the statistics</span>
    <span class="n">th_frac</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">th_days_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span><span class="o">/</span><span class="n">days_season</span>

    <span class="n">dset_dict_lcc_2t_season</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dset_dict_lcc_2t_season</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t_season</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">)</span>

    <span class="c1"># for all the other statistics we want to remove th_frac days where liquid content, temperature, and snowfall requirements are met</span>
    <span class="c1"># which also means we have to apply the threshold for the total precipitation</span>
    <span class="c1"># find where total precipitation &gt;= 0.01 kg m-2 h-1 in LCCs with T2&lt;0C</span>
    <span class="n">th_tp</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">dset_dict_lcc_2t_sf</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;pr&#39;</span><span class="p">]</span> <span class="o">&gt;=</span><span class="n">th_tp</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="c1"># find where snowfall &gt;= 0.01 kg m-2 h-1 or &gt;= threshold in these liquid containing clouds. </span>
    <span class="n">th_sf</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">dset_dict_lcc_2t_sf</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t_sf</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset_dict_lcc_2t_sf</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;prsn&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">th_sf</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="c1"># applying snowfall days, based on threshold (th_sf). Gives days where snowfall above th_sf and counts days in season and devides </span>
    <span class="c1"># by season days</span>
    <span class="n">th_days_sf</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dset_dict_lcc_2t_sf</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span><span class="o">/</span><span class="n">days_season</span>
    <span class="n">dset_dict_lcc_2t_sf_season</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t_sf</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dset_dict_lcc_2t_sf_season</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t_season</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_sf</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">)</span>
    <span class="n">dset_dict_lcc_2t_sf_season</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dset_dict_lcc_2t_days</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

    <span class="c1"># Now create daily dataset based on seasonal supercooled liquid containing cloud days above th_sf, and th_frac</span>
    <span class="n">_mam</span> <span class="o">=</span> <span class="p">((</span><span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="s1">&#39;MAM&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>
    <span class="n">_jja</span> <span class="o">=</span> <span class="p">((</span><span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="s1">&#39;JJA&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>
    <span class="n">_son</span> <span class="o">=</span> <span class="p">((</span><span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">)))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="s1">&#39;SON&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>
    <span class="n">_djf</span> <span class="o">=</span> <span class="p">((</span><span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> 
                    <span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="s1">&#39;DJF&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>

    <span class="n">dset_dict_lcc_2t_days</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">objects</span><span class="o">=</span><span class="p">[</span><span class="n">_djf</span><span class="p">,</span> <span class="n">_jja</span><span class="p">,</span> <span class="n">_mam</span><span class="p">,</span> <span class="n">_son</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dset_dict_lcc_2t_sf_days</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="c1"># Now create daily dataset based on seasonal supercooled liquid containing cloud days above th_sf, and th_frac</span>
    <span class="n">_mam</span> <span class="o">=</span> <span class="p">((</span><span class="n">dset_dict_lcc_2t_sf</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">dset_dict_lcc_2t_sf</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_sf</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="s1">&#39;MAM&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>
    <span class="n">_jja</span> <span class="o">=</span> <span class="p">((</span><span class="n">dset_dict_lcc_2t_sf</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">dset_dict_lcc_2t_sf</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_sf</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="s1">&#39;JJA&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>
    <span class="n">_son</span> <span class="o">=</span> <span class="p">((</span><span class="n">dset_dict_lcc_2t_sf</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">dset_dict_lcc_2t_sf</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">)))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_sf</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="s1">&#39;SON&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>
    <span class="n">_djf</span> <span class="o">=</span> <span class="p">((</span><span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dset_dict_lcc_2t_sf</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">dset_dict_lcc_2t_sf</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> 
                    <span class="n">dset_dict_lcc_2t_sf</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">dset_dict_lcc_2t_sf</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_sf</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="s1">&#39;DJF&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>

    <span class="n">dset_dict_lcc_2t_sf_days</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">objects</span><span class="o">=</span><span class="p">[</span><span class="n">_djf</span><span class="p">,</span> <span class="n">_jja</span><span class="p">,</span> <span class="n">_mam</span><span class="p">,</span> <span class="n">_son</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># def find_precip_cloud(dset):</span>
<span class="c1">#     # 1. find where LWP &gt;=5 gm-2</span>
<span class="c1">#     sf = dset[&#39;prsn&#39;].where(dset[&#39;lwp&#39;]&gt;=0.005, other=np.nan)</span>
<span class="c1">#     lwp = dset[&#39;lwp&#39;].where(dset[&#39;lwp&#39;]&gt;=0.005, other=np.nan)</span>
<span class="c1">#     iwp = dset[&#39;clivi&#39;].where(dset[&#39;lwp&#39;]&gt;=0.005, other=np.nan)</span>
<span class="c1">#     twp = dset[&#39;twp&#39;].where(dset[&#39;lwp&#39;]&gt;=0.005, other=np.nan)</span>
<span class="c1">#     t2 = dset[&#39;tas&#39;].where(dset[&#39;lwp&#39;]&gt;=0.005, other=np.nan)</span>
    
<span class="c1">#     # print(1,&#39;sf&#39;, sf.min(skipna=True).values, sf.max(skipna=True).values, &#39;lwp&#39;, lwp.min(skipna=True).values, lwp.max(skipna=True).values, &#39;t2&#39;, t2.min(skipna=True).values, t2.max(skipna=True).values)</span>
<span class="c1">#     # 2. find where snowfall &gt;= 0.01mms-1</span>
<span class="c1">#     unit_sf = dset[&#39;prsn&#39;]</span>
<span class="c1">#     sf = sf.where(unit_sf&gt;=0.01*24, other=np.nan)</span>
<span class="c1">#     lwp = lwp.where(unit_sf&gt;=0.01*24, other=np.nan)</span>
<span class="c1">#     iwp = iwp.where(unit_sf&gt;=0.01*24, other=np.nan)</span>
<span class="c1">#     twp = twp.where(unit_sf&gt;0.01*24, other=np.nan)</span>
<span class="c1">#     t2 = t2.where(unit_sf&gt;=0.01*24, other=np.nan)</span>
<span class="c1">#     # print(2,&#39;sf&#39;, sf.min(skipna=True).values, sf.max(skipna=True).values, &#39;lwp&#39;, lwp.min(skipna=True).values, lwp.max(skipna=True).values, &#39;t2&#39;, t2.min(skipna=True).values, t2.max(skipna=True).values)</span>
    
<span class="c1">#     # 3. find where 2m-temperature &lt;= 0C</span>
<span class="c1">#     sf = sf.where(dset[&#39;tas&#39;]&lt;=273.15, other=np.nan)</span>
<span class="c1">#     lwp = lwp.where(dset[&#39;tas&#39;]&lt;=273.15, other=np.nan)</span>
<span class="c1">#     iwp = iwp.where(dset[&#39;tas&#39;]&lt;=273.15, other=np.nan)</span>
<span class="c1">#     twp = twp.where(dset[&#39;tas&#39;]&lt;=273.15, other=np.nan)</span>
<span class="c1">#     t2 = t2.where(dset[&#39;tas&#39;]&lt;=273.15, other=np.nan)</span>
<span class="c1">#     # print(3,&#39;sf&#39;, sf.min(skipna=True).values, sf.max(skipna=True).values, &#39;lwp&#39;, lwp.min(skipna=True).values, lwp.max(skipna=True).values, &#39;t2&#39;, t2.min(skipna=True).values, t2.max(skipna=True).values)</span>
    
<span class="c1">#     sf_count = sf.groupby(&#39;time.season&#39;).count(dim=&#39;time&#39;,keep_attrs=True)</span>
<span class="c1">#     # lwp_count = lwp.groupby(&#39;time.season&#39;).count(dim=&#39;time&#39;,keep_attrs=True)</span>
<span class="c1">#     # iwp_count = iwp.groupby(&#39;time.season&#39;).count(dim=&#39;time&#39;, keep_attrs=True)</span>
<span class="c1">#     # t2_count = t2.groupby(&#39;time.season&#39;).count(dim=&#39;time&#39;, keep_attrs=True)</span>
    
<span class="c1">#     return(sf_count, sf, iwp, lwp, twp)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="how-often-do-we-have-slc-with-thresholds-for-surface-snowfall-liquid-water-path-and-temperature">
<h2>How often do we have SLC with thresholds for surface snowfall, liquid water path, and temperature<a class="headerlink" href="#how-often-do-we-have-slc-with-thresholds-for-surface-snowfall-liquid-water-path-and-temperature" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cumm</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

    <span class="c1"># create dataset with all cumm</span>
    <span class="n">cumm</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
    <span class="c1"># count the days per season when there was a LCC, and 2t&lt;=0C, and where 10% per season a lcc cloud existed when also the surface temp was below freezing</span>
    <span class="n">cumm</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_days&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dset_dict_lcc_2t_days</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span><span class="o">/</span><span class="n">days_season</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">cumm</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">cumm</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
        <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">cumm</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
        <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">cumm</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    
        
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_cum_lcc_days_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
    <span class="n">fct</span><span class="o">.</span><span class="n">plt_seasonal_NH_SH</span><span class="p">((</span><span class="n">cumm</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cumm</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_days&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">cbar_label</span><span class="o">=</span><span class="s1">&#39;Frequency of liquid containing cloud days (%)&#39;</span><span class="p">,</span> <span class="n">plt_title</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">),</span> <span class="n">extend</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="n">cumm</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_days&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dset_dict_lcc_2t_sf_days</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span><span class="o">/</span><span class="n">days_season</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">cumm</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">cumm</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
        <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">cumm</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
        <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">cumm</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_cum_sf_days_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
    <span class="n">fct</span><span class="o">.</span><span class="n">plt_seasonal_NH_SH</span><span class="p">((</span><span class="n">cumm</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cumm</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_days&#39;</span><span class="p">]</span> <span class="o">&gt;</span><span class="mf">0.</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">cbar_label</span><span class="o">=</span><span class="s1">&#39;Frequency of snowfall days from LCCs (%)&#39;</span><span class="p">,</span> <span class="n">plt_title</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">),</span> <span class="n">extend</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MIROC6 min: 0.0 max: 0.25 std: 0.064 mean: 0.031
MIROC6 min: 0.0 max: 0.236 std: 0.043 mean: 0.014
CESM2 min: 0.0 max: 0.84 std: 0.047 mean: 0.004
CESM2 min: 0.0 max: 0.0 std: 0.0 mean: 0.0
CanESM5 min: 0.0 max: 0.928 std: 0.246 mean: 0.223
CanESM5 min: 0.0 max: 0.719 std: 0.181 mean: 0.15
AWI-ESM-1-1-LR min: 0.0 max: 0.25 std: 0.081 mean: 0.054
AWI-ESM-1-1-LR min: 0.0 max: 0.201 std: 0.027 mean: 0.006
MPI-ESM1-2-LR min: 0.0 max: 0.973 std: 0.304 mean: 0.246
MPI-ESM1-2-LR min: 0.0 max: 0.679 std: 0.138 mean: 0.098
IPSL-CM5A2-INCA min: 0.0 max: 0.931 std: 0.243 mean: 0.191
IPSL-CM5A2-INCA min: 0.0 max: 0.919 std: 0.232 mean: 0.179
</pre></div>
</div>
<img alt="../_images/dd9175e4800cc57d9ffb051ff11a67fcb205449fcafd3c647bd96f42e5ce969a.png" src="../_images/dd9175e4800cc57d9ffb051ff11a67fcb205449fcafd3c647bd96f42e5ce969a.png" />
<img alt="../_images/d4d96eed47beba9903a7c8520f5a7065f55f9802e904332331c791b7a98ecfbb.png" src="../_images/d4d96eed47beba9903a7c8520f5a7065f55f9802e904332331c791b7a98ecfbb.png" />
<img alt="../_images/d2efe8d10fc677d910f2ae177b81557327d33bcfec6b676d23e08b1a193d09ad.png" src="../_images/d2efe8d10fc677d910f2ae177b81557327d33bcfec6b676d23e08b1a193d09ad.png" />
<img alt="../_images/3aac050b9a5df9d69aacf57fa33405f0e6b464432c7d5fba68ed2168c875b8fd.png" src="../_images/3aac050b9a5df9d69aacf57fa33405f0e6b464432c7d5fba68ed2168c875b8fd.png" />
<img alt="../_images/c7577328796c8a24a98fdcc0b328294bdc075c63e366dc85ef4a040a6fd03586.png" src="../_images/c7577328796c8a24a98fdcc0b328294bdc075c63e366dc85ef4a040a6fd03586.png" />
<img alt="../_images/58be859327a4e61fc94c5d437f455748e34bc5e8b815c7c1f01496a6ad0550f5.png" src="../_images/58be859327a4e61fc94c5d437f455748e34bc5e8b815c7c1f01496a6ad0550f5.png" />
<img alt="../_images/b1488c3aed3c431a383f18e8d63a65352e92288e485c8932b2683d070bf9e068.png" src="../_images/b1488c3aed3c431a383f18e8d63a65352e92288e485c8932b2683d070bf9e068.png" />
<img alt="../_images/fb3e3c9b65509e1ba46e96052a5cba6eb5a7f08cddd86fcbb5fdf1f8c18f6271.png" src="../_images/fb3e3c9b65509e1ba46e96052a5cba6eb5a7f08cddd86fcbb5fdf1f8c18f6271.png" />
<img alt="../_images/889cc7f40448db189c2115ec64d34b464a44be008cc67efda9317a606011dd90.png" src="../_images/889cc7f40448db189c2115ec64d34b464a44be008cc67efda9317a606011dd90.png" />
<img alt="../_images/492a3d2cf9a8bf68c6646bb3b468b2d862b22b6898d6e7c04017d82fa67374e0.png" src="../_images/492a3d2cf9a8bf68c6646bb3b468b2d862b22b6898d6e7c04017d82fa67374e0.png" />
<img alt="../_images/f2d87978cdab159d8cb91a84955727d9cd2cd0da16e973342cabdc5dd49a5a4f.png" src="../_images/f2d87978cdab159d8cb91a84955727d9cd2cd0da16e973342cabdc5dd49a5a4f.png" />
<img alt="../_images/fc11b37e0812c9ee814cea453038403a9d95ab485d3ddd376a5d332c69242fa1.png" src="../_images/fc11b37e0812c9ee814cea453038403a9d95ab485d3ddd376a5d332c69242fa1.png" />
</div>
</div>
</section>
<section id="liquid-containing-cloud-frequency">
<h2>Liquid containing cloud frequency<a class="headerlink" href="#liquid-containing-cloud-frequency" title="Permalink to this heading">#</a></h2>
<p>Relative frequency</p>
<div class="math notranslate nohighlight">
\[RF = \frac{f}{n} = \frac{\text{number of times the data occurred in an observation}}{\text{total frequency}}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratios</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
    <span class="c1"># relative frequency of liquid containing clouds per season</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t_days</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># number of times a super cooled liquid water cloud occured when the liquid water path is larger than 5gm-2, and temperature below 0degC</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">dset_dict_lcc</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>         <span class="c1"># frequency of liquid clouds (only LWP threshold applied) when lwp is larger than 5gm-2</span>

    <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">n</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
        <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
        <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    
    <span class="n">fct</span><span class="o">.</span><span class="n">plt_seasonal_NH_SH</span><span class="p">((</span><span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_season&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;Liquid containing cloud frequency (%)&#39;</span><span class="p">,</span> <span class="n">plt_title</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">),</span> <span class="n">extend</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_rf_lcc_wo_snow_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># relative frequency of liquid containing clouds per month</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t_days</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># number of times a super cooled liquid water cloud occured when the liquid water path is larger than 5gm-2, and temperature below 0degC</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">dset_dict_lcc</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>         <span class="c1"># frequency of liquid clouds (only LWP threshold applied) when lwp is larger than 5gm-2</span>

    <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">n</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
        <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
        <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>min: 0.0 max: 1.0 std: 0.367 mean: 0.186
min: 0.0 max: 1.0 std: 0.377 mean: 0.193
min: 0.0 max: 1.0 std: 0.112 mean: 0.013
min: 0.0 max: 1.0 std: 0.113 mean: 0.013
min: 0.0 max: 1.0 std: 0.443 mean: 0.473
min: 0.0 max: 1.0 std: 0.458 mean: 0.493
min: 0.0 max: 1.0 std: 0.454 mean: 0.364
min: 0.0 max: 1.0 std: 0.466 mean: 0.379
min: 0.0 max: 1.0 std: 0.449 mean: 0.472
min: 0.0 max: 1.0 std: 0.463 mean: 0.486
min: 0.0 max: 1.0 std: 0.425 mean: 0.43
min: 0.0 max: 1.0 std: 0.447 mean: 0.449
</pre></div>
</div>
<img alt="../_images/6fce2440fe1759da3f8a42581f797d769a4c20af670432cba7a90e64be3f6cc1.png" src="../_images/6fce2440fe1759da3f8a42581f797d769a4c20af670432cba7a90e64be3f6cc1.png" />
<img alt="../_images/6c7470a559ca4fb1fd4f4fbcde35db923ccbfa3dad6276645b411ef319953b45.png" src="../_images/6c7470a559ca4fb1fd4f4fbcde35db923ccbfa3dad6276645b411ef319953b45.png" />
<img alt="../_images/803e471c115f7517e77c7d0f1d4a201a74b6ac9331818c3970d751c84a96d99a.png" src="../_images/803e471c115f7517e77c7d0f1d4a201a74b6ac9331818c3970d751c84a96d99a.png" />
<img alt="../_images/fe5ef6f8b90425487326af5992cab46ee961e9ea68144ce946c8c2fbb45e45af.png" src="../_images/fe5ef6f8b90425487326af5992cab46ee961e9ea68144ce946c8c2fbb45e45af.png" />
<img alt="../_images/1c7a3f748e299a4d09f5680cea89ea76fc042f80e196b042d48cc4402275fc4d.png" src="../_images/1c7a3f748e299a4d09f5680cea89ea76fc042f80e196b042d48cc4402275fc4d.png" />
<img alt="../_images/217c4d91fef496d3893ce075e1b16615e24c1f795719161fb2b10a8b542b88cb.png" src="../_images/217c4d91fef496d3893ce075e1b16615e24c1f795719161fb2b10a8b542b88cb.png" />
</div>
</div>
</section>
<section id="masked-and-weighted-average">
<h2>Masked and weighted average<a class="headerlink" href="#masked-and-weighted-average" title="Permalink to this heading">#</a></h2>
<p>Make use of the <code class="docutils literal notranslate"><span class="pre">xarray</span></code> function <code class="docutils literal notranslate"><span class="pre">weighted</span></code>, but use the weights from CMIP6.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NH_mean</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">SH_mean</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">NH_std</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">SH_std</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">weights</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">NH_mean</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
    <span class="n">SH_mean</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>

    <span class="n">NH_std</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
    <span class="n">SH_std</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>

    <span class="c1"># Grid cells have different area, so when we do the global average, they have to be weigted by the area of each grid cell.</span>
    <span class="c1"># weights[model] = fct.area_grid(ratios[&#39;lat&#39;].values, ratios[&#39;lon&#39;].values)</span>
    <span class="n">weights</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">areacella</span>

    <span class="n">NH_mean</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
    <span class="n">SH_mean</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>

    <span class="n">NH_std</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
    <span class="n">SH_std</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<section id="annual-cycle-of-frequency-of-liquid-containing-clouds">
<h3>Annual cycle of frequency of liquid containing clouds<a class="headerlink" href="#annual-cycle-of-frequency-of-liquid-containing-clouds" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

    <span class="n">fct</span><span class="o">.</span><span class="n">plt_annual_cycle</span><span class="p">(</span><span class="n">NH_mean</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">],</span> 
                         <span class="n">SH_mean</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">],</span> 
                         <span class="n">NH_std</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">],</span> 
                         <span class="n">SH_std</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">],</span> 
                         <span class="s1">&#39;Liquid containing cloud frequency&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">))</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_rf_lcc_wo_snow_annual_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f0493904ce54372d8f2c550bbe7d1db704dcdd5d7b562e174c02d7c56a59044b.png" src="../_images/f0493904ce54372d8f2c550bbe7d1db704dcdd5d7b562e174c02d7c56a59044b.png" />
<img alt="../_images/6bfa17ce1ea4adf3badca754fa8ced7e63268d3bac270d86077ae5cccf035020.png" src="../_images/6bfa17ce1ea4adf3badca754fa8ced7e63268d3bac270d86077ae5cccf035020.png" />
<img alt="../_images/a48ffbc618975e13bd63689a4cfe0216883a1fa66bdb3a1876899416b99c6b9f.png" src="../_images/a48ffbc618975e13bd63689a4cfe0216883a1fa66bdb3a1876899416b99c6b9f.png" />
<img alt="../_images/6536cd4a60eae274138024655266f9805bdb73b4351ae49c5e6222a276f3ebba.png" src="../_images/6536cd4a60eae274138024655266f9805bdb73b4351ae49c5e6222a276f3ebba.png" />
<img alt="../_images/be3060e77d4a47e7249b5e9fa0fc0a267fc2679f1327936ba0afbec38ceb0103.png" src="../_images/be3060e77d4a47e7249b5e9fa0fc0a267fc2679f1327936ba0afbec38ceb0103.png" />
<img alt="../_images/ef2d3005876179e8c3f8be97ca600192ceddb13de6912fad8fadff8185f0e512.png" src="../_images/ef2d3005876179e8c3f8be97ca600192ceddb13de6912fad8fadff8185f0e512.png" />
</div>
</div>
</section>
</section>
<section id="frequency-of-snowfall-from-lccs">
<h2>Frequency of snowfall from LCCs<a class="headerlink" href="#frequency-of-snowfall-from-lccs" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

      <span class="c1"># relative frequency of snowing liquid containing clouds per season</span>
      <span class="n">f</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t_sf_days</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;prsn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># number of times a super cooled liquid water cloud occured when the liquid water path is larger than 5gm-2, and temperature below 0degC</span>
      <span class="n">n</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t_days</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

      <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">n</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
            <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
            <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

      <span class="c1"># </span>
      <span class="n">fct</span><span class="o">.</span><span class="n">plt_seasonal_NH_SH</span><span class="p">((</span><span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_season&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;Frequency of snowfall from LCCs (%)&#39;</span><span class="p">,</span> <span class="n">plt_title</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">),</span> <span class="n">extend</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

      <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_rf_lcc_w_snow_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

      <span class="c1"># relative frequency of liquid containing clouds per month</span>
      <span class="n">f</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t_sf_days</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;prsn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># number of times a super cooled liquid water cloud occured when the liquid water path is larger than 5gm-2, and temperature below 0degC</span>
      <span class="n">n</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t_days</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>         <span class="c1"># frequency of liquid clouds (only LWP threshold applied) when lwp is larger than 5gm-2</span>

      <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">n</span>

      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
            <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
            <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

      <span class="c1"># Grid cells have different area, so when we do the global average, they have to be weigted by the area of each grid cell.</span>
      <span class="n">weights</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">areacella</span>

      <span class="n">NH_mean</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
      <span class="n">SH_mean</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>

      <span class="n">NH_std</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
      <span class="n">SH_std</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>min: 0.0 max: 1.0 std: 0.394 mean: 0.4
min: 0.0 max: 1.0 std: 0.398 mean: 0.394
min: 0.0 max: 0.0 std: 0.0 mean: 0.0
min: 0.0 max: 0.0 std: 0.0 mean: 0.0
min: 0.0 max: 1.0 std: 0.257 mean: 0.637
min: 0.0 max: 1.0 std: 0.272 mean: 0.64
min: 0.0 max: 1.0 std: 0.242 mean: 0.104
min: 0.0 max: 1.0 std: 0.248 mean: 0.104
min: 0.0 max: 0.981 std: 0.241 mean: 0.381
min: 0.0 max: 1.0 std: 0.252 mean: 0.381
min: 0.0 max: 1.0 std: 0.153 mean: 0.917
min: 0.0 max: 1.0 std: 0.157 mean: 0.922
</pre></div>
</div>
<img alt="../_images/12d2de82193031b80ebdc078db176e6ea3999e1d52e06736828fdc091a7dc97a.png" src="../_images/12d2de82193031b80ebdc078db176e6ea3999e1d52e06736828fdc091a7dc97a.png" />
<img alt="../_images/0f6dcbb721b1d7676641f0fa95c655e669274916cf17ced30dba3db49da940c2.png" src="../_images/0f6dcbb721b1d7676641f0fa95c655e669274916cf17ced30dba3db49da940c2.png" />
<img alt="../_images/3b9d34753901db807172e667ac86390a767490fdba09c0c3779f80bfe13d49de.png" src="../_images/3b9d34753901db807172e667ac86390a767490fdba09c0c3779f80bfe13d49de.png" />
<img alt="../_images/17fe1756fd028cd9088687d821cfec6d0f6e731a34f5257632158ca47cabd6d5.png" src="../_images/17fe1756fd028cd9088687d821cfec6d0f6e731a34f5257632158ca47cabd6d5.png" />
<img alt="../_images/f1784b1fe647a8703257d54d3c14156bc75e0fef5fa27407260ac90e66c9534d.png" src="../_images/f1784b1fe647a8703257d54d3c14156bc75e0fef5fa27407260ac90e66c9534d.png" />
<img alt="../_images/b1cf962224ec3a6792f28146fc49a0551d9c9ade01cfdfdd7d94b99464ce532d.png" src="../_images/b1cf962224ec3a6792f28146fc49a0551d9c9ade01cfdfdd7d94b99464ce532d.png" />
</div>
</div>
<section id="annual-cycle-of-frequency-of-snowfall-from-lccs">
<h3>Annual cycle of frequency of snowfall from LCCs<a class="headerlink" href="#annual-cycle-of-frequency-of-snowfall-from-lccs" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

    <span class="n">fct</span><span class="o">.</span><span class="n">plt_annual_cycle</span><span class="p">(</span><span class="n">NH_mean</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">],</span> <span class="n">SH_mean</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">],</span> <span class="n">NH_std</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">],</span> <span class="n">SH_std</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">],</span> <span class="s1">&#39;Frequency of snowfall from LCCs&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">))</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_rf_lcc_wo_snow_annual_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9cc914dd8e86039ea9a1c717063f1dbc13d73c68f87ff26eb0c8c5fb04b2b30f.png" src="../_images/9cc914dd8e86039ea9a1c717063f1dbc13d73c68f87ff26eb0c8c5fb04b2b30f.png" />
<img alt="../_images/1943f61258355dc0fa1b1da88b580840b8d2bf2a730355964906b9e64195e539.png" src="../_images/1943f61258355dc0fa1b1da88b580840b8d2bf2a730355964906b9e64195e539.png" />
<img alt="../_images/7d0885fa52943aec70a450ec35b9cba6d789faa2dc9d1b44b5f859a684a91b1f.png" src="../_images/7d0885fa52943aec70a450ec35b9cba6d789faa2dc9d1b44b5f859a684a91b1f.png" />
<img alt="../_images/b3b74e47c8c9df3bf19bf01aa6ded8604b0d4649d64a7eda1e900136536315a1.png" src="../_images/b3b74e47c8c9df3bf19bf01aa6ded8604b0d4649d64a7eda1e900136536315a1.png" />
<img alt="../_images/d64befd318e83cf7f0b29cfef54bbaffd019d300cb5b7ba04851fde2b896520c.png" src="../_images/d64befd318e83cf7f0b29cfef54bbaffd019d300cb5b7ba04851fde2b896520c.png" />
<img alt="../_images/fdd3cc6ab337276c8504ccd4a0497c4bdd04d90e1639ab28559ef1fc59cf33d6.png" src="../_images/fdd3cc6ab337276c8504ccd4a0497c4bdd04d90e1639ab28559ef1fc59cf33d6.png" />
</div>
</div>
</section>
</section>
<section id="relative-snowfall-efficency">
<h2>Relative snowfall efficency<a class="headerlink" href="#relative-snowfall-efficency" title="Permalink to this heading">#</a></h2>
<p>The precipitation efficiency of convection is a measure of how much of the water that condenses in a rising column of air reaches the surface as precipitation [3].</p>
<p>In our case, we calculate the snowfall efficency by deviding the mean surface snowfall rate (sf, with units kg m-2 h-1) with the column integrated total water path (TWP, with units kg m-2). This leaves us with units of h-1, which means we get a daily mean relative snowfall efficency per hour.</p>
<div class="math notranslate nohighlight">
\[\eta = \frac{sf}{TWP}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

      <span class="c1"># snowfall efficency per season</span>
      <span class="c1"># first averavge over time and then fraction remove weighting only for spatial average</span>

      <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_eff_season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t_season</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;prsn&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">dset_dict_lcc_2t_season</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span>
      <span class="c1"># plt_seasonal_NH_SH(dset_dict_lcc_2t_sf_season[&#39;prsn&#39;]/dset_dict_lcc_2t_sf_season[&#39;twp&#39;], np.arange(0,1, 0.1),&#39;&#39;,&#39;&#39;)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
            <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
            <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

      <span class="n">fct</span><span class="o">.</span><span class="n">plt_seasonal_NH_SH</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_eff_season&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="s1">&#39;relative snowfall eff. (h$^{-1}$)&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">),</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
      <span class="c1"># save precip efficency from mixed-phase clouds figure</span>
      <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_sf_twp_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>min: 0.162 max: 6.483 std: 0.446 mean: 0.777
min: 0.557 max: 0.557 std: 0.0 mean: 0.557
min: 0.01 max: 1.745 std: 0.236 mean: 0.569
min: 0.0 max: 2.899 std: 0.262 mean: 0.425
min: 0.0 max: 2.607 std: 0.273 mean: 0.476
min: 0.14 max: 1.231 std: 0.115 mean: 0.422
</pre></div>
</div>
<img alt="../_images/b1f11fd8418299c7065a338fbbcf44455416d8a5f171afb234c2e7e9361e62cd.png" src="../_images/b1f11fd8418299c7065a338fbbcf44455416d8a5f171afb234c2e7e9361e62cd.png" />
<img alt="../_images/206f8665ead18cb5221040c9d73a6bc74df71feec9f406cd37b43f594a4bac97.png" src="../_images/206f8665ead18cb5221040c9d73a6bc74df71feec9f406cd37b43f594a4bac97.png" />
<img alt="../_images/e0f22a8f5007a2e87ce7a3ee9d7511d8145abb042a7feb9201692ca3ecf2b88d.png" src="../_images/e0f22a8f5007a2e87ce7a3ee9d7511d8145abb042a7feb9201692ca3ecf2b88d.png" />
<img alt="../_images/6346eb79604fb08a5c2a774d5fca4cc231cfce0aaa0a1f8ec58a1efd7329a995.png" src="../_images/6346eb79604fb08a5c2a774d5fca4cc231cfce0aaa0a1f8ec58a1efd7329a995.png" />
<img alt="../_images/37ae30a6ac86e0ee065571579c2930073ce22ce12ba64dfbd967e50710ae7343.png" src="../_images/37ae30a6ac86e0ee065571579c2930073ce22ce12ba64dfbd967e50710ae7343.png" />
<img alt="../_images/3c5a31c7c1306f7489a9ac152d3993437f11fb8c84e9e10e34ab3f343265fa30.png" src="../_images/3c5a31c7c1306f7489a9ac152d3993437f11fb8c84e9e10e34ab3f343265fa30.png" />
</div>
</div>
<section id="annual-cycle-of-relative-snowfall-efficency">
<h3>Annual cycle of relative snowfall efficency<a class="headerlink" href="#annual-cycle-of-relative-snowfall-efficency" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

      <span class="n">f</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;prsn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
      <span class="n">n</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
      <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">n</span>
      <span class="n">NH_mean</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
      <span class="n">SH_mean</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>

      <span class="n">NH_std</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
      <span class="n">SH_std</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>

      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
            <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
            <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

      <span class="c1"># for year in np.unique(dset_dict[&#39;time.year&#39;]):</span>
      <span class="c1">#     # print(year)</span>
      <span class="c1">#     f = dset_dict_lcc_2t[&#39;prsn&#39;].sel(time=slice(str(year))).groupby(&#39;time.month&#39;).sum(dim=&#39;time&#39;, skipna=True, keep_attrs=False)</span>
      <span class="c1">#     n = dset_dict_lcc_2t[&#39;twp&#39;].sel(time=slice(str(year))).groupby(&#39;time.month&#39;).sum(dim=&#39;time&#39;, skipna=True, keep_attrs=False)</span>

      <span class="c1">#     _ratio = f/n</span>
      
      <span class="c1">#     NH_mean[&#39;sf_eff_month_&#39;+str(year)] = _ratio.sel(lat=slice(45,90)).weighted(weights).mean((&#39;lat&#39;, &#39;lon&#39;))</span>
      <span class="c1">#     SH_mean[&#39;sf_eff_month_&#39;+str(year)] = _ratio.sel(lat=slice(-90,-45)).weighted(weights).mean((&#39;lat&#39;, &#39;lon&#39;))</span>
      
      <span class="c1">#     NH_std[&#39;sf_eff_month_&#39;+str(year)] = _ratio.sel(lat=slice(45,90)).weighted(weights).std((&#39;lat&#39;, &#39;lon&#39;))</span>
      <span class="c1">#     SH_std[&#39;sf_eff_month_&#39;+str(year)] = _ratio.sel(lat=slice(-90,-45)).weighted(weights).std((&#39;lat&#39;, &#39;lon&#39;))</span>

      <span class="n">fct</span><span class="o">.</span><span class="n">plt_annual_cycle</span><span class="p">(</span><span class="n">NH_mean</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">],</span> <span class="n">SH_mean</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">],</span> <span class="n">NH_std</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">],</span> <span class="n">SH_std</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">],</span> <span class="s1">&#39;relative snowfall eff. (h$^{-1}$)&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">))</span>
      <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_sf_twp_annual_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>min: 0.0 max: 84.79 std: 1.97 mean: 1.357
min: 0.0 max: 1.504 std: 0.438 mean: 0.316
min: 0.0 max: 5.067 std: 0.284 mean: 0.557
min: 0.0 max: 4.663 std: 0.35 mean: 0.453
min: 0.0 max: 3.122 std: 0.301 mean: 0.464
min: 0.0 max: 1.769 std: 0.172 mean: 0.437
</pre></div>
</div>
<img alt="../_images/b56b77d7f9771508638e4f8353517da6277e7324de4786504e9c9c9f2c260555.png" src="../_images/b56b77d7f9771508638e4f8353517da6277e7324de4786504e9c9c9f2c260555.png" />
<img alt="../_images/618f3dfdad592766363c813727e276caab4e519762e93c87c0cba66d448350de.png" src="../_images/618f3dfdad592766363c813727e276caab4e519762e93c87c0cba66d448350de.png" />
<img alt="../_images/f36ccdda221bc984a5c33c25f07a2d1100a431e5dbcd48330dcd29fa11d0fba7.png" src="../_images/f36ccdda221bc984a5c33c25f07a2d1100a431e5dbcd48330dcd29fa11d0fba7.png" />
<img alt="../_images/127fab0fffa1361f79f3487bf129ddb17cb78b7fcd1337cfd8c1b1ed85379ba9.png" src="../_images/127fab0fffa1361f79f3487bf129ddb17cb78b7fcd1337cfd8c1b1ed85379ba9.png" />
<img alt="../_images/ca0e845bdb0351c3d98d8d66ee14e173315bd36ac2a579a1c04b5085d48cb857.png" src="../_images/ca0e845bdb0351c3d98d8d66ee14e173315bd36ac2a579a1c04b5085d48cb857.png" />
<img alt="../_images/c5d0ef6b3a5a1e2c4653add1784fb2392ec9300d02da2110b72059469b578fd8.png" src="../_images/c5d0ef6b3a5a1e2c4653add1784fb2392ec9300d02da2110b72059469b578fd8.png" />
</div>
</div>
</section>
</section>
<section id="relative-precipitation-efficency">
<h2>Relative precipitation efficency<a class="headerlink" href="#relative-precipitation-efficency" title="Permalink to this heading">#</a></h2>
<p>Use of total precipitation, but where LWP <span class="math notranslate nohighlight">\(\ge\)</span> 0.005 gm-2, 2-meter temperature <span class="math notranslate nohighlight">\(\le\)</span> 273.15K.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

      <span class="c1"># supercooled precipitation efficency per season</span>
      <span class="c1"># first averavge over time and then fraction remove weighting only for spatial average</span>

      <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t_season</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;pr&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">dset_dict_lcc_2t_season</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span>
      <span class="c1"># plt_seasonal_NH_SH(dset_dict_lcc_2t_tp_season[&#39;msr&#39;]/dset_dict_lcc_2t_tp_season[&#39;twp&#39;], np.arange(0,1, 0.1),&#39;&#39;,&#39;&#39;)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
            <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
            <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

      <span class="c1"># Plot precipitation efficency</span>

      <span class="n">fct</span><span class="o">.</span><span class="n">plt_seasonal_NH_SH</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_season&#39;</span><span class="p">]</span> <span class="o">&gt;</span><span class="mf">0.</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="s1">&#39;relative supercooled precipitation eff. (h$^{-1}$)&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">),</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
      <span class="c1"># save precip efficency from mixed-phase clouds figure</span>
      <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_tp_twp_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>min: 0.178 max: 6.485 std: 0.445 mean: 0.799
min: nan max: nan std: nan mean: nan
min: 0.115 max: 1.88 std: 0.248 mean: 0.633
min: 0.09 max: 3.051 std: 0.265 mean: 0.531
min: 0.117 max: 2.692 std: 0.273 mean: 0.581
min: 0.212 max: 1.231 std: 0.111 mean: 0.454
</pre></div>
</div>
<img alt="../_images/a5431901b13212b6c3106e51c6b7f360d000bea8a57a42a788480e843e25da98.png" src="../_images/a5431901b13212b6c3106e51c6b7f360d000bea8a57a42a788480e843e25da98.png" />
<img alt="../_images/e2200ff7c7948e99df60ef64d8b4b8d5586d54a195018d0a7bae2cbf21019451.png" src="../_images/e2200ff7c7948e99df60ef64d8b4b8d5586d54a195018d0a7bae2cbf21019451.png" />
<img alt="../_images/4d2008b2822d454a61f6539f1d9c4577c6fb444da0b4e62300df02e6236c5e3d.png" src="../_images/4d2008b2822d454a61f6539f1d9c4577c6fb444da0b4e62300df02e6236c5e3d.png" />
<img alt="../_images/e3ff80deb9a7fac43d171c250e1a339083a5db6c07165de4ffba4f4fbf9324c7.png" src="../_images/e3ff80deb9a7fac43d171c250e1a339083a5db6c07165de4ffba4f4fbf9324c7.png" />
<img alt="../_images/24ea0367b1f0fbe94a4ef00a860bc3b18e992f4c598c447b4327030f33ee6f11.png" src="../_images/24ea0367b1f0fbe94a4ef00a860bc3b18e992f4c598c447b4327030f33ee6f11.png" />
<img alt="../_images/80adf04565772775a19f1b12fa8d6f190dd534e978b0ef34ab1aebbce109eadc.png" src="../_images/80adf04565772775a19f1b12fa8d6f190dd534e978b0ef34ab1aebbce109eadc.png" />
</div>
</div>
<section id="annual-cycle-of-relative-supercooled-precipitation-efficency">
<h3>Annual cycle of relative supercooled precipitation efficency<a class="headerlink" href="#annual-cycle-of-relative-supercooled-precipitation-efficency" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

      <span class="n">f</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;pr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
      <span class="n">n</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
      <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">n</span>
      <span class="n">NH_mean</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
      <span class="n">SH_mean</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>

      <span class="n">NH_std</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
      <span class="n">SH_std</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>

      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
            <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
            <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
      <span class="c1"># for year in np.unique(dset_dict[&#39;time.year&#39;]):</span>
      <span class="c1">#     # print(year)</span>
      <span class="c1">#     f = dset_dict_lcc_2t[model][&#39;pr&#39;].sel(time=slice(str(year))).groupby(&#39;time.month&#39;).sum(dim=&#39;time&#39;, skipna=True, keep_attrs=False)</span>
      <span class="c1">#     n = dset_dict_lcc_2t[model][&#39;twp&#39;].sel(time=slice(str(year))).groupby(&#39;time.month&#39;).sum(dim=&#39;time&#39;, skipna=True, keep_attrs=False)</span>

      <span class="c1">#     _ratio = f/n</span>
      
      <span class="c1">#     NH_mean[model][&#39;tp_eff_month_&#39;+str(year)] = _ratio.sel(lat=slice(45,90)).weighted(weights[model]).mean((&#39;lat&#39;, &#39;lon&#39;))</span>
      <span class="c1">#     SH_mean[model][&#39;tp_eff_month_&#39;+str(year)] = _ratio.sel(lat=slice(-90,-45)).weighted(weights[model]).mean((&#39;lat&#39;, &#39;lon&#39;))</span>
      
      <span class="c1">#     NH_std[model][&#39;tp_eff_month_&#39;+str(year)] = _ratio.sel(lat=slice(45,90)).weighted(weights[model]).std((&#39;lat&#39;, &#39;lon&#39;))</span>
      <span class="c1">#     SH_std[model][&#39;tp_eff_month_&#39;+str(year)] = _ratio.sel(lat=slice(-90,-45)).weighted(weights[model]).std((&#39;lat&#39;, &#39;lon&#39;))</span>

      <span class="n">fct</span><span class="o">.</span><span class="n">plt_annual_cycle</span><span class="p">(</span><span class="n">NH_mean</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">],</span> <span class="n">SH_mean</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">],</span> <span class="n">NH_std</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">],</span> <span class="n">SH_std</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">],</span> <span class="s1">&#39;relative supercooled precipitation eff. (h$^{-1}$)&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">))</span>
      <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_tp_twp_annual_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>min: 0.014 max: 84.796 std: 1.971 mean: 1.381
min: 0.0 max: 0.0 std: 0.0 mean: 0.0
min: 0.0 max: 9.465 std: 0.398 mean: 0.658
min: 0.0 max: 12.083 std: 0.367 mean: 0.556
min: 0.0 max: 6.72 std: 0.307 mean: 0.568
min: 0.0 max: 1.833 std: 0.161 mean: 0.467
</pre></div>
</div>
<img alt="../_images/c829a05e743999740c56285c90872a39b4cdd8eef701d2528358298c4ea63cf6.png" src="../_images/c829a05e743999740c56285c90872a39b4cdd8eef701d2528358298c4ea63cf6.png" />
<img alt="../_images/f4c9f243b990beb96874673f05d3ad3febac10e05cb30c4bb83dfa8ee2b880ee.png" src="../_images/f4c9f243b990beb96874673f05d3ad3febac10e05cb30c4bb83dfa8ee2b880ee.png" />
<img alt="../_images/b19ecd1837ebda683d20ee4cb33b42f57755ca5fe71b4728e8d0dceca2dd536c.png" src="../_images/b19ecd1837ebda683d20ee4cb33b42f57755ca5fe71b4728e8d0dceca2dd536c.png" />
<img alt="../_images/4a47bcce127b0d4f2c869cdbe77916d60d3bb8ed9a57550ec2a6e1611f3d8513.png" src="../_images/4a47bcce127b0d4f2c869cdbe77916d60d3bb8ed9a57550ec2a6e1611f3d8513.png" />
<img alt="../_images/9481f0fdf20ff53f75898577adc8c88df539102a820bf99245fed31f8b9dfb7c.png" src="../_images/9481f0fdf20ff53f75898577adc8c88df539102a820bf99245fed31f8b9dfb7c.png" />
<img alt="../_images/81ede660402cf049ac87325ecd7774a47153785f7fc9ce4eee8a19b03e547886.png" src="../_images/81ede660402cf049ac87325ecd7774a47153785f7fc9ce4eee8a19b03e547886.png" />
</div>
</div>
</section>
</section>
<section id="frequency-of-freezing-rain">
<h2>Frequency of freezing rain<a class="headerlink" href="#frequency-of-freezing-rain" title="Permalink to this heading">#</a></h2>
<p>Use of the thresholds.</p>
<div class="math notranslate nohighlight">
\[RF = \frac{\text{total precipitation}(T\le273.15; LWP\ge0.005gm^{-2}) - \text{snowfall}(T\le273.15; LWP\ge0.005gm^{-2})}{\text{total precipitation}(T\le273.15; LWP\ge0.005gm^{-2})}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

      <span class="c1"># first count the days where we have freezing rain per season and relate to total precipitation days</span>
      <span class="n">fr_d</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t_days</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset_dict_lcc_2t_days</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
      <span class="n">tp_d</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t_days</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;pr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset_dict_lcc_2t_days</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;pr&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

      <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr_pr_days&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fr_d</span><span class="o">/</span><span class="n">tp_d</span>

      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr_pr_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr_pr_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
            <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr_pr_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
            <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr_pr_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

      <span class="n">fct</span><span class="o">.</span><span class="n">plt_seasonal_NH_SH</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr_pr_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr_pr_days&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;Freezing rain days (%)&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">),</span> <span class="n">extend</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
      <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_mfrr_mtpr_days_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

      <span class="c1"># then bring the amount of freezing rain into relation to the total precipitation (How many percent is freezing rain in comparison to total precipitation)</span>
      <span class="n">fr</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t_days</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset_dict_lcc_2t_days</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">)</span>
      <span class="n">tp</span> <span class="o">=</span> <span class="n">dset_dict_lcc_2t_days</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;pr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset_dict_lcc_2t_days</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;pr&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">)</span>

      <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr_pr_frac&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">fr</span><span class="o">/</span><span class="n">tp</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr_pr_frac&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr_pr_frac&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
            <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr_pr_frac&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
            <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr_pr_frac&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

      <span class="n">fct</span><span class="o">.</span><span class="n">plt_seasonal_NH_SH</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr_pr_frac&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;mfrr_pr_frac&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;Freezing rain fraction (%)&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">),</span> <span class="n">extend</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
      <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_mfrr_mtpr_amount_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>min: 0.268 max: 0.972 std: 0.101 mean: 0.573
min: 0.0 max: 0.381 std: 0.054 mean: 0.05
min: nan max: nan std: nan mean: nan
min: nan max: nan std: nan mean: nan
min: 0.568 max: 1.0 std: 0.072 mean: 0.932
min: 0.0 max: 0.918 std: 0.182 mean: 0.224
min: 0.595 max: 1.0 std: 0.046 mean: 0.958
min: 0.03 max: 1.0 std: 0.188 mean: 0.463
min: 0.509 max: 1.0 std: 0.052 mean: 0.947
min: 0.015 max: 1.0 std: 0.174 mean: 0.447
min: 0.0 max: 0.977 std: 0.19 mean: 0.209
min: 0.0 max: 1.0 std: 0.17 mean: 0.233
</pre></div>
</div>
<img alt="../_images/7185615929a5ffb3537940fa1bbff38297c968f3f0cd8803ebe8d564b69f4244.png" src="../_images/7185615929a5ffb3537940fa1bbff38297c968f3f0cd8803ebe8d564b69f4244.png" />
<img alt="../_images/d90ecf9c0e339b276994e5985109642d6974c51070893a3d7a11a071a56ecb64.png" src="../_images/d90ecf9c0e339b276994e5985109642d6974c51070893a3d7a11a071a56ecb64.png" />
<img alt="../_images/126d8efacb6172fabc42e9c73b4cb6ef1fa30747e62b436067267ac1ae7e0b08.png" src="../_images/126d8efacb6172fabc42e9c73b4cb6ef1fa30747e62b436067267ac1ae7e0b08.png" />
<img alt="../_images/4fac27c17fd004d217adde823409458ccaf39a77781596e26552440e12871673.png" src="../_images/4fac27c17fd004d217adde823409458ccaf39a77781596e26552440e12871673.png" />
<img alt="../_images/18bffeced3856ca2e9908126a42152f94a870253a659a193c62b7b02d14385de.png" src="../_images/18bffeced3856ca2e9908126a42152f94a870253a659a193c62b7b02d14385de.png" />
<img alt="../_images/2f02edc23e0e4efdf313f6a816e5e41f925b1d70a044c70b250c2dc8f1e16d69.png" src="../_images/2f02edc23e0e4efdf313f6a816e5e41f925b1d70a044c70b250c2dc8f1e16d69.png" />
<img alt="../_images/c3b5c3389b45589660b586a0a3cff5f6aadf742c898c993a6cb5b298d253c573.png" src="../_images/c3b5c3389b45589660b586a0a3cff5f6aadf742c898c993a6cb5b298d253c573.png" />
<img alt="../_images/a9b3d73425739aa16b967faeedaaba9638b4b65535dbc7ef2d4e8648d846a5b4.png" src="../_images/a9b3d73425739aa16b967faeedaaba9638b4b65535dbc7ef2d4e8648d846a5b4.png" />
<img alt="../_images/62af6a6301ec5851fa41420ee98129973b5ccc3188e114d9309dcdf25bfdb2c1.png" src="../_images/62af6a6301ec5851fa41420ee98129973b5ccc3188e114d9309dcdf25bfdb2c1.png" />
<img alt="../_images/cd4e7d0db960bde339208a85a146f806f3214889bea90d81c11c1dbce3845be2.png" src="../_images/cd4e7d0db960bde339208a85a146f806f3214889bea90d81c11c1dbce3845be2.png" />
<img alt="../_images/2f755fa51655d6c4a579b8f193f30a7a2fc4d0bbad8e9b2e587cb92554348852.png" src="../_images/2f755fa51655d6c4a579b8f193f30a7a2fc4d0bbad8e9b2e587cb92554348852.png" />
<img alt="../_images/429907ff146bbfd56b1c5c3a69fc3c58990b882325680824e008813564cbe649.png" src="../_images/429907ff146bbfd56b1c5c3a69fc3c58990b882325680824e008813564cbe649.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_count&#39;</span><span class="p">],</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_lcc&#39;</span><span class="p">],</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;iwp_lcc&#39;</span><span class="p">],</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lwp_lcc&#39;</span><span class="p">],</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;twp_lcc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">find_precip_cloud</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_precip_cloud2</span><span class="p">(</span><span class="n">dset</span><span class="p">):</span>
    <span class="c1"># 1. find where LWP &gt;=5 gm-2</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;prsn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">lwp</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">iwp</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;clivi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">twp</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    
    <span class="c1"># print(1,&#39;sf&#39;, sf.min(skipna=True).values, sf.max(skipna=True).values, &#39;lwp&#39;, lwp.min(skipna=True).values, lwp.max(skipna=True).values, &#39;t2&#39;, t2.min(skipna=True).values, t2.max(skipna=True).values)</span>
    <span class="c1"># 2. find where snowfall &gt;= 0.01mms-1</span>
    <span class="c1"># unit_sf = dset[&#39;prsn&#39;]</span>
    <span class="c1"># sf = sf.where(unit_sf&gt;=0.01*24, other=np.nan)</span>
    <span class="c1"># lwp = lwp.where(unit_sf&gt;=0.01*24, other=np.nan)</span>
    <span class="c1"># iwp = iwp.where(unit_sf&gt;=0.01*24, other=np.nan)</span>
    <span class="c1"># twp = twp.where(unit_sf&gt;0.01*24, other=np.nan)</span>
    <span class="c1"># t2 = t2.where(unit_sf&gt;=0.01*24, other=np.nan)</span>
    <span class="c1"># print(2,&#39;sf&#39;, sf.min(skipna=True).values, sf.max(skipna=True).values, &#39;lwp&#39;, lwp.min(skipna=True).values, lwp.max(skipna=True).values, &#39;t2&#39;, t2.min(skipna=True).values, t2.max(skipna=True).values)</span>
    
    <span class="c1"># 3. find where 2m-temperature &lt;= 0C</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mf">273.15</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">lwp</span> <span class="o">=</span> <span class="n">lwp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mf">273.15</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">iwp</span> <span class="o">=</span> <span class="n">iwp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mf">273.15</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">twp</span> <span class="o">=</span> <span class="n">twp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mf">273.15</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">t2</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mf">273.15</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="c1"># print(3,&#39;sf&#39;, sf.min(skipna=True).values, sf.max(skipna=True).values, &#39;lwp&#39;, lwp.min(skipna=True).values, lwp.max(skipna=True).values, &#39;t2&#39;, t2.min(skipna=True).values, t2.max(skipna=True).values)</span>
    
    <span class="n">sf_count</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># lwp_count = lwp.groupby(&#39;time.season&#39;).count(dim=&#39;time&#39;,keep_attrs=True)</span>
    <span class="c1"># iwp_count = iwp.groupby(&#39;time.season&#39;).count(dim=&#39;time&#39;, keep_attrs=True)</span>
    <span class="c1"># t2_count = t2.groupby(&#39;time.season&#39;).count(dim=&#39;time&#39;, keep_attrs=True)</span>
    
    <span class="k">return</span><span class="p">(</span><span class="n">sf_count</span><span class="p">,</span> <span class="n">sf</span><span class="p">,</span> <span class="n">iwp</span><span class="p">,</span> <span class="n">lwp</span><span class="p">,</span> <span class="n">twp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_count2&#39;</span><span class="p">],</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_lcc2&#39;</span><span class="p">],</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;iwp_lcc2&#39;</span><span class="p">],</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lwp_lcc2&#39;</span><span class="p">],</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;twp_lcc2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">find_precip_cloud2</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plt_seasonal_NH_SH</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span><span class="n">levels</span><span class="p">,</span><span class="n">cbar_label</span><span class="p">,</span><span class="n">plt_title</span><span class="p">):</span>

    <span class="n">f</span><span class="p">,</span> <span class="n">axsm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">ncols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">)})</span>

    <span class="n">coast</span> <span class="o">=</span> <span class="n">cy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="s1">&#39;physical&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;110m&#39;</span><span class="p">,</span>
                            <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;coastline&#39;</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:</span><span class="mi">4</span><span class="p">],</span> <span class="n">variable</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
        <span class="c1"># ax.add_feature(cy.feature.COASTLINE, alpha=0.5)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">coast</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">45</span><span class="p">],</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
        <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span>   <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">variable</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hawaii_r</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span><span class="s1">&#39;season = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">4</span><span class="p">:],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span> <span class="n">variable</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">i</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">SouthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
        <span class="c1"># ax.add_feature(cy.feature.COASTLINE, alpha=0.5)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">coast</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">45</span><span class="p">],</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
        <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span>   <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">cf</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hawaii_r</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span><span class="s1">&#39;season = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>

    <span class="n">cbaxes</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">1.0125</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">])</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbaxes</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">extend</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">cbar_label</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">plt_title</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">);</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="c1"># Cummulative snowfall days</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_cum_sf_days_season_mean_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
    <span class="n">plt_seasonal_NH_SH</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_count&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">310</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">cbar_label</span><span class="o">=</span><span class="s1">&#39;Cummulative snowfall days&#39;</span><span class="p">,</span> <span class="n">plt_title</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1350f817b39070997b9db575933c2b7cf663df4afb82a070355f3dfd181ccb77.png" src="../_images/1350f817b39070997b9db575933c2b7cf663df4afb82a070355f3dfd181ccb77.png" />
<img alt="../_images/25f9c5cdd43e59e275d57a49f52f150dfa6b448d68b9942ec59b6f55daf9681a.png" src="../_images/25f9c5cdd43e59e275d57a49f52f150dfa6b448d68b9942ec59b6f55daf9681a.png" />
<img alt="../_images/2e11a33e07590ed93f4831cd32e75bbb0ba8aa1159d37f679be7490d8b0cebe0.png" src="../_images/2e11a33e07590ed93f4831cd32e75bbb0ba8aa1159d37f679be7490d8b0cebe0.png" />
<img alt="../_images/2706fe13156c0f0f2e09aaba3d3c0fa519101b46b38b30be24750fbb2ddc8100.png" src="../_images/2706fe13156c0f0f2e09aaba3d3c0fa519101b46b38b30be24750fbb2ddc8100.png" />
<img alt="../_images/cb2676ddc46e7e6f08c698953bd26af877c382dd513035110b169134ceb9ae9a.png" src="../_images/cb2676ddc46e7e6f08c698953bd26af877c382dd513035110b169134ceb9ae9a.png" />
<img alt="../_images/aaba6291a2477a207a8a854e5dd95dba8a9a138f7d7be8232f79c6b7b57b9fce.png" src="../_images/aaba6291a2477a207a8a854e5dd95dba8a9a138f7d7be8232f79c6b7b57b9fce.png" />
<img alt="../_images/09ebaf43e984d0df2320d8910ed54594063f404fc0005c89568e21dfe8f8f7eb.png" src="../_images/09ebaf43e984d0df2320d8910ed54594063f404fc0005c89568e21dfe8f8f7eb.png" />
</div>
</div>
</section>
<section id="calculating-bin-and-bin-sizes">
<h2>Calculating bin and bin sizes<a class="headerlink" href="#calculating-bin-and-bin-sizes" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://www.statisticshowto.com/choose-bin-sizes-statistics/">https://www.statisticshowto.com/choose-bin-sizes-statistics/</a></p>
<p>Useful to plot TWP vs. Snowfall (precipitation efficency)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plt_seasonal_2dhist_wp_sf</span><span class="p">(</span><span class="n">x_value</span><span class="p">,</span> <span class="n">y_value</span><span class="p">,</span> <span class="n">plt_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">):</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">axsm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">ncols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># cmap = cm.batlow</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">hawaii_r</span>
    <span class="c1"># levels = np.arange(0.1,65000,5000)</span>
    <span class="c1"># norm = BoundaryNorm(levels, ncolors=cmap.N, )</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">50000</span><span class="p">)</span>



    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:</span><span class="mi">4</span><span class="p">],</span> <span class="n">x_value</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;.6&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
        <span class="n">Z</span><span class="p">,</span> <span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">((</span><span class="n">x_value</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x_value</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">&gt;=</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> 
                                        <span class="p">(</span><span class="n">y_value</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_value</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">&gt;=</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> 
                                        <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">160</span><span class="p">],</span> 
                                        <span class="nb">range</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">160</span><span class="p">]])</span>   

        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span><span class="p">,</span> <span class="n">Z</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,)</span>
        <span class="c1"># cbar = f.colorbar(im, ax=ax,)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span><span class="sa">r</span><span class="s1">&#39;lat$\geq 45^\circ$N; season = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        
        
        <span class="n">_corr</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">x_value</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x_value</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">&gt;=</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">),</span> <span class="n">y_value</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_value</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">&gt;=</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">))</span>
        <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="s1">&#39;Corr: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">_corr</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">)</span>
        
        

    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">4</span><span class="p">:],</span> <span class="n">x_value</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;.6&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
        <span class="n">Z</span><span class="p">,</span> <span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">((</span><span class="n">x_value</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x_value</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">&lt;=-</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> 
                                        <span class="p">(</span><span class="n">y_value</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_value</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">&lt;=-</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> 
                                        <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">160</span><span class="p">],</span> 
                                        <span class="nb">range</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">160</span><span class="p">]])</span>   

        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span><span class="p">,</span> <span class="n">Z</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,)</span>
        <span class="c1"># cbar = f.colorbar(im, ax=ax, )</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span><span class="sa">r</span><span class="s1">&#39;lat$\leq-45^\circ$S; season = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span><span class="n">x_value</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        
        <span class="n">_corr</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">x_value</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x_value</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">&lt;=-</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">),</span> <span class="n">y_value</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_value</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">&lt;=-</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">))</span>
        <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="s1">&#39;Corr: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">_corr</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">)</span>
        
    <span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">y_value</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]))</span>
    <span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">y_value</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]))</span>


    <span class="n">cbaxes</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">1.0125</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">])</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbaxes</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean Frequency&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">plt_title</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">);</span>
    
    
    
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">lwp</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lwp_lcc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;time&#39;</span><span class="p">),</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">iwp</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;iwp_lcc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;time&#39;</span><span class="p">),</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sf</span>  <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_lcc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;time&#39;</span><span class="p">),</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># Total water path</span>
    <span class="n">twp</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;twp_lcc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;time&#39;</span><span class="p">),</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># precip efficency from mixed-phase clouds</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_2dhist_twp_sf_season_mean_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
    <span class="n">plt_seasonal_2dhist_wp_sf</span><span class="p">(</span><span class="n">twp</span><span class="p">,</span> <span class="n">sf</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> Mean seasonal total precip. efficency&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="p">),</span> <span class="s1">&#39;Total Water Path&#39;</span><span class="p">,</span> <span class="s1">&#39;Snowfall&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e677c98c28e2b0690ef50b8d99ec79f0e34a9a65ba82828eadd974bcb0818078.png" src="../_images/e677c98c28e2b0690ef50b8d99ec79f0e34a9a65ba82828eadd974bcb0818078.png" />
<img alt="../_images/ed87b5d396c1e8df33f71c51c0a377c68d083eb33ab17cb364c6b95f4a041ff4.png" src="../_images/ed87b5d396c1e8df33f71c51c0a377c68d083eb33ab17cb364c6b95f4a041ff4.png" />
<img alt="../_images/27c42e98dfa6d76ca7d89fcaf5bd4dba7be5c5b3dbdd223317fdb9a22d51a407.png" src="../_images/27c42e98dfa6d76ca7d89fcaf5bd4dba7be5c5b3dbdd223317fdb9a22d51a407.png" />
<img alt="../_images/d407462f96e21fb9e2d58b6924a233ac4d6e5bcdca1d257b484f45449d8c0b86.png" src="../_images/d407462f96e21fb9e2d58b6924a233ac4d6e5bcdca1d257b484f45449d8c0b86.png" />
<img alt="../_images/33e7e625c4ceba314fa952ca462a1f1c10a6f86151479ce37f9802f70b8bd0fb.png" src="../_images/33e7e625c4ceba314fa952ca462a1f1c10a6f86151479ce37f9802f70b8bd0fb.png" />
<img alt="../_images/ff2a26779443935761f6e9f7f7b7240fa233477ce7497879e9acf0df14ab5ea8.png" src="../_images/ff2a26779443935761f6e9f7f7b7240fa233477ce7497879e9acf0df14ab5ea8.png" />
<img alt="../_images/91bebb9fc48a880af10649f1777431cc79419006d73b05f78e6be087a32bb0f9.png" src="../_images/91bebb9fc48a880af10649f1777431cc79419006d73b05f78e6be087a32bb0f9.png" />
</div>
</div>
</section>
<section id="precipitation-efficency-spatial">
<h2>Precipitation efficency - spatial<a class="headerlink" href="#precipitation-efficency-spatial" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

    <span class="c1"># calculate precipitation efficency</span>
    <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;precip_eff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_lcc&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;twp_lcc&#39;</span><span class="p">]</span>
    
    <span class="c1"># calculate days in each season for each year</span>
    <span class="n">sum_day_DJF</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sum_day_MAM</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sum_day_JJA</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sum_day_SON</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">):</span>
        <span class="n">year</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
        <span class="n">sum_day_DJF</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;precip_eff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-01&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;precip_eff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-02&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;precip_eff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-12&#39;</span><span class="p">))</span>
        <span class="n">sum_day_MAM</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;precip_eff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-03&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;precip_eff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-04&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;precip_eff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-05&#39;</span><span class="p">))</span>
        <span class="n">sum_day_JJA</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;precip_eff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-06&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;precip_eff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-07&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;precip_eff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-08&#39;</span><span class="p">))</span>
        <span class="n">sum_day_SON</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;precip_eff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-09&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;precip_eff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-10&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;precip_eff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-11&#39;</span><span class="p">))</span>

    <span class="n">days_DJF</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sum_day_DJF</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">days_MAM</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sum_day_MAM</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">days_JJA</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sum_day_JJA</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">days_SON</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sum_day_SON</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="c1"># calculate sum of monthly precip eff</span>
    <span class="n">precip_eff_mon</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;precip_eff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># calculate sum of each season precipitation eff</span>
    <span class="n">precip_eff</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">precip_eff</span><span class="p">[</span><span class="s1">&#39;DJF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">precip_eff_mon</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">precip_eff_mon</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">precip_eff_mon</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">12</span><span class="p">))</span><span class="o">/</span><span class="n">days_DJF</span>
    <span class="n">precip_eff</span><span class="p">[</span><span class="s1">&#39;MAM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">precip_eff_mon</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">precip_eff_mon</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">precip_eff_mon</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span><span class="o">/</span><span class="n">days_MAM</span>
    <span class="n">precip_eff</span><span class="p">[</span><span class="s1">&#39;JJA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">precip_eff_mon</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="n">precip_eff_mon</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="n">precip_eff_mon</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span><span class="o">/</span><span class="n">days_JJA</span>
    <span class="n">precip_eff</span><span class="p">[</span><span class="s1">&#39;SON&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">precip_eff_mon</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span> <span class="o">+</span> <span class="n">precip_eff_mon</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="n">precip_eff_mon</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">11</span><span class="p">))</span><span class="o">/</span><span class="n">days_SON</span>

    <span class="n">_da</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">precip_eff</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">_coord</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">precip_eff</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="c1"># _da = list(pe.values())</span>
    <span class="c1"># _coord = list(pe.keys())    </span>
    <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;precip_eff_seas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">objs</span><span class="o">=</span><span class="n">_da</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">_coord</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;concat_dim&#39;</span><span class="p">:</span><span class="s1">&#39;season&#39;</span><span class="p">})</span>
    
    <span class="c1"># Plot precipitation efficency</span>
    <span class="n">plt_seasonal_NH_SH</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;precip_eff_seas&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">15.5</span><span class="p">,</span><span class="mf">.5</span><span class="p">),</span> <span class="s1">&#39;relative snowfall eff.&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">))</span>

    <span class="c1"># save precip efficency from mixed-phase clouds figure</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_sf_twp_season_mean_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        
        
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/74c1b216be8bf68d7ada15812183a250f239dda5a4308bd1edf7e982b2cb8a31.png" src="../_images/74c1b216be8bf68d7ada15812183a250f239dda5a4308bd1edf7e982b2cb8a31.png" />
<img alt="../_images/abb8204d6aecf0bae0e495ef7ca576d7437dff3586f88bf65d3b9a2a23fc6230.png" src="../_images/abb8204d6aecf0bae0e495ef7ca576d7437dff3586f88bf65d3b9a2a23fc6230.png" />
<img alt="../_images/cc68feaf3d6e0bfb6ace76951dd671b5d30f8ed502a3e5d441043140a0990ff0.png" src="../_images/cc68feaf3d6e0bfb6ace76951dd671b5d30f8ed502a3e5d441043140a0990ff0.png" />
<img alt="../_images/b7ddb35987baed7dc2d0f9e7d0c9ba38c99892f5c06f970d6d2d812b9dcebed8.png" src="../_images/b7ddb35987baed7dc2d0f9e7d0c9ba38c99892f5c06f970d6d2d812b9dcebed8.png" />
<img alt="../_images/f549df6eb797211c24386d6a4401f37ba26e491ec7f0d0629c659bd57a731217.png" src="../_images/f549df6eb797211c24386d6a4401f37ba26e491ec7f0d0629c659bd57a731217.png" />
<img alt="../_images/c5d4937c0e3ca96442d446edaa2a1216f42f4a023432e031499ae230e1b53832.png" src="../_images/c5d4937c0e3ca96442d446edaa2a1216f42f4a023432e031499ae230e1b53832.png" />
<img alt="../_images/f94ba67cc3f08b5489dcb8bdbb5bb9999f5ad105534d628f2a06a0041b7ed44a.png" src="../_images/f94ba67cc3f08b5489dcb8bdbb5bb9999f5ad105534d628f2a06a0041b7ed44a.png" />
</div>
</div>
</section>
<section id="relative-frequency">
<h2>Relative frequency<a class="headerlink" href="#relative-frequency" title="Permalink to this heading">#</a></h2>
<div class="math notranslate nohighlight">
\[RF = \frac{f}{n} = \frac{\text{number of times the data occurred in an observation}}{\text{total frequency}}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="c1"># frequency without snow requirement</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">f</span><span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lwp_lcc2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;rf_lcc_wo_snow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">n</span>
    <span class="n">plt_seasonal_NH_SH</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;rf_lcc_wo_snow&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.05</span><span class="p">,</span><span class="mf">0.05</span><span class="p">),</span> <span class="s1">&#39;Relative frequency from precip. LCCs&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">))</span>
    <span class="c1"># save frequency from LCCs</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_rf_lcc_wo_snow_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    
    
    <span class="c1"># frequency with snow from lccs</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">f</span><span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lwp_lcc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;rf_lcc_w_snow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">n</span>
    <span class="n">plt_seasonal_NH_SH</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;rf_lcc_w_snow&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.05</span><span class="p">,</span><span class="mf">0.05</span><span class="p">),</span> <span class="s1">&#39;Relative frequency from precip. LCCs&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">))</span>
    <span class="c1"># save frequency from LCCs</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_rf_lcc_w_snow_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    
    
    <span class="n">n</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;prsn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">f</span><span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_lcc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;rf_sf_lcc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">n</span>
    <span class="n">plt_seasonal_NH_SH</span><span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;rf_sf_lcc&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.05</span><span class="p">,</span><span class="mf">0.05</span><span class="p">),</span> <span class="s1">&#39;Relative precip. frequency in LCCs&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">))</span>
    <span class="c1"># save frequency from LCCs</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_rf_sf_lcc_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2ba3fb11b9a1c27e33859d46e1561ac73bb4cfaa67c8e0366c1b717f8ce8b53e.png" src="../_images/2ba3fb11b9a1c27e33859d46e1561ac73bb4cfaa67c8e0366c1b717f8ce8b53e.png" />
<img alt="../_images/6d051827160a355e5fff880bde99f9e8039311b9bd95855a8a8a16b8a1ff3678.png" src="../_images/6d051827160a355e5fff880bde99f9e8039311b9bd95855a8a8a16b8a1ff3678.png" />
<img alt="../_images/35862f98b80fa3cee5d8da9aa5487501eba75a9bcb00317acaa978045905beb8.png" src="../_images/35862f98b80fa3cee5d8da9aa5487501eba75a9bcb00317acaa978045905beb8.png" />
<img alt="../_images/6955da53ff85c4adb8db8de1d326538c29e42a4fa8e966b1b6d966eb0e451cff.png" src="../_images/6955da53ff85c4adb8db8de1d326538c29e42a4fa8e966b1b6d966eb0e451cff.png" />
<img alt="../_images/a988b079f7742a55e7285c413f09c72fabd609d88f153ee51f2edd60bcd00743.png" src="../_images/a988b079f7742a55e7285c413f09c72fabd609d88f153ee51f2edd60bcd00743.png" />
<img alt="../_images/596c80aaac28c95ba5b16c430b35a79e4736582feac5afbfc989f67565c1e917.png" src="../_images/596c80aaac28c95ba5b16c430b35a79e4736582feac5afbfc989f67565c1e917.png" />
<img alt="../_images/cb80bb5ecc63fc2719d26520e1581c3d0c17b8f8f0f6d3b6350f1f3128fd87cb.png" src="../_images/cb80bb5ecc63fc2719d26520e1581c3d0c17b8f8f0f6d3b6350f1f3128fd87cb.png" />
<img alt="../_images/fb81a8aa97296d8c16a892a0938fe0db639b4440027177c17d6c83d8c9b5e43d.png" src="../_images/fb81a8aa97296d8c16a892a0938fe0db639b4440027177c17d6c83d8c9b5e43d.png" />
<img alt="../_images/6916c59445088b1e8fa1188953a711cf84c665fdc8e29c9ef737a73a47b4c745.png" src="../_images/6916c59445088b1e8fa1188953a711cf84c665fdc8e29c9ef737a73a47b4c745.png" />
<img alt="../_images/c102b0756e18a680ec820a582217b56679333123f54e40bf2714c5fcb5406955.png" src="../_images/c102b0756e18a680ec820a582217b56679333123f54e40bf2714c5fcb5406955.png" />
<img alt="../_images/3290d97499ba824bfe103343d8e351f6f8215b3e9caf788131b811880dfdfc9a.png" src="../_images/3290d97499ba824bfe103343d8e351f6f8215b3e9caf788131b811880dfdfc9a.png" />
<img alt="../_images/1b7775f33b05007517aa5079c8b2f8591087fc1dfd786d6fe4428bdd93c96809.png" src="../_images/1b7775f33b05007517aa5079c8b2f8591087fc1dfd786d6fe4428bdd93c96809.png" />
<img alt="../_images/818eee2994ae0f4e4f914209d09a2fcf34dc5795098932b1e3e6ada32b1fa4c6.png" src="../_images/818eee2994ae0f4e4f914209d09a2fcf34dc5795098932b1e3e6ada32b1fa4c6.png" />
<img alt="../_images/57ca05725caa904e550754a09c9b206c2fd46e5f6a60bdda15c4545af7bb16db.png" src="../_images/57ca05725caa904e550754a09c9b206c2fd46e5f6a60bdda15c4545af7bb16db.png" />
<img alt="../_images/9f048ef90190ff8565f5c4538f06fa496d1280ca8d0b1f056d84bc8c9ea65446.png" src="../_images/9f048ef90190ff8565f5c4538f06fa496d1280ca8d0b1f056d84bc8c9ea65446.png" />
<img alt="../_images/9deb94f5402e948b3d162a785bb063c2feb04db3ac591aad43ee2db66effef80.png" src="../_images/9deb94f5402e948b3d162a785bb063c2feb04db3ac591aad43ee2db66effef80.png" />
<img alt="../_images/863860f57ccefc37356318beb100c7f4bd691212eb023463aba058e6fe2e5525.png" src="../_images/863860f57ccefc37356318beb100c7f4bd691212eb023463aba058e6fe2e5525.png" />
<img alt="../_images/f295757531c0c02d073412ebaad127c00ab60b135231bd71405ff2b137ef6f0c.png" src="../_images/f295757531c0c02d073412ebaad127c00ab60b135231bd71405ff2b137ef6f0c.png" />
<img alt="../_images/e2e81a0e9b4982247d52e5678c1e4a8be772bf8712e48d3e349fb40ae654b0d3.png" src="../_images/e2e81a0e9b4982247d52e5678c1e4a8be772bf8712e48d3e349fb40ae654b0d3.png" />
<img alt="../_images/0635a8f252e9f304b07e9977c024ad174c873814695b20d05895ffea83e74771.png" src="../_images/0635a8f252e9f304b07e9977c024ad174c873814695b20d05895ffea83e74771.png" />
<img alt="../_images/097260400d20ab66ab3300fd95b4a2df688c1a307664bf7795b57ed772ef2ed0.png" src="../_images/097260400d20ab66ab3300fd95b4a2df688c1a307664bf7795b57ed772ef2ed0.png" />
</div>
</div>
</section>
<section id="plot-annual-cycle-of-lcc-frequency-precipitaiton-frequency-in-lccs-relative-snowfall-efficeny">
<h2>Plot annual cycle of LCC frequency, precipitaiton frequency in LCCs, relative snowfall efficeny<a class="headerlink" href="#plot-annual-cycle-of-lcc-frequency-precipitaiton-frequency-in-lccs-relative-snowfall-efficeny" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lcc_wo_snow_NH</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">lcc_wo_snow_SH</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">sf_lcc_NH</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">sf_lcc_SH</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lwp_lcc2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">rf_lcc_wo_snow</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">n</span>

    <span class="n">lcc_wo_snow_NH</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">rf_lcc_wo_snow</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">)))</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">),</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">lcc_wo_snow_SH</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">rf_lcc_wo_snow</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">)))</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">),</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    
    
    <span class="n">n</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;prsn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">f</span><span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_lcc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">rf_sf_lcc</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">n</span>
    
    <span class="n">sf_lcc_NH</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">rf_sf_lcc</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">)))</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">),</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">sf_lcc_SH</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">rf_sf_lcc</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">)))</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">),</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">lcc_wo_snow_NH</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">lcc_wo_snow_NH</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">)</span>
        <span class="n">lcc_wo_snow_SH</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">lcc_wo_snow_SH</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">)</span>
        
        <span class="n">sf_lcc_NH</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">sf_lcc_NH</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">)</span>
        <span class="n">sf_lcc_SH</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">sf_lcc_SH</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">continue</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratios</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
<span class="n">_da</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lcc_wo_snow_NH</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">_coord</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lcc_wo_snow_NH</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_NH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">objs</span><span class="o">=</span><span class="n">_da</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">_coord</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;concat_dim&#39;</span><span class="p">:</span><span class="s1">&#39;model&#39;</span><span class="p">})</span>
    
<span class="n">_da</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lcc_wo_snow_SH</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">_coord</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lcc_wo_snow_SH</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_SH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">objs</span><span class="o">=</span><span class="n">_da</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">_coord</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;concat_dim&#39;</span><span class="p">:</span><span class="s1">&#39;model&#39;</span><span class="p">})</span>
<span class="n">_da</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sf_lcc_NH</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">_coord</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sf_lcc_NH</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_lcc_NH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">objs</span><span class="o">=</span><span class="n">_da</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">_coord</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;concat_dim&#39;</span><span class="p">:</span><span class="s1">&#39;model&#39;</span><span class="p">})</span>
<span class="n">_da</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sf_lcc_SH</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">_coord</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sf_lcc_SH</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_lcc_SH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">objs</span><span class="o">=</span><span class="n">_da</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">_coord</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;concat_dim&#39;</span><span class="p">:</span><span class="s1">&#39;model&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_era0</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;/scratch/franzihe/output/ERA5/daily_means/model_grid/ERA5_daily_mean_ERA5_200701_201012.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">71</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ds_era0</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">opendataset</span><span class="p">(</span><span class="s1">&#39;/scratch/franzihe/output/ERA5/daily_means/model_grid/ERA5_daily_mean_ERA5_200701_201012.nc&#39;</span><span class="p">)</span>

<span class="ne">AttributeError</span>: module &#39;xarray&#39; has no attribute &#39;opendataset&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">axsm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_NH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">add_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_SH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">add_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_lcc_NH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">add_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_lcc_SH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">add_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;relative freq. from LCCs&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span><span class="s1">&#39;Arctic&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;relative freq. from LCCs&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span><span class="s1">&#39;Antarctic&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;relative precip. freq. in LCCs&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;relative precip. freq. in LCCs&#39;</span><span class="p">)</span>


<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.01</span><span class="p">,</span> <span class="mf">.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">.102</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f8239e54fa05354d823ce4d222d1005879f94978543dbadb940dc2366b72d1bc.png" src="../_images/f8239e54fa05354d823ce4d222d1005879f94978543dbadb940dc2366b72d1bc.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="load-era5-data-in-model-resolutions">
<h1>Load ERA5 data in model resolutions<a class="headerlink" href="#load-era5-data-in-model-resolutions" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_era</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">ds_era</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/ERA5/daily_means/model_grid/*</span><span class="si">{}</span><span class="s1">*.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span><span class="n">model</span><span class="p">)))</span>
    
    <span class="c1"># remove leap day from dataset</span>
    <span class="n">ds_era</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_era</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=~</span><span class="p">((</span><span class="n">ds_era</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_era</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="mi">29</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="differences-model-era5">
<h1>Differences Model - ERA5<a class="headerlink" href="#differences-model-era5" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plt_seasonal_diff</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">cbar_label</span><span class="p">,</span> <span class="n">plt_title</span><span class="p">):</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">axsm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">ncols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">)})</span>

    <span class="n">coast</span> <span class="o">=</span> <span class="n">cy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="s1">&#39;physical&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;110m&#39;</span><span class="p">,</span>
                            <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;coastline&#39;</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:</span><span class="mi">4</span><span class="p">],</span> <span class="n">variable</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
        <span class="c1"># ax.add_feature(cy.feature.COASTLINE, alpha=0.5)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">coast</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">45</span><span class="p">],</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
        <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span>   <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">variable</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">vik</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span><span class="s1">&#39;season = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">4</span><span class="p">:],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span> <span class="n">variable</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">i</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">SouthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
        <span class="c1"># ax.add_feature(cy.feature.COASTLINE, alpha=0.5)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">coast</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">45</span><span class="p">],</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
        <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span>   <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">cf</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">vik</span><span class="p">,</span><span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span><span class="s1">&#39;season = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>

    <span class="n">cbaxes</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">1.0125</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">])</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbaxes</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">cbar_label</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">plt_title</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">);</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="difference-cummulative-snowfall-days">
<h2>Difference Cummulative snowfall days<a class="headerlink" href="#difference-cummulative-snowfall-days" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_count&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ds_era</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lcc_count&#39;</span><span class="p">]</span>
    <span class="n">plt_title</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> - ERA5&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">cbar_label</span> <span class="o">=</span> <span class="s1">&#39;Difference - cummulative snowfall days&#39;</span>
    
    <span class="n">plt_seasonal_diff</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">cbar_label</span><span class="p">,</span> <span class="n">plt_title</span><span class="p">)</span>
    
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_diff_cum_sf_days_season_mean_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/67f08fac44a4cb93c5d71186cdd085c8ab6e4ddfe790b485be7bf7ca604c8b0a.png" src="../_images/67f08fac44a4cb93c5d71186cdd085c8ab6e4ddfe790b485be7bf7ca604c8b0a.png" />
<img alt="../_images/210f2ae49b9edf5ac921712af0237dc7034ba159c92782eaf23cd0c4cf44a457.png" src="../_images/210f2ae49b9edf5ac921712af0237dc7034ba159c92782eaf23cd0c4cf44a457.png" />
<img alt="../_images/07f58a5d71178bb290ec71be1962b96e3f7f7248f308f6a7758898d874a0c637.png" src="../_images/07f58a5d71178bb290ec71be1962b96e3f7f7248f308f6a7758898d874a0c637.png" />
<img alt="../_images/8453421d073dfab8e7d69b5bcfe8ba37003cb58dd734b6a207d5e0b8e9b244f9.png" src="../_images/8453421d073dfab8e7d69b5bcfe8ba37003cb58dd734b6a207d5e0b8e9b244f9.png" />
<img alt="../_images/9714640fa3bdec8733f7b81fc000d3eede6002bfbb03ecdc362aff65e372697f.png" src="../_images/9714640fa3bdec8733f7b81fc000d3eede6002bfbb03ecdc362aff65e372697f.png" />
<img alt="../_images/e963b0f7bc4a867e327815ce650b102e82f905608783e2c95aa6f2b5455bf3e2.png" src="../_images/e963b0f7bc4a867e327815ce650b102e82f905608783e2c95aa6f2b5455bf3e2.png" />
<img alt="../_images/aba89ff3b74b51a11b315591dc953a420847d8f07049ed57d44669fd08638fe5.png" src="../_images/aba89ff3b74b51a11b315591dc953a420847d8f07049ed57d44669fd08638fe5.png" />
</div>
</div>
</section>
<section id="difference-frequencys">
<h2>Difference Frequencys<a class="headerlink" href="#difference-frequencys" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="c1"># Difference relative frequency lccs without snow requirement</span>
    <span class="n">rf_lcc_wo_snow</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;rf_lcc_wo_snow&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ds_era</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;rf_lcc_wo_snow&#39;</span><span class="p">]</span>
    <span class="n">plt_title</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> - ERA5&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
    <span class="n">cbar_label</span> <span class="o">=</span> <span class="s1">&#39;Difference - LCCs&#39;</span>
    <span class="n">plt_seasonal_diff</span><span class="p">(</span><span class="n">rf_lcc_wo_snow</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span><span class="n">cbar_label</span><span class="p">,</span> <span class="n">plt_title</span><span class="p">)</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_diff_rf_lcc_wo_snow_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    
    <span class="c1"># Difference relative frequency precipitating LCCs</span>
    <span class="n">rf_lcc</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;rf_lcc&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ds_era</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;rf_lcc&#39;</span><span class="p">]</span>
    <span class="n">plt_title</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> - ERA5&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
    <span class="n">cbar_label</span> <span class="o">=</span> <span class="s1">&#39;Difference - precip. LCCs&#39;</span>
    
    <span class="n">plt_seasonal_diff</span><span class="p">(</span><span class="n">rf_lcc</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">cbar_label</span><span class="p">,</span> <span class="n">plt_title</span><span class="p">)</span>
    
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_diff_rf_lcc_w_snow_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Difference relative frequency precipitation from LCCss</span>
    <span class="n">rf_sf_lcc</span> <span class="o">=</span> <span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;rf_sf_lcc&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ds_era</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;rf_sf_lcc&#39;</span><span class="p">]</span>
    <span class="n">plt_title</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> - ERA5&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
    <span class="n">cbar_label</span> <span class="o">=</span> <span class="s1">&#39;Difference - LCC precip.&#39;</span>
    
    <span class="n">plt_seasonal_diff</span><span class="p">(</span><span class="n">rf_sf_lcc</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">cbar_label</span><span class="p">,</span> <span class="n">plt_title</span><span class="p">)</span>
    
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_diff_rf_sf_lcc_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ded7c1d03b0faf87ee78d38148b9511794cbfd6d5697c02387eb8ee9a4e2a26c.png" src="../_images/ded7c1d03b0faf87ee78d38148b9511794cbfd6d5697c02387eb8ee9a4e2a26c.png" />
<img alt="../_images/7c0bdb91abf665ebfb355652c37046f941368983380954111c230af49f8cd508.png" src="../_images/7c0bdb91abf665ebfb355652c37046f941368983380954111c230af49f8cd508.png" />
<img alt="../_images/a1caf059afeb8a74a78a6bad3b2a70e98d79f8fb140870c5940a563dad093778.png" src="../_images/a1caf059afeb8a74a78a6bad3b2a70e98d79f8fb140870c5940a563dad093778.png" />
<img alt="../_images/01c19869d3e9b517fb664b553053421a9610a3c664b3ae1755ee5c209ac6df2c.png" src="../_images/01c19869d3e9b517fb664b553053421a9610a3c664b3ae1755ee5c209ac6df2c.png" />
<img alt="../_images/77e7e0ab0f46ae0ade695a5c5fdb2ab4547522dbf9ec4e3b892595644809583c.png" src="../_images/77e7e0ab0f46ae0ade695a5c5fdb2ab4547522dbf9ec4e3b892595644809583c.png" />
<img alt="../_images/0748fd7c6b7da15aa5b05628a773ce0d3f584f64989bb5478a628a4c6595ea86.png" src="../_images/0748fd7c6b7da15aa5b05628a773ce0d3f584f64989bb5478a628a4c6595ea86.png" />
<img alt="../_images/76d9b8bbf7c800009b60010a554276744eacb10d21ff188dad6041bb64605cee.png" src="../_images/76d9b8bbf7c800009b60010a554276744eacb10d21ff188dad6041bb64605cee.png" />
<img alt="../_images/027b63fbb254305c417f1d8ab1c0c92c67896fdc05148a54dca341a34bf11cd5.png" src="../_images/027b63fbb254305c417f1d8ab1c0c92c67896fdc05148a54dca341a34bf11cd5.png" />
<img alt="../_images/a615617848f9c0b39115e5b15e42ceaa97036e5115ebd6c6cd72b0638165fea8.png" src="../_images/a615617848f9c0b39115e5b15e42ceaa97036e5115ebd6c6cd72b0638165fea8.png" />
<img alt="../_images/68e45c448deb2fb41ba22a868b181abf4dbe0d3a1e2f38456bcff4f16b191f67.png" src="../_images/68e45c448deb2fb41ba22a868b181abf4dbe0d3a1e2f38456bcff4f16b191f67.png" />
<img alt="../_images/5938398775d81397d1dfe9a46b642d1d8f0ae11914a3f3a45003d8d3cbea980d.png" src="../_images/5938398775d81397d1dfe9a46b642d1d8f0ae11914a3f3a45003d8d3cbea980d.png" />
<img alt="../_images/a42d7a5fac2ec809a2ee6179c93d3444130901fad0694cee354465d0bfec38be.png" src="../_images/a42d7a5fac2ec809a2ee6179c93d3444130901fad0694cee354465d0bfec38be.png" />
<img alt="../_images/a5006480c36ec7d995ff3983bb102e9cb8e667891c7780b2f936fb81c82af5a4.png" src="../_images/a5006480c36ec7d995ff3983bb102e9cb8e667891c7780b2f936fb81c82af5a4.png" />
<img alt="../_images/b7dcbf31add58b837384e3a73496a429a3dc6f1c7be28bfa60c7de2ee80e1e09.png" src="../_images/b7dcbf31add58b837384e3a73496a429a3dc6f1c7be28bfa60c7de2ee80e1e09.png" />
<img alt="../_images/17c72a38955518d397b76780b2d7438f8fbc3547e725a39c66bb928b998ea360.png" src="../_images/17c72a38955518d397b76780b2d7438f8fbc3547e725a39c66bb928b998ea360.png" />
<img alt="../_images/7634d1a329908311de2d8b5e494b6a7dca759bd015f06f49678e9af4e97fda0c.png" src="../_images/7634d1a329908311de2d8b5e494b6a7dca759bd015f06f49678e9af4e97fda0c.png" />
<img alt="../_images/1d9056151a316a36bbdbe7e6ac4a738e7db0263622bec9277603ca9f2b48f6f6.png" src="../_images/1d9056151a316a36bbdbe7e6ac4a738e7db0263622bec9277603ca9f2b48f6f6.png" />
<img alt="../_images/6d8e7354c0c1d65577cb5b6b34ef7300179ca24f9d912aff5764c51348dfea9d.png" src="../_images/6d8e7354c0c1d65577cb5b6b34ef7300179ca24f9d912aff5764c51348dfea9d.png" />
<img alt="../_images/b436fdcf6fe0b2d52259cf6d69549018204d6e2f83f3025556746c518080dced.png" src="../_images/b436fdcf6fe0b2d52259cf6d69549018204d6e2f83f3025556746c518080dced.png" />
<img alt="../_images/e5c429d19d8eeb2f2def169ef1a87f3bae4b2ff6753ee806b26bd8be3b65f380.png" src="../_images/e5c429d19d8eeb2f2def169ef1a87f3bae4b2ff6753ee806b26bd8be3b65f380.png" />
<img alt="../_images/e64bc90b88396ecc21034c22a8a94b0bba3136e3b974d515ddf0970b869a7314.png" src="../_images/e64bc90b88396ecc21034c22a8a94b0bba3136e3b974d515ddf0970b869a7314.png" />
</div>
</div>
</section>
<section id="difference-total-water-path">
<h2>Difference total water path<a class="headerlink" href="#difference-total-water-path" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">dset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

    <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
    
    <span class="c1"># total water path</span>
    <span class="n">ds_era</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;twp_lcc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_era</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;iwp_lcc&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ds_era</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;lwp_lcc&#39;</span><span class="p">]</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;twp_lcc&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ds_era</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;twp_lcc&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">plt_seasonal_diff</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="s1">&#39;Diff. total water path [kg m-2]&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> - ERA5&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_diff_twp_sf_days_season_mean_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    
    
    <span class="c1"># snowfall difference for snowfall days</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="p">(</span><span class="n">dset_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_lcc&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ds_era</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;sf_lcc&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    
    <span class="n">plt_seasonal_diff</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="s1">&#39;Diff. Snowfall [mm]&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> - ERA5&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_diff_sf_sf_days_season_mean_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/bc19a895a69300ddda10acfd33b527a587b54a423f3a06a066719a73f62b38da.png" src="../_images/bc19a895a69300ddda10acfd33b527a587b54a423f3a06a066719a73f62b38da.png" />
<img alt="../_images/852aa817c03863cb89632c680e3c3ad64dec8e097ddbc16f0c08a2c632e12831.png" src="../_images/852aa817c03863cb89632c680e3c3ad64dec8e097ddbc16f0c08a2c632e12831.png" />
<img alt="../_images/11e1402ecc9b22709436633bc27fc3fc64204b3818841246aa34d55efd704b52.png" src="../_images/11e1402ecc9b22709436633bc27fc3fc64204b3818841246aa34d55efd704b52.png" />
<img alt="../_images/e1d349092101634f39cdcbe72b487abc443c00d0c0c524caef882201cc77897f.png" src="../_images/e1d349092101634f39cdcbe72b487abc443c00d0c0c524caef882201cc77897f.png" />
<img alt="../_images/428dafe8b651c57bfac154777254fd9690cce636683d42ca16ade058dee3552a.png" src="../_images/428dafe8b651c57bfac154777254fd9690cce636683d42ca16ade058dee3552a.png" />
<img alt="../_images/70922c8ecf0e83e4b0fdc53949b57869611d9a6be3589aa9e2236862fb1eb5cc.png" src="../_images/70922c8ecf0e83e4b0fdc53949b57869611d9a6be3589aa9e2236862fb1eb5cc.png" />
<img alt="../_images/109d8f64dce66bc3f49835e6f2b2bcf53b0289e839934e8ab07f3475baf2161a.png" src="../_images/109d8f64dce66bc3f49835e6f2b2bcf53b0289e839934e8ab07f3475baf2161a.png" />
<img alt="../_images/81128b9baf61e7f51e6637a2e180e3abe83158622de73110da5d4cd2132e3469.png" src="../_images/81128b9baf61e7f51e6637a2e180e3abe83158622de73110da5d4cd2132e3469.png" />
<img alt="../_images/439d4cf80bede73c15a108c5f3fd52038c16d76fcae79dc5cbdc358897e21017.png" src="../_images/439d4cf80bede73c15a108c5f3fd52038c16d76fcae79dc5cbdc358897e21017.png" />
<img alt="../_images/bc1f00d3f53902d12f1d05a704b6fcaaf0ea498719aebfd7b6870a92bc2217be.png" src="../_images/bc1f00d3f53902d12f1d05a704b6fcaaf0ea498719aebfd7b6870a92bc2217be.png" />
<img alt="../_images/c8e91cc11bc0ab5c7ecacf618ebc615cfd6dde67f16309f246de9f85077feb5c.png" src="../_images/c8e91cc11bc0ab5c7ecacf618ebc615cfd6dde67f16309f246de9f85077feb5c.png" />
<img alt="../_images/4cd3cb2357017b84ada8f1068d8197ae83f4b07601111deea311a3d1e395dfba.png" src="../_images/4cd3cb2357017b84ada8f1068d8197ae83f4b07601111deea311a3d1e395dfba.png" />
<img alt="../_images/69586319beaba0341bf67fa2e493546d1b1fc69559d07c07892feecf59521d72.png" src="../_images/69586319beaba0341bf67fa2e493546d1b1fc69559d07c07892feecf59521d72.png" />
<img alt="../_images/2c9ee2f057ec8efa4964edb49bc9d442b8ff52b344d80038f6cf3637be90b733.png" src="../_images/2c9ee2f057ec8efa4964edb49bc9d442b8ff52b344d80038f6cf3637be90b733.png" />
</div>
</div>
</section>
<section id="calendar">
<h2>Calendar<a class="headerlink" href="#calendar" title="Permalink to this heading">#</a></h2>
<p>Not all models in CMIP6 use the same calendar. Hence we double check the time axis. Later, when we regrid to the same horizontal resolution (<a href="#regrid_hz">Regrid CMIP6 data</a>) we will assign the same calendars for each model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # metadata of the historical run:</span>
<span class="c1"># _d2 = pd.Series([&quot;calendar&quot;,</span>
<span class="c1">#                  &quot;branch_time_in_parent&quot;, #&quot;parent_activity_id&quot;, &quot;parent_experiment_id&quot;,	&quot;parent_mip_era&quot;,</span>
<span class="c1">#                  &quot;parent_source_id&quot;,#&quot;parent_sub_experiment_id&quot;, </span>
<span class="c1">#                  &quot;parent_time_units&quot;,# &quot;parent_variant_label&quot;</span>
<span class="c1">#                   ])</span>
<span class="c1"># _d2 = pd.DataFrame(_d2).rename(columns={0:&#39;index&#39;})</span>
<span class="c1"># for model in dset_dict.keys():</span>
<span class="c1">#     _data = []</span>
<span class="c1">#     _names =[]</span>
<span class="c1">#     _data.append(dset_dict[model].time.to_index().calendar)</span>
<span class="c1">#     for k, v in dset_dict[model].attrs.items():</span>
        
<span class="c1">#         if &#39;parent_time_units&#39; in k or &#39;branch_time_in_parent&#39; in k or &#39;parent_source_id&#39; in k:</span>
<span class="c1">#             _data.append(v)</span>
<span class="c1">#             _names.append(k)</span>
<span class="c1">#     _d2 = pd.concat([_d2,   pd.Series(_data)], axis=1)</span>

<span class="c1"># _d2.dropna(how=&#39;all&#39;, axis=1, inplace=True)</span>
<span class="c1"># _d2 = _d2.set_index(&#39;index&#39;)</span>
<span class="c1"># _d2.columns = _d2.loc[&#39;parent_source_id&#39;]</span>
<span class="c1"># _d2.drop(&#39;parent_source_id&#39;).T</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="show-attributes-and-individual-identifier">
<h2>Show attributes and individual identifier<a class="headerlink" href="#show-attributes-and-individual-identifier" title="Permalink to this heading">#</a></h2>
<p>… is going to be the reference model for the horizontal grid. The <code class="docutils literal notranslate"><span class="pre">xarray</span></code> datasets inside <code class="docutils literal notranslate"><span class="pre">dset_dict</span></code> can be extracted as any value in a Python dictionary.</p>
<p>The dictonary key is the source_id from <code class="docutils literal notranslate"><span class="pre">list_models</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for model in dset_dict.keys():</span>
<span class="c1">#     print(&#39;Institution: {}, \</span>
<span class="c1">#           Model: {},   \</span>
<span class="c1">#           Nominal res: {},  \</span>
<span class="c1">#           lon x lat, level, top,: {}, \</span>
<span class="c1">#           tracking_id: {}&#39;.format(dset_dict[model].attrs[&#39;institution_id&#39;],</span>
<span class="c1">#                                   dset_dict[model].attrs[&#39;source_id&#39;], </span>
<span class="c1">#                                   dset_dict[model].attrs[&#39;nominal_resolution&#39;], </span>
<span class="c1">#                                   dset_dict[model].attrs[&#39;source&#39;],</span>
<span class="c1">#                                   dset_dict[model].attrs[&#39;tracking_id&#39;]))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="assign-attributes-to-the-variables">
<h2>Assign attributes to the variables<a class="headerlink" href="#assign-attributes-to-the-variables" title="Permalink to this heading">#</a></h2>
<p>We will assign the attributes to the variables as in ERA5 to make CMIP6 and ERA5 variables comperable.</p>
<ul class="simple">
<li><p><a class="reference external" href="http://clipc-services.ceda.ac.uk/dreq/u/62f26742cf240c1b5169a5cd511196b6.html"><code class="docutils literal notranslate"><span class="pre">pr</span></code></a> and <a class="reference external" href="http://clipc-services.ceda.ac.uk/dreq/u/051919eddec810e292c883205c944ceb.html"><code class="docutils literal notranslate"><span class="pre">prsn</span></code></a> in <strong>kg m-2 s-1</strong> <span class="math notranslate nohighlight">\(\rightarrow\)</span> Multiply by <strong>3600</strong> to get <strong>mm h-1</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># now = datetime.utcnow()</span>
<span class="c1"># for model in dset_dict.keys():</span>
<span class="c1"># # </span>
<span class="c1">#     for var_id in dset_dict[model].keys():</span>
         
<span class="c1">#         if var_id == &#39;prsn&#39;:</span>
<span class="c1">#             dset_dict[model][var_id] = dset_dict[model][var_id]*3600</span>
<span class="c1">#             dset_dict[model][var_id] = dset_dict[model][var_id].assign_attrs({&#39;standard_name&#39;: &#39;snowfall_flux&#39;,</span>
<span class="c1">#     &#39;long_name&#39;: &#39;Snowfall Flux&#39;,</span>
<span class="c1">#     &#39;comment&#39;: &#39;At surface; includes precipitation of all forms of water in the solid phase&#39;,</span>
<span class="c1">#     &#39;units&#39;: &#39;mm h-1&#39;,</span>
<span class="c1">#     &#39;original_units&#39;: &#39;kg m-2 s-1&#39;,</span>
<span class="c1">#     &#39;history&#39;: &quot;{}Z altered by F. Hellmuth: Converted units from &#39;kg m-2 s-1&#39; to &#39;mm h-1&#39;.&quot;.format(now.strftime(&quot;%d/%m/%Y %H:%M:%S&quot;)),</span>
<span class="c1">#     &#39;cell_methods&#39;: &#39;area: time: mean&#39;,</span>
<span class="c1">#     &#39;cell_measures&#39;: &#39;area: areacella&#39;})</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="interpolate-from-cmip6-hybrid-sigma-pressure-levels-to-era5-isobaric-pressure-levels">
<h2>Interpolate from CMIP6 hybrid sigma-pressure levels to ERA5 isobaric pressure levels<a class="headerlink" href="#interpolate-from-cmip6-hybrid-sigma-pressure-levels-to-era5-isobaric-pressure-levels" title="Permalink to this heading">#</a></h2>
<p>The vertical variables in the CMIP6 models are in hybrid sigma-pressure levels. Hence the vertical variable in the xarray datasets in <code class="docutils literal notranslate"><span class="pre">dset_dict</span></code> will be calculated by using the formula:
$<span class="math notranslate nohighlight">\( P(i,j,k) = hyam(k) p0 + hybm(k) ps(i,j)\)</span>$
to calculate the pressure</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Rename datasets with different naming convention for constant hyam</span>
<span class="c1"># for model in dset_dict.keys():</span>
<span class="c1">#     if (&#39;a&#39; in list(dset_dict[model].keys())) == True:</span>
<span class="c1">#         dset_dict[model] = dset_dict[model].rename({&#39;a&#39;:&#39;ap&#39;, &#39;a_bnds&#39;: &#39;ap_bnds&#39;})</span>
<span class="c1">#     if model == &#39;IPSL-CM6A-LR&#39;:</span>
<span class="c1">#         dset_dict[model] = dset_dict[model].rename({&#39;presnivs&#39;:&#39;plev&#39;})</span>
<span class="c1">#     if model == &#39;IPSL-CM5A2-INCA&#39;:</span>
<span class="c1">#         dset_dict[model] = dset_dict[model].rename({&#39;lev&#39;:&#39;plev&#39;})</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for model in dset_dict.keys():</span>
<span class="c1">#     for var_id in dset_dict[model].keys():#[&#39;clw&#39;, &#39;cli&#39;]:</span>
<span class="c1">#         if var_id == &#39;clw&#39; or var_id == &#39;cli&#39;:</span>
<span class="c1">#             # Convert the model level to isobaric levels</span>
<span class="c1">#             #### ap, b, ps, p0</span>
<span class="c1">#             if (&#39;ap&#39; in list(dset_dict[model].keys())) == True and \</span>
<span class="c1">#                 (&#39;ps&#39; in list(dset_dict[model].keys())) == True and \</span>
<span class="c1">#                 (&#39;p0&#39; in list(dset_dict[model].keys())) == True:</span>
<span class="c1">#                 if (&#39;lev&#39; in list(dset_dict[model][var_id].coords)) == True and \</span>
<span class="c1">#                     (&#39;lev&#39; in list(dset_dict[model][&#39;ap&#39;].coords)) == True and \</span>
<span class="c1">#                     (&#39;lev&#39; in list(dset_dict[model][&#39;b&#39;].coords)) == True:</span>
<span class="c1">#                         print(model, var_id, &#39;lev, ap, ps, p0&#39;)</span>
<span class="c1">#                         # dset_dict[model][var_id] = gc.interpolation.interp_hybrid_to_pressure(data = dset_dict[model][var_id],</span>
<span class="c1">#                         #                                                                                 ps   = dset_dict[model][&#39;ps&#39;], </span>
<span class="c1">#                         #                                                                                 hyam = dset_dict[model][&#39;ap&#39;], </span>
<span class="c1">#                         #                                                                                 hybm = dset_dict[model][&#39;b&#39;], </span>
<span class="c1">#                         #                                                                                 p0   = dset_dict[model][&#39;p0&#39;], </span>
<span class="c1">#                         #                                                                                 new_levels=new_levels,</span>
<span class="c1">#                         #                                                                                 lev_dim=&#39;lev&#39;)</span>
<span class="c1">#                         dset_dict[model][&#39;plev&#39;] = dset_dict[model][&#39;ap&#39;]*dset_dict[model][&#39;p0&#39;] + dset_dict[model][&#39;b&#39;]*dset_dict[model][&#39;ps&#39;]</span>
<span class="c1">#                         dset_dict[model][&#39;plev&#39;] = dset_dict[model][&#39;plev&#39;].transpose(&#39;time&#39;, &#39;lev&#39;,&#39;lat&#39;,&#39;lon&#39;)</span>
                
<span class="c1">#                 if (&#39;plev&#39; in list(dset_dict[model][var_id].coords)) == True:</span>
<span class="c1">#                     print(model, var_id, &#39;variable on pressure levels&#39;, )</span>
<span class="c1">#                 # if (&#39;lev&#39; in list(dset_dict[model][var_id].coords)) == True and \</span>
<span class="c1">#                 #     (&#39;lev&#39; in list(dset_dict[model][&#39;ap&#39;].coords)) == False and \</span>
<span class="c1">#                 #     (&#39;lev&#39; in list(dset_dict[model][&#39;b&#39;].coords)) == False:</span>
<span class="c1">#                 #         print(model, &#39;variable on pressure levels&#39;, &#39;lev, ap, ps,&#39;)</span>
<span class="c1">#             # Convert the model level to isobaric levels</span>
<span class="c1">#             #### ap, b, p0</span>
<span class="c1">#             if (&#39;ap&#39; in list(dset_dict[model].keys())) == True and \</span>
<span class="c1">#                 (&#39;ps&#39; in list(dset_dict[model].keys())) == True and \</span>
<span class="c1">#                 (&#39;p0&#39; in list(dset_dict[model].keys())) == False:</span>
<span class="c1">#                 if (&#39;lev&#39; in list(dset_dict[model][var_id].coords)) == True and \</span>
<span class="c1">#                     (&#39;lev&#39; in list(dset_dict[model][&#39;ap&#39;].coords)) == True and \</span>
<span class="c1">#                     (&#39;lev&#39; in list(dset_dict[model][&#39;b&#39;].coords)) == True:</span>
<span class="c1">#                         print(model,var_id, &#39;lev, ap, ps,&#39;)</span>
<span class="c1">#                         # dset_dict[model][var_id] = gc.interpolation.interp_hybrid_to_pressure(data = dset_dict[model][var_id],</span>
<span class="c1">#                         #                                                                                 ps   = dset_dict[model][&#39;ps&#39;], </span>
<span class="c1">#                         #                                                                                 hyam = dset_dict[model][&#39;ap&#39;], </span>
<span class="c1">#                         #                                                                                 hybm = dset_dict[model][&#39;b&#39;], </span>
<span class="c1">#                         #                                                                                 new_levels=new_levels,</span>
<span class="c1">#                         #                                                                                 lev_dim=&#39;lev&#39;)</span>
<span class="c1">#                         dset_dict[model][&#39;plev&#39;] = dset_dict[model][&#39;ap&#39;] + dset_dict[model][&#39;b&#39;]*dset_dict[model][&#39;ps&#39;]</span>
<span class="c1">#                         dset_dict[model][&#39;plev&#39;] = dset_dict[model][&#39;plev&#39;].transpose(&#39;time&#39;, &#39;lev&#39;,&#39;lat&#39;,&#39;lon&#39;)</span>
                
<span class="c1">#                 if (&#39;plev&#39; in list(dset_dict[model][var_id].coords)) == True:</span>
<span class="c1">#                     print(model, var_id, &#39;variable on pressure levels&#39;, )</span>
                
<span class="c1">#             if (&#39;b&#39; in list(dset_dict[model].keys())) == True and \</span>
<span class="c1">#                 (&#39;orog&#39; in list(dset_dict[model].keys())) == True:</span>
<span class="c1">#                 if (&#39;lev&#39; in list(dset_dict[model][var_id].coords)) == True and \</span>
<span class="c1">#                     (&#39;lev&#39; in list(dset_dict[model][&#39;pfull&#39;].coords)) == True:</span>
<span class="c1">#                         print(model, &#39;hybrid height coordinate&#39;)</span>
                
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculate-liquid-water-path-from-content">
<h2>Calculate liquid water path from content<a class="headerlink" href="#calculate-liquid-water-path-from-content" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for model in dset_dict.keys():</span>
    
<span class="c1">#     if (&#39;plev&#39; in list(dset_dict[model].keys())) == True:</span>
<span class="c1">#         print(model, &#39;plev&#39;)</span>
<span class="c1">#         _lwp = xr.DataArray(data=da.full(shape=dset_dict[model][&#39;clw&#39;].shape,fill_value=np.nan),</span>
<span class="c1">#                                 dims=dset_dict[model][&#39;clw&#39;].dims,</span>
<span class="c1">#                                 coords=dset_dict[model][&#39;clw&#39;].coords)</span>
<span class="c1">#         # lev2 is the atmospheric pressure, lower in the atmosphere than lev. Sigma-pressure coordinates are from 1 to 0, with 1 at the surface</span>
<span class="c1">#         for i in range(len(dset_dict[model][&#39;lev&#39;])-1):</span>
<span class="c1">#             # calculate pressure difference between two levels</span>
<span class="c1">#             dp = (dset_dict[model][&#39;plev&#39;].isel(lev=i) - dset_dict[model][&#39;plev&#39;].isel(lev=i+1))</span>
<span class="c1">#             # calculate mean liquid water content between two layers</span>
<span class="c1">#             dlwc = (dset_dict[model][&#39;clw&#39;].isel(lev=i) + dset_dict[model][&#39;clw&#39;].isel(lev=i+1))/2</span>
<span class="c1">#             # calculate liquid water path between two layers</span>
<span class="c1">#             _lwp[:,i,:,:] = dp[:,:,:]/9.81 * dlwc[:,:,:]</span>
        
<span class="c1">#             # sum over all layers to ge the liquid water path in the atmospheric column</span>
<span class="c1">#             dset_dict[model][&#39;lwp&#39;] = _lwp.sum(dim=&#39;lev&#39;,skipna=True)</span>
            
<span class="c1">#             # assign attributes to data array</span>
<span class="c1">#             dset_dict[model][&#39;lwp&#39;] = dset_dict[model][&#39;lwp&#39;].assign_attrs(dset_dict[model][&#39;clw&#39;].attrs)</span>
<span class="c1">#             dset_dict[model][&#39;lwp&#39;] = dset_dict[model][&#39;lwp&#39;].assign_attrs({&#39;long_name&#39;:&#39;Liquid Water Path&#39;, </span>
<span class="c1">#                                                                             &#39;units&#39; : &#39;kg m-2&#39;,</span>
<span class="c1">#                                                                                 &#39;mipTable&#39;:&#39;&#39;, &#39;out_name&#39;: &#39;lwp&#39;,</span>
<span class="c1">#                                                                                 &#39;standard_name&#39;: &#39;atmosphere_mass_content_of_cloud_liquid_water&#39;,</span>
<span class="c1">#                                                                                 &#39;title&#39;: &#39;Liquid Water Path&#39;,</span>
<span class="c1">#                                                                                 &#39;variable_id&#39;: &#39;lwp&#39;, &#39;original_units&#39;: &#39;kg/kg&#39;,</span>
<span class="c1">#                                                                                 &#39;history&#39;: &quot;{}Z altered by F. Hellmuth: Interpolate data from hybrid-sigma levels to isobaric levels with P=a*p0 + b*psfc. Calculate lwp with hydrostatic equation.&quot;.format(now.strftime(&quot;%d/%m/%Y %H:%M:%S&quot;))})</span>
<span class="c1">#         # when ice water path does not exist</span>
<span class="c1">#         if (&#39;clivi&#39; in list(dset_dict[model].keys())) == False:</span>
<span class="c1">#             _iwp = xr.DataArray(data=da.full(shape=dset_dict[model][&#39;cli&#39;].shape,fill_value=np.nan),</span>
<span class="c1">#                                     dims=dset_dict[model][&#39;cli&#39;].dims,</span>
<span class="c1">#                                     coords=dset_dict[model][&#39;cli&#39;].coords)</span>
<span class="c1">#             # lev2 is the atmospheric pressure, lower in the atmosphere than lev. Sigma-pressure coordinates are from 1 to 0, with 1 at the surface</span>
<span class="c1">#             for i in range(len(dset_dict[model][&#39;lev&#39;])-1):</span>
<span class="c1">#                 # calculate pressure difference between two levels</span>
<span class="c1">#                 dp = (dset_dict[model][&#39;plev&#39;].isel(lev=i) - dset_dict[model][&#39;plev&#39;].isel(lev=i+1))</span>
<span class="c1">#                 # calculate mean liquid water content between two layers</span>
<span class="c1">#                 diwc = (dset_dict[model][&#39;cli&#39;].isel(lev=i) + dset_dict[model][&#39;cli&#39;].isel(lev=i+1))/2</span>
<span class="c1">#                 # calculate liquid water path between two layers</span>
<span class="c1">#                 _iwp[:,i,:,:] = dp[:,:,:]/9.81 * diwc[:,:,:]</span>
            
                
<span class="c1">#                 # sum over all layers to ge the Ice water path in the atmospheric column</span>
<span class="c1">#                 dset_dict[model][&#39;clivi&#39;] = _iwp.sum(dim=&#39;lev&#39;,skipna=True)</span>
                
<span class="c1">#                 # assign attributes to data array</span>
<span class="c1">#                 dset_dict[model][&#39;clivi&#39;] = dset_dict[model][&#39;clivi&#39;].assign_attrs(dset_dict[model][&#39;cli&#39;].attrs)</span>
<span class="c1">#                 dset_dict[model][&#39;clivi&#39;] = dset_dict[model][&#39;clivi&#39;].assign_attrs({&#39;long_name&#39;:&#39;Ice Water Path&#39;, </span>
<span class="c1">#                                                                                 &#39;units&#39; : &#39;kg m-2&#39;,</span>
<span class="c1">#                                                                                     &#39;mipTable&#39;:&#39;&#39;, &#39;out_name&#39;: &#39;clivi&#39;,</span>
<span class="c1">#                                                                                     &#39;standard_name&#39;: &#39;atmosphere_mass_content_of_cloud_ice_water&#39;,</span>
<span class="c1">#                                                                                     &#39;title&#39;: &#39;Ice Water Path&#39;,</span>
<span class="c1">#                                                                                     &#39;variable_id&#39;: &#39;clivi&#39;, &#39;original_units&#39;: &#39;kg/kg&#39;,</span>
<span class="c1">#                                                                                     &#39;history&#39;: &quot;{}Z altered by F. Hellmuth: Interpolate data from hybrid-sigma levels to isobaric levels with P=a*p0 + b*psfc. Calculate clivi with hydrostatic equation.&quot;.format(now.strftime(&quot;%d/%m/%Y %H:%M:%S&quot;))})</span>
            
<span class="c1">#     if (&#39;plev&#39; in list(dset_dict[model].coords)) == True:</span>
<span class="c1">#         print(model, &#39;plev coord&#39;)</span>
<span class="c1">#         _lwp = xr.DataArray(data=da.full(shape=dset_dict[model][&#39;clw&#39;].shape,fill_value=np.nan),</span>
<span class="c1">#                                 dims=dset_dict[model][&#39;clw&#39;].dims,</span>
<span class="c1">#                                 coords=dset_dict[model][&#39;clw&#39;].coords)</span>
<span class="c1">#         # lev2 is the atmospheric pressure, lower in the atmosphere than lev. Sigma-pressure coordinates are from 1 to 0, with 1 at the surface</span>
<span class="c1">#         for i in range(len(dset_dict[model][&#39;plev&#39;])-1):</span>
<span class="c1">#             # calculate pressure difference between two levels</span>
<span class="c1">#             dp = (dset_dict[model][&#39;plev&#39;].isel(plev=i) - dset_dict[model][&#39;plev&#39;].isel(plev=i+1))</span>
<span class="c1">#             # calculate mean liquid water content between two layers</span>
<span class="c1">#             dlwc = (dset_dict[model][&#39;clw&#39;].isel(plev=i) + dset_dict[model][&#39;clw&#39;].isel(plev=i+1))/2</span>
<span class="c1">#             # calculate liquid water path between two layers</span>
<span class="c1">#             _lwp[:,i,:,:] = dp/9.81 * dlwc[:,:,:]</span>
        
<span class="c1">#             # sum over all layers to ge the liquid water path in the atmospheric column</span>
<span class="c1">#             dset_dict[model][&#39;lwp&#39;] = _lwp.sum(dim=&#39;plev&#39;,skipna=True)</span>
            
<span class="c1">#             # assign attributes to data array</span>
<span class="c1">#             dset_dict[model][&#39;lwp&#39;] = dset_dict[model][&#39;lwp&#39;].assign_attrs(dset_dict[model][&#39;clw&#39;].attrs)</span>
<span class="c1">#             dset_dict[model][&#39;lwp&#39;] = dset_dict[model][&#39;lwp&#39;].assign_attrs({&#39;long_name&#39;:&#39;Liquid Water Path&#39;, </span>
<span class="c1">#                                                                             &#39;units&#39; : &#39;kg m-2&#39;,</span>
<span class="c1">#                                                                                 &#39;mipTable&#39;:&#39;&#39;, &#39;out_name&#39;: &#39;lwp&#39;,</span>
<span class="c1">#                                                                                 &#39;standard_name&#39;: &#39;atmosphere_mass_content_of_cloud_liquid_water&#39;,</span>
<span class="c1">#                                                                                 &#39;title&#39;: &#39;Liquid Water Path&#39;,</span>
<span class="c1">#                                                                                 &#39;variable_id&#39;: &#39;lwp&#39;, &#39;original_units&#39;: &#39;kg/kg&#39;,</span>
<span class="c1">#                                                                                 &#39;history&#39;: &quot;{}Z altered by F. Hellmuth: Interpolate data from hybrid-sigma levels to isobaric levels with P=a*p0 + b*psfc. Calculate lwp with hydrostatic equation.&quot;.format(now.strftime(&quot;%d/%m/%Y %H:%M:%S&quot;))})</span>
<span class="c1">#         # when ice water path does not exist</span>
<span class="c1">#         if (&#39;clivi&#39; in list(dset_dict[model].keys())) == False:</span>
<span class="c1">#             _iwp = xr.DataArray(data=da.full(shape=dset_dict[model][&#39;cli&#39;].shape,fill_value=np.nan),</span>
<span class="c1">#                                     dims=dset_dict[model][&#39;cli&#39;].dims,</span>
<span class="c1">#                                     coords=dset_dict[model][&#39;cli&#39;].coords)</span>
<span class="c1">#             # lev2 is the atmospheric pressure, lower in the atmosphere than lev. Sigma-pressure coordinates are from 1 to 0, with 1 at the surface</span>
<span class="c1">#             for i in range(len(dset_dict[model][&#39;plev&#39;])-1):</span>
<span class="c1">#                 # calculate pressure difference between two levels</span>
<span class="c1">#                 dp = (dset_dict[model][&#39;plev&#39;].isel(plev=i) - dset_dict[model][&#39;plev&#39;].isel(plev=i+1))</span>
<span class="c1">#                 # calculate mean liquid water content between two layers</span>
<span class="c1">#                 diwc = (dset_dict[model][&#39;cli&#39;].isel(plev=i) + dset_dict[model][&#39;cli&#39;].isel(plev=i+1))/2</span>
<span class="c1">#                 # calculate liquid water path between two layers</span>
<span class="c1">#                 _iwp[:,i,:,:] = dp/9.81 * diwc[:,:,:]</span>
            
                
<span class="c1">#                 # sum over all layers to ge the Ice water path in the atmospheric column</span>
<span class="c1">#                 dset_dict[model][&#39;clivi&#39;] = _iwp.sum(dim=&#39;plev&#39;,skipna=True)</span>
                
<span class="c1">#                 # assign attributes to data array</span>
<span class="c1">#                 dset_dict[model][&#39;clivi&#39;] = dset_dict[model][&#39;clivi&#39;].assign_attrs(dset_dict[model][&#39;clw&#39;].attrs)</span>
<span class="c1">#                 dset_dict[model][&#39;clivi&#39;] = dset_dict[model][&#39;clivi&#39;].assign_attrs({&#39;long_name&#39;:&#39;Ice Water Path&#39;, </span>
<span class="c1">#                                                                                 &#39;units&#39; : &#39;kg m-2&#39;,</span>
<span class="c1">#                                                                                     &#39;mipTable&#39;:&#39;&#39;, &#39;out_name&#39;: &#39;clivi&#39;,</span>
<span class="c1">#                                                                                     &#39;standard_name&#39;: &#39;atmosphere_mass_content_of_cloud_ice_water&#39;,</span>
<span class="c1">#                                                                                     &#39;title&#39;: &#39;Ice Water Path&#39;,</span>
<span class="c1">#                                                                                     &#39;variable_id&#39;: &#39;clivi&#39;, &#39;original_units&#39;: &#39;kg/kg&#39;,</span>
<span class="c1">#                                                                                     &#39;history&#39;: &quot;{}Z altered by F. Hellmuth: Interpolate data from hybrid-sigma levels to isobaric levels with P=a*p0 + b*psfc. Calculate clivi with hydrostatic equation.&quot;.format(now.strftime(&quot;%d/%m/%Y %H:%M:%S&quot;))})</span>
            
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># lwp_count_month = dset_dict[model][&#39;lwp_lcc&#39;].groupby(&#39;time.month&#39;).count(dim=&#39;time&#39;)</span>
<span class="c1"># lwp_count_season = dset_dict[model][&#39;lwp&#39;].groupby(&#39;time.season&#39;).count(dim=&#39;time&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># lcc_freq_djf = (lwp_count_month.sel(month=12)+lwp_count_month.sel(month=1)+lwp_count_month.sel(month=2)) / lwp_count_season.sel(season=&#39;DJF&#39;)</span>
<span class="c1"># lcc_freq_mam = (lwp_count_month.sel(month=3) + lwp_count_month.sel(month=4) + lwp_count_month.sel(month=5)) / lwp_count_season.sel(season=&#39;MAM&#39;)</span>
<span class="c1"># lcc_freq_jja = (lwp_count_month.sel(month=6) + lwp_count_month.sel(month=7) + lwp_count_month.sel(month=8)) / lwp_count_season.sel(season=&#39;JJA&#39;)</span>
<span class="c1"># lcc_freq_son = (lwp_count_month.sel(month=9) + lwp_count_month.sel(month=10) + lwp_count_month.sel(month=11)) / lwp_count_season.sel(season=&#39;SON&#39;)</span>

<span class="c1"># lcc_freq = xr.concat([lcc_freq_djf, lcc_freq_mam, lcc_freq_jja, lcc_freq_son], dim=&#39;season&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plt_seasonal_NH_SH(lcc_freq, np.arange(0,1.1,0.1), &#39;LCC frequency&#39;, model)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h2>Open CMIP6 variables<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<p>… by using <code class="docutils literal notranslate"><span class="pre">intake</span></code> from <a class="reference external" href="https://gallery.pangeo.io/repos/pangeo-data/pangeo-tutorial-gallery/intake.html">pangeo.io</a>, specifically <code class="docutils literal notranslate"><span class="pre">intake-esm</span></code>.</p>
<p>An example on <a class="reference external" href="https://pangeo-data.github.io/pangeo-cmip6-cloud/accessing_data.html#loading-an-esm-collection">Loading an ESM collection</a> and <a class="reference external" href="https://pangeo-data.github.io/pangeo-cmip6-cloud/accessing_data.html#searching-for-datasets">searching for datasets</a> can also be found on the <a class="reference external" href="https://pangeo-data.github.io/pangeo-cmip6-cloud/accessing_data.html">Pangeo / ESGF Cloud Data Working Group documentation</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># cat_url = &quot;https://storage.googleapis.com/cmip6/pangeo-cmip6.json&quot;</span>
<span class="c1"># col = intake.open_esm_datastore(cat_url)</span>
<span class="c1"># col</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id2">
<h2>Search corresponding data<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<p>Get the data required for the analysis. Define variables, models, experiment, and time resolution as defined in <a href="#data_wrangling">2. Data Wrangling</a>
.</p>
<ul class="simple">
<li><p>use member_id = ‘r1i1p1f1’.</p></li>
<li><p>using intake-esm’s <code class="docutils literal notranslate"><span class="pre">search()</span></code> function:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">col.search(variable_id,</span> <span class="pre">source_id,</span> <span class="pre">experiment_id,</span> <span class="pre">table_id,</span> <span class="pre">member_id,</span> <span class="pre">institution_id,</span> <span class="pre">grid_label)</span></code></p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ## Variables</span>
<span class="c1"># variable_id=[</span>
<span class="c1">#             &#39;cli&#39;,</span>
<span class="c1">#             &#39;clivi&#39;,</span>
<span class="c1">#             &#39;clw&#39;,</span>
<span class="c1">#             # &#39;lwp&#39;,</span>
<span class="c1">#             # &#39;pr&#39;,</span>
<span class="c1">#             &#39;prsn&#39;,</span>
<span class="c1">#             # &#39;ta&#39;, </span>
<span class="c1">#             &#39;tas&#39;</span>
<span class="c1">#              ]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ## Models</span>
<span class="c1"># # list_models = [</span>
<span class="c1"># #     &#39;NorESM2-MM&#39;,</span>
<span class="c1"># #     &#39;TaiESM1&#39;,</span>
<span class="c1"># #     &#39;EC-Earth3-AerChem&#39;,</span>
<span class="c1"># #     &#39;GFDL-ESM4&#39;,</span>
<span class="c1"># #     &#39;SAM0-UNICON&#39;,</span>
<span class="c1"># #     &#39;CAMS-CSM1-0&#39;,</span>
<span class="c1"># #     &#39;CMCC-CM2-HR4&#39;,</span>
<span class="c1"># #     &#39;MPI-ESM1-2-HR&#39;,</span>
<span class="c1"># #     &#39;BCC-CSM2-MR&#39;,</span>
<span class="c1"># #     &#39;E3SM-1-1&#39;,</span>
<span class="c1"># #     &#39;CMCC-CM2-SR5&#39;,</span>
<span class="c1"># #     &#39;CMCC-ESM2&#39;,</span>
<span class="c1"># #     &#39;FGOALS-f3-L&#39;,</span>
<span class="c1"># #     &#39;E3SM-1-1-ECA&#39;,</span>
<span class="c1"># #     &#39;CIESM&#39;,</span>
<span class="c1"># #     &#39;GFDL-CM4&#39;,</span>
<span class="c1"># #     &#39;MRI-ESM2-0&#39;]  </span>

<span class="c1"># list_models = [&#39;MIROC6&#39;, &#39;CESM2&#39;, &#39;CanESM5&#39;, &#39;AWI-ESM-1-1-LR&#39;, &#39;MPI-ESM1-2-LR&#39;,</span>
<span class="c1">#        &#39;UKESM1-0-LL&#39;, &#39;HadGEM3-GC31-LL&#39;, &#39;CNRM-CM6-1&#39;, &#39;CNRM-ESM2-1&#39;,</span>
<span class="c1">#        &#39;IPSL-CM6A-LR&#39;, &#39;IPSL-CM5A2-INCA&#39;]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ## experiment</span>
<span class="c1"># experiment_id = [&#39;historical&#39;]</span>

<span class="c1"># ## time resolution</span>
<span class="c1"># t_res = [&#39;day&#39;, &#39;CFday&#39;]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ## search for variables, models, ...</span>
<span class="c1"># cat = col.search(variable_id=variable_id, source_id=list_models, experiment_id=experiment_id, table_id = t_res, member_id=[&#39;r1i1p1f1&#39;])</span>
<span class="c1"># # cat.df</span>
<span class="c1"># ## show the CMIP6 models found in pandas Dataframe </span>
<span class="c1"># cat.df[&#39;source_id&#39;].unique()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-dictionary-from-the-list-of-datasets-we-found">
<h2>Create dictionary from the list of datasets we found<a class="headerlink" href="#create-dictionary-from-the-list-of-datasets-we-found" title="Permalink to this heading">#</a></h2>
<p>Load the found datasets into xarray dataset containers using intake-esm’s <code class="docutils literal notranslate"><span class="pre">to_dataset_dict()</span></code> function, which yields a Python dictionary.</p>
<blockquote>
<div><p><strong><em>NOTE:</em></strong> This step may take several minutes so be patient!</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># dset_dict = cat.to_dataset_dict(zarr_kwargs={&#39;use_cftime&#39;:True,})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># dset_dict.keys()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # list all merged datasets and show coordinates</span>
<span class="c1"># for keys, ds in dset_dict.items():</span>
<span class="c1">#     print(&#39;{}: {}&#39;.format(keys, list(ds.dims)))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id3">
<h2>Calendar<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h2>
<p>Not all models in CMIP6 use the same calendar. Hence we double check the time axis. Later, when we regrid to the same horizontal resolution (<a href="#regrid_hz">Regrid CMIP6 data</a>) we will assign the same calendars for each model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # metadata of the historical run:</span>
<span class="c1"># _d2 = pd.Series([&quot;calendar&quot;,</span>
<span class="c1">#                  &quot;branch_time_in_parent&quot;, #&quot;parent_activity_id&quot;, &quot;parent_experiment_id&quot;,	&quot;parent_mip_era&quot;,</span>
<span class="c1">#                  &quot;parent_source_id&quot;,#&quot;parent_sub_experiment_id&quot;, </span>
<span class="c1">#                  &quot;parent_time_units&quot;,# &quot;parent_variant_label&quot;</span>
<span class="c1">#                   ])</span>
<span class="c1"># _d2 = pd.DataFrame(_d2).rename(columns={0:&#39;index&#39;})</span>
<span class="c1"># for i in dset_dict.keys():</span>
<span class="c1">#     _data = []</span>
<span class="c1">#     _names =[]</span>
<span class="c1">#     _data.append(dset_dict[i].time.to_index().calendar)</span>
<span class="c1">#     for k, v in dset_dict[i].attrs.items():</span>
        
<span class="c1">#         if &#39;parent_time_units&#39; in k or &#39;branch_time_in_parent&#39; in k or &#39;parent_source_id&#39; in k:</span>
<span class="c1">#             _data.append(v)</span>
<span class="c1">#             _names.append(k)</span>
<span class="c1">#     _d2 = pd.concat([_d2,   pd.Series(_data)], axis=1)</span>

<span class="c1"># _d2.dropna(how=&#39;all&#39;, axis=1, inplace=True)</span>
<span class="c1"># _d2 = _d2.set_index(&#39;index&#39;)</span>
<span class="c1"># _d2.columns = _d2.loc[&#39;parent_source_id&#39;]</span>
<span class="c1"># _d2.drop(&#39;parent_source_id&#39;).T</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id4">
<h2>Show attributes and individual identifier<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h2>
<p>NorESM2-MM is going to be the reference model for the horizontal grid. The <code class="docutils literal notranslate"><span class="pre">xarray</span></code> datasets inside <code class="docutils literal notranslate"><span class="pre">dset_dict</span></code> can be extracted as any value in a Python dictionary.</p>
<p>The dictonary key for NorESM2-MM is: <strong><a class="reference external" href="http://CMIP.NCC.NorESM2-MM.historical.Amon.gn">CMIP.NCC.NorESM2-MM.historical.Amon.gn</a></strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># if variable_id[0] == &#39;lwp&#39;:</span>
<span class="c1">#     ds = dset_dict[&#39;CMIP.NCC.NorESM2-MM.historical.AERmon.gn&#39;]</span>
<span class="c1"># else:</span>
<span class="c1">#     ds = dset_dict[&#39;CMIP.NCC.NorESM2-MM.historical.Amon.gn&#39;]</span>
    

<span class="c1">## attributes of the xarray dataset </span>
<span class="c1"># ds[variable_id[0]].attrs, ds.attrs[&#39;tracking_id&#39;]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># dset_dict.keys()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for model in dset_dict.keys():</span>
<span class="c1">#     for keys in dset_dict[model].keys():</span>
<span class="c1">#         print(model, keys)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id5">
<h2>Assign attributes to the variables<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h2>
<p>We will assign the attributes to the variables as in ERA5 to make CMIP6 and ERA5 variables comperable.</p>
<ul class="simple">
<li><p><a class="reference external" href="http://clipc-services.ceda.ac.uk/dreq/u/dd916e3e2eca18cda5d9f81749d0c91c.html"><code class="docutils literal notranslate"><span class="pre">cli</span></code></a> and <a class="reference external" href="http://clipc-services.ceda.ac.uk/dreq/u/86b2b3318a73839edfafa9d46864aadc.html"><code class="docutils literal notranslate"><span class="pre">clw</span></code></a> in <strong>kg kg-1</strong> <span class="math notranslate nohighlight">\(\rightarrow\)</span> Multiply by <strong>1000</strong> to get <strong>g kg-1</strong></p></li>
<li><p><a class="reference external" href="http://clipc-services.ceda.ac.uk/dreq/u/73c496f5669cc122cf1cddfe4df2a27a.html"><code class="docutils literal notranslate"><span class="pre">clivi</span></code></a> and <a class="reference external" href="http://clipc-services.ceda.ac.uk/dreq/u/e6b31a1928879fcd3c92fe7b592f070e.html"><code class="docutils literal notranslate"><span class="pre">lwp</span></code></a> in <strong>kg m-2</strong> <span class="math notranslate nohighlight">\(\rightarrow\)</span> Multiply by <strong>1000</strong> to get <strong>g m-2</strong></p></li>
<li><p><a class="reference external" href="http://clipc-services.ceda.ac.uk/dreq/u/62f26742cf240c1b5169a5cd511196b6.html"><code class="docutils literal notranslate"><span class="pre">pr</span></code></a> and <a class="reference external" href="http://clipc-services.ceda.ac.uk/dreq/u/051919eddec810e292c883205c944ceb.html"><code class="docutils literal notranslate"><span class="pre">prsn</span></code></a> in <strong>kg m-2 s-1</strong> <span class="math notranslate nohighlight">\(\rightarrow\)</span> Multiply by <strong>86400</strong> to get <strong>mm day-1</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for var_id in variable_id:</span>
<span class="c1">#     for keys in dset_dict.keys():</span>
<span class="c1">#         if var_id == &#39;cli&#39; or var_id == &#39;clw&#39; or var_id == &#39;lwp&#39; or var_id  == &#39;clivi&#39;:</span>
<span class="c1">#             dset_dict[keys][var_id] = dset_dict[keys][var_id]*1000</span>
<span class="c1">#             if var_id == &#39;cli&#39;:</span>
<span class="c1">#                 dset_dict[keys][var_id].attrs = {&#39;units&#39;: &#39;g kg-1&#39;, &#39;long_name&#39;: &#39;Mass Fraction of Cloud Ice&#39;, &#39;standard_name&#39;: &#39;mass_fraction_of_cloud_ice_in_air&#39;, &#39;comment&#39;: &#39;Includes both large-scale and convective cloud. This is calculated as the mass of cloud ice in the grid cell divided by the mass of air (including the water in all phases) in the grid cell. It includes precipitating hydrometeors ONLY if the precipitating hydrometeors affect the calculation of radiative transfer in model.&#39;, &#39;cell_methods&#39;: &#39;area: time: mean (interval: 5 minutes)&#39;, &#39;cell_measures&#39;: &#39;area: areacella&#39;,}</span>
<span class="c1">#             if var_id == &#39;clw&#39;:</span>
<span class="c1">#                 dset_dict[keys][var_id].attrs = {&#39;units&#39;: &#39;g kg-1&#39;, &#39;long_name&#39;: &#39;Mass Fraction of Cloud Liquid Water&#39;, &#39;standard_name&#39;: &#39;mass_fraction_of_cloud_liquid_water_in_air&#39;, &#39;comment&#39;: &#39;Includes both large-scale and convective cloud. Calculate as the mass of cloud liquid water in the grid cell divided by the mass of air (including the water in all phases) in the grid cells. Precipitating hydrometeors are included ONLY if the precipitating hydrometeors affect the calculation of radiative transfer in model.&#39;, &#39;cell_methods&#39;: &#39;area: time: mean&#39;, &#39;cell_measures&#39;: &#39;area: areacella&#39;}</span>
<span class="c1">#             if var_id == &#39;clivi&#39;:</span>
<span class="c1">#                 dset_dict[keys][var_id].attrs = {&#39;units&#39;: &#39;g m-2&#39;, &#39;long_name&#39;: &#39;Ice Water Path&#39;, &#39;comment&#39;: &#39;mass of ice water in the column divided by the area of the column (not just the area of the cloudy portion of the column). Includes precipitating frozen hydrometeors ONLY if the precipitating hydrometeor affects the calculation of radiative transfer in model.&#39;, &#39;cell_methods&#39;: &#39;area: time: mean&#39;, &#39;cell_measures&#39;: &#39;area: areacella&#39;} </span>
<span class="c1">#             if var_id == &#39;lwp&#39;:</span>
<span class="c1">#                 dset_dict[keys][var_id].attrs = {&#39;units&#39;: &#39;g m-2&#39;, &#39;long_name&#39;: &#39;Liquid Water Path&#39;, &#39;comment&#39;: &#39;The total mass of liquid water in cloud per unit area.&#39;, &#39;cell_methods&#39;: &#39;area: time: mean&#39;, &#39;cell_measures&#39;: &#39;area: areacella&#39;}</span>

<span class="c1">#         if var_id == &#39;pr&#39; or var_id == &#39;prsn&#39;:</span>
<span class="c1">#             try: </span>
<span class="c1">#                 dset_dict[keys][var_id] = dset_dict[keys][var_id]*86400</span>
<span class="c1">#                 if var_id == &#39;pr&#39;:</span>
<span class="c1">#                     dset_dict[keys][var_id].attrs = {&#39;units&#39;: &#39;mm day-1&#39;, &#39;long_name&#39;: &#39;Precipitation&#39;, &#39;comment&#39;: &#39;includes both liquid and solid phases&#39;,&#39;cell_methods&#39;: &#39;area: time: mean&#39;, &#39;cell_measures&#39;: &#39;area: areacella&#39;}</span>
<span class="c1">#                 if var_id == &#39;prsn&#39;:</span>
<span class="c1">#                     dset_dict[keys][var_id].attrs = {&#39;units&#39;: &#39;mm day-1&#39;, &#39;long_name&#39;: &#39;Snowfall&#39;, &#39;comment&#39;: &#39;At surface; includes precipitation of all forms of water in the solid phase&#39;, &#39;cell_methods&#39;: &#39;area: time: mean&#39;, &#39;cell_measures&#39;: &#39;area: areacella&#39;}</span>
<span class="c1">#             except KeyError:</span>
<span class="c1">#                 continue</span>
        
</pre></div>
</div>
</div>
</div>
</section>
<section id="id6">
<h2>Interpolate from CMIP6 hybrid sigma-pressure levels to ERA5 isobaric pressure levels<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h2>
<p>The vertical variables in the CMIP6 models are in hybrid sigma-pressure levels. Hence the vertical variable in the xarray datasets in <code class="docutils literal notranslate"><span class="pre">dset_dict</span></code> will be calculated by using the <a class="reference external" href="https://geocat-comp.readthedocs.io/en/latest/index.html#">GeoCAT-comb</a> function to <a class="reference external" href="https://geocat-comp.readthedocs.io/en/latest/user_api/generated/geocat.comp.interpolation.interp_hybrid_to_pressure.html#geocat.comp.interpolation.interp_hybrid_to_pressure">interpolate data from hybrid-sigma levels to isobaric levels</a>.</p>
<p>The GeoCAT-comb function takes the following input:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>:   Multidimensional data array, which holds hybrid-sigma levels and has a lev_dim coordinate.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ps</span></code>:     A multi-dimensional array of surface pressures (Pa), same time/space shape as data. Not all variables include the surface pressure, hence we will search the <code class="docutils literal notranslate"><span class="pre">Pangeo.io</span></code> catalog to find the surface pressure associated with the model.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hyam</span></code>:     One-dimensional arrays containing the hybrid A coefficients. Must have the same dimension size as the lev_dim dimension of data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hybm</span></code>:     One-dimensional arrays containing the hybrid B coefficients. Must have the same dimension size as the lev_dim dimension of data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p0</span></code>:       Scalar numeric value equal to surface reference pressure (Pa). Defaults to 100000 Pa.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">new_levels</span></code>: A one-dimensional array of output pressure levels (Pa). We will use the pressure of <code class="docutils literal notranslate"><span class="pre">air_temperature</span></code> (19 levels).</p></li>
</ul>
<div class="math notranslate nohighlight">
\[ P(i,j,k) = hyam(k) p0 + hybm(k) ps(i,j)\]</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">geocat</span>

<span class="n">geocat</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">interpolation</span><span class="o">.</span><span class="n">interp_hybrid_to_pressure</span><span class="p">(</span><span class="n">data</span>      <span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">],</span> 
                                                    <span class="n">ps</span>        <span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;ps&#39;</span><span class="p">],</span> 
                                                    <span class="n">hyam</span>      <span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">],</span> 
                                                    <span class="n">hybm</span>      <span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span> 
                                                    <span class="n">p0</span>        <span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;p0&#39;</span><span class="p">],</span> 
                                                    <span class="n">new_levels</span><span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;plev&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # load the levels from the ERA5 file and transfer to Pa</span>
<span class="c1"># era_level = (xr.open_dataset(&#39;/scratch/franzihe/input/ERA5/monthly_means/0.25deg/clwc_Amon_ERA5_198501_198912.nc&#39;)[&#39;level&#39;])*100</span>

<span class="c1"># if ((&#39;clw&#39; or &#39;cli&#39; or &#39;ta&#39;) in variable_id) == True:</span>
<span class="c1">#     # if var_id == &#39;clw&#39; or var_id == &#39;cli&#39;:</span>
<span class="c1">#     for keys in dset_dict.keys():</span>
<span class="c1">#         # rename cmip pressure level for atmospheric temperature</span>
<span class="c1">#         dset_dict[keys] = dset_dict[keys].rename({&#39;plev&#39;:&#39;clev&#39;})</span>
<span class="c1">#         # interpolate from hybrid to pressure levels for clw and cli</span>
<span class="c1">#         for var_id in [variable_id[variable_id.index(&#39;clw&#39;)], variable_id[variable_id.index(&#39;cli&#39;)]]:</span>

<span class="c1">#             if (&#39;ps&#39; in list(dset_dict[keys].keys())) == False:     # valid for models which don&#39;t provide ps in the clw or cli dataset</span>
<span class="c1">#                 model = keys.split(&#39;.&#39;)[2]</span>
<span class="c1">#                 ds_ps = col.search(source_id=model, table_id = [&#39;Amon&#39;, ], experiment_id=[&#39;historical&#39;], variable_id=[&#39;ps&#39;,&#39;p0&#39;, ], member_id=[&#39;r1i1p1f1&#39;]).to_dataset_dict(zarr_kwargs={&#39;use_cftime&#39;:True,}, )</span>
<span class="c1">#                 dset_dict[keys].update(ds_ps[keys], )</span>
<span class="c1">#                 dset_dict[keys][&#39;ps&#39;] = dset_dict[keys][&#39;ps&#39;].isel(member_id = 0)</span>
                
                
<span class="c1">#             # Rename datasets with different naming convention for constant A</span>
<span class="c1">#             if (&#39;a&#39; in list(dset_dict[keys].keys())) == False:</span>
<span class="c1">#                 dset_dict[keys] = dset_dict[keys].rename({&#39;ap&#39;:&#39;a&#39;, &#39;ap_bnds&#39;: &#39;a_bnds&#39;})</span>
                    
                    
<span class="c1">#             # Convert the model level to isobaric levels</span>
<span class="c1">#             #### a, b, ps, p0</span>
<span class="c1">#             if (&#39;a&#39; in list(dset_dict[keys].keys())) == True and (&#39;b&#39; in list(dset_dict[keys].keys())) == True and (&#39;p0&#39; in list(dset_dict[keys].keys())) == True and (&#39;ps&#39; in list(dset_dict[keys].keys())) == True:</span>
<span class="c1">#                 dset_dict[keys][&#39;{}_interp&#39;.format(var_id)] = gc.interpolation.interp_hybrid_to_pressure(data=dset_dict[keys][var_id].isel(member_id = 0), </span>
<span class="c1">#                                                                                                                 ps=dset_dict[keys][&#39;ps&#39;],hyam=dset_dict[keys][&#39;a&#39;],</span>
<span class="c1">#                                                                                                                 hybm=dset_dict[keys][&#39;b&#39;],</span>
<span class="c1">#                                                                                                                 p0=dset_dict[keys][&#39;p0&#39;].values, </span>
<span class="c1">#                                                                                                                 new_levels=(era_level).values, )</span>
<span class="c1">#                 # # remove the variables needed for the calculation of the isobaric levels. If this step is not performed, </span>
<span class="c1">#                 # # the horizontal regridding will not be possible.</span>
<span class="c1">#                 # dset_dict[keys] = dset_dict[keys].drop((&#39;a&#39;, &#39;p0&#39;, &#39;b&#39;, &#39;ps&#39;, &#39;a_bnds&#39;, &#39;b_bnds&#39;, var_id))</span>
<span class="c1">#                 dset_dict[keys] = dset_dict[keys].drop((var_id))</span>
<span class="c1">#                 dset_dict[keys] = dset_dict[keys].rename({&#39;{}_interp&#39;.format(var_id):var_id})</span>

<span class="c1">#             #### a, b, ps</span>
<span class="c1">#             elif (&#39;a&#39; in list(dset_dict[keys].keys())) == True and (&#39;b&#39; in list(dset_dict[keys].keys())) == True and (&#39;ps&#39; in list(dset_dict[keys].keys())) == True and (&#39;p0&#39; in list(dset_dict[keys].keys())) == False:</span>
<span class="c1">#                 dset_dict[keys][&#39;{}_interp&#39;.format(var_id)] = gc.interpolation.interp_hybrid_to_pressure(data=dset_dict[keys][var_id].isel(member_id=0), </span>
<span class="c1">#                                                                                                                 ps=dset_dict[keys][&#39;ps&#39;],</span>
<span class="c1">#                                                                                                                 hyam=dset_dict[keys][&#39;a&#39;], </span>
<span class="c1">#                                                                                                                 hybm=dset_dict[keys][&#39;b&#39;],</span>
<span class="c1">#                                                                                                                 p0=100000.0,</span>
<span class="c1">#                                                                                                                 new_levels=(era_level).values, )</span>
<span class="c1">#                 # dset_dict[keys] = dset_dict[keys].drop((&#39;a&#39;, &#39;b&#39;, &#39;ps&#39;, &#39;a_bnds&#39;, &#39;b_bnds&#39;, var_id))</span>
<span class="c1">#                 dset_dict[keys] = dset_dict[keys].drop((var_id))</span>
<span class="c1">#                 dset_dict[keys] = dset_dict[keys].rename({&#39;{}_interp&#39;.format(var_id):var_id})</span>
        
<span class="c1">#         # remove the variables needed for the calculation of the isobaric levels. If this step is not performed, </span>
<span class="c1">#         # the horizontal regridding will not be possible.</span>
<span class="c1">#         if (&#39;p0&#39; in list(dset_dict[keys].keys())) == True:</span>
<span class="c1">#             dset_dict[keys] = dset_dict[keys].drop((&#39;a&#39;, &#39;p0&#39;, &#39;b&#39;, &#39;ps&#39;, &#39;a_bnds&#39;, &#39;b_bnds&#39;,))</span>
<span class="c1">#         elif (&#39;p0&#39; in list(dset_dict[keys].keys())) == False:</span>
<span class="c1">#             dset_dict[keys] = dset_dict[keys].drop((&#39;a&#39;, &#39;b&#39;, &#39;ps&#39;, &#39;a_bnds&#39;, &#39;b_bnds&#39;,))</span>
 
</pre></div>
</div>
</div>
</div>
</section>
<section id="regrid-cmip6-data-to-noresm2-mm-grid-a-id-regrid-hz-a">
<h2>Regrid CMIP6 data to NorESM2-MM grid <a id='regrid_hz'></a><a class="headerlink" href="#regrid-cmip6-data-to-noresm2-mm-grid-a-id-regrid-hz-a" title="Permalink to this heading">#</a></h2>
<p>We want to conduct statistical analysis at the annual and seasonal timescales to determine the biases in cloud phase and precipitation (liquid and solid) in the CMIP6 models. At the moment we have all historical data from the CMIP6 models. For this, we will have to extract the 30-year period between 1985 and 2014.</p>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> Define a start and end year.</p>
<p>The CMIP6 high resolution models have approximately a nominal resolution of 100km. But not all have identical grid spacing. Hence we will make use of the python package <code class="docutils literal notranslate"><span class="pre">xesmf</span></code> and the documentation on <a class="reference external" href="https://xesmf.readthedocs.io/en/latest/notebooks/Compare_algorithms.html#Decreasing-resolution">decreasing resolution</a>, <a class="reference external" href="https://xesmf.readthedocs.io/en/latest/notebooks/Masking.html?highlight=conservative#Limitations-and-warnings">Limitations and warnings</a>.</p>
<p>NorESM2-MM will be the reference grid since we want to compare the models to the ERA5 data. The ERA5 data has a nominal resolution of 0.25deg and has been regridded to the same horizontal resolution as the NorESM2-MM in <a class="reference internal" href="../ERA5/ERA5_1985-2014.html"><span class="doc std std-doc">the ERA5 Jupyter Notebook</span></a>.</p>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> Define NorESM2-MM as the reference grid <code class="docutils literal notranslate"><span class="pre">ds_out</span></code>.</p>
<p>Create a new Python dictionary (<code class="docutils literal notranslate"><span class="pre">ds_gridded_dict</span></code>) with the regridded CMIP6 <code class="docutils literal notranslate"><span class="pre">xarray</span></code> datasets between 1985 an 2014. Save each regridded model to a <code class="docutils literal notranslate"><span class="pre">netcdf</span></code>, locally.</p>
<blockquote>
<div><p><strong><em>NOTE:</em></strong> This step may take several minutes!</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># starty = 1985; endy = 2014</span>
<span class="c1"># year_range = range(starty, endy+1)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ds_out = dset_dict[&#39;CMIP.NCC.NorESM2-MM.historical.Amon.gn&#39;]</span>
<span class="c1"># ds_in  = dset_dict[model]</span>

<span class="c1"># import xesmf</span>

<span class="c1"># # Regridder data</span>
<span class="c1"># regridder = xesmf.Regridder(ds_in, ds_out, &quot;conservative&quot;)</span>

<span class="c1"># # Apply regridder to data</span>
<span class="c1">#  # the entire dataset can be processed at once</span>
<span class="c1"># ds_in_regrid = regridder(ds_in)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # create dictionary for reggridded data</span>
<span class="c1"># ds_gridded_dict = dict()</span>

<span class="c1"># # Read in the output grid from NorESM</span>
<span class="c1"># if variable_id[0] == &#39;lwp&#39;:</span>
<span class="c1">#     ds_out = dset_dict[&#39;CMIP.NCC.NorESM2-MM.historical.AERmon.gn&#39;].isel(member_id = 0)</span>
<span class="c1"># else:</span>
<span class="c1">#     ds_out = dset_dict[&#39;CMIP.NCC.NorESM2-MM.historical.Amon.gn&#39;].isel(member_id = 0)</span>
<span class="c1"># ds_out = ds_out.sel(time = ds_out.time.dt.year.isin(year_range)).squeeze()</span>


<span class="c1"># counter = 0</span>

<span class="c1"># for keys in dset_dict.keys():</span>
<span class="c1">#     # select only models which have atmospheric monthly values</span>
<span class="c1">#     amon = keys.split(&#39;.&#39;)[-2]</span>
<span class="c1">#     if amon == &#39;Amon&#39; or amon == &#39;AERmon&#39;: </span>
<span class="c1">#         # select model name </span>
<span class="c1">#         model = keys.split(&#39;.&#39;)[2]</span>
        
<span class="c1">#         # select where data should be saved</span>
<span class="c1">#         if len(variable_id) &gt; 1:</span>
<span class="c1">#             filename = &#39;{}_Amon_1deg_{}01_{}12.nc&#39;.format(variable_id, starty, endy)</span>
<span class="c1">#         elif len([variable_id]) == 1:</span>
<span class="c1">#             filename = &#39;{}_Amon_1deg_{}01_{}12.nc&#39;.format(variable_id[0], starty, endy)</span>
<span class="c1">#         # filename = &#39;{}_Amon_1deg_{}01_{}12.nc&#39;.format(variable_id[0], starty, endy)</span>
<span class="c1">#         savepath = &#39;/scratch/franzihe/output/CMIP6_hist/1deg/{}/&#39;.format(model)</span>
<span class="c1">#         nc_out = savepath + filename</span>
<span class="c1">#         files = glob(nc_out)</span>
        
<span class="c1">#         # Input data from CMIP6 model to be regridded</span>
<span class="c1">#         ds_in = dset_dict[keys].isel(member_id = 0)</span>
<span class="c1">#         ds_in = ds_in.sel(time = ds_in.time.dt.year.isin(year_range)).squeeze()</span>
            
<span class="c1">#         # common time grid</span>
<span class="c1">#         ds_in[&#39;time&#39;] = ds_out[&#39;time&#39;]</span>
            

<span class="c1">#         # Regrid data</span>
<span class="c1">#         ds_in_regrid = fct.regrid_data(ds_in, ds_out)</span>


<span class="c1">#         # Shift the longitude from 0--&gt;360 to -180--&gt;180 and sort by longitude and time</span>
<span class="c1">#         ds_in_regrid = ds_in_regrid.assign_coords(lon=(((ds_in_regrid.lon + 180) % 360) - 180)).sortby(&#39;lon&#39;).sortby(&#39;time&#39;)</span>
<span class="c1">#         ds_in_regrid = ds_in_regrid.reset_coords(names=[&#39;time_bnds&#39;, ], drop=True)</span>
            
            
<span class="c1">#         # create dataset with all models</span>
<span class="c1">#         ds_gridded_dict[model] = ds_in_regrid</span>

<span class="c1">#         # if nc_out in files:</span>
<span class="c1">#         #     print(&#39;{} is downloaded&#39;.format(nc_out))</span>
<span class="c1">#         #     counter += 1</span>
<span class="c1">#         #     print(&#39;Have regridded in total: {:} files&#39;.format(str(counter)))</span>
<span class="c1">#         # else:    </span>
<span class="c1">#             # Save to netcdf file</span>
<span class="c1">#         ds_in_regrid.to_netcdf(nc_out)</span>
<span class="c1">#         print(&#39;file written: {}&#39;.format(nc_out))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="connect-all-models-into-one-dataset-with-new-coordinate-model">
<h2>Connect all models into one Dataset with new coordinate ‘model’<a class="headerlink" href="#connect-all-models-into-one-dataset-with-new-coordinate-model" title="Permalink to this heading">#</a></h2>
<p>We will create a <code class="docutils literal notranslate"><span class="pre">xarray.Dataset</span></code> with all CMIP6 models, after the interpolation to the same horizonal (and vertical) resolution. This step will make the next steps easier, as we will not need the the full dictonary key and can just use the model name.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # not needed if regridding works</span>
<span class="c1"># ds_gridded_dict = dict()</span>
<span class="c1"># for model in list_models:</span>
<span class="c1">#     ds_gridded_dict[model] = xr.open_dataset(&#39;/scratch/franzihe/output/CMIP6_hist/1deg/{}/{}_Amon_1deg_198501_201412.nc&#39;.format(model,variable_id))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # expand the model with nan array where missing variables</span>
<span class="c1"># for model in ds_gridded_dict.keys():</span>
<span class="c1">#     for var in variable_id:</span>
<span class="c1">#         # print(var, model)</span>
<span class="c1">#         if (var in ds_gridded_dict[model].variables) == False:</span>
<span class="c1">#             print(model, var)</span>
<span class="c1">#             if var == &#39;pr&#39; or var == &#39;prsn&#39;:</span>
<span class="c1">#                 ds_gridded_dict[model][var] = xr.DataArray(data=da.full(shape = (ds_gridded_dict[model][&#39;time&#39;].shape[0], </span>
<span class="c1">#                                                                                  ds_gridded_dict[model][&#39;lat&#39;].shape[0], </span>
<span class="c1">#                                                                                  ds_gridded_dict[model][&#39;lon&#39;].shape[0]), </span>
<span class="c1">#                                                             fill_value=np.nan, </span>
<span class="c1">#                                                             chunks=(120, 721, 1440/2)), dims = [ds_gridded_dict[model].time.dims[0], ds_gridded_dict[model].lat.dims[0], ds_gridded_dict[model].lon.dims[0]], coords=[ds_gridded_dict[model].time.values, ds_gridded_dict[model].lat.values, ds_gridded_dict[model].lon.values])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># _ds = list(ds_gridded_dict.values())</span>
<span class="c1"># _coord = list(ds_gridded_dict.keys())</span>
<span class="c1"># ds_cmip = xr.concat(objs=_ds, dim=_coord, coords=&quot;all&quot;).rename({&#39;concat_dim&#39;:&#39;model&#39;})</span>
<span class="c1"># ds_cmip = ds_cmip.drop(&#39;bnds&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ds_cmip = xr.open_mfdataset(&#39;/scratch/franzihe/output/CMIP6_hist/1deg/*.nc&#39;)</span>
<span class="c1"># ds_cmip</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id7">
<h2>Supercooled liquid water fraction<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h2>
<div class="math notranslate nohighlight">
\[SLF = \frac{\text{cloud liquid water content}}{\text{cloud liquid water content} + \text{cloud ice water content}}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ds_cmip[&#39;SLF&#39;] = ds_cmip[&#39;clw&#39;]/(ds_cmip[&#39;cli&#39;] + ds_cmip[&#39;clw&#39;])</span>
<span class="c1"># ds_cmip[&#39;SLF&#39;].attrs = {&#39;units&#39;: &#39;&#39;, &#39;long_name&#39;:&#39;Super cooled liquid water fraction&#39;}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # ds_cmip[&#39;SLF&#39;] = fct.set4D_latitude_values_nan(ds_cmip[&#39;SLF&#39;], 45, -45)</span>

<span class="c1"># # find only SLF where snowfall</span>
<span class="c1"># ds_cmip[&#39;SLF_sf&#39;] = ds_cmip[&#39;SLF&#39;].where((ds_cmip[&#39;prsn&#39;] * 3600/86400) &gt;= 0.01)</span>
<span class="c1"># ds_cmip[&#39;SLF_sf&#39;] = ds_cmip[&#39;SLF_sf&#39;].sortby(&#39;latitude&#39;, ascending=True)</span>
<span class="c1"># ds_cmip[&#39;SLF_sf&#39;] = ds_cmip[&#39;SLF_sf&#39;].groupby(&#39;time.season&#39;).mean((&#39;time&#39;, &#39;longitude&#39;), skipna=True)</span>

<span class="c1"># fig, axsm = plt.subplots(2,2, sharex=True, sharey=True, figsize=[15, 7.5])</span>
<span class="c1"># for ax, sea in zip(axsm.flatten(), ds_cmip[&#39;SLF_sf&#39;].season):</span>
<span class="c1">#     cf = ds_cmip[&#39;SLF_sf&#39;].sel(season=sea).plot(ax=ax,x=&#39;latitude&#39;, y=&#39;level&#39;, cmap=cm.tokyo_r, levels=np.arange(0,1.1,0.1), ylim= [1000, 1], yincrease=False, add_colorbar=False)</span>
<span class="c1">#     ax.grid()</span>
<span class="c1">#     ax.set(title=&#39;season = {}&#39;.format(sea.values), ylabel=&#39;Pressure [hPa]&#39;, xlabel=&#39;Latitude&#39;)</span>
    

<span class="c1"># fig.suptitle(&#39;ERA5 ({} - {})&#39;.format(starty, endy), fontweight=&quot;bold&quot;)</span>
<span class="c1"># cbaxes = fig.add_axes([0.1, 0.0, 0.8, 0.025])</span>
<span class="c1"># cbar = plt.colorbar(cf, cax=cbaxes, shrink=0.5, orientation=&#39;horizontal&#39;, label=&#39;Supercooled liquid water fraction&#39;)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id8">
<h2>Statistics<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h2>
<p>For variables:</p>
<ul class="simple">
<li><p>Snowfall [sf]</p></li>
<li><p>Total column cloud liquid, supercooled liqid, and rain water [tclslrw]</p></li>
<li><p>Total column cloud ice, snow water [tcisw]</p></li>
<li><p>2m-Temperature [2t]</p></li>
</ul>
<ol class="arabic simple">
<li><p>Find where liquid water path is <span class="math notranslate nohighlight">\(\ge\)</span> 5 g m-2</p></li>
<li><p>Find where snowfall is <span class="math notranslate nohighlight">\(\ge\)</span> 0.01mm h-1</p></li>
<li><p>Find where 2m-temperature <span class="math notranslate nohighlight">\(\le\)</span> 0 <span class="math notranslate nohighlight">\(^o\)</span> C</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># def set4D_latitude_values_nan(array, upper_lat, lower_lat):</span>
<span class="c1">#     array[:,:,int(array[&#39;lat&#39;].where((array[&#39;lat&#39;] &gt; lower_lat) &amp; (array[&#39;lat&#39;] &lt; upper_lat)).argmin(&#39;lat&#39;)) : int(array[&#39;lat&#39;].where((array[&#39;lat&#39;] &gt; lower_lat) &amp; (array[&#39;lat&#39;] &lt; upper_lat)).argmax(&#39;lat&#39;)), :] = xr.DataArray(data=da.full(shape=(array[:,:,int(array[&#39;lat&#39;].where((array[&#39;lat&#39;]&gt;lower_lat) &amp; (array[&#39;lat&#39;]&lt;upper_lat)).argmin(&#39;lat&#39;)) :\</span>
<span class="c1">#                                            int(array[&#39;lat&#39;].where((array[&#39;lat&#39;]&gt;lower_lat) &amp; (array[&#39;lat&#39;]&lt;upper_lat)).argmax(&#39;lat&#39;)), :]).shape,</span>
<span class="c1">#                           fill_value=np.nan),</span>
<span class="c1">#              dims=(array[:,:,int(array[&#39;lat&#39;].where((array[&#39;lat&#39;]&gt;lower_lat) &amp; (array[&#39;lat&#39;]&lt;upper_lat)).argmin(&#39;lat&#39;)) :\</span>
<span class="c1">#                              int(array[&#39;lat&#39;].where((array[&#39;lat&#39;]&gt;lower_lat) &amp; (array[&#39;lat&#39;]&lt;upper_lat)).argmax(&#39;lat&#39;)), :]).dims,</span>
<span class="c1">#              coords=(array[:,:,int(array[&#39;lat&#39;].where((array[&#39;lat&#39;]&gt;lower_lat) &amp; (array[&#39;lat&#39;]&lt;upper_lat)).argmin(&#39;lat&#39;)) :\</span>
<span class="c1">#                                int(array[&#39;lat&#39;].where((array[&#39;lat&#39;]&gt;lower_lat) &amp; (array[&#39;lat&#39;]&lt;upper_lat)).argmax(&#39;lat&#39;)), :]).coords)</span>

<span class="c1">#     return array</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ds_cmip[&#39;prsn&#39;]  = set4D_latitude_values_nan(ds_cmip[&#39;prsn&#39;], 45, -45)</span>
<span class="c1"># ds_cmip[&#39;lwp&#39;]   = set4D_latitude_values_nan(ds_cmip[&#39;lwp&#39;], 45, -45)</span>
<span class="c1"># ds_cmip[&#39;clivi&#39;] = set4D_latitude_values_nan(ds_cmip[&#39;clivi&#39;], 45, -45)</span>
<span class="c1"># ds_cmip[&#39;tas&#39;]   = set4D_latitude_values_nan(ds_cmip[&#39;tas&#39;], 45, -45)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # 1. find where LWP &gt;=5 gm-2</span>
<span class="c1"># sf = ds_cmip[&#39;prsn&#39;].where(ds_cmip[&#39;lwp&#39;]&gt;=5)</span>
<span class="c1"># lwp = ds_cmip[&#39;lwp&#39;].where(ds_cmip[&#39;lwp&#39;]&gt;=5)</span>
<span class="c1"># iwp = ds_cmip[&#39;clivi&#39;].where(ds_cmip[&#39;lwp&#39;]&gt;=5)</span>
<span class="c1"># t2 = ds_cmip[&#39;tas&#39;].where(ds_cmip[&#39;tas&#39;]&gt;=5)</span>

<span class="c1"># # 2. find where snowfall &gt;= 0.01mmh-1</span>
<span class="c1"># unit_sf = ds_cmip[&#39;prsn&#39;]*(3600/86400)</span>
<span class="c1"># sf = sf.where(unit_sf&gt;=0.01)</span>
<span class="c1"># lwp = lwp.where(unit_sf&gt;=0.01)</span>
<span class="c1"># iwp = iwp.where(unit_sf&gt;=0.01)</span>
<span class="c1"># t2 = t2.where(unit_sf&gt;=0.01)</span>

<span class="c1"># # 3. find where 2m-temperature &lt;= 0C</span>
<span class="c1"># sf = sf.where(ds_cmip[&#39;tas&#39;]&lt;=273.15)</span>
<span class="c1"># lwp = lwp.where(ds_cmip[&#39;tas&#39;]&lt;=273.15)</span>
<span class="c1"># iwp = iwp.where(ds_cmip[&#39;tas&#39;]&lt;=273.15)</span>
<span class="c1"># t2 = t2.where(ds_cmip[&#39;tas&#39;]&lt;=273.15)</span>

<span class="c1"># # count occurences per season</span>
<span class="c1"># sf_count = sf.groupby(&#39;time.season&#39;).count(dim=&#39;time&#39;,keep_attrs=True)</span>
<span class="c1"># lwp_count = lwp.groupby(&#39;time.season&#39;).count(dim=&#39;time&#39;,keep_attrs=True)</span>
<span class="c1"># iwp_count = iwp.groupby(&#39;time.season&#39;).count(dim=&#39;time&#39;,keep_attrs=True)</span>
<span class="c1"># t2_count = t2.groupby(&#39;time.season&#39;).count(dim=&#39;time&#39;,keep_attrs=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># def plt_seasonal_NH_SH(variable,levels,cbar_label,plt_title):</span>

<span class="c1">#     f, axsm = plt.subplots(nrows=2,ncols=4,figsize =[10,7], subplot_kw={&#39;projection&#39;: ccrs.NorthPolarStereo(central_longitude=0.0,globe=None)})</span>

<span class="c1">#     for ax, season in zip(axsm.flatten()[:4], variable.season):</span>
<span class="c1">#         ax.add_feature(cy.feature.COASTLINE, alpha=0.5)</span>
<span class="c1">#         ax.set_extent([-180, 180, 90, 45], ccrs.PlateCarree())</span>
<span class="c1">#         ax.set(title =&#39;season = {}&#39;.format(season.values))</span>
<span class="c1">#         gl = ax.gridlines(draw_labels=True)</span>
<span class="c1">#         gl.top_labels   = False</span>
<span class="c1">#         gl.right_labels = False</span>
<span class="c1">#         variable.sel(season=season).plot(ax=ax, transform=ccrs.PlateCarree(), add_colorbar=False,</span>
<span class="c1">#                             cmap=cm.hawaii_r, levels=levels)</span>

<span class="c1">#     for ax, i, season in zip(axsm.flatten()[4:], np.arange(5,9), variable.season):</span>
<span class="c1">#         ax.remove()</span>
<span class="c1">#         ax = f.add_subplot(2,4,i, projection=ccrs.SouthPolarStereo(central_longitude=0.0, globe=None))</span>
<span class="c1">#         ax.add_feature(cy.feature.COASTLINE, alpha=0.5)</span>
<span class="c1">#         ax.set_extent([-180, 180, -90, -45], ccrs.PlateCarree())</span>
<span class="c1">#         ax.set(title =&#39;season = {}&#39;.format(season.values))</span>
<span class="c1">#         gl = ax.gridlines(draw_labels=True)</span>
<span class="c1">#         gl.top_labels   = False</span>
<span class="c1">#         gl.right_labels = False</span>
<span class="c1">#         cf = variable.sel(season=season).plot(ax=ax, transform=ccrs.PlateCarree(), add_colorbar=False,</span>
<span class="c1">#                             cmap=cm.hawaii_r, levels=levels)</span>

<span class="c1">#     cbaxes = f.add_axes([1.0125, 0.025, 0.025, 0.9])</span>
<span class="c1">#     cbar = plt.colorbar(cf, cax=cbaxes, shrink=0.5,extend=&#39;max&#39;, orientation=&#39;vertical&#39;, label=cbar_label)</span>
<span class="c1">#     f.suptitle(plt_title, fontweight=&quot;bold&quot;);</span>
<span class="c1">#     plt.tight_layout(pad=0., w_pad=0., h_pad=0.)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for model in sf_count[&#39;model&#39;]:</span>

<span class="c1">#     # snowfall event occurance</span>
<span class="c1">#     plt_seasonal_NH_SH((sf_count.where(sf_count&gt;0.)).sel(model=model),np.arange(0,100,10),cbar_label =&#39;{} frequency (month)&#39;,plt_title=&#39;{} {} ({} - {}) Count of months where sf &gt;= 7.2mm&#39;.format(model.values,sf_count.where(sf_count&gt;0.).attrs[&#39;long_name&#39;], starty,endy))</span>

<span class="c1">#     # snowfall divided by ice water path</span>
<span class="c1">#     sf_iwp = ((sf/(iwp)).groupby(&#39;time.season&#39;).mean(&#39;time&#39;, keep_attrs=True, skipna=True))</span>
<span class="c1">#     plt_seasonal_NH_SH(sf_iwp.sel(model=model),np.arange(0,0.0475,0.0025),cbar_label=&#39;precipitation efficency ()&#39;,plt_title=&#39;{} Snowfall/IWP ({} - {}) where sf &gt;= 7.2mm&#39;.format(model.values,starty,endy))</span>

<span class="c1">#     # snowfall divided by the sum of ice and liquid water path</span>
<span class="c1">#     sf_iwp_lwp = ((sf/(lwp+iwp)).groupby(&#39;time.season&#39;).mean(&#39;time&#39;, keep_attrs=True, skipna=True))</span>
<span class="c1">#     plt_seasonal_NH_SH(sf_iwp_lwp.sel(model=model), np.arange(0,0.0475,0.0025),cbar_label=&#39;precipiation efficency ()&#39;, plt_title=&#39;{} Snowfall/(IWP + LWP) ({} {}) where sf &gt;= 7.2mm&#39;.format(model.values,starty,endy))</span>

<span class="c1">#     # liquid water path</span>
<span class="c1">#     lwp_season = lwp.groupby(&#39;time.season&#39;).mean(dim=&#39;time&#39;,keep_attrs=True, skipna=True)</span>
<span class="c1">#     plt_seasonal_NH_SH(lwp_season.sel(model=model), np.arange(0,360, 10),cbar_label=&#39;{} ({})&#39;.format(lwp_season.attrs[&#39;long_name&#39;], lwp_season.attrs[&#39;units&#39;]),plt_title=&#39;{} {} ({} - {}) Count of months where sf &gt;= 7.2mm&#39;.format(model.values,lwp_season.attrs[&#39;long_name&#39;], starty,endy))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># _iwp = iwp.groupby(&#39;time.season&#39;).mean((&#39;time&#39;, ), keep_attrs=True, skipna=True)</span>
<span class="c1"># _lwp = lwp.groupby(&#39;time.season&#39;).mean((&#39;time&#39;, ), keep_attrs=True, skipna=True)</span>
<span class="c1"># _sf = sf.groupby(&#39;time.season&#39;).mean((&#39;time&#39;, ), keep_attrs=True, skipna=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># &#39;EC-Earth3-AerChem&#39;</span>
<span class="c1"># &#39;NorESM2-MM&#39;</span>
<span class="c1"># &#39;GFDL-ESM4&#39;</span>
<span class="c1"># &#39;TaiESM1&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># _iwp.min().values, _iwp.max().values</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># _sf.min().values, _sf.max().values</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># from matplotlib.colors import LogNorm</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># def plt_2dhist_iwp_sf(_iwp, _sf,model ):</span>
<span class="c1">#     f, axsm = plt.subplots(nrows=2,ncols=4,figsize =[10,5], sharex=True, sharey=True)</span>
<span class="c1">#     cmap = cm.batlow</span>
<span class="c1">#     # levels = np.arange(0.1,65000,5000)</span>
<span class="c1">#     # norm = BoundaryNorm(levels, ncolors=cmap.N, )</span>
<span class="c1">#     norm = LogNorm(vmin=1, vmax=65000)</span>



<span class="c1">#     for ax, season in zip(axsm.flatten()[:4], _iwp.season):</span>
<span class="c1">#         Z, xedges, yedges = np.histogram2d((_iwp.where(_iwp[&#39;lat&#39;] &gt;=45).sel(season=season).values.flatten()), </span>
<span class="c1">#                                         (_sf.where(_sf[&#39;lat&#39;] &gt;=45).sel(season=season).values.flatten()), </span>
<span class="c1">#                                         bins=[54, 25], </span>
<span class="c1">#                                         range=[[5,545],[0, 25]])   </span>

<span class="c1">#         im = ax.pcolormesh(xedges, yedges, Z.transpose(), cmap=cmap,norm=norm,)</span>
<span class="c1">#         # cbar = f.colorbar(im, ax=ax,)</span>
<span class="c1">#         ax.set(title =r&#39;lat$\geq 45^\circ$N; season = {}&#39;.format(season.values))</span>
<span class="c1">#         ax.grid()</span>

<span class="c1">#     for ax, season in zip(axsm.flatten()[4:], _iwp.season):</span>
<span class="c1">#         Z, xedges, yedges = np.histogram2d((_iwp.where(_iwp[&#39;lat&#39;] &lt;=-45).sel(season=season).values.flatten()), </span>
<span class="c1">#                                         (_sf.where(_sf[&#39;lat&#39;] &lt;=-45).sel(season=season).values.flatten()), </span>
<span class="c1">#                                         bins=[54, 25], </span>
<span class="c1">#                                         range=[[5,545],[0, 25]])   </span>

<span class="c1">#         im = ax.pcolormesh(xedges, yedges, Z.transpose(), cmap=cmap,norm=norm,)</span>
<span class="c1">#         # cbar = f.colorbar(im, ax=ax, )</span>
<span class="c1">#         ax.set(title =r&#39;lat$\leq-45^\circ$S; season = {}&#39;.format(season.values))</span>
        
<span class="c1">#         ax.set_xlabel(&#39;Ice Water Path ({})&#39;.format(_iwp.attrs[&#39;units&#39;]))</span>
<span class="c1">#         ax.grid()</span>
        
<span class="c1">#     axsm.flatten()[0].set_ylabel(&#39;{} ({})&#39;.format(_sf.attrs[&#39;long_name&#39;], _sf.attrs[&#39;units&#39;]))</span>
<span class="c1">#     axsm.flatten()[4].set_ylabel(&#39;{} ({})&#39;.format(_sf.attrs[&#39;long_name&#39;], _sf.attrs[&#39;units&#39;]))</span>


<span class="c1">#     cbaxes = f.add_axes([1.0125, 0.025, 0.025, 0.9])</span>
<span class="c1">#     cbar = plt.colorbar(im, cax=cbaxes, shrink=0.5, orientation=&#39;vertical&#39;, label=&#39;frequency&#39;)</span>
<span class="c1">#     f.suptitle(&#39;{} ({} - {}) Months where sf &gt;= 7.2mm&#39;.format(model, starty,endy), fontweight=&quot;bold&quot;);</span>
<span class="c1">#     plt.tight_layout(pad=0.5, w_pad=0.5, h_pad=0.5)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># model = [&#39;EC-Earth3-AerChem&#39;, &#39;NorESM2-MM&#39;, &#39;GFDL-ESM4&#39;, &#39;TaiESM1&#39;]</span>
<span class="c1"># for model in model:</span>
<span class="c1">#     plt_2dhist_iwp_sf(_iwp.sel(model=model), _sf.sel(model=&#39;NorESM2-MM&#39;), model)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-mixed-phase-clouds">
<h2>Find mixed-phase clouds<a class="headerlink" href="#find-mixed-phase-clouds" title="Permalink to this heading">#</a></h2>
<p>Calculate the IWC/LWC statistics given by the values. Setting the value to 0.5 will find the level in the atmosphere where IWC and LWC are 50/50. Setting it to a value of 0.7 will find the level where IWC is 70% while LWC is 30%.</p>
<ol class="arabic simple">
<li><p>find the fraction of IWC to LWC
$<span class="math notranslate nohighlight">\(fraction = \frac{IWC}{IWC + LWC}\)</span>$</p></li>
<li><p>find the nearest value to given IWC-fraction</p></li>
<li><p>find atmospheric pressure levels where IWC/LWC fraction occurs</p></li>
<li><p>find the index of the first atmospheric pressure level</p></li>
<li><p>use the index to select variables</p></li>
</ol>
</section>
<section id="create-dictionary-from-the-list-of-datasets-we-want-to-use-for-the-iwc-lwc-statistics">
<h2>Create dictionary from the list of datasets we want to use for the IWC/LWC statistics<a class="headerlink" href="#create-dictionary-from-the-list-of-datasets-we-want-to-use-for-the-iwc-lwc-statistics" title="Permalink to this heading">#</a></h2>
<p>Calculate the IWC/LWC statistics given by the values. Setting the value to 0.5 will find the level in the atmosphere where IWC and LWC are 50/50. Setting it to a value of 0.7 will find the level where IWC is 70% while LWC is 30%.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># _ds = list(dset_dict2.values())</span>
<span class="c1"># _coord = list(dset_dict2.keys())</span>
<span class="c1"># ds_cmip_1deg = xr.concat(objs=_ds, dim=_coord, coords=&quot;all&quot;).rename({&#39;concat_dim&#39;:&#39;stat&#39;})</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="exploratory-data-analysis-a-id-exploratory-a">
<h1>3. Exploratory Data Analysis <a id='exploratory'></a><a class="headerlink" href="#exploratory-data-analysis-a-id-exploratory-a" title="Permalink to this heading">#</a></h1>
<section id="create-seasonal-mean-of-all-regridded-models">
<h2>Create seasonal mean of all regridded models<a class="headerlink" href="#create-seasonal-mean-of-all-regridded-models" title="Permalink to this heading">#</a></h2>
<p>…and plot seasonal mean of each individual model</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for var_id in list(ds_cmip.keys()):</span>
<span class="c1">#     ds_cmip = fct.seasonal_mean_std(ds_cmip, var_id)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # extract the variable name similar to ERA5 for plotting</span>
<span class="c1"># var = fct.to_era_variable[variable_id[variable_id.index(&#39;prsn&#39;)]]</span>

<span class="c1"># for model in ds_cmip.model.values:</span>
<span class="c1">#     fct.plt_spatial_seasonal_mean(ds_cmip[variable_id[variable_id.index(&#39;prsn&#39;)]+&#39;_season_mean&#39;].sel(model=model), var, title=&#39;{} MEAN ({} - {})&#39;.format(model,starty, endy))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-model-mean-spread-of-seasonal-mean-of-all-regridded-models">
<h2>Create model mean/spread of seasonal mean of all regridded models<a class="headerlink" href="#create-model-mean-spread-of-seasonal-mean-of-all-regridded-models" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ds_cmip[variable_id[variable_id.index(&#39;prsn&#39;)]+&#39;_season_model_mean&#39;] = ds_cmip[variable_id[variable_id.index(&#39;prsn&#39;)]+&#39;_season_mean&#39;].mean(&#39;model&#39;, keep_attrs=True, skipna = True)</span>
<span class="c1"># ds_cmip[variable_id[variable_id.index(&#39;prsn&#39;)]+&#39;_season_model_std&#39;]  = ds_cmip[variable_id[variable_id.index(&#39;prsn&#39;)]+&#39;_season_mean&#39;].std(&#39;model&#39;, keep_attrs=True, skipna = True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fig, axs, im = fct.plt_spatial_seasonal_mean(ds_cmip[variable_id[variable_id.index(&#39;prsn&#39;)]+&#39;_season_model_mean&#39;], var, add_colorbar=False, title=&#39;CMIP6 - high resolution (1985 - 2014)&#39;)</span>

<span class="c1"># fig.subplots_adjust(right=0.8)</span>
<span class="c1"># cbar_ax = fig.add_axes([1, 0.15, 0.025, 0.7])</span>
<span class="c1"># cb = fig.colorbar(im, cax=cbar_ax, orientation=&quot;vertical&quot;, fraction=0.046, pad=0.04)</span>
<span class="c1"># cb.set_label(label=&#39;MEAN - {}&#39;.format(fct.plt_dict[var][fct.plt_dict[&#39;header&#39;].index(&#39;label&#39;)]), weight=&#39;bold&#39;)</span>

<span class="c1"># plt.tight_layout()</span>


<span class="c1"># axs[2].text(1,-0.12, ds_cmip.model.values.tolist()[0:5], size=12, ha=&quot;center&quot;, </span>
<span class="c1">#          transform=axs[2].transAxes, bbox ={&#39;facecolor&#39;:&#39;green&#39;,</span>
<span class="c1">#                 &#39;alpha&#39;:0.6,</span>
<span class="c1">#                 &#39;pad&#39;:5})</span>
<span class="c1"># if len(ds_cmip.model.values.tolist()) &gt; 4:</span>
<span class="c1">#     axs[2].text(1,-0.25, ds_cmip.model.values.tolist()[5:10], size=12, ha=&quot;center&quot;, </span>
<span class="c1">#             transform=axs[2].transAxes, bbox ={&#39;facecolor&#39;:&#39;green&#39;,</span>
<span class="c1">#                     &#39;alpha&#39;:0.6,</span>
<span class="c1">#                     &#39;pad&#39;:5})</span>
<span class="c1"># if len(ds_cmip.model.values.tolist()) &gt; 10:</span>
<span class="c1">#     axs[2].text(1,-0.38, ds_cmip.model.values.tolist()[10:-1], size=12, ha=&quot;center&quot;, </span>
<span class="c1">#             transform=axs[2].transAxes, bbox ={&#39;facecolor&#39;:&#39;green&#39;,</span>
<span class="c1">#                     &#39;alpha&#39;:0.6,</span>
<span class="c1">#                     &#39;pad&#39;:5})</span>
    

<span class="c1"># # save figure to png</span>
<span class="c1"># figdir = &#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6/&#39;</span>
<span class="c1"># figname = &#39;{}_season_mean_1deg_{}_{}.png&#39;.format(variable_id[0], starty, endy)</span>
<span class="c1"># plt.savefig(figdir + figname, format = &#39;png&#39;, bbox_inches = &#39;tight&#39;, transparent = False)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fig, axs, im = fct.plt_spatial_seasonal_mean(ds_cmip[variable_id[variable_id.index(&#39;prsn&#39;)]+&#39;_season_model_mean&#39;], var, add_colorbar=False, title=&#39;CMIP6 - high resolution (1985 - 2014)&#39;)</span>

<span class="c1"># fig.subplots_adjust(right=0.8)</span>
<span class="c1"># cbar_ax = fig.add_axes([1, 0.15, 0.025, 0.7])</span>
<span class="c1"># cb = fig.colorbar(im, cax=cbar_ax, orientation=&quot;vertical&quot;, fraction=0.046, pad=0.04)</span>
<span class="c1"># cb.set_label(label=&#39;MEAN - {}&#39;.format(fct.plt_dict[var][fct.plt_dict[&#39;header&#39;].index(&#39;label&#39;)]), weight=&#39;bold&#39;)</span>



<span class="c1"># for ax, i in zip(axs, ds_cmip[variable_id[variable_id.index(&#39;prsn&#39;)]+&#39;_season_model_std&#39;].season):</span>
<span class="c1">#     sm = ds_cmip[variable_id[variable_id.index(&#39;prsn&#39;)]+&#39;_season_model_std&#39;].sel(season=i).plot.contour(ax=ax, transform=ccrs.PlateCarree(), </span>
<span class="c1">#                                                                       robust=True,</span>
<span class="c1">#                                                                       vmin = fct.plt_dict[var][fct.plt_dict[&#39;header&#39;].index(&#39;vmin_std&#39;)], </span>
<span class="c1">#                                                                       vmax = fct.plt_dict[var][fct.plt_dict[&#39;header&#39;].index(&#39;vmax_std&#39;)],</span>
<span class="c1">#                                                                        levels = 6,</span>
<span class="c1">#                                                                       cmap=cm.lajolla,</span>
<span class="c1">#                                                                       add_colorbar=False)</span>
    
<span class="c1"># cbar_ax = fig.add_axes([1.10, 0.15, 0.025, 0.7])</span>
<span class="c1"># sb = fig.colorbar(sm, cax=cbar_ax, orientation=&quot;vertical&quot;, fraction=0.046, pad=0.04)</span>
<span class="c1"># sb.set_label(label=&#39;STD - {}&#39;.format(fct.plt_dict[var][fct.plt_dict[&#39;header&#39;].index(&#39;label&#39;)]), weight=&#39;bold&#39;)</span>


<span class="c1"># plt.tight_layout()</span>


<span class="c1"># axs[2].text(1,-0.12, ds_cmip.model.values.tolist()[0:5], size=12, ha=&quot;center&quot;, </span>
<span class="c1">#          transform=axs[2].transAxes, bbox ={&#39;facecolor&#39;:&#39;green&#39;,</span>
<span class="c1">#                 &#39;alpha&#39;:0.6,</span>
<span class="c1">#                 &#39;pad&#39;:5})</span>
<span class="c1"># if len(ds_cmip.model.values.tolist()) &gt; 4:</span>
<span class="c1">#     axs[2].text(1,-0.25, ds_cmip.model.values.tolist()[5:10], size=12, ha=&quot;center&quot;, </span>
<span class="c1">#             transform=axs[2].transAxes, bbox ={&#39;facecolor&#39;:&#39;green&#39;,</span>
<span class="c1">#                     &#39;alpha&#39;:0.6,</span>
<span class="c1">#                     &#39;pad&#39;:5})</span>
<span class="c1"># if len(ds_cmip.model.values.tolist()) &gt; 10:</span>
<span class="c1">#     axs[2].text(1,-0.38, ds_cmip.model.values.tolist()[10:-1], size=12, ha=&quot;center&quot;, </span>
<span class="c1">#             transform=axs[2].transAxes, bbox ={&#39;facecolor&#39;:&#39;green&#39;,</span>
<span class="c1">#                     &#39;alpha&#39;:0.6,</span>
<span class="c1">#                     &#39;pad&#39;:5})</span>
<span class="c1"># # save figure to png</span>
<span class="c1"># figdir = &#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6/&#39;</span>
<span class="c1"># figname = &#39;{}_season_mean_std_1deg_{}_{}.png&#39;.format(variable_id[0], starty, endy)</span>
<span class="c1"># plt.savefig(figdir + figname, format = &#39;png&#39;, bbox_inches = &#39;tight&#39;, transparent = False)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # save to netcdf</span>
<span class="c1"># filename = &#39;{}_1deg_{}01_{}12.nc&#39;.format(variable_id[0], starty, endy)</span>
<span class="c1"># savepath = &#39;/scratch/franzihe/output/CMIP6_hist/1deg/&#39;</span>
<span class="c1"># nc_out = savepath + filename</span>
<span class="c1"># files = glob(nc_out)</span>

<span class="c1"># counter = 0 </span>
<span class="c1"># # Save to netcdf file</span>
<span class="c1"># if nc_out in files:</span>
<span class="c1"># #     print(&#39;{} is downloaded&#39;.format(nc_out))</span>
<span class="c1"># #     counter += 1</span>
<span class="c1"># #     print(&#39;Have saved in total: {:} files&#39;.format(str(counter)))</span>
<span class="c1"># # else:</span>
<span class="c1">#     ds_cmip.to_netcdf(nc_out)</span>
<span class="c1">#     print(&#39;file written: .{}&#39;.format(nc_out))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="references-a-id-references-a">
<h1>References <a id='references'></a><a class="headerlink" href="#references-a-id-references-a" title="Permalink to this heading">#</a></h1>
<p>[1] Zelinka, M. D., Myers, T. A., McCoy, D. T., Po-Chedley, S., Caldwell, P. M., Ceppi, P., et al. (2020). Causes of higher climate sensitivity in CMIP6 models. Geophysical Research Letters, 47, e2019GL085782. <a class="reference external" href="https://doi-org.ezproxy.uio.no/10.1029/2019GL085782">https://doi-org.ezproxy.uio.no/10.1029/2019GL085782</a></p>
<p>[2] Bjordal, J., Storelvmo, T., Alterskjær, K. et al. Equilibrium climate sensitivity above 5 °C plausible due to state-dependent cloud feedback. Nat. Geosci. 13, 718–721 (2020). <a class="reference external" href="https://doi-org.ezproxy.uio.no/10.1038/s41561-020-00649-1">https://doi-org.ezproxy.uio.no/10.1038/s41561-020-00649-1</a></p>
<p>[3] Wu, T., Lu, Y., Fang, Y., Xin, X., Li, L., Li, W., Jie, W., Zhang, J., Liu, Y., Zhang, L., Zhang, F., Zhang, Y., Wu, F., Li, J., Chu, M., Wang, Z., Shi, X., Liu, X., Wei, M., Huang, A., Zhang, Y., and Liu, X.: The Beijing Climate Center Climate System Model (BCC-CSM): the main progress from CMIP5 to CMIP6 , Geosci. Model Dev., 12, 1573–1600, <a class="reference external" href="https://doi.org/10.5194/gmd-12-1573-2019">https://doi.org/10.5194/gmd-12-1573-2019</a>, 2019.</p>
<p>[4] Lee, W.-L., Wang, Y.-C., Shiu, C.-J., Tsai, I., Tu, C.-Y., Lan, Y.-Y., Chen, J.-P., Pan, H.-L., and Hsu, H.-H.: Taiwan Earth System Model Version 1: description and evaluation of mean state, Geosci. Model Dev., 13, 3887–3904, <a class="reference external" href="https://doi.org/10.5194/gmd-13-3887-2020">https://doi.org/10.5194/gmd-13-3887-2020</a>, 2020.</p>
<p>[5] Bian HE, Yongqiang YU, Qing BAO, Pengfei LIN, Hailong LIU, Jinxiao LI, Lei WANG, Yimin LIU, Guoxiong WU, Kangjun CHEN, Yuyang GUO, Shuwen ZHAO, Xiaoqi ZHANG, Mirong SONG &amp; Jinbo XIE (2020) CAS FGOALS-f3-L model dataset descriptions for CMIP6 DECK experiments, Atmospheric and Oceanic Science Letters, 13:6, 582-588, DOI: 10.1080/16742834.2020.1778419</p>
<p>[6] Cherchi, A., Fogli, P. G., Lovato, T., Peano, D., Iovino, D., Gualdi, S., et al. (2019). Global mean climate and main patterns of variability in the CMCC-CM2 coupled model. Journal of Advances in Modeling Earth Systems, 11, 185– 209. <a class="reference external" href="https://doi-org.ezproxy.uio.no/10.1029/2018MS001369">https://doi-org.ezproxy.uio.no/10.1029/2018MS001369</a></p>
<p>[7] van Noije, T., Bergman, T., Le Sager, P., O’Donnell, D., Makkonen, R., Gonçalves-Ageitos, M., Döscher, R., Fladrich, U., von Hardenberg, J., Keskinen, J.-P., Korhonen, H., Laakso, A., Myriokefalitakis, S., Ollinaho, P., Pérez García-Pando, C., Reerink, T., Schrödner, R., Wyser, K., and Yang, S.: EC-Earth3-AerChem: a global climate model with interactive aerosols and atmospheric chemistry participating in CMIP6 , Geosci. Model Dev., 14, 5637–5668, <a class="reference external" href="https://doi.org/10.5194/gmd-14-5637-2021">https://doi.org/10.5194/gmd-14-5637-2021</a>, 2021.</p>
<p>[8] Golaz, J.-C., Caldwell, P. M., Van Roekel, L. P., Petersen, M. R., Tang, Q., Wolfe, J. D., et al. (2019). The DOE E3SM coupled model version 1: Overview and evaluation at standard resolution. Journal of Advances in Modeling Earth Systems, 11, 2089– 2129. <a class="reference external" href="https://doi-org.ezproxy.uio.no/10.1029/2018MS001603">https://doi-org.ezproxy.uio.no/10.1029/2018MS001603</a></p>
<p>[9] Burrows, S. M., Maltrud, M., Yang, X., Zhu, Q., Jeffery, N., Shi, X., et al. (2020). The DOE E3SM v1.1 biogeochemistry configuration: Description and simulated ecosystem-climate responses to historical changes in forcing. Journal of Advances in Modeling Earth Systems, 12, e2019MS001766. <a class="reference external" href="https://doi-org.ezproxy.uio.no/10.1029/2019MS001766">https://doi-org.ezproxy.uio.no/10.1029/2019MS001766</a></p>
<p>[10] Müller, W. A., Jungclaus, J. H., Mauritsen, T., Baehr, J., Bittner, M., Budich, R., et al. (2018). A higher-resolution version of the Max Planck Institute Earth System Model (MPI-ESM1.2-HR). Journal of Advances in Modeling Earth Systems, 10, 1383– 1413. <a class="reference external" href="https://doi-org.ezproxy.uio.no/10.1029/2017MS001217">https://doi-org.ezproxy.uio.no/10.1029/2017MS001217</a></p>
<p>[11] Yukimoto, S., H. Kawai, T. Koshiro, N. Oshima, K. Yoshida, S. Urakawa, H. Tsujino, M. Deushi, T. Tanaka, M. Hosaka, S. Yabu, H. Yoshimura, E. Shindo, R. Mizuta, A. Obata, Y. Adachi, and M. Ishii, 2019: The Meteorological Research Institute Earth System Model version 2.0, MRI-ESM2.0: Description and basic evaluation of the physical component. J. Meteor. Soc. Japan, 97, 931–965, doi:10.2151/jmsj.2019-051.</p>
<p>[12] Seland, Ø., Bentsen, M., Olivié, D., Toniazzo, T., Gjermundsen, A., Graff, L. S., Debernard, J. B., Gupta, A. K., He, Y.-C., Kirkevåg, A., Schwinger, J., Tjiputra, J., Aas, K. S., Bethke, I., Fan, Y., Griesfeller, J., Grini, A., Guo, C., Ilicak, M., Karset, I. H. H., Landgren, O., Liakka, J., Moseid, K. O., Nummelin, A., Spensberger, C., Tang, H., Zhang, Z., Heinze, C., Iversen, T., and Schulz, M.: Overview of the Norwegian Earth System Model (NorESM2) and key climate response of CMIP6 DECK, historical, and scenario simulations, Geosci. Model Dev., 13, 6165–6200, <a class="reference external" href="https://doi.org/10.5194/gmd-13-6165-2020">https://doi.org/10.5194/gmd-13-6165-2020</a>, 2020.</p>
<p>[13] Held, I. M., Guo, H., Adcroft, A., Dunne, J. P., Horowitz, L. W., Krasting, J., et al. (2019). Structure and performance of GFDL’s CM4.0 climate model. Journal of Advances in Modeling Earth Systems, 11, 3691– 3727. <a class="reference external" href="https://doi-org.ezproxy.uio.no/10.1029/2019MS001829">https://doi-org.ezproxy.uio.no/10.1029/2019MS001829</a></p>
<p>[14] Dunne, J. P., Horowitz, L. W., Adcroft, A. J., Ginoux, P., Held, I. M., John, J. G., et al. (2020). The GFDL Earth System Model Version 4.1 (GFDL-ESM 4.1): Overall coupled model description and simulation characteristics. Journal of Advances in Modeling Earth Systems, 12, e2019MS002015. <a class="reference external" href="https://doi-org.ezproxy.uio.no/10.1029/2019MS002015">https://doi-org.ezproxy.uio.no/10.1029/2019MS002015</a></p>
<p>[15] Park, S., Shin, J., Kim, S., Oh, E., &amp; Kim, Y. (2019). Global Climate Simulated by the Seoul National University Atmosphere Model Version 0 with a Unified Convection Scheme (SAM0-UNICON), Journal of Climate, 32(10), 2917-2949. Retrieved Jan 12, 2022, from <a class="reference external" href="https://journals-ametsoc-org.ezproxy.uio.no/view/journals/clim/32/10/jcli-d-18-0796.1.xml">https://journals-ametsoc-org.ezproxy.uio.no/view/journals/clim/32/10/jcli-d-18-0796.1.xml</a></p>
<p>[16] Lin, Y., Huang, X., Liang, Y., Qin, Y., Xu, S., &amp; Huang, W., et al. (2020). Community Integrated Earth System Model (CIESM): Description and evaluation. Journal of Advances in Modeling Earth Systems, 12, e2019MS002036. <a class="reference external" href="https://doi-org.ezproxy.uio.no/10.1029/2019MS002036">https://doi-org.ezproxy.uio.no/10.1029/2019MS002036</a></p>
<img src="https://drive.google.com/uc?id=1zb0LHvipx8JOXLLrCxzYToJM7eNK4eaw"  height="100" />
<img src="https://reliance.rohub.org/static/media/Reliance-logo.433dc2e9.png"  height="100" />
<img src="https://www.uio.no/vrtx/decorating/resources/dist/src2/images/footer/uio-logo-en.svg"  height="100" />
<img src="https://erc.europa.eu/sites/default/files/logo_0.png"  height="100" />
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./cmip"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../CMIP6_ERA5_CloudSat/plt_seasonal_mean.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Analysis of CMIP6, ERA5, and CloudSat</p>
      </div>
    </a>
    <a class="right-next"
       href="../cloudsat.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Cloudsat</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Example with CMIP6 models (100 - 500 km)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-a-id-introduction-a">1. Introduction <a id="introduction"></a></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-wrangling-a-id-data-wrangling-a">2. Data Wrangling <a id="data_wrangling"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#organize-my-data">Organize my data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-python-packages">Import python packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#open-cmip6-variables">Open CMIP6 variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#search-corresponding-data">Search corresponding data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#convert-calender-from-dtype-object-to-datetime64">Convert Calender from dtype=object to datetime64</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#count-the-days-in-one-season-over-year-range">Count the days in one season over year range</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#supercooled-liquid-water-fraction">Supercooled liquid water fraction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statistics">Statistics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-often-do-we-have-slc-with-thresholds-for-surface-snowfall-liquid-water-path-and-temperature">How often do we have SLC with thresholds for surface snowfall, liquid water path, and temperature</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#liquid-containing-cloud-frequency">Liquid containing cloud frequency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#masked-and-weighted-average">Masked and weighted average</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annual-cycle-of-frequency-of-liquid-containing-clouds">Annual cycle of frequency of liquid containing clouds</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#frequency-of-snowfall-from-lccs">Frequency of snowfall from LCCs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annual-cycle-of-frequency-of-snowfall-from-lccs">Annual cycle of frequency of snowfall from LCCs</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relative-snowfall-efficency">Relative snowfall efficency</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annual-cycle-of-relative-snowfall-efficency">Annual cycle of relative snowfall efficency</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relative-precipitation-efficency">Relative precipitation efficency</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annual-cycle-of-relative-supercooled-precipitation-efficency">Annual cycle of relative supercooled precipitation efficency</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#frequency-of-freezing-rain">Frequency of freezing rain</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-bin-and-bin-sizes">Calculating bin and bin sizes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#precipitation-efficency-spatial">Precipitation efficency - spatial</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relative-frequency">Relative frequency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-annual-cycle-of-lcc-frequency-precipitaiton-frequency-in-lccs-relative-snowfall-efficeny">Plot annual cycle of LCC frequency, precipitaiton frequency in LCCs, relative snowfall efficeny</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#load-era5-data-in-model-resolutions">Load ERA5 data in model resolutions</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#differences-model-era5">Differences Model - ERA5</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#difference-cummulative-snowfall-days">Difference Cummulative snowfall days</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#difference-frequencys">Difference Frequencys</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#difference-total-water-path">Difference total water path</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calendar">Calendar</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#show-attributes-and-individual-identifier">Show attributes and individual identifier</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assign-attributes-to-the-variables">Assign attributes to the variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interpolate-from-cmip6-hybrid-sigma-pressure-levels-to-era5-isobaric-pressure-levels">Interpolate from CMIP6 hybrid sigma-pressure levels to ERA5 isobaric pressure levels</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-liquid-water-path-from-content">Calculate liquid water path from content</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Open CMIP6 variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Search corresponding data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-dictionary-from-the-list-of-datasets-we-found">Create dictionary from the list of datasets we found</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Calendar</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Show attributes and individual identifier</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Assign attributes to the variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Interpolate from CMIP6 hybrid sigma-pressure levels to ERA5 isobaric pressure levels</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regrid-cmip6-data-to-noresm2-mm-grid-a-id-regrid-hz-a">Regrid CMIP6 data to NorESM2-MM grid <a id="regrid_hz"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#connect-all-models-into-one-dataset-with-new-coordinate-model">Connect all models into one Dataset with new coordinate ‘model’</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Supercooled liquid water fraction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Statistics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#find-mixed-phase-clouds">Find mixed-phase clouds</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-dictionary-from-the-list-of-datasets-we-want-to-use-for-the-iwc-lwc-statistics">Create dictionary from the list of datasets we want to use for the IWC/LWC statistics</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exploratory-data-analysis-a-id-exploratory-a">3. Exploratory Data Analysis <a id="exploratory"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-seasonal-mean-of-all-regridded-models">Create seasonal mean of all regridded models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-model-mean-spread-of-seasonal-mean-of-all-regridded-models">Create model mean/spread of seasonal mean of all regridded models</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#references-a-id-references-a">References <a id="references"></a></a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Franziska Hellmuth
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>