

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Example with CMIP6 models (100 - 500 km) &#8212; globalsnow</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'cmip/CMIP6_daily_2006-2009';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to Global Snow project website
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../ERA5/ERA5_1985-2014.html">Example with ERA5 high-resolution (~0.25deg) monthly means</a></li>






<li class="toctree-l1"><a class="reference internal" href="../CMIP6_ERA5_CloudSat/plt_seasonal_mean.html">Analysis of CMIP6, ERA5, and CloudSat</a></li>



<li class="toctree-l1"><a class="reference internal" href="CMIP6_hr_1985-2014.html">Example with CMIP6 models (100 - 500 km)</a></li>








<li class="toctree-l1 has-children"><a class="reference internal" href="../cloudsat.html">Cloudsat</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../CloudSat/get_pressure_grid.html">Example to get CloudSat mean pressure level profile</a></li>



<li class="toctree-l2"><a class="reference internal" href="../CloudSat/read_2C_snow.html">Regrid CloudSat data to horizontal grid</a></li>



</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/franzihe/CloudSat_ERA5_CMIP6_analysis" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/franzihe/CloudSat_ERA5_CMIP6_analysis/issues/new?title=Issue%20on%20page%20%2Fcmip/CMIP6_daily_2006-2009.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/cmip/CMIP6_daily_2006-2009.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Example with CMIP6 models (100 - 500 km)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Example with CMIP6 models (100 - 500 km)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-a-id-introduction-a">1. Introduction <a id="introduction"></a></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-wrangling-a-id-data-wrangling-a">2. Data Wrangling <a id="data_wrangling"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#organize-my-data">Organize my data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-python-packages">Import python packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#open-cmip6-variables">Open CMIP6 variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#search-corresponding-data">Search corresponding data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assign-attributes-to-the-variables">Assign attributes to the variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interpolate-from-cmip6-hybrid-sigma-pressure-levels-to-isobaric-pressure-levels">Interpolate from CMIP6 hybrid sigma-pressure levels to isobaric pressure levels</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-liquid-water-path-from-content">Calculate liquid water path from content</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regrid-cmip6-data-to-ipsl-cm6a-lr-and-ipsl-cm5a2-inca-grid-a-id-regrid-hz-a">Regrid CMIP6 data to IPSL-CM6A-LR and IPSL-CM5A2_INCA grid <a id="regrid_hz"></a></a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># export PYTHONPATH=&quot;${PYTHONPATH}:/uio/kant/geo-geofag-u1/franzihe/Documents/Python/globalsnow/CloudSat_ERA5_CMIP6_analysis/utils/&quot;</span>
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="example-with-cmip6-models-100-500-km">
<h1>Example with CMIP6 models (100 - 500 km)<a class="headerlink" href="#example-with-cmip6-models-100-500-km" title="Permalink to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="table-of-contents">
<h1>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this heading">#</a></h1>
<ul>
<li><a href="#introduction">1. Introduction</a></li>
<li><a href="#data_wrangling">2. Data Wrangling</a></li>
<li><a href="#exploratory">3. Exploratory Data Analysis</a></li>
<li><a href="#conclusion">4. Conclusion</a></li>
<li><a href="#references">5. References</a></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introduction-a-id-introduction-a">
<h1>1. Introduction <a id='introduction'></a><a class="headerlink" href="#introduction-a-id-introduction-a" title="Permalink to this heading">#</a></h1>
<p>Cloud feedbacks are a major contributor to the spread of climate sensitivity in global climate models (GCMs) <a class="reference external" href="https://doi-org.ezproxy.uio.no/10.1029/2019GL085782">Zelinka et al. (2020)</a>. Among the most poorly understood cloud feedbacks is the one associated with the cloud phase, which is expected to be modified with climate change <a class="reference external" href="https://doi-org.ezproxy.uio.no/10.1038/s41561-020-00649-1">Bjordal et al. (2020)</a>. Cloud phase bias, in addition, has significant implications for the simulation of radiative properties and glacier and ice sheet mass balances in climate models.</p>
<p>In this context, this work aims to expand our knowledge on how the representation of the cloud phase affects snow formation in GCMs. Better understanding this aspect is necessary to develop climate models further and improve future climate predictions.</p>
<ul class="simple">
<li><p>Retrieve CMIP6 data through <a class="reference external" href="https://esgf-node.llnl.gov/search/cmip6/">ESGF</a></p></li>
<li><p>Hybrid sigma-pressure coordinates to isobaric pressure levels of the European Centre for Medium-Range Weather Forecast Re-Analysis 5 (ERA5) with <a class="reference external" href="https://geocat-comp.readthedocs.io/en/latest/index.html">GeoCAT-comb</a></p></li>
<li><p>Regridd the CMIP6 variables to the exact horizontal resolution with <a class="reference external" href="https://xesmf.readthedocs.io/en/latest/"><code class="docutils literal notranslate"><span class="pre">xesmf</span></code></a></p></li>
<li><p>Calculate an ensemble mean of all used models</p></li>
<li><p>Calculate and plot the seasonal mean of the ensemble mean</p></li>
</ul>
<p><strong>Questions</strong></p>
<ul class="simple">
<li><p>How is the cloud phase and snowfall varying between 2007 and 2010?</p></li>
</ul>
<blockquote>
<div><p><strong><em>NOTE:</em></strong> We answer questions related to the comparison of CMIP models to ERA5 in another <a class="reference internal" href="../CMIP6_ERA5_CloudSat/plt_seasonal_mean.html"><span class="doc std std-doc">Jupyter Notebook</span></a>.</p>
</div></blockquote>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-wrangling-a-id-data-wrangling-a">
<h1>2. Data Wrangling <a id='data_wrangling'></a><a class="headerlink" href="#data-wrangling-a-id-data-wrangling-a" title="Permalink to this heading">#</a></h1>
<p>This study will compare surface snowfall, ice, and liquid water content from the Coupled Model Intercomparison Project Phase 6 (<a class="reference external" href="https://esgf-node.llnl.gov/projects/cmip6/">CMIP6</a>) climate models to the European Centre for Medium-Range Weather Forecast Re-Analysis 5 (<a class="reference external" href="https://www.ecmwf.int/en/forecasts/datasets/reanalysis-datasets/era5">ERA5</a>) data from <strong>2006 to 2009</strong>. We conduct statistical analysis at the annual and seasonal timescales to determine the biases in cloud phase and precipitation (liquid and solid) in the CMIP6 models and their potential connection between them.</p>
<ul class="simple">
<li><p>Time period: 2006 to 2009</p></li>
<li><p>horizonal resolution: depending on model</p></li>
<li><p>time resolution: daily mean atmospheric data (CFday, day)</p></li>
<li><p>Variables:</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>shortname</p></th>
<th class="head text-center"><p>Long name</p></th>
<th class="head text-right"><p>Units</p></th>
<th class="head text-right"><p>levels</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>prsn</p></td>
<td class="text-center"><p>Snowfall Flux</p></td>
<td class="text-right"><p>[kg m-2 s-1]</p></td>
<td class="text-right"><p>surface</p></td>
</tr>
<tr class="row-odd"><td><p>clw</p></td>
<td class="text-center"><p>Mass Fraction of Cloud Liquid Water</p></td>
<td class="text-right"><p>[kg kg-1]</p></td>
<td class="text-right"><p>ml</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-right"><p>to calculate lwp use integral clw -dp/dg</p></td>
<td class="text-right"><p></p></td>
</tr>
<tr class="row-odd"><td><p>tas</p></td>
<td class="text-center"><p>Near-Surface Air Temperature</p></td>
<td class="text-right"><p>[K]</p></td>
<td class="text-right"><p>surface</p></td>
</tr>
<tr class="row-even"><td><p>clivi</p></td>
<td class="text-center"><p>Ice Water Path</p></td>
<td class="text-right"><p>[kg m-2]</p></td>
<td class="text-right"><p></p></td>
</tr>
<tr class="row-odd"><td><p>lwp</p></td>
<td class="text-center"><p>Liquid Water Path</p></td>
<td class="text-right"><p>[kg m-2]</p></td>
<td class="text-right"><p></p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>CMIP6 models:</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Institution</p></th>
<th class="head text-center"><p>Model name</p></th>
<th class="head text-right"><p>Reference</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="xref myst">MIROC</span></p></td>
<td class="text-center"><p>MIROC6</p></td>
<td class="text-right"><p><span class="xref myst">Tatebe et al. (2019)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="xref myst">NCAR</span></p></td>
<td class="text-center"><p>CESM2</p></td>
<td class="text-right"><p><span class="xref myst">Danabasoglu et al. (2020)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="xref myst">CCCma</span></p></td>
<td class="text-center"><p>CanESM5</p></td>
<td class="text-right"><p><span class="xref myst">Swart et al. (2019)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="xref myst">AWI</span></p></td>
<td class="text-center"><p>AWI-ESM-1-1-LR</p></td>
<td class="text-right"><p><span class="xref myst"></span></p></td>
</tr>
<tr class="row-even"><td><p><span class="xref myst"></span></p></td>
<td class="text-center"><p>MPI-ESM1-2-LR</p></td>
<td class="text-right"><p><span class="xref myst"></span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="xref myst">MOHC</span></p></td>
<td class="text-center"><p>UKESM1-0-LL</p></td>
<td class="text-right"><p><span class="xref myst"></span></p></td>
</tr>
<tr class="row-even"><td><p><span class="xref myst">MOHC</span></p></td>
<td class="text-center"><p>HadGem3-GC31-LL</p></td>
<td class="text-right"><p><span class="xref myst">Roberts et al. (2019)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="xref myst">CNRM-CERFACS</span></p></td>
<td class="text-center"><p>CNRM-CM6-1</p></td>
<td class="text-right"><p><span class="xref myst">Voldoire et al. (2019)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="xref myst">CNRM-CERFACS</span></p></td>
<td class="text-center"><p>CNRM-ESM2-1</p></td>
<td class="text-right"><p><span class="xref myst">Seferian et al. (2019)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="xref myst">IPSL</span></p></td>
<td class="text-center"><p>IPSL-CM6A-LR</p></td>
<td class="text-right"><p><span class="xref myst">Boucher et al. (2020)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="xref myst">IPSL</span></p></td>
<td class="text-center"><p>IPSL-CM5A2-INCA</p></td>
<td class="text-right"><p><span class="xref myst"></span></p></td>
</tr>
</tbody>
</table>
<section id="organize-my-data">
<h2>Organize my data<a class="headerlink" href="#organize-my-data" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Define a prefix for my project (you may need to adjust it for your own usage on your infrastructure).</p>
<ul>
<li><p>input folder where all the data used as input to my Jupyter Notebook is stored (and eventually shared)</p></li>
<li><p>output folder where all the results to keep are stored</p></li>
<li><p>tool folder where all the tools</p></li>
</ul>
</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">/input/cmip6_hist/daily_means</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="n">hostname</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>

<span class="n">abs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>
<span class="n">WORKDIR</span> <span class="o">=</span> <span class="n">abs_path</span><span class="p">[:</span><span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">abs_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">abs_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>


<span class="k">if</span> <span class="s2">&quot;mimi&quot;</span> <span class="ow">in</span> <span class="n">hostname</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
    <span class="n">DATA_DIR</span> <span class="o">=</span> <span class="s2">&quot;/scratch/franzihe/&quot;</span>
<span class="k">elif</span> <span class="s2">&quot;glefsekaldt&quot;</span> <span class="ow">in</span> <span class="n">hostname</span><span class="p">:</span> 
    <span class="n">DATA_DIR</span> <span class="o">=</span> <span class="s2">&quot;/home/franzihe/Data/&quot;</span>

<span class="n">INPUT_DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">)</span>
<span class="n">OUTPUT_DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">)</span>
<span class="n">UTILS_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">WORKDIR</span><span class="p">,</span> <span class="s1">&#39;utils/&#39;</span><span class="p">)</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">UTILS_DIR</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mimi.uio.no
</pre></div>
</div>
</div>
</div>
</section>
<section id="import-python-packages">
<h2>Import python packages<a class="headerlink" href="#import-python-packages" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Python</span></code> environment requirements: file <a class="reference download internal" download="" href="../_downloads/06f3f4f78bf14ffb9f9cfdf395203c3c/requirements_globalsnow.txt"><span class="xref download myst">requirements_globalsnow.txt</span></a></p></li>
<li><p>load <code class="docutils literal notranslate"><span class="pre">python</span></code> packages from <a class="reference download internal" download="" href="../_downloads/5eb7796ec8541cded4dcee2282ad687a/imports.py"><span class="xref download myst">imports.py</span></a></p></li>
<li><p>load <code class="docutils literal notranslate"><span class="pre">functions</span></code> from <a class="reference download internal" download="" href="../_downloads/3afa0d66b1ce4f3999c315ad3a2e691d/functions.py"><span class="xref download myst">functions.py</span></a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># supress warnings</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span> <span class="c1"># don&#39;t output warnings</span>

<span class="c1"># import packages</span>
<span class="kn">from</span> <span class="nn">imports</span> <span class="kn">import</span> <span class="p">(</span><span class="n">xr</span><span class="p">,</span> <span class="n">intake</span><span class="p">,</span> <span class="n">cftime</span><span class="p">,</span> <span class="n">xe</span><span class="p">,</span> <span class="n">glob</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">cm</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">fct</span><span class="p">,</span><span class="n">ccrs</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">plt</span><span class="p">,</span> <span class="n">da</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">LogNorm</span><span class="p">,</span> <span class="n">distributed</span><span class="p">,)</span><span class="c1"># dask)</span>
<span class="n">xr</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">display_style</span><span class="o">=</span><span class="s2">&quot;html&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.core.options.set_options at 0x7fd1b43bab90&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># reload imports</span>
<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a client for distributed computing with dask</span>
<span class="c1"># client = dask.distributed.Client()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="open-cmip6-variables">
<h2>Open CMIP6 variables<a class="headerlink" href="#open-cmip6-variables" title="Permalink to this heading">#</a></h2>
<p>Get the data required for the analysis. Beforehand we downloaded the daily averaged data on single levels and model levels via.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmip_in</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;cmip6_hist/&#39;</span><span class="p">)</span>



<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmip_in</span><span class="p">,</span> <span class="s1">&#39;common_grid&#39;</span><span class="p">))</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmip_in</span><span class="p">,</span> <span class="s1">&#39;single_model&#39;</span><span class="p">))</span>
<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">variable_id</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;clw&#39;</span><span class="p">,</span> <span class="s1">&#39;cli&#39;</span><span class="p">,</span> <span class="s1">&#39;clivi&#39;</span><span class="p">,</span> <span class="s1">&#39;tas&#39;</span><span class="p">,</span> <span class="s1">&#39;prsn&#39;</span><span class="p">,</span> <span class="s1">&#39;pr&#39;</span><span class="p">,</span> <span class="s1">&#39;pfull&#39;</span><span class="p">,</span> <span class="s1">&#39;phalf&#39;</span><span class="p">,</span>  <span class="s1">&#39;areacella&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>At the moment we have downloaded the end of the historical simulations for CMIP6 models. We define start and end year to ensure to only extract the 4-year period between 2006 and 2009.</p>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> Define a start and end year</p>
<p>We will load all available models into one dictonary, which includes an xarray dataset with <code class="docutils literal notranslate"><span class="pre">xarray.open_mfdataset(file)</span></code> and select the time range <a class="reference external" href="https://xarray.pydata.org/en/stable/user-guide/indexing.html">by name</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># source_id</span>
<span class="n">list_models</span> <span class="o">=</span> <span class="p">[</span>
               <span class="c1"># &#39;MIROC6&#39;, #area</span>
               <span class="c1"># # &#39;CESM2&#39;, #area # this model has snowfall only over land</span>
               <span class="c1"># &#39;CanESM5&#39;, # area</span>
               <span class="c1"># &#39;AWI-ESM-1-1-LR&#39;, # area</span>
               <span class="c1"># &#39;MPI-ESM1-2-LR&#39;, # area</span>
               <span class="c1"># &#39;UKESM1-0-LL&#39;, </span>
               <span class="c1"># &#39;HadGEM3-GC31-LL&#39;,</span>
               <span class="s1">&#39;CNRM-CM6-1&#39;</span><span class="p">,</span> <span class="c1">#area</span>
               <span class="s1">&#39;CNRM-ESM2-1&#39;</span><span class="p">,</span> <span class="c1">#area</span>
               <span class="c1"># &#39;IPSL-CM6A-LR&#39;, #area</span>
               <span class="c1"># &#39;IPSL-CM5A2-INCA&#39; #area</span>
            <span class="p">]</span>

<span class="c1">## experiment</span>
<span class="n">experiment_id</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;historical&#39;</span><span class="p">]</span>

<span class="c1">## time resolution</span>
<span class="n">t_res</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">,]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="search-corresponding-data">
<h2>Search corresponding data<a class="headerlink" href="#search-corresponding-data" title="Permalink to this heading">#</a></h2>
<p>Get the data required for the analysis. Define variables, models, experiment, and time resolution as defined in <a href="#data_wrangling">2. Data Wrangling</a>
.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">open_ds_var_id</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">year_range</span><span class="p">,</span> <span class="n">var_id</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">var_id</span> <span class="o">==</span> <span class="s1">&#39;pr&#39;</span><span class="p">:</span>
            <span class="n">ds_var_id</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">files</span><span class="p">,</span><span class="n">drop_variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;prsn&#39;</span><span class="p">])</span>
            
        <span class="k">elif</span> <span class="n">var_id</span> <span class="o">==</span> <span class="s1">&#39;ta&#39;</span><span class="p">:</span>
            <span class="n">ds_var_id</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">files</span><span class="p">,</span><span class="n">drop_variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">var_id</span> <span class="o">==</span> <span class="s1">&#39;phalf&#39;</span><span class="p">:</span>
            <span class="n">ds_var_id</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">files</span><span class="p">,</span><span class="n">drop_variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;orog&#39;</span><span class="p">,</span><span class="s1">&#39;b_bnds&#39;</span><span class="p">,</span> <span class="s1">&#39;ps&#39;</span><span class="p">,</span><span class="s1">&#39;ap&#39;</span><span class="p">,</span><span class="s1">&#39;ap_bnds&#39;</span><span class="p">,])</span>
            <span class="c1"># if model == &#39;IPSL-CM6A-LR&#39;:</span>
            <span class="c1">#     ds_var_id = ds_var_id.assign_coords({&#39;presnivs&#39;: ds_var_id[&#39;klev&#39;].data})</span>
            <span class="c1">#     ds_var_id = ds_var_id.drop_dims({&#39;klev&#39;}).rename({&#39;presnivs&#39;:&#39;klev&#39;})</span>
                
            <span class="c1">#     # ds_var_id = ds_var_id.rename({&#39;presnivs&#39;:&#39;half_lev&#39;,})</span>
            <span class="c1"># #     </span>
            <span class="c1"># else:</span>
            <span class="n">ds_var_id</span> <span class="o">=</span> <span class="n">ds_var_id</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;lev&#39;</span><span class="p">:</span><span class="s1">&#39;half_lev&#39;</span><span class="p">,</span><span class="s1">&#39;lev_bnds&#39;</span><span class="p">:</span><span class="s1">&#39;half_lev_bnds&#39;</span><span class="p">})</span>
        
           
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ds_var_id</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
        <span class="c1"># select only years needed for analysis</span>
        <span class="n">ds_var_id</span> <span class="o">=</span> <span class="n">ds_var_id</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">ds_var_id</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">year_range</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        
        
            
        <span class="k">if</span> <span class="n">var_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ds_var_id</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var_id</span><span class="si">}</span><span class="s1"> do not exists in </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span><span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ds_var_id[var_id] = ds_var_id[var_id].where(ds_var_id[var_id] &gt;= 0.)</span>
            <span class="k">return</span><span class="p">(</span><span class="n">ds_var_id</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;no files found for </span><span class="si">{</span><span class="n">var_id</span><span class="si">}</span><span class="s1"> in </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>We can call dask.delayed on our funtions to make them lazy. Rather than compute their results immediately, they record what we want to compute as a task into a graph that weâ€™ll run later on parallel hardware.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>    
<span class="k">def</span> <span class="nf">search_data</span><span class="p">(</span><span class="n">cmip_in</span><span class="p">,</span> <span class="n">t_res</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">experiment_id</span><span class="p">,</span><span class="n">variable_id</span><span class="p">,</span> <span class="n">year_range</span><span class="p">,</span> <span class="n">variant_label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;CNRM-CM6-1&#39;</span><span class="p">:</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">cmip_in</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;single_model/</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">_*</span><span class="si">{</span><span class="n">t_res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">experiment_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">variant_label</span><span class="si">}</span><span class="s2">*&quot;</span>
        <span class="p">)</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variable_id</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">cmip_in</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;single_model/</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">_*</span><span class="si">{</span><span class="n">t_res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">experiment_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">*&quot;</span>
        <span class="p">)</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variable_id</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">]</span>
    
    
    <span class="c1"># file_paths = (dask.delayed(glob)(file_path) for file_path in file_paths)</span>
    <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">glob</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">]</span>
    
    <span class="c1"># ds_clw, ds_cli, ds_clivi, ds_tas, ds_prsn, ds_pr, ds_pfull, ds_ta = ([</span>
    <span class="c1">#     dask.delayed(open_ds_var_id)(files, year_range, var_id)</span>
    <span class="c1">#     for files, var_id in zip(file_paths, variable_id)</span>
    <span class="c1"># ])</span>
    <span class="n">ds_clw</span><span class="p">,</span> <span class="n">ds_cli</span><span class="p">,</span> <span class="n">ds_clivi</span><span class="p">,</span> <span class="n">ds_tas</span><span class="p">,</span> <span class="n">ds_prsn</span><span class="p">,</span> <span class="n">ds_pr</span><span class="p">,</span> <span class="n">ds_pfull</span><span class="p">,</span> <span class="n">ds_phalf</span> <span class="o">=</span> <span class="p">([</span>
        <span class="n">open_ds_var_id</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">year_range</span><span class="p">,</span> <span class="n">var_id</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">files</span><span class="p">,</span> <span class="n">var_id</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">file_paths</span><span class="p">,</span> <span class="n">variable_id</span><span class="p">)</span>
    <span class="p">])</span>
    
    <span class="n">dsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">ds_clw</span><span class="p">,</span> <span class="n">ds_cli</span><span class="p">,</span> <span class="n">ds_clivi</span><span class="p">,</span> <span class="n">ds_tas</span><span class="p">,</span> <span class="n">ds_prsn</span><span class="p">,</span> <span class="n">ds_pr</span><span class="p">,</span> <span class="n">ds_pfull</span><span class="p">,</span> <span class="n">ds_phalf</span><span class="p">]</span>
    
        
    
    <span class="c1"># Combine datasets by coordinates</span>
    <span class="c1"># dset = dask.delayed(xr.combine_by_coords)([ds for ds in dsets])</span>
    <span class="n">dset</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">combine_by_coords</span><span class="p">([</span><span class="n">ds</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">dsets</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">combine_attrs</span> <span class="o">=</span><span class="s1">&#39;drop_conflicts&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds_pfull</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># sort to start at the top of the atmosphere</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">lev</span><span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">lev</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">half_lev</span><span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">half_lev</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ds_areacella</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
            <span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmip_in</span><span class="si">}</span><span class="s2">/single_model/</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">/areacella_fx_*</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">experiment_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">*.nc&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
            <span class="c1">#drop_variables=[&quot;lat_bnds&quot;, &quot;lon_bnds&quot;],</span>
        <span class="p">)</span>
        <span class="c1"># dset = xr.merge([dset, ds_areacella])</span>
        <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;areacella&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_areacella</span><span class="p">[</span><span class="s1">&#39;areacella&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;areacella does not exist in </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
    <span class="c1"># shift longitude to be from -180 to 180</span>
    <span class="n">dset</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="p">(((</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span><span class="p">))</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="n">dset</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">drop</span><span class="p">({</span><span class="s1">&#39;height&#39;</span><span class="p">})</span>
    
    <span class="k">return</span> <span class="n">dset</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">year</span><span class="o">=</span><span class="mi">2006</span>
<span class="n">dset</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">list_models</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;CNRM-CM6-1&#39;</span><span class="p">:</span>
                <span class="n">dset</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_data</span><span class="p">(</span><span class="n">cmip_in</span><span class="p">,</span> <span class="n">t_res</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">experiment_id</span><span class="p">,</span><span class="n">variable_id</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">year</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">variant_label</span><span class="o">=</span><span class="s1">&#39;r1i1p1f2&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">dset</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_data</span><span class="p">(</span><span class="n">cmip_in</span><span class="p">,</span> <span class="n">t_res</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">experiment_id</span><span class="p">,</span><span class="n">variable_id</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">year</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">)</span>
                
<span class="c1"># dset[model]#.attrs[&#39;references&#39;]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>no files found for cli in CNRM-CM6-1
no files found for pfull in CNRM-CM6-1
no files found for phalf in CNRM-CM6-1
no files found for cli in CNRM-ESM2-1
no files found for pfull in CNRM-ESM2-1
no files found for phalf in CNRM-ESM2-1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dset</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: 'â–º';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: 'â–¼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:      (lat: 128, lon: 256, lev: 91, axis_nbounds: 2, time: 365,
                  bnds: 2)
Coordinates:
  * lat          (lat) float64 -88.93 -87.54 -86.14 -84.74 ... 86.14 87.54 88.93
  * lon          (lon) float64 -180.0 -178.6 -177.2 -175.8 ... 175.8 177.2 178.6
  * lev          (lev) float64 0.9988 0.9959 0.992 ... 2.951e-05 9.869e-06
  * time         (time) datetime64[ns] 2006-01-01T12:00:00 ... 2006-12-31T12:...
Dimensions without coordinates: axis_nbounds, bnds
Data variables: (12/13)
    lev_bounds   (lev, axis_nbounds) float64 dask.array&lt;chunksize=(91, 2), meta=np.ndarray&gt;
    time_bounds  (time, axis_nbounds) datetime64[ns] dask.array&lt;chunksize=(365, 2), meta=np.ndarray&gt;
    clw          (time, lev, lat, lon) float32 dask.array&lt;chunksize=(365, 91, 128, 256), meta=np.ndarray&gt;
    ps           (time, lat, lon) float32 dask.array&lt;chunksize=(365, 128, 256), meta=np.ndarray&gt;
    ap           (lev) float64 dask.array&lt;chunksize=(91,), meta=np.ndarray&gt;
    b            (lev) float64 dask.array&lt;chunksize=(91,), meta=np.ndarray&gt;
    ...           ...
    ap_bnds      (bnds, lev) float64 dask.array&lt;chunksize=(2, 91), meta=np.ndarray&gt;
    clivi        (time, lat, lon) float32 dask.array&lt;chunksize=(365, 128, 256), meta=np.ndarray&gt;
    pr           (time, lat, lon) float32 dask.array&lt;chunksize=(365, 128, 256), meta=np.ndarray&gt;
    prsn         (time, lat, lon) float32 dask.array&lt;chunksize=(365, 128, 256), meta=np.ndarray&gt;
    tas          (time, lat, lon) float32 dask.array&lt;chunksize=(365, 128, 256), meta=np.ndarray&gt;
    areacella    (lat, lon) float32 4.52e+08 4.52e+08 ... 4.52e+08 4.52e+08
Attributes: (12/48)
    Conventions:            CF-1.7 CMIP-6.2
    description:            CMIP6 historical
    title:                  CNRM-ESM2-1 model output prepared for CMIP6 / CMI...
    activity_id:            CMIP
    contact:                contact.cmip@meteo.fr
    data_specs_version:     01.00.21
    ...                     ...
    CMIP6_CV_version:       cv=6.2.3.0-7-g2019642
    dr2xml_md5sum:          789c0010d555326fb79e73c3e20c5d0e
    xios_commit:            1442-shuffle
    nemo_gelato_commit:     49095b3accd5d4c_6524fe19b00467a
    arpege_minor_version:   6.3.2
    history:                none</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-869b042c-41c8-422c-a3a3-da7d3673fff6' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-869b042c-41c8-422c-a3a3-da7d3673fff6' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>lat</span>: 128</li><li><span class='xr-has-index'>lon</span>: 256</li><li><span class='xr-has-index'>lev</span>: 91</li><li><span>axis_nbounds</span>: 2</li><li><span class='xr-has-index'>time</span>: 365</li><li><span>bnds</span>: 2</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-03a02ace-1dcb-45ea-bc51-a131915ab6a3' class='xr-section-summary-in' type='checkbox'  checked><label for='section-03a02ace-1dcb-45ea-bc51-a131915ab6a3' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-88.93 -87.54 ... 87.54 88.93</div><input id='attrs-93b3c295-ecde-4d3a-a05e-57499321b66f' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-93b3c295-ecde-4d3a-a05e-57499321b66f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5f48cc5a-781e-4a69-b589-06868c98eec0' class='xr-var-data-in' type='checkbox'><label for='data-5f48cc5a-781e-4a69-b589-06868c98eec0' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>axis :</span></dt><dd>Y</dd><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>long_name :</span></dt><dd>Latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><pre>array([-88.927735, -87.538705, -86.141472, -84.742386, -83.342596, -81.942466,
       -80.542146, -79.14171 , -77.741196, -76.340629, -74.940023, -73.539389,
       -72.138732, -70.738059, -69.337372, -67.936673, -66.535966, -65.135251,
       -63.73453 , -62.333803, -60.933072, -59.532337, -58.131598, -56.730857,
       -55.330112, -53.929366, -52.528617, -51.127867, -49.727115, -48.326361,
       -46.925606, -45.52485 , -44.124093, -42.723335, -41.322576, -39.921816,
       -38.521056, -37.120294, -35.719532, -34.31877 , -32.918007, -31.517244,
       -30.11648 , -28.715716, -27.314951, -25.914186, -24.513421, -23.112655,
       -21.71189 , -20.311124, -18.910357, -17.509591, -16.108824, -14.708057,
       -13.30729 , -11.906523, -10.505756,  -9.104989,  -7.704221,  -6.303454,
        -4.902687,  -3.501919,  -2.101151,  -0.700384,   0.700384,   2.101151,
         3.501919,   4.902687,   6.303454,   7.704221,   9.104989,  10.505756,
        11.906523,  13.30729 ,  14.708057,  16.108824,  17.509591,  18.910357,
        20.311124,  21.71189 ,  23.112655,  24.513421,  25.914186,  27.314951,
        28.715716,  30.11648 ,  31.517244,  32.918007,  34.31877 ,  35.719532,
        37.120294,  38.521056,  39.921816,  41.322576,  42.723335,  44.124093,
        45.52485 ,  46.925606,  48.326361,  49.727115,  51.127867,  52.528617,
        53.929366,  55.330112,  56.730857,  58.131598,  59.532337,  60.933072,
        62.333803,  63.73453 ,  65.135251,  66.535966,  67.936673,  69.337372,
        70.738059,  72.138732,  73.539389,  74.940023,  76.340629,  77.741196,
        79.14171 ,  80.542146,  81.942466,  83.342596,  84.742386,  86.141472,
        87.538705,  88.927735])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-180.0 -178.6 ... 177.2 178.6</div><input id='attrs-317a5a61-bff3-4465-903d-4b0ead9577b4' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-317a5a61-bff3-4465-903d-4b0ead9577b4' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8d0b6c90-38a4-463d-a58a-acf1fecf476e' class='xr-var-data-in' type='checkbox'><label for='data-8d0b6c90-38a4-463d-a58a-acf1fecf476e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>axis :</span></dt><dd>X</dd><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>long_name :</span></dt><dd>Longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><pre>array([-180.     , -178.59375, -177.1875 , ...,  175.78125,  177.1875 ,
        178.59375])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lev</span></div><div class='xr-var-dims'>(lev)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.9988 0.9959 ... 9.869e-06</div><input id='attrs-c0635f8d-3843-4743-a263-7090637923d1' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-c0635f8d-3843-4743-a263-7090637923d1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b7d5e5ff-fa28-44c7-a504-d430b10071e9' class='xr-var-data-in' type='checkbox'><label for='data-b7d5e5ff-fa28-44c7-a504-d430b10071e9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>name :</span></dt><dd>lev</dd><dt><span>standard_name :</span></dt><dd>atmosphere_hybrid_sigma_pressure_coordinate</dd><dt><span>long_name :</span></dt><dd>atmospheric model level</dd><dt><span>units :</span></dt><dd>1</dd><dt><span>positive :</span></dt><dd>down</dd><dt><span>formula :</span></dt><dd>p = ap + b*ps</dd><dt><span>formula_term :</span></dt><dd>ap: ap b: b ps: ps</dd><dt><span>bounds :</span></dt><dd>lev_bounds</dd></dl></div><div class='xr-var-data'><pre>array([9.988151e-01, 9.959496e-01, 9.919785e-01, 9.867627e-01, 9.803135e-01,
       9.727423e-01, 9.639018e-01, 9.535363e-01, 9.416150e-01, 9.281436e-01,
       9.131237e-01, 8.965609e-01, 8.784941e-01, 8.589981e-01, 8.381457e-01,
       8.160020e-01, 7.926548e-01, 7.682247e-01, 7.428293e-01, 7.165710e-01,
       6.895664e-01, 6.619600e-01, 6.338908e-01, 6.054764e-01, 5.768424e-01,
       5.481361e-01, 5.195776e-01, 4.914467e-01, 4.640177e-01, 4.375466e-01,
       4.122711e-01, 3.882926e-01, 3.655744e-01, 3.440645e-01, 3.237057e-01,
       3.044435e-01, 2.862251e-01, 2.690002e-01, 2.527204e-01, 2.373396e-01,
       2.228133e-01, 2.090992e-01, 1.961565e-01, 1.839464e-01, 1.724318e-01,
       1.615771e-01, 1.513484e-01, 1.417132e-01, 1.326406e-01, 1.241009e-01,
       1.160565e-01, 1.084543e-01, 1.012399e-01, 9.436681e-02, 8.779560e-02,
       8.149272e-02, 7.542972e-02, 6.958413e-02, 6.395049e-02, 5.853933e-02,
       5.336302e-02, 4.843146e-02, 4.375126e-02, 3.932698e-02, 3.516221e-02,
       3.125945e-02, 2.762004e-02, 2.424404e-02, 2.113017e-02, 1.827577e-02,
       1.567665e-02, 1.332716e-02, 1.122009e-02, 9.346718e-03, 7.696813e-03,
       6.258735e-03, 5.019516e-03, 3.965015e-03, 3.080094e-03, 2.348848e-03,
       1.754865e-03, 1.281528e-03, 9.123277e-04, 6.312078e-04, 4.228940e-04,
       2.732123e-04, 1.693656e-04, 1.001505e-04, 5.609681e-05, 2.951331e-05,
       9.869430e-06])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2006-01-01T12:00:00 ... 2006-12-...</div><input id='attrs-f01004c8-793b-40e0-876d-9e83c493f723' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-f01004c8-793b-40e0-876d-9e83c493f723' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b159ba5a-44a1-4aba-9fe8-d189f0bf49ee' class='xr-var-data-in' type='checkbox'><label for='data-b159ba5a-44a1-4aba-9fe8-d189f0bf49ee' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>axis :</span></dt><dd>T</dd><dt><span>standard_name :</span></dt><dd>time</dd><dt><span>long_name :</span></dt><dd>Time axis</dd><dt><span>time_origin :</span></dt><dd>1850-01-01 00:00:00</dd><dt><span>bounds :</span></dt><dd>time_bounds</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;2006-01-01T12:00:00.000000000&#x27;, &#x27;2006-01-02T12:00:00.000000000&#x27;,
       &#x27;2006-01-03T12:00:00.000000000&#x27;, ..., &#x27;2006-12-29T12:00:00.000000000&#x27;,
       &#x27;2006-12-30T12:00:00.000000000&#x27;, &#x27;2006-12-31T12:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-deb485ad-c6db-4eeb-8686-c373d1863ae0' class='xr-section-summary-in' type='checkbox'  checked><label for='section-deb485ad-c6db-4eeb-8686-c373d1863ae0' class='xr-section-summary' >Data variables: <span>(13)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>lev_bounds</span></div><div class='xr-var-dims'>(lev, axis_nbounds)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(91, 2), meta=np.ndarray&gt;</div><input id='attrs-c1db2058-34f2-40e7-be79-f8dbd2aade9b' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-c1db2058-34f2-40e7-be79-f8dbd2aade9b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8e69d958-e4ec-4feb-8807-935a9b185313' class='xr-var-data-in' type='checkbox'><label for='data-8e69d958-e4ec-4feb-8807-935a9b185313' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>standard_name :</span></dt><dd>atmosphere_hybrid_sigma_pressure_coordinate</dd><dt><span>units :</span></dt><dd>1</dd><dt><span>formula :</span></dt><dd>p = ap + b*ps</dd><dt><span>formula_term :</span></dt><dd>ap: ap b: b ps: ps</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 1.42 kiB </td>
                        <td> 1.42 kiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (91, 2) </td>
                        <td> (91, 2) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 4 Graph Layers </td>
                        <td> 1 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float64 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="79" height="170" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="29" y2="0" style="stroke-width:2" />
  <line x1="0" y1="120" x2="29" y2="120" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="120" style="stroke-width:2" />
  <line x1="29" y1="0" x2="29" y2="120" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 29.56599059001709,0.0 29.56599059001709,120.0 0.0,120.0" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="14.782995" y="140.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" >2</text>
  <text x="49.565991" y="60.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,49.565991,60.000000)">91</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>time_bounds</span></div><div class='xr-var-dims'>(time, axis_nbounds)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(365, 2), meta=np.ndarray&gt;</div><input id='attrs-28718007-44a6-4491-827b-c900bda87e70' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-28718007-44a6-4491-827b-c900bda87e70' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f2c33f4b-117b-4812-95fa-8fb09582ec4d' class='xr-var-data-in' type='checkbox'><label for='data-f2c33f4b-117b-4812-95fa-8fb09582ec4d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 5.70 kiB </td>
                        <td> 5.70 kiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (365, 2) </td>
                        <td> (365, 2) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 26 Graph Layers </td>
                        <td> 1 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> datetime64[ns] </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="75" height="170" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="25" y2="0" style="stroke-width:2" />
  <line x1="0" y1="120" x2="25" y2="120" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="120" style="stroke-width:2" />
  <line x1="25" y1="0" x2="25" y2="120" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 25.412616514582485,0.0 25.412616514582485,120.0 0.0,120.0" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="12.706308" y="140.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" >2</text>
  <text x="45.412617" y="60.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,45.412617,60.000000)">365</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>clw</span></div><div class='xr-var-dims'>(time, lev, lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(365, 91, 128, 256), meta=np.ndarray&gt;</div><input id='attrs-c1ea0aaf-e4a4-4fa6-9b56-a20004401dce' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-c1ea0aaf-e4a4-4fa6-9b56-a20004401dce' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9904b19a-7468-4b02-8cef-26f3ac97b00d' class='xr-var-data-in' type='checkbox'><label for='data-9904b19a-7468-4b02-8cef-26f3ac97b00d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Mass Fraction of Cloud Liquid Water</dd><dt><span>units :</span></dt><dd>kg kg-1</dd><dt><span>online_operation :</span></dt><dd>average</dd><dt><span>cell_methods :</span></dt><dd>area: time: mean</dd><dt><span>interval_operation :</span></dt><dd>900 s</dd><dt><span>interval_write :</span></dt><dd>1 d</dd><dt><span>standard_name :</span></dt><dd>mass_fraction_of_cloud_liquid_water_in_air</dd><dt><span>description :</span></dt><dd>Calculated as the mass of  cloud liquid water in the grid cell divided by the mass of air (including the water in all phases) in the grid cell.  This includes precipitating hydrometeors ONLY if the precipitating hydrometeors affect the calculation of radiative transfer in model.</dd><dt><span>history :</span></dt><dd>none</dd><dt><span>cell_measures :</span></dt><dd>area: areacella</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 4.05 GiB </td>
                        <td> 4.05 GiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (365, 91, 128, 256) </td>
                        <td> (365, 91, 128, 256) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 6 Graph Layers </td>
                        <td> 1 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float32 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="539" height="119" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="25" x2="120" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2" />
  <line x1="120" y1="0" x2="120" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,25.412616514582485 0.0,25.412616514582485" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="45.412617" font-size="1.0rem" font-weight="100" text-anchor="middle" >365</text>
  <text x="140.000000" y="12.706308" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,12.706308)">1</text>


  <!-- Horizontal lines -->
  <line x1="190" y1="0" x2="215" y2="25" style="stroke-width:2" />
  <line x1="190" y1="44" x2="215" y2="69" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="190" y1="0" x2="190" y2="44" style="stroke-width:2" />
  <line x1="215" y1="25" x2="215" y2="69" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="190.0,0.0 215.22854437145963,25.228544371459638 215.22854437145963,69.27038187824817 190.0,44.04183750678854" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="190" y1="0" x2="274" y2="0" style="stroke-width:2" />
  <line x1="215" y1="25" x2="299" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="190" y1="0" x2="215" y2="25" style="stroke-width:2" />
  <line x1="274" y1="0" x2="299" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="190.0,0.0 274.16438356164383,0.0 299.39292793310346,25.228544371459638 215.22854437145963,25.228544371459638" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="215" y1="25" x2="299" y2="25" style="stroke-width:2" />
  <line x1="215" y1="69" x2="299" y2="69" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="215" y1="25" x2="215" y2="69" style="stroke-width:2" />
  <line x1="299" y1="25" x2="299" y2="69" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="215.22854437145963,25.228544371459638 299.39292793310346,25.228544371459638 299.39292793310346,69.27038187824817 215.22854437145963,69.27038187824817" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="257.310736" y="89.270382" font-size="1.0rem" font-weight="100" text-anchor="middle" >256</text>
  <text x="319.392928" y="47.249463" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,319.392928,47.249463)">128</text>
  <text x="192.614272" y="76.656110" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,192.614272,76.656110)">91</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>ps</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(365, 128, 256), meta=np.ndarray&gt;</div><input id='attrs-4d594a5d-3e6d-456e-b30a-6420607bea0f' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-4d594a5d-3e6d-456e-b30a-6420607bea0f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-45a59e58-45b4-46b1-b04b-c5fef79dd0f6' class='xr-var-data-in' type='checkbox'><label for='data-45a59e58-45b4-46b1-b04b-c5fef79dd0f6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Surface Air Pressure</dd><dt><span>units :</span></dt><dd>Pa</dd><dt><span>online_operation :</span></dt><dd>average</dd><dt><span>cell_methods :</span></dt><dd>area: time: mean</dd><dt><span>interval_operation :</span></dt><dd>900 s</dd><dt><span>interval_write :</span></dt><dd>1 d</dd><dt><span>standard_name :</span></dt><dd>surface_air_pressure</dd><dt><span>description :</span></dt><dd>Surface Air Pressure</dd><dt><span>history :</span></dt><dd>none</dd><dt><span>cell_measures :</span></dt><dd>area: areacella</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 45.62 MiB </td>
                        <td> 45.62 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (365, 128, 256) </td>
                        <td> (365, 128, 256) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 6 Graph Layers </td>
                        <td> 1 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float32 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="214" height="164" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="44" x2="80" y2="114" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="44" style="stroke-width:2" />
  <line x1="80" y1="70" x2="80" y2="114" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,114.63007280090619 10.0,44.04183750678854" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="94" y2="0" style="stroke-width:2" />
  <line x1="80" y1="70" x2="164" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="94" y1="0" x2="164" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 94.16438356164383,0.0 164.75261885576148,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="164" y2="70" style="stroke-width:2" />
  <line x1="80" y1="114" x2="164" y2="114" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="114" style="stroke-width:2" />
  <line x1="164" y1="70" x2="164" y2="114" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 164.75261885576148,70.58823529411765 164.75261885576148,114.63007280090619 80.58823529411765,114.63007280090619" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="122.670427" y="134.630073" font-size="1.0rem" font-weight="100" text-anchor="middle" >256</text>
  <text x="184.752619" y="92.609154" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,184.752619,92.609154)">128</text>
  <text x="35.294118" y="99.335955" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,99.335955)">365</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>ap</span></div><div class='xr-var-dims'>(lev)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(91,), meta=np.ndarray&gt;</div><input id='attrs-e1959ebf-661a-417f-bcaf-3000fc063ca3' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-e1959ebf-661a-417f-bcaf-3000fc063ca3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-72153bd4-8236-4718-a642-00e14e543994' class='xr-var-data-in' type='checkbox'><label for='data-72153bd4-8236-4718-a642-00e14e543994' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>vertical coordinate formula term: ap(k)</dd><dt><span>online_operation :</span></dt><dd>once</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 728 B </td>
                        <td> 728 B </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (91,) </td>
                        <td> (91,) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 4 Graph Layers </td>
                        <td> 1 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float64 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="75" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="25" x2="120" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2" />
  <line x1="120" y1="0" x2="120" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,25.86984685721921 0.0,25.86984685721921" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="45.869847" font-size="1.0rem" font-weight="100" text-anchor="middle" >91</text>
  <text x="140.000000" y="12.934923" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,12.934923)">1</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>b</span></div><div class='xr-var-dims'>(lev)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(91,), meta=np.ndarray&gt;</div><input id='attrs-79ff1903-dd09-4b77-baec-a152e4d1c0a0' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-79ff1903-dd09-4b77-baec-a152e4d1c0a0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6777e4b6-252b-4481-9131-b90886b35d9c' class='xr-var-data-in' type='checkbox'><label for='data-6777e4b6-252b-4481-9131-b90886b35d9c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>vertical coordinate formula term: b(k)</dd><dt><span>online_operation :</span></dt><dd>once</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 728 B </td>
                        <td> 728 B </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (91,) </td>
                        <td> (91,) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 4 Graph Layers </td>
                        <td> 1 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float64 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="75" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="25" x2="120" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2" />
  <line x1="120" y1="0" x2="120" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,25.86984685721921 0.0,25.86984685721921" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="45.869847" font-size="1.0rem" font-weight="100" text-anchor="middle" >91</text>
  <text x="140.000000" y="12.934923" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,12.934923)">1</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>b_bnds</span></div><div class='xr-var-dims'>(bnds, lev)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(2, 91), meta=np.ndarray&gt;</div><input id='attrs-a58e3c50-54ff-4896-ae46-d5a86f12867f' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-a58e3c50-54ff-4896-ae46-d5a86f12867f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4dab7365-1dd1-4675-acc3-70668a1c761e' class='xr-var-data-in' type='checkbox'><label for='data-4dab7365-1dd1-4675-acc3-70668a1c761e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>vertical coordinate formula term: b(k+1/2)</dd><dt><span>online_operation :</span></dt><dd>once</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 1.42 kiB </td>
                        <td> 1.42 kiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (2, 91) </td>
                        <td> (2, 91) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 4 Graph Layers </td>
                        <td> 1 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float64 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="79" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="29" x2="120" y2="29" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="29" style="stroke-width:2" />
  <line x1="120" y1="0" x2="120" y2="29" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,29.56599059001709 0.0,29.56599059001709" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="49.565991" font-size="1.0rem" font-weight="100" text-anchor="middle" >91</text>
  <text x="140.000000" y="14.782995" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,14.782995)">2</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>ap_bnds</span></div><div class='xr-var-dims'>(bnds, lev)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(2, 91), meta=np.ndarray&gt;</div><input id='attrs-13e9e3d1-d25a-4522-a5ca-3dbb9d018e48' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-13e9e3d1-d25a-4522-a5ca-3dbb9d018e48' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8fefe883-b55f-4ec2-aa49-5e091d59f559' class='xr-var-data-in' type='checkbox'><label for='data-8fefe883-b55f-4ec2-aa49-5e091d59f559' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>vertical coordinate formula term: ap(k+1/2)</dd><dt><span>online_operation :</span></dt><dd>once</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 1.42 kiB </td>
                        <td> 1.42 kiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (2, 91) </td>
                        <td> (2, 91) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 4 Graph Layers </td>
                        <td> 1 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float64 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="79" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="29" x2="120" y2="29" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="29" style="stroke-width:2" />
  <line x1="120" y1="0" x2="120" y2="29" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,29.56599059001709 0.0,29.56599059001709" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="49.565991" font-size="1.0rem" font-weight="100" text-anchor="middle" >91</text>
  <text x="140.000000" y="14.782995" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,14.782995)">2</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>clivi</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(365, 128, 256), meta=np.ndarray&gt;</div><input id='attrs-d9431e04-c6ea-448a-9735-3e5589f2a06b' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-d9431e04-c6ea-448a-9735-3e5589f2a06b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7902b17c-0633-4354-aa5e-f6569c6f461b' class='xr-var-data-in' type='checkbox'><label for='data-7902b17c-0633-4354-aa5e-f6569c6f461b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Ice Water Path</dd><dt><span>units :</span></dt><dd>kg m-2</dd><dt><span>online_operation :</span></dt><dd>average</dd><dt><span>cell_methods :</span></dt><dd>area: time: mean</dd><dt><span>interval_operation :</span></dt><dd>900 s</dd><dt><span>interval_write :</span></dt><dd>1 d</dd><dt><span>description :</span></dt><dd>calculate mass of ice water in the column divided by the area of the column (not just the area of the cloudy portion of the column). This includes precipitating frozen hydrometeors ONLY if the precipitating hydrometeors affect the calculation of radiative transfer in model.</dd><dt><span>history :</span></dt><dd>none</dd><dt><span>cell_measures :</span></dt><dd>area: areacella</dd><dt><span>standard_name :</span></dt><dd>atmosphere_mass_content_of_cloud_ice</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 45.62 MiB </td>
                        <td> 45.62 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (365, 128, 256) </td>
                        <td> (365, 128, 256) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 6 Graph Layers </td>
                        <td> 1 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float32 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="214" height="164" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="44" x2="80" y2="114" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="44" style="stroke-width:2" />
  <line x1="80" y1="70" x2="80" y2="114" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,114.63007280090619 10.0,44.04183750678854" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="94" y2="0" style="stroke-width:2" />
  <line x1="80" y1="70" x2="164" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="94" y1="0" x2="164" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 94.16438356164383,0.0 164.75261885576148,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="164" y2="70" style="stroke-width:2" />
  <line x1="80" y1="114" x2="164" y2="114" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="114" style="stroke-width:2" />
  <line x1="164" y1="70" x2="164" y2="114" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 164.75261885576148,70.58823529411765 164.75261885576148,114.63007280090619 80.58823529411765,114.63007280090619" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="122.670427" y="134.630073" font-size="1.0rem" font-weight="100" text-anchor="middle" >256</text>
  <text x="184.752619" y="92.609154" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,184.752619,92.609154)">128</text>
  <text x="35.294118" y="99.335955" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,99.335955)">365</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>pr</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(365, 128, 256), meta=np.ndarray&gt;</div><input id='attrs-b67b4a1b-f1ac-4785-9d27-ff093e9cb4dd' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-b67b4a1b-f1ac-4785-9d27-ff093e9cb4dd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9eea1f3c-5999-43a5-b384-d743dcf35b4c' class='xr-var-data-in' type='checkbox'><label for='data-9eea1f3c-5999-43a5-b384-d743dcf35b4c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Precipitation</dd><dt><span>units :</span></dt><dd>kg m-2 s-1</dd><dt><span>online_operation :</span></dt><dd>average</dd><dt><span>cell_methods :</span></dt><dd>area: time: mean</dd><dt><span>interval_operation :</span></dt><dd>900 s</dd><dt><span>interval_write :</span></dt><dd>1 d</dd><dt><span>standard_name :</span></dt><dd>precipitation_flux</dd><dt><span>description :</span></dt><dd>at surface; includes both liquid and solid phases from all types of clouds (both large-scale and convective)</dd><dt><span>history :</span></dt><dd>none</dd><dt><span>cell_measures :</span></dt><dd>area: areacella</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 45.62 MiB </td>
                        <td> 45.62 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (365, 128, 256) </td>
                        <td> (365, 128, 256) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 6 Graph Layers </td>
                        <td> 1 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float32 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="214" height="164" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="44" x2="80" y2="114" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="44" style="stroke-width:2" />
  <line x1="80" y1="70" x2="80" y2="114" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,114.63007280090619 10.0,44.04183750678854" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="94" y2="0" style="stroke-width:2" />
  <line x1="80" y1="70" x2="164" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="94" y1="0" x2="164" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 94.16438356164383,0.0 164.75261885576148,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="164" y2="70" style="stroke-width:2" />
  <line x1="80" y1="114" x2="164" y2="114" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="114" style="stroke-width:2" />
  <line x1="164" y1="70" x2="164" y2="114" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 164.75261885576148,70.58823529411765 164.75261885576148,114.63007280090619 80.58823529411765,114.63007280090619" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="122.670427" y="134.630073" font-size="1.0rem" font-weight="100" text-anchor="middle" >256</text>
  <text x="184.752619" y="92.609154" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,184.752619,92.609154)">128</text>
  <text x="35.294118" y="99.335955" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,99.335955)">365</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>prsn</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(365, 128, 256), meta=np.ndarray&gt;</div><input id='attrs-f8512183-aeb2-4246-89e9-1b8f535945d4' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-f8512183-aeb2-4246-89e9-1b8f535945d4' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-16146004-082f-4aad-a4d7-715ea8d6a3fd' class='xr-var-data-in' type='checkbox'><label for='data-16146004-082f-4aad-a4d7-715ea8d6a3fd' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Snowfall Flux</dd><dt><span>units :</span></dt><dd>kg m-2 s-1</dd><dt><span>online_operation :</span></dt><dd>average</dd><dt><span>cell_methods :</span></dt><dd>area: time: mean</dd><dt><span>interval_operation :</span></dt><dd>900 s</dd><dt><span>interval_write :</span></dt><dd>1 d</dd><dt><span>standard_name :</span></dt><dd>snowfall_flux</dd><dt><span>description :</span></dt><dd>at surface; includes precipitation of all forms of water in the solid phase</dd><dt><span>history :</span></dt><dd>none</dd><dt><span>cell_measures :</span></dt><dd>area: areacella</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 45.62 MiB </td>
                        <td> 45.62 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (365, 128, 256) </td>
                        <td> (365, 128, 256) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 6 Graph Layers </td>
                        <td> 1 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float32 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="214" height="164" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="44" x2="80" y2="114" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="44" style="stroke-width:2" />
  <line x1="80" y1="70" x2="80" y2="114" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,114.63007280090619 10.0,44.04183750678854" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="94" y2="0" style="stroke-width:2" />
  <line x1="80" y1="70" x2="164" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="94" y1="0" x2="164" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 94.16438356164383,0.0 164.75261885576148,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="164" y2="70" style="stroke-width:2" />
  <line x1="80" y1="114" x2="164" y2="114" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="114" style="stroke-width:2" />
  <line x1="164" y1="70" x2="164" y2="114" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 164.75261885576148,70.58823529411765 164.75261885576148,114.63007280090619 80.58823529411765,114.63007280090619" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="122.670427" y="134.630073" font-size="1.0rem" font-weight="100" text-anchor="middle" >256</text>
  <text x="184.752619" y="92.609154" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,184.752619,92.609154)">128</text>
  <text x="35.294118" y="99.335955" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,99.335955)">365</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>tas</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(365, 128, 256), meta=np.ndarray&gt;</div><input id='attrs-f25f4ee4-a0bc-49c6-b1b9-9bd4f68e8511' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-f25f4ee4-a0bc-49c6-b1b9-9bd4f68e8511' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-930891c2-056a-40fb-8560-0a0db60db03f' class='xr-var-data-in' type='checkbox'><label for='data-930891c2-056a-40fb-8560-0a0db60db03f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>online_operation :</span></dt><dd>average</dd><dt><span>cell_methods :</span></dt><dd>area: time: mean</dd><dt><span>interval_operation :</span></dt><dd>900 s</dd><dt><span>interval_write :</span></dt><dd>1 d</dd><dt><span>standard_name :</span></dt><dd>air_temperature</dd><dt><span>description :</span></dt><dd>Near-Surface Air Temperature</dd><dt><span>long_name :</span></dt><dd>Near-Surface Air Temperature</dd><dt><span>history :</span></dt><dd>none</dd><dt><span>units :</span></dt><dd>K</dd><dt><span>cell_measures :</span></dt><dd>area: areacella</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 45.62 MiB </td>
                        <td> 45.62 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (365, 128, 256) </td>
                        <td> (365, 128, 256) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 6 Graph Layers </td>
                        <td> 1 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float32 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="214" height="164" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="44" x2="80" y2="114" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="44" style="stroke-width:2" />
  <line x1="80" y1="70" x2="80" y2="114" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,114.63007280090619 10.0,44.04183750678854" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="94" y2="0" style="stroke-width:2" />
  <line x1="80" y1="70" x2="164" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="94" y1="0" x2="164" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 94.16438356164383,0.0 164.75261885576148,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="164" y2="70" style="stroke-width:2" />
  <line x1="80" y1="114" x2="164" y2="114" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="114" style="stroke-width:2" />
  <line x1="164" y1="70" x2="164" y2="114" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 164.75261885576148,70.58823529411765 164.75261885576148,114.63007280090619 80.58823529411765,114.63007280090619" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="122.670427" y="134.630073" font-size="1.0rem" font-weight="100" text-anchor="middle" >256</text>
  <text x="184.752619" y="92.609154" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,184.752619,92.609154)">128</text>
  <text x="35.294118" y="99.335955" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,99.335955)">365</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>areacella</span></div><div class='xr-var-dims'>(lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-da803749-7ac9-41cf-9b0e-bc313e7f27da' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-da803749-7ac9-41cf-9b0e-bc313e7f27da' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7a664fdd-018b-4e6a-ae18-b8ca4b87aac7' class='xr-var-data-in' type='checkbox'><label for='data-7a664fdd-018b-4e6a-ae18-b8ca4b87aac7' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>online_operation :</span></dt><dd>once</dd><dt><span>cell_methods :</span></dt><dd>area: sum</dd><dt><span>standard_name :</span></dt><dd>cell_area</dd><dt><span>description :</span></dt><dd>Cell areas for any grid used to report atmospheric variables and any other variable using that grid (e.g., soil moisture content). These cell areas should be defined to enable exact calculation of global integrals (e.g., of vertical fluxes of energy at the surface and top of the atmosphere).</dd><dt><span>long_name :</span></dt><dd>Grid-Cell Area for Atmospheric Variables</dd><dt><span>history :</span></dt><dd>none</dd><dt><span>units :</span></dt><dd>m2</dd></dl></div><div class='xr-var-data'><pre>array([[4.519586e+08, 4.519586e+08, 4.519586e+08, ..., 4.519586e+08,
        4.519586e+08, 4.519586e+08],
       [1.040237e+09, 1.040237e+09, 1.040237e+09, ..., 1.040237e+09,
        1.040237e+09, 1.040237e+09],
       [1.635971e+09, 1.635971e+09, 1.635971e+09, ..., 1.635971e+09,
        1.635971e+09, 1.635971e+09],
       ...,
       [1.635971e+09, 1.635971e+09, 1.635971e+09, ..., 1.635971e+09,
        1.635971e+09, 1.635971e+09],
       [1.040237e+09, 1.040237e+09, 1.040237e+09, ..., 1.040237e+09,
        1.040237e+09, 1.040237e+09],
       [4.519586e+08, 4.519586e+08, 4.519586e+08, ..., 4.519586e+08,
        4.519586e+08, 4.519586e+08]], dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-31c67e66-dfa7-4e60-a8de-6e45755e7b57' class='xr-section-summary-in' type='checkbox'  ><label for='section-31c67e66-dfa7-4e60-a8de-6e45755e7b57' class='xr-section-summary' >Attributes: <span>(48)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>Conventions :</span></dt><dd>CF-1.7 CMIP-6.2</dd><dt><span>description :</span></dt><dd>CMIP6 historical</dd><dt><span>title :</span></dt><dd>CNRM-ESM2-1 model output prepared for CMIP6 / CMIP historical</dd><dt><span>activity_id :</span></dt><dd>CMIP</dd><dt><span>contact :</span></dt><dd>contact.cmip@meteo.fr</dd><dt><span>data_specs_version :</span></dt><dd>01.00.21</dd><dt><span>dr2xml_version :</span></dt><dd>1.9</dd><dt><span>experiment_id :</span></dt><dd>historical</dd><dt><span>experiment :</span></dt><dd>all-forcing simulation of the recent past</dd><dt><span>external_variables :</span></dt><dd>areacella</dd><dt><span>forcing_index :</span></dt><dd>2</dd><dt><span>frequency :</span></dt><dd>day</dd><dt><span>further_info_url :</span></dt><dd>https://furtherinfo.es-doc.org/CMIP6.CNRM-CERFACS.CNRM-ESM2-1.historical.none.r1i1p1f2</dd><dt><span>grid :</span></dt><dd>data regridded to a T127 gaussian grid (128x256 latlon) from a native atmosphere T127l reduced gaussian grid</dd><dt><span>grid_label :</span></dt><dd>gr</dd><dt><span>nominal_resolution :</span></dt><dd>250 km</dd><dt><span>initialization_index :</span></dt><dd>1</dd><dt><span>institution_id :</span></dt><dd>CNRM-CERFACS</dd><dt><span>institution :</span></dt><dd>CNRM (Centre National de Recherches Meteorologiques, Toulouse 31057, France), CERFACS (Centre Europeen de Recherche et de Formation Avancee en Calcul Scientifique, Toulouse 31057, France)</dd><dt><span>license :</span></dt><dd>CMIP6 model data produced by CNRM-CERFACS is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License (https://creativecommons.org/licenses). Consult https://pcmdi.llnl.gov/CMIP6/TermsOfUse for terms of use governing CMIP6 output, including citation requirements and proper acknowledgment. Further information about this data, including some limitations, can be found via the further_info_url (recorded as a global attribute in this file) and at http://www.umr-cnrm.fr/cmip6/. The data producers and data providers make no warranty, either express or implied, including, but not limited to, warranties of merchantability and fitness for a particular purpose. All liabilities arising from the supply of the information (including any liability arising in negligence) are excluded to the fullest extent permitted by law.</dd><dt><span>mip_era :</span></dt><dd>CMIP6</dd><dt><span>parent_experiment_id :</span></dt><dd>piControl</dd><dt><span>parent_mip_era :</span></dt><dd>CMIP6</dd><dt><span>parent_activity_id :</span></dt><dd>CMIP</dd><dt><span>parent_source_id :</span></dt><dd>CNRM-ESM2-1</dd><dt><span>parent_time_units :</span></dt><dd>days since 1850-01-01 00:00:00</dd><dt><span>parent_variant_label :</span></dt><dd>r1i1p1f2</dd><dt><span>branch_method :</span></dt><dd>standard</dd><dt><span>branch_time_in_parent :</span></dt><dd>0.0</dd><dt><span>branch_time_in_child :</span></dt><dd>0.0</dd><dt><span>physics_index :</span></dt><dd>1</dd><dt><span>product :</span></dt><dd>model-output</dd><dt><span>realization_index :</span></dt><dd>1</dd><dt><span>realm :</span></dt><dd>atmos</dd><dt><span>references :</span></dt><dd>http://www.umr-cnrm.fr/cmip6/references</dd><dt><span>source :</span></dt><dd>CNRM-ESM2-1 (2017):  aerosol: TACTIC_v2 atmos: Arpege 6.3 (T127; Gaussian Reduced with 24572 grid points in total distributed over 128 latitude circles (with 256 grid points per latitude circle between 30degN and 30degS reducing to 20 grid points per latitude circle at 88.9degN and 88.9degS); 91 levels; top level 78.4 km) atmosChem: REPROBUS-C_v2 land: Surfex 8.0c ocean: Nemo 3.6 (eORCA1, tripolar primarily 1deg; 362 x 294 longitude/latitude; 75 levels; top grid cell 0-1 m) ocnBgchem: Pisces 2.s seaIce: Gelato 6.1</dd><dt><span>source_id :</span></dt><dd>CNRM-ESM2-1</dd><dt><span>source_type :</span></dt><dd>AOGCM BGC AER CHEM</dd><dt><span>sub_experiment_id :</span></dt><dd>none</dd><dt><span>sub_experiment :</span></dt><dd>none</dd><dt><span>variant_label :</span></dt><dd>r1i1p1f2</dd><dt><span>EXPID :</span></dt><dd>CNRM-ESM2-1_historical_r1i1p1f2</dd><dt><span>CMIP6_CV_version :</span></dt><dd>cv=6.2.3.0-7-g2019642</dd><dt><span>dr2xml_md5sum :</span></dt><dd>789c0010d555326fb79e73c3e20c5d0e</dd><dt><span>xios_commit :</span></dt><dd>1442-shuffle</dd><dt><span>nemo_gelato_commit :</span></dt><dd>49095b3accd5d4c_6524fe19b00467a</dd><dt><span>arpege_minor_version :</span></dt><dd>6.3.2</dd><dt><span>history :</span></dt><dd>none</dd></dl></div></li></ul></div></div></div></div>
</div>
</section>
<section id="assign-attributes-to-the-variables">
<h2>Assign attributes to the variables<a class="headerlink" href="#assign-attributes-to-the-variables" title="Permalink to this heading">#</a></h2>
<p>We will assign the attributes to the variables as in ERA5 to make CMIP6 and ERA5 variables comperable.</p>
<ul class="simple">
<li><p><a class="reference external" href="http://clipc-services.ceda.ac.uk/dreq/u/62f26742cf240c1b5169a5cd511196b6.html"><code class="docutils literal notranslate"><span class="pre">pr</span></code></a> and <a class="reference external" href="http://clipc-services.ceda.ac.uk/dreq/u/051919eddec810e292c883205c944ceb.html"><code class="docutils literal notranslate"><span class="pre">prsn</span></code></a> in <strong>kg m-2 s-1</strong> <span class="math notranslate nohighlight">\(\rightarrow\)</span> Multiply by <strong>3600</strong> to get <strong>mm h-1</strong> <span class="math notranslate nohighlight">\(\rightarrow\)</span> Multiply by <strong>24</strong> to get <strong>mm day-1</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">assign_att</span><span class="p">(</span><span class="n">dset</span><span class="p">):</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
    <span class="c1"># </span>
    <span class="k">for</span> <span class="n">var_id</span> <span class="ow">in</span> <span class="n">dset</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            
            <span class="k">if</span> <span class="n">var_id</span> <span class="o">==</span> <span class="s1">&#39;prsn&#39;</span><span class="p">:</span>
                <span class="n">dset</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span><span class="o">*</span><span class="mi">3600</span>
                <span class="n">dset</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">({</span><span class="s1">&#39;standard_name&#39;</span><span class="p">:</span> <span class="s1">&#39;snowfall_flux&#39;</span><span class="p">,</span>
                                                            <span class="s1">&#39;comment&#39;</span><span class="p">:</span> <span class="s1">&#39;At surface; includes precipitation of all forms of water in the solid phase&#39;</span><span class="p">,</span>
                                                            <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2 h-1&#39;</span><span class="p">,</span>
                                                            <span class="s1">&#39;original_units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2 s-1&#39;</span><span class="p">,</span>
                                                            <span class="s1">&#39;history&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">Z altered by F. Hellmuth: Converted units from &#39;kg m-2 s-1&#39; to &#39;kg m-2 h-1&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y %H:%M:%S&quot;</span><span class="p">)),</span>
                                                            <span class="s1">&#39;cell_methods&#39;</span><span class="p">:</span> <span class="s1">&#39;area: time: mean&#39;</span><span class="p">,</span>
                                                            <span class="s1">&#39;cell_measures&#39;</span><span class="p">:</span> <span class="s1">&#39;area: areacella&#39;</span><span class="p">})</span>
                
            <span class="k">if</span> <span class="n">var_id</span> <span class="o">==</span> <span class="s1">&#39;pr&#39;</span><span class="p">:</span>
                <span class="n">dset</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span><span class="o">*</span><span class="mi">3600</span>
                <span class="n">dset</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">({</span><span class="s1">&#39;standard_name&#39;</span><span class="p">:</span> <span class="s1">&#39;precipitation_flux&#39;</span><span class="p">,</span>
                                                          <span class="s1">&#39;comment&#39;</span><span class="p">:</span> <span class="s1">&#39;includes both liquid and solid phases&#39;</span><span class="p">,</span>
                                                          <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2 h-1&#39;</span><span class="p">,</span>
                                                          <span class="s1">&#39;original_units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2 s-1&#39;</span><span class="p">,</span>
                                                          <span class="s1">&#39;history&#39;</span><span class="p">:</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">Z altered by F. Hellmuth: Converted units from &#39;kg m-2 s-1&#39; to &#39;kg m-2 h-1&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y %H:%M:%S&quot;</span><span class="p">)),</span>
                                                          <span class="s1">&#39;cell_methods&#39;</span><span class="p">:</span> <span class="s1">&#39;area: time: mean&#39;</span><span class="p">,</span>
                                                          <span class="s1">&#39;cell_measures&#39;</span><span class="p">:</span> <span class="s1">&#39;area: areacella&#39;</span><span class="p">})</span>
                
                
    <span class="k">return</span> <span class="n">dset</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for model in list_models:</span>
<span class="c1">#     dset[model] = assign_att(dset[model])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="interpolate-from-cmip6-hybrid-sigma-pressure-levels-to-isobaric-pressure-levels">
<h2>Interpolate from CMIP6 hybrid sigma-pressure levels to isobaric pressure levels<a class="headerlink" href="#interpolate-from-cmip6-hybrid-sigma-pressure-levels-to-isobaric-pressure-levels" title="Permalink to this heading">#</a></h2>
<p>The vertical variables in the CMIP6 models are in hybrid sigma-pressure levels. Hence the vertical variable in the xarray datasets in <code class="docutils literal notranslate"><span class="pre">dset_dict</span></code> will be calculated by using the formula:
$<span class="math notranslate nohighlight">\( P(i,j,k) = hyam(k) p0 + hybm(k) ps(i,j)\)</span>$
to calculate the pressure</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">interp_hybrid_plev</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    
    <span class="c1"># You can simplify the if conditions by using the &quot;in&quot; operator to check if the required keys are present in the dictionary.</span>
    <span class="c1"># Rename datasets with different naming convention for constant hyam</span>
    <span class="k">if</span> <span class="s1">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">dset</span> <span class="ow">and</span> <span class="s1">&#39;a_bnds&#39;</span> <span class="ow">in</span> <span class="n">dset</span><span class="p">:</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="s1">&#39;ap&#39;</span><span class="p">,</span> <span class="s1">&#39;a_bnds&#39;</span><span class="p">:</span> <span class="s1">&#39;ap_bnds&#39;</span><span class="p">})</span>
    <span class="k">if</span> <span class="s1">&#39;nbnd&#39;</span> <span class="ow">in</span> <span class="n">dset</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;nbnd&#39;</span><span class="p">:</span><span class="s1">&#39;bnds&#39;</span><span class="p">})</span>
    <span class="k">if</span> <span class="s1">&#39;presnivs&#39;</span> <span class="ow">in</span> <span class="n">dset</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;presnivs&#39;</span><span class="p">:</span><span class="s1">&#39;plev&#39;</span><span class="p">})</span>
 
    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;IPSL-CM5A2-INCA&#39;</span> <span class="ow">and</span> <span class="s1">&#39;lev&#39;</span> <span class="ow">in</span> <span class="n">dset</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;lev&#39;</span><span class="p">:</span><span class="s1">&#39;plev&#39;</span><span class="p">})</span>
        
    
    
    <span class="c1"># if all the necessary variables are present in the dataset before performing any calculations. If any of the </span>
    <span class="c1"># variables are missing, the function can simply move on to the next variable. This will reduce the number of </span>
    <span class="c1"># unnecessary calculations that are performed.</span>
    <span class="k">for</span> <span class="n">var_id</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;clw&#39;</span><span class="p">,</span> <span class="s1">&#39;cli&#39;</span><span class="p">]:</span>
        
        <span class="c1"># Convert the model level to isobaric levels</span>
        <span class="c1"># Instead of checking if a key is present in the list of keys returned by dset.keys(), it would be faster </span>
        <span class="c1"># to use the in operator to check if the key is present in the dictionary. For example, instead of </span>
        <span class="c1"># if (&#39;a&#39; in list(dset.keys())) == True:, it would be faster to use if &#39;a&#39; in dset:.</span>
        <span class="k">if</span> <span class="s1">&#39;ap&#39;</span> <span class="ow">in</span> <span class="n">dset</span> <span class="ow">and</span> <span class="s1">&#39;ps&#39;</span> <span class="ow">in</span> <span class="n">dset</span> <span class="ow">and</span> <span class="s1">&#39;p0&#39;</span> <span class="ow">in</span> <span class="n">dset</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;lev&#39;</span> <span class="ow">in</span> <span class="n">dset</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span> <span class="ow">and</span> <span class="s1">&#39;lev&#39;</span> <span class="ow">in</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;ap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span> <span class="ow">and</span> <span class="s1">&#39;lev&#39;</span> <span class="ow">in</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
                <span class="c1"># Convert to pressure levels</span>
                <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;plev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;ap&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;p0&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;ps&#39;</span><span class="p">]</span>
                <span class="c1"># dset[&#39;plev&#39;] = dset[&#39;plev&#39;].transpose(&#39;time&#39;, &#39;lev&#39;,&#39;lat&#39;,&#39;lon&#39;)</span>
                
            <span class="c1"># Create plev_bnds array</span>
            <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;plev_bnds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;ap_bnds&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;p0&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;b_bnds&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;ps&#39;</span><span class="p">]</span>
            <span class="c1"># Instead of using the transpose method on the entire array, you can specify the dimensions you want to transpose</span>
            <span class="c1"># dset[&#39;plev_bnds&#39;] = dset[&#39;plev_bnds&#39;].transpose(&#39;time&#39;, &#39;lev&#39;,&#39;lat&#39;,&#39;lon&#39;, &#39;bnds&#39;)</span>
                
        <span class="k">elif</span> <span class="s1">&#39;ap&#39;</span> <span class="ow">in</span> <span class="n">dset</span> <span class="ow">and</span> <span class="s1">&#39;ps&#39;</span> <span class="ow">in</span> <span class="n">dset</span> <span class="ow">and</span> <span class="s1">&#39;p0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dset</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;lev&#39;</span> <span class="ow">in</span> <span class="n">dset</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span> <span class="ow">and</span> <span class="s1">&#39;lev&#39;</span> <span class="ow">in</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;ap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span> <span class="ow">and</span> <span class="s1">&#39;lev&#39;</span> <span class="ow">in</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
                <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;plev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;ap&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;ps&#39;</span><span class="p">]</span>
                <span class="c1"># dset[&#39;plev&#39;] = dset[&#39;plev&#39;].transpose(&#39;time&#39;, &#39;lev&#39;,&#39;lat&#39;,&#39;lon&#39;)</span>
                
            <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;plev_bnds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;ap_bnds&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;b_bnds&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;ps&#39;</span><span class="p">]</span>
            <span class="c1"># dset[&#39;plev_bnds&#39;] = dset[&#39;plev_bnds&#39;].transpose(&#39;time&#39;, &#39;lev&#39;,&#39;lat&#39;,&#39;lon&#39;, &#39;bnds&#39;)</span>
        
        
        <span class="n">dset</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;plev&#39;</span><span class="p">,</span> <span class="s1">&#39;lev&#39;</span><span class="p">,</span> <span class="s1">&#39;bnds&#39;</span><span class="p">,</span><span class="s1">&#39;axis_nbounds&#39;</span><span class="p">,</span> <span class="s1">&#39;half_lev&#39;</span><span class="p">,</span> <span class="s1">&#39;klevp1&#39;</span><span class="p">,</span> <span class="n">missing_dims</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span> <span class="p">)</span>

        <span class="c1"># Remove unnecessary variables</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">([</span><span class="s1">&#39;ap&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;ps&#39;</span><span class="p">,</span> <span class="s1">&#39;p0&#39;</span><span class="p">,</span> <span class="s1">&#39;ap_bnds&#39;</span><span class="p">,</span> <span class="s1">&#39;b_bnds&#39;</span><span class="p">,</span> <span class="s1">&#39;lev_bnds&#39;</span><span class="p">,</span> <span class="s1">&#39;orog&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        
        
                
                
    <span class="k">return</span> <span class="n">dset</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for model in list_models:</span>
<span class="c1">#     dset[model] = interp_hybrid_plev(dset[model], model)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculate-liquid-water-path-from-content">
<h2>Calculate liquid water path from content<a class="headerlink" href="#calculate-liquid-water-path-from-content" title="Permalink to this heading">#</a></h2>
<p>Once the pressure levels are calculated the daily average LWP (IWP) is calculated for each CMIP6 model.
\begin{equation}
LWP = \rho_{air} \cdot \Delta clw \cdot \Delta Z
\end{equation}</p>
<p>with hydrostatic equation</p>
<p>\begin{equation}
\frac{\Delta p}{\Delta Z}  = -\rho_{air} \cdot g<br />
\end{equation}</p>
<p>\begin{equation}
\leftrightarrow LWP = - \frac{\rho_{air}}{\rho_{air} g} \cdot \Delta clw \Delta p
\end{equation}</p>
<p>with <span class="math notranslate nohighlight">\(\Delta clw = clw(NLEV-k)\)</span> and <span class="math notranslate nohighlight">\(\Delta p = p(NLEV-k + 1/2) - p(NLEV-k - 1/2)\)</span> follows for the total liquid water path in the column:</p>
<p>\begin{equation}
-\frac{1}{g} \sum_{k=0}^{NLEV+1} LWP(k) = -\frac{1}{g} \sum_{k=0}^{NLEV+1} clw(NLEV-k) \cdot [p(NLEV-k + 1/2) - p(NLEV-k - 1/2)]
\end{equation}</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calc_water_path</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span><span class="n">model</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="mf">9.81</span><span class="p">,</span> <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()):</span>
    
    
    <span class="k">if</span> <span class="s1">&#39;plev&#39;</span> <span class="ow">in</span> <span class="n">dset</span><span class="p">:</span>
        <span class="n">dp</span> <span class="o">=</span> <span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;plev_bnds&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;bnds&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;IPSL-CM6A-LR&#39;</span> <span class="ow">or</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;IPSL-CM5A2-INCA&#39;</span><span class="p">:</span>
            <span class="n">dp</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">klevp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;klevp1&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;klevp1&#39;</span><span class="p">:</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;clw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plev</span><span class="o">.</span><span class="n">data</span><span class="p">})</span>
            <span class="n">dp</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;klevp1&#39;</span><span class="p">:</span><span class="s1">&#39;lev&#39;</span><span class="p">})</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;plev&#39;</span><span class="p">:</span><span class="s1">&#39;lev&#39;</span><span class="p">})</span>
    <span class="k">elif</span> <span class="s1">&#39;phalf&#39;</span> <span class="ow">in</span> <span class="n">dset</span><span class="p">:</span>
        <span class="n">dp</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;phalf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;half_lev&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="n">dp</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;half_lev&#39;</span><span class="p">:</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;clw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lev</span><span class="o">.</span><span class="n">data</span><span class="p">})</span>
        <span class="n">dp</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;half_lev&#39;</span><span class="p">:</span><span class="s1">&#39;lev&#39;</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dset</span>
    
    <span class="n">_lwp</span> <span class="o">=</span> <span class="o">-</span> <span class="n">dp</span> <span class="o">/</span> <span class="n">g</span> <span class="o">*</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;clw&#39;</span><span class="p">]</span>
    <span class="n">lwp_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">_lwp</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">_lwp</span><span class="o">.</span><span class="n">get_axis_num</span><span class="p">(</span><span class="s1">&#39;lev&#39;</span><span class="p">),</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">lwp_sum</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;prsn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;prsn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>
    
    <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;clw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
    <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">({</span>
            <span class="s1">&#39;long_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Daily average Liquid Water Path&#39;</span><span class="p">,</span>
            <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mipTable&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;out_name&#39;</span><span class="p">:</span> <span class="s1">&#39;lwp&#39;</span><span class="p">,</span>
            <span class="s1">&#39;standard_name&#39;</span><span class="p">:</span> <span class="s1">&#39;atmosphere_mass_content_of_cloud_liquid_water&#39;</span><span class="p">,</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Liquid Water Path&#39;</span><span class="p">,</span>
            <span class="s1">&#39;variable_id&#39;</span><span class="p">:</span> <span class="s1">&#39;lwp&#39;</span><span class="p">,</span>
            <span class="s1">&#39;original_units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg/kg&#39;</span><span class="p">,</span>
            <span class="s1">&#39;history&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">Z altered by F. Hellmuth: Interpolate data from hybrid-sigma levels to isobaric levels with P=a*p0 + b*psfc. Calculate lwp with hydrostatic equation.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y %H:%M:%S&quot;</span><span class="p">))</span>
        <span class="p">})</span>
        
    <span class="n">dset</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">([</span><span class="s1">&#39;clw&#39;</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="s1">&#39;cli&#39;</span> <span class="ow">in</span> <span class="n">dset</span><span class="p">:</span>
        <span class="n">_iwp</span> <span class="o">=</span> <span class="o">-</span> <span class="n">dp</span> <span class="o">/</span> <span class="n">g</span> <span class="o">*</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;cli&#39;</span><span class="p">]</span>
        <span class="n">iwp_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">_iwp</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">_iwp</span><span class="o">.</span><span class="n">get_axis_num</span><span class="p">(</span><span class="s1">&#39;lev&#39;</span><span class="p">),</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;clivi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">iwp_sum</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;prsn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;prsn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>
        
        <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;clivi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;clivi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="s1">&#39;cli&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
        <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;clivi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;clivi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">({</span>
                <span class="s1">&#39;long_name&#39;</span><span class="p">:</span><span class="s1">&#39;Daily average Ice Water Path&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;units&#39;</span> <span class="p">:</span> <span class="s1">&#39;kg m-2&#39;</span><span class="p">,</span>
                <span class="s1">&#39;mipTable&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;out_name&#39;</span><span class="p">:</span> <span class="s1">&#39;clivi&#39;</span><span class="p">,</span>
                <span class="s1">&#39;standard_name&#39;</span><span class="p">:</span> <span class="s1">&#39;atmosphere_mass_content_of_cloud_ice_water&#39;</span><span class="p">,</span>
                <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Ice Water Path&#39;</span><span class="p">,</span>
                <span class="s1">&#39;variable_id&#39;</span><span class="p">:</span> <span class="s1">&#39;clivi&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;original_units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg/kg&#39;</span><span class="p">,</span>
                <span class="s1">&#39;history&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">Z altered by F. Hellmuth: Interpolate data from hybrid-sigma levels to isobaric levels with P=a*p0 + b*psfc. Calculate clivi with hydrostatic equation.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y %H:%M:%S&quot;</span><span class="p">))})</span>
            
        <span class="n">dset</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">([</span><span class="s1">&#39;cli&#39;</span><span class="p">])</span>
        
    <span class="k">return</span> <span class="n">dset</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for model in list_models:</span>
<span class="c1">#     dset[model] = calc_water_path(dse[model],model, g=9.81, now = datetime.utcnow())</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="regrid-cmip6-data-to-ipsl-cm6a-lr-and-ipsl-cm5a2-inca-grid-a-id-regrid-hz-a">
<h2>Regrid CMIP6 data to IPSL-CM6A-LR and IPSL-CM5A2_INCA grid <a id='regrid_hz'></a><a class="headerlink" href="#regrid-cmip6-data-to-ipsl-cm6a-lr-and-ipsl-cm5a2-inca-grid-a-id-regrid-hz-a" title="Permalink to this heading">#</a></h2>
<p>We want to conduct statistical analysis at the annual and seasonal timescales to determine the biases in cloud phase and precipitation (liquid and solid) in the CMIP6 models. At the moment we have all historical data from the CMIP6 models. For this, we will have to extract the 4-year period between 2006 and 2009.</p>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> Define a start and end year.</p>
<p>The CMIP6 high resolution models have approximately a nominal resolution of 250km. But not all have identical grid spacing. Hence we will make use of the python package <code class="docutils literal notranslate"><span class="pre">xesmf</span></code> and the documentation on <a class="reference external" href="https://xesmf.readthedocs.io/en/latest/notebooks/Compare_algorithms.html#Decreasing-resolution">decreasing resolution</a>, <a class="reference external" href="https://xesmf.readthedocs.io/en/latest/notebooks/Masking.html?highlight=conservative#Limitations-and-warnings">Limitations and warnings</a>.</p>
<p>IPSL-CM6A-LR will be the reference grid for models with 250km resolution.</p>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> Define IPSL-CM6A-LR as the reference grid <code class="docutils literal notranslate"><span class="pre">ds_out</span></code>.</p>
<p>Create a new Python dictionary (<code class="docutils literal notranslate"><span class="pre">dset_gridded</span></code>) with the regridded CMIP6 <code class="docutils literal notranslate"><span class="pre">xarray</span></code> datasets between 2006 an 2009. Save each regridded model to a <code class="docutils literal notranslate"><span class="pre">netcdf</span></code>, locally.</p>
<blockquote>
<div><p><strong><em>NOTE:</em></strong> This step may take several minutes!</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">regrid_and_save</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span> <span class="n">ds_out</span><span class="p">,</span> <span class="n">grid_model</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">cmip_in</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>

    <span class="k">if</span> <span class="s1">&#39;lat_bnds&#39;</span> <span class="ow">in</span> <span class="n">dset</span> <span class="ow">or</span> <span class="s1">&#39;lon_bnds&#39;</span> <span class="ow">in</span> <span class="n">dset</span><span class="p">:</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">({</span><span class="s1">&#39;lat_bnds&#39;</span><span class="p">,</span> <span class="s1">&#39;lon_bnds&#39;</span><span class="p">})</span>
    
    <span class="n">regridder</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span><span class="n">ds_in</span><span class="o">=</span><span class="n">dset</span><span class="p">,</span> <span class="n">ds_out</span><span class="o">=</span><span class="n">ds_out</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;conservative&quot;</span><span class="p">)</span>
    <span class="n">dset_regrid</span> <span class="o">=</span> <span class="n">regridder</span><span class="p">(</span><span class="n">dset</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;areacella&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dset_regrid</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">dset_regrid</span><span class="p">[</span><span class="s1">&#39;areacella&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_out</span><span class="p">[</span><span class="s1">&#39;areacella&#39;</span><span class="p">]</span>

    <span class="n">var_ids</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;clivi&#39;</span><span class="p">,</span> <span class="s1">&#39;lwp&#39;</span><span class="p">,</span> <span class="s1">&#39;pr&#39;</span><span class="p">,</span> <span class="s1">&#39;prsn&#39;</span><span class="p">,</span> <span class="s1">&#39;tas&#39;</span><span class="p">,</span> <span class="s1">&#39;areacella&#39;</span><span class="p">]</span>


    <span class="k">for</span> <span class="n">var_id</span> <span class="ow">in</span> <span class="n">var_ids</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">var_id</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dset_regrid</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Writing regrid files: var_id: </span><span class="si">{</span><span class="n">var_id</span><span class="si">}</span><span class="s1">, year: </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">, model: </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">variant_label</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;variant_label&#39;</span><span class="p">]</span>
            <span class="n">NH_file_grid</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cmip_in</span><span class="si">}</span><span class="s1">/common_grid/</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">var_id</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">grid_model</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">_40_90_</span><span class="si">{</span><span class="n">experiment_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">variant_label</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">0101-</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">1231.nc&#39;</span>
            <span class="n">SH_file_grid</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cmip_in</span><span class="si">}</span><span class="s1">/common_grid/</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">var_id</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">grid_model</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">_-40_-90_</span><span class="si">{</span><span class="n">experiment_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">variant_label</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">0101-</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">1231.nc&#39;</span>
            <span class="p">(</span><span class="n">dset_regrid</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">90</span><span class="p">)))</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">NH_file_grid</span><span class="p">)</span>
            <span class="p">(</span><span class="n">dset_regrid</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">40</span><span class="p">)))</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">SH_file_grid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var_id</span><span class="si">}</span><span class="s1"> does not exist in </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Create a memory object with a cache directory</span>
<span class="c1"># cache_dir = &#39;/scratch/franzihe/cache_dir/&#39;</span>
<span class="c1"># memory = Memory(location=cache_dir)</span>

<span class="c1"># # Decorate the search_data function with the cache memory</span>
<span class="c1"># @memory.cache</span>
<span class="c1"># def search_data_cached(t_res, model, experiment_id, variable_id, year_range):</span>
<span class="c1">#     return search_data(t_res, model, experiment_id, variable_id, year_range)</span>

<span class="k">def</span> <span class="nf">process_year</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">list_models</span><span class="p">,</span><span class="n">cmip_in</span><span class="p">,</span> <span class="n">t_res</span><span class="p">,</span> <span class="n">experiment_id</span><span class="p">,</span><span class="n">variable_id</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">list_models</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;CNRM-CM6-1&#39;</span><span class="p">:</span>
                <span class="n">dset</span> <span class="o">=</span> <span class="n">search_data</span><span class="p">(</span><span class="n">cmip_in</span><span class="p">,</span> <span class="n">t_res</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">experiment_id</span><span class="p">,</span><span class="n">variable_id</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">year</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">variant_label</span><span class="o">=</span><span class="s1">&#39;r1i1p1f2&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">dset</span> <span class="o">=</span> <span class="n">search_data</span><span class="p">(</span><span class="n">cmip_in</span><span class="p">,</span> <span class="n">t_res</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">experiment_id</span><span class="p">,</span><span class="n">variable_id</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">year</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">)</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">assign_att</span><span class="p">(</span><span class="n">dset</span><span class="p">)</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">interp_hybrid_plev</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span><span class="n">model</span><span class="p">)</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">calc_water_path</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span><span class="n">model</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="mf">9.81</span><span class="p">,</span> <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">())</span>
        
       
        <span class="k">for</span> <span class="n">var_id</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;clivi&#39;</span><span class="p">,</span> <span class="s1">&#39;lwp&#39;</span><span class="p">,</span> <span class="s1">&#39;pr&#39;</span><span class="p">,</span> <span class="s1">&#39;prsn&#39;</span><span class="p">,</span> <span class="s1">&#39;tas&#39;</span><span class="p">,</span> <span class="s1">&#39;areacella&#39;</span><span class="p">]:</span>
        <span class="c1"># for var_id in [&#39;lwp&#39;,]:</span>
            <span class="k">if</span> <span class="n">var_id</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dset</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Writing files: var_id: </span><span class="si">{</span><span class="n">var_id</span><span class="si">}</span><span class="s1">, year: </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">, model: </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">variant_label</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;variant_label&#39;</span><span class="p">]</span>
                <span class="n">NH_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cmip_in</span><span class="si">}</span><span class="s1">/single_model/</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">var_id</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">_40_90_</span><span class="si">{</span><span class="n">experiment_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">variant_label</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">0101-</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">1231.nc&#39;</span>
                <span class="n">SH_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cmip_in</span><span class="si">}</span><span class="s1">/single_model/</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">var_id</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">_-40_-90_</span><span class="si">{</span><span class="n">experiment_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">variant_label</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">0101-</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">1231.nc&#39;</span>
                
                <span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="mi">90</span><span class="p">)))</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">NH_file</span><span class="p">)</span>
                <span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">)))</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">SH_file</span><span class="p">)</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var_id</span><span class="si">}</span><span class="s1"> does not exist in </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">grid_model</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;IPSL-CM6A-LR&#39;</span><span class="p">,</span> <span class="s1">&#39;IPSL-CM5A2-INCA&#39;</span><span class="p">]:</span>
                <span class="n">ds_out</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmip_in</span><span class="si">}</span><span class="s2">/single_model/</span><span class="si">{</span><span class="n">grid_model</span><span class="si">}</span><span class="s2">/areacella_*</span><span class="si">{</span><span class="n">grid_model</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">experiment_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">*.nc&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],)</span>
                <span class="c1"># Shift longitude to be from -180 to 180</span>
                <span class="n">ds_out</span> <span class="o">=</span> <span class="n">ds_out</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="p">(((</span><span class="n">ds_out</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span><span class="p">))</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">grid_model</span> <span class="o">==</span> <span class="s1">&#39;IPSL-CM6A-LR&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;CanESM5&#39;</span> <span class="ow">or</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;IPSL-CM5A2-INCA&#39;</span><span class="p">:</span>
                                <span class="k">continue</span>
                        <span class="k">else</span><span class="p">:</span>
                                <span class="n">regrid_and_save</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span> <span class="n">ds_out</span><span class="p">,</span> <span class="n">grid_model</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">cmip_in</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">grid_model</span> <span class="o">==</span> <span class="s1">&#39;IPSL-CM5A2-INCA&#39;</span><span class="p">:</span>
                        <span class="n">regrid_and_save</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span> <span class="n">ds_out</span><span class="p">,</span> <span class="n">grid_model</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">cmip_in</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>  
<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2006</span><span class="p">,</span> <span class="mi">2007</span><span class="p">,</span> <span class="mi">2008</span><span class="p">,</span> <span class="mi">2009</span><span class="p">]:</span>
    <span class="c1"># This will run the process_year function for each year in parallel, using all available cores (n_jobs=-1).</span>
    <span class="c1"># Parallel(n_jobs=-1)(delayed(process_year)(year, list_models, t_res, experiment_id,variable_id))# for year in [2006, 2007, 2008, 2009])</span>
    <span class="n">process_year</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">list_models</span><span class="p">,</span><span class="n">cmip_in</span><span class="p">,</span> <span class="n">t_res</span><span class="p">,</span> <span class="n">experiment_id</span><span class="p">,</span><span class="n">variable_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>no files found for cli in AWI-ESM-1-1-LR
no files found for pfull in AWI-ESM-1-1-LR
no files found for phalf in AWI-ESM-1-1-LR
Writing files: var_id: clivi, year: 2006, model: AWI-ESM-1-1-LR
Writing files: var_id: lwp, year: 2006, model: AWI-ESM-1-1-LR
Writing files: var_id: pr, year: 2006, model: AWI-ESM-1-1-LR
Writing files: var_id: prsn, year: 2006, model: AWI-ESM-1-1-LR
Writing files: var_id: tas, year: 2006, model: AWI-ESM-1-1-LR
Writing files: var_id: areacella, year: 2006, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: clivi, year: 2006, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: lwp, year: 2006, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: pr, year: 2006, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: prsn, year: 2006, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: tas, year: 2006, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: areacella, year: 2006, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: clivi, year: 2006, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: lwp, year: 2006, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: pr, year: 2006, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: prsn, year: 2006, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: tas, year: 2006, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: areacella, year: 2006, model: AWI-ESM-1-1-LR
no files found for cli in MPI-ESM1-2-LR
no files found for pfull in MPI-ESM1-2-LR
no files found for phalf in MPI-ESM1-2-LR
Writing files: var_id: clivi, year: 2006, model: MPI-ESM1-2-LR
Writing files: var_id: lwp, year: 2006, model: MPI-ESM1-2-LR
Writing files: var_id: pr, year: 2006, model: MPI-ESM1-2-LR
Writing files: var_id: prsn, year: 2006, model: MPI-ESM1-2-LR
Writing files: var_id: tas, year: 2006, model: MPI-ESM1-2-LR
Writing files: var_id: areacella, year: 2006, model: MPI-ESM1-2-LR
Writing regrid files: var_id: clivi, year: 2006, model: MPI-ESM1-2-LR
Writing regrid files: var_id: lwp, year: 2006, model: MPI-ESM1-2-LR
Writing regrid files: var_id: pr, year: 2006, model: MPI-ESM1-2-LR
Writing regrid files: var_id: prsn, year: 2006, model: MPI-ESM1-2-LR
Writing regrid files: var_id: tas, year: 2006, model: MPI-ESM1-2-LR
Writing regrid files: var_id: areacella, year: 2006, model: MPI-ESM1-2-LR
Writing regrid files: var_id: clivi, year: 2006, model: MPI-ESM1-2-LR
Writing regrid files: var_id: lwp, year: 2006, model: MPI-ESM1-2-LR
Writing regrid files: var_id: pr, year: 2006, model: MPI-ESM1-2-LR
Writing regrid files: var_id: prsn, year: 2006, model: MPI-ESM1-2-LR
Writing regrid files: var_id: tas, year: 2006, model: MPI-ESM1-2-LR
Writing regrid files: var_id: areacella, year: 2006, model: MPI-ESM1-2-LR
no files found for cli in AWI-ESM-1-1-LR
no files found for pfull in AWI-ESM-1-1-LR
no files found for phalf in AWI-ESM-1-1-LR
Writing files: var_id: clivi, year: 2007, model: AWI-ESM-1-1-LR
Writing files: var_id: lwp, year: 2007, model: AWI-ESM-1-1-LR
Writing files: var_id: pr, year: 2007, model: AWI-ESM-1-1-LR
Writing files: var_id: prsn, year: 2007, model: AWI-ESM-1-1-LR
Writing files: var_id: tas, year: 2007, model: AWI-ESM-1-1-LR
Writing files: var_id: areacella, year: 2007, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: clivi, year: 2007, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: lwp, year: 2007, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: pr, year: 2007, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: prsn, year: 2007, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: tas, year: 2007, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: areacella, year: 2007, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: clivi, year: 2007, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: lwp, year: 2007, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: pr, year: 2007, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: prsn, year: 2007, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: tas, year: 2007, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: areacella, year: 2007, model: AWI-ESM-1-1-LR
no files found for cli in MPI-ESM1-2-LR
no files found for pfull in MPI-ESM1-2-LR
no files found for phalf in MPI-ESM1-2-LR
Writing files: var_id: clivi, year: 2007, model: MPI-ESM1-2-LR
Writing files: var_id: lwp, year: 2007, model: MPI-ESM1-2-LR
Writing files: var_id: pr, year: 2007, model: MPI-ESM1-2-LR
Writing files: var_id: prsn, year: 2007, model: MPI-ESM1-2-LR
Writing files: var_id: tas, year: 2007, model: MPI-ESM1-2-LR
Writing files: var_id: areacella, year: 2007, model: MPI-ESM1-2-LR
Writing regrid files: var_id: clivi, year: 2007, model: MPI-ESM1-2-LR
Writing regrid files: var_id: lwp, year: 2007, model: MPI-ESM1-2-LR
Writing regrid files: var_id: pr, year: 2007, model: MPI-ESM1-2-LR
Writing regrid files: var_id: prsn, year: 2007, model: MPI-ESM1-2-LR
Writing regrid files: var_id: tas, year: 2007, model: MPI-ESM1-2-LR
Writing regrid files: var_id: areacella, year: 2007, model: MPI-ESM1-2-LR
Writing regrid files: var_id: clivi, year: 2007, model: MPI-ESM1-2-LR
Writing regrid files: var_id: lwp, year: 2007, model: MPI-ESM1-2-LR
Writing regrid files: var_id: pr, year: 2007, model: MPI-ESM1-2-LR
Writing regrid files: var_id: prsn, year: 2007, model: MPI-ESM1-2-LR
Writing regrid files: var_id: tas, year: 2007, model: MPI-ESM1-2-LR
Writing regrid files: var_id: areacella, year: 2007, model: MPI-ESM1-2-LR
no files found for cli in AWI-ESM-1-1-LR
no files found for pfull in AWI-ESM-1-1-LR
no files found for phalf in AWI-ESM-1-1-LR
Writing files: var_id: clivi, year: 2008, model: AWI-ESM-1-1-LR
Writing files: var_id: lwp, year: 2008, model: AWI-ESM-1-1-LR
Writing files: var_id: pr, year: 2008, model: AWI-ESM-1-1-LR
Writing files: var_id: prsn, year: 2008, model: AWI-ESM-1-1-LR
Writing files: var_id: tas, year: 2008, model: AWI-ESM-1-1-LR
Writing files: var_id: areacella, year: 2008, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: clivi, year: 2008, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: lwp, year: 2008, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: pr, year: 2008, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: prsn, year: 2008, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: tas, year: 2008, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: areacella, year: 2008, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: clivi, year: 2008, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: lwp, year: 2008, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: pr, year: 2008, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: prsn, year: 2008, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: tas, year: 2008, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: areacella, year: 2008, model: AWI-ESM-1-1-LR
no files found for cli in MPI-ESM1-2-LR
no files found for pfull in MPI-ESM1-2-LR
no files found for phalf in MPI-ESM1-2-LR
Writing files: var_id: clivi, year: 2008, model: MPI-ESM1-2-LR
Writing files: var_id: lwp, year: 2008, model: MPI-ESM1-2-LR
Writing files: var_id: pr, year: 2008, model: MPI-ESM1-2-LR
Writing files: var_id: prsn, year: 2008, model: MPI-ESM1-2-LR
Writing files: var_id: tas, year: 2008, model: MPI-ESM1-2-LR
Writing files: var_id: areacella, year: 2008, model: MPI-ESM1-2-LR
Writing regrid files: var_id: clivi, year: 2008, model: MPI-ESM1-2-LR
Writing regrid files: var_id: lwp, year: 2008, model: MPI-ESM1-2-LR
Writing regrid files: var_id: pr, year: 2008, model: MPI-ESM1-2-LR
Writing regrid files: var_id: prsn, year: 2008, model: MPI-ESM1-2-LR
Writing regrid files: var_id: tas, year: 2008, model: MPI-ESM1-2-LR
Writing regrid files: var_id: areacella, year: 2008, model: MPI-ESM1-2-LR
Writing regrid files: var_id: clivi, year: 2008, model: MPI-ESM1-2-LR
Writing regrid files: var_id: lwp, year: 2008, model: MPI-ESM1-2-LR
Writing regrid files: var_id: pr, year: 2008, model: MPI-ESM1-2-LR
Writing regrid files: var_id: prsn, year: 2008, model: MPI-ESM1-2-LR
Writing regrid files: var_id: tas, year: 2008, model: MPI-ESM1-2-LR
Writing regrid files: var_id: areacella, year: 2008, model: MPI-ESM1-2-LR
no files found for cli in AWI-ESM-1-1-LR
no files found for pfull in AWI-ESM-1-1-LR
no files found for phalf in AWI-ESM-1-1-LR
Writing files: var_id: clivi, year: 2009, model: AWI-ESM-1-1-LR
Writing files: var_id: lwp, year: 2009, model: AWI-ESM-1-1-LR
Writing files: var_id: pr, year: 2009, model: AWI-ESM-1-1-LR
Writing files: var_id: prsn, year: 2009, model: AWI-ESM-1-1-LR
Writing files: var_id: tas, year: 2009, model: AWI-ESM-1-1-LR
Writing files: var_id: areacella, year: 2009, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: clivi, year: 2009, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: lwp, year: 2009, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: pr, year: 2009, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: prsn, year: 2009, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: tas, year: 2009, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: areacella, year: 2009, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: clivi, year: 2009, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: lwp, year: 2009, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: pr, year: 2009, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: prsn, year: 2009, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: tas, year: 2009, model: AWI-ESM-1-1-LR
Writing regrid files: var_id: areacella, year: 2009, model: AWI-ESM-1-1-LR
no files found for cli in MPI-ESM1-2-LR
no files found for pfull in MPI-ESM1-2-LR
no files found for phalf in MPI-ESM1-2-LR
Writing files: var_id: clivi, year: 2009, model: MPI-ESM1-2-LR
Writing files: var_id: lwp, year: 2009, model: MPI-ESM1-2-LR
Writing files: var_id: pr, year: 2009, model: MPI-ESM1-2-LR
Writing files: var_id: prsn, year: 2009, model: MPI-ESM1-2-LR
Writing files: var_id: tas, year: 2009, model: MPI-ESM1-2-LR
Writing files: var_id: areacella, year: 2009, model: MPI-ESM1-2-LR
Writing regrid files: var_id: clivi, year: 2009, model: MPI-ESM1-2-LR
Writing regrid files: var_id: lwp, year: 2009, model: MPI-ESM1-2-LR
Writing regrid files: var_id: pr, year: 2009, model: MPI-ESM1-2-LR
Writing regrid files: var_id: prsn, year: 2009, model: MPI-ESM1-2-LR
Writing regrid files: var_id: tas, year: 2009, model: MPI-ESM1-2-LR
Writing regrid files: var_id: areacella, year: 2009, model: MPI-ESM1-2-LR
Writing regrid files: var_id: clivi, year: 2009, model: MPI-ESM1-2-LR
Writing regrid files: var_id: lwp, year: 2009, model: MPI-ESM1-2-LR
Writing regrid files: var_id: pr, year: 2009, model: MPI-ESM1-2-LR
Writing regrid files: var_id: prsn, year: 2009, model: MPI-ESM1-2-LR
Writing regrid files: var_id: tas, year: 2009, model: MPI-ESM1-2-LR
Writing regrid files: var_id: areacella, year: 2009, model: MPI-ESM1-2-LR
</pre></div>
</div>
</div>
</div>
<img src="https://drive.google.com/uc?id=1zb0LHvipx8JOXLLrCxzYToJM7eNK4eaw"  height="100" />
<img src="https://reliance.rohub.org/static/media/Reliance-logo.433dc2e9.png"  height="100" />
<img src="https://www.uio.no/vrtx/decorating/resources/dist/src2/images/footer/uio-logo-en.svg"  height="100" />
<img src="https://erc.europa.eu/sites/default/files/logo_0.png"  height="100" />
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./cmip"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Example with CMIP6 models (100 - 500 km)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-a-id-introduction-a">1. Introduction <a id="introduction"></a></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-wrangling-a-id-data-wrangling-a">2. Data Wrangling <a id="data_wrangling"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#organize-my-data">Organize my data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-python-packages">Import python packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#open-cmip6-variables">Open CMIP6 variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#search-corresponding-data">Search corresponding data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assign-attributes-to-the-variables">Assign attributes to the variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interpolate-from-cmip6-hybrid-sigma-pressure-levels-to-isobaric-pressure-levels">Interpolate from CMIP6 hybrid sigma-pressure levels to isobaric pressure levels</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-liquid-water-path-from-content">Calculate liquid water path from content</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regrid-cmip6-data-to-ipsl-cm6a-lr-and-ipsl-cm5a2-inca-grid-a-id-regrid-hz-a">Regrid CMIP6 data to IPSL-CM6A-LR and IPSL-CM5A2_INCA grid <a id="regrid_hz"></a></a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Franziska Hellmuth
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      Â© Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>