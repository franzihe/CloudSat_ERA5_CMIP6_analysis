
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analysis of CMIP6, ERA5, and CloudSat &#8212; globalsnow</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Example with high-resolution CMIP6 models (~100 km) using Pangeo catalog" href="../cmip/CMIP6_hr_1985-2014.html" />
    <link rel="prev" title="Example with ERA5 high-resolution (~0.25deg) monthly means" href="../ERA5/ERA5_1985-2014.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">globalsnow</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Welcome to Global Snow project website
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ERA5/ERA5_1985-2014.html">
   Example with ERA5 high-resolution (~0.25deg) monthly means
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Analysis of CMIP6, ERA5, and CloudSat
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../cmip/CMIP6_hr_1985-2014.html">
   Example with high-resolution CMIP6 models (~100 km) using Pangeo catalog
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../cloudsat.html">
   Cloudsat
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../CloudSat/get_pressure_grid.html">
     Example to get CloudSat mean pressure level profile
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/CMIP6_ERA5_CloudSat/plt_seasonal_mean.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/franzihe/CloudSat_ERA5_CMIP6_analysis"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/franzihe/CloudSat_ERA5_CMIP6_analysis/issues/new?title=Issue%20on%20page%20%2FCMIP6_ERA5_CloudSat/plt_seasonal_mean.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/franzihe/CloudSat_ERA5_CMIP6_analysis/main?urlpath=tree/work/CMIP6_ERA5_CloudSat/plt_seasonal_mean.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Analysis of CMIP6, ERA5, and CloudSat
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-the-difference-between-era5-and-cmip6-model-mean">
   Plot the difference between ERA5 and CMIP6 model mean
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-difference-between-era5-and-the-model-with-positive-negative-bias">
   Plot difference between ERA5 and the model with positive/negative bias
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#max">
     MAX
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#min">
     MIN
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#individual-model">
     Individual model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-the-seasonal-mean-zonally">
   Plot the seasonal mean zonally
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-global-mean-of-cmip6-and-era5-literature-values">
   Plot global mean of CMIP6 and ERA5, literature values
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#south-of-30-deg">
     South of 30 deg
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#north-of-30-deg">
     North of 30 deg
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#global-30n-s">
     Global, 30N/S
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-iwp-vs-snowfall-for-when-snowfall-occurs-rightarrow-snowfall-0">
   Plot IWP vs. snowfall for when snowfall occurs
   <span class="math notranslate nohighlight">
    \(\rightarrow\)
   </span>
   snowfall&gt;0
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     South of -30 deg
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     North of 30 deg
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#calculate-linear-regression-and-create-dataset-from-latitudes">
       Calculate linear regression and create dataset from latitudes
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#table-with-regression-values">
       Table with regression values
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#plot-iwp-snowfall-scatter-with-regression-lines">
       Plot IWP-snowfall scatter with regression lines
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#difference-era5-cmip6-model-mean">
     Difference ERA5 - CMIP6 model mean
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#hypothesis">
       Hypothesis
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#assumptions">
       Assumptions
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#statistical-details">
         Statistical details
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Analysis of CMIP6, ERA5, and CloudSat</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Analysis of CMIP6, ERA5, and CloudSat
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-the-difference-between-era5-and-cmip6-model-mean">
   Plot the difference between ERA5 and CMIP6 model mean
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-difference-between-era5-and-the-model-with-positive-negative-bias">
   Plot difference between ERA5 and the model with positive/negative bias
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#max">
     MAX
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#min">
     MIN
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#individual-model">
     Individual model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-the-seasonal-mean-zonally">
   Plot the seasonal mean zonally
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-global-mean-of-cmip6-and-era5-literature-values">
   Plot global mean of CMIP6 and ERA5, literature values
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#south-of-30-deg">
     South of 30 deg
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#north-of-30-deg">
     North of 30 deg
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#global-30n-s">
     Global, 30N/S
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-iwp-vs-snowfall-for-when-snowfall-occurs-rightarrow-snowfall-0">
   Plot IWP vs. snowfall for when snowfall occurs
   <span class="math notranslate nohighlight">
    \(\rightarrow\)
   </span>
   snowfall&gt;0
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     South of -30 deg
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     North of 30 deg
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#calculate-linear-regression-and-create-dataset-from-latitudes">
       Calculate linear regression and create dataset from latitudes
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#table-with-regression-values">
       Table with regression values
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#plot-iwp-snowfall-scatter-with-regression-lines">
       Plot IWP-snowfall scatter with regression lines
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#difference-era5-cmip6-model-mean">
     Difference ERA5 - CMIP6 model mean
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#hypothesis">
       Hypothesis
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#assumptions">
       Assumptions
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#statistical-details">
         Statistical details
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="analysis-of-cmip6-era5-and-cloudsat">
<h1>Analysis of CMIP6, ERA5, and CloudSat<a class="headerlink" href="#analysis-of-cmip6-era5-and-cloudsat" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># supress warnings</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span> <span class="c1"># don&#39;t output warnings</span>

<span class="c1"># import packages</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Python/globalsnow/eosc-nordic-climate-demonstrator/work/utils&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">imports</span> <span class="kn">import</span> <span class="p">(</span><span class="n">xr</span><span class="p">,</span> <span class="n">glob</span><span class="p">,</span> <span class="n">ccrs</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span>  <span class="c1">#stats, </span>
<span class="n">plt</span><span class="p">,</span> <span class="n">cm</span><span class="p">,</span> <span class="n">fct</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># reload imports</span>
<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">variable_id</span> <span class="o">=</span> <span class="p">[</span>
               <span class="p">[</span><span class="s1">&#39;prsn&#39;</span><span class="p">,</span> <span class="s1">&#39;sf&#39;</span><span class="p">],</span>
               <span class="c1"># [&#39;clivi&#39;, &#39;tciw&#39;]</span>
            <span class="c1">#    [&#39;lwp&#39;, &#39;tclw&#39;],</span>
               <span class="c1"># [&#39;tas&#39;, &#39;2t&#39;]</span>
               <span class="c1"># [&#39;pr&#39;, &#39;tp&#39;]</span>
               <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">starty</span> <span class="o">=</span> <span class="mi">1985</span><span class="p">;</span> <span class="n">endy</span> <span class="o">=</span> <span class="mi">2014</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmip_file</span> <span class="o">=</span> <span class="s1">&#39;/scratch/franzihe/output/CMIP6_hist/1deg/*_1deg_</span><span class="si">{}</span><span class="s1">01_</span><span class="si">{}</span><span class="s1">12.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">cfiles</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">cmip_file</span><span class="p">)</span>

<span class="n">era_file</span>  <span class="o">=</span> <span class="s1">&#39;/scratch/franzihe/output/ERA5/monthly_means/1deg/*_1deg_</span><span class="si">{}</span><span class="s1">01_</span><span class="si">{}</span><span class="s1">12.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">efiles</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">era_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in datasets </span>
<span class="n">cmip</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">cfiles</span><span class="p">)</span>
<span class="n">era</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">efiles</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmip_seasonal_mean</span> <span class="o">=</span> <span class="n">cmip</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">era_seasonal_mean</span>  <span class="o">=</span> <span class="n">era</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;prsn&#39;</span><span class="p">:</span>
    <span class="n">cbar_label</span> <span class="o">=</span> <span class="s1">&#39;Snowfall (mm$\,$day$^{-1}$)&#39;</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">.6</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mf">.6</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="mi">30</span>
<span class="k">if</span> <span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;pr&#39;</span><span class="p">:</span>
    <span class="n">cbar_label</span> <span class="o">=</span> <span class="s1">&#39;Total Precipitation (mm$\,$day$^{-1}$)&#39;</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">.6</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mf">.6</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="mi">30</span>
<span class="k">if</span>  <span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;clivi&#39;</span><span class="p">:</span>
    <span class="n">cbar_label</span> <span class="o">=</span> <span class="s1">&#39;Ice Water Path (g$\,$m$^{-2}$)&#39;</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">30</span>
    <span class="n">vmax</span><span class="o">=</span> <span class="mi">30</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="mi">60</span>
<span class="k">if</span>  <span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lwp&#39;</span><span class="p">:</span>
    <span class="n">cbar_label</span> <span class="o">=</span> <span class="s1">&#39;Liquid Water Path (g$\,$m$^{-2}$)&#39;</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">30</span>
    <span class="n">vmax</span><span class="o">=</span> <span class="mi">30</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="mi">60</span>
<span class="k">if</span> <span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;tas&#39;</span><span class="p">:</span>
    <span class="n">cbar_label</span> <span class="o">=</span> <span class="s1">&#39;2-m temperature (K)&#39;</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">30</span>
    <span class="n">vmax</span><span class="o">=</span> <span class="mi">30</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="mi">60</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="plot-the-difference-between-era5-and-cmip6-model-mean">
<h1>Plot the difference between ERA5 and CMIP6 model mean<a class="headerlink" href="#plot-the-difference-between-era5-and-cmip6-model-mean" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">axs</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">plt_diff_seasonal</span><span class="p">(</span><span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_mean&#39;</span><span class="p">],</span> 
                            <span class="n">cmip</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_model_mean&#39;</span><span class="p">],</span> 
                        <span class="n">cbar_label</span><span class="p">,</span> 
                        <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;ERA5 - CMIP6 model mean (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">))</span>
<span class="c1"># add model names</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mf">0.12</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">cmip</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
            <span class="n">transform</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">bbox</span> <span class="o">=</span><span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="mf">0.6</span><span class="p">,</span>
                    <span class="s1">&#39;pad&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">});</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cmip</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">cmip</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span><span class="mi">5</span><span class="p">:</span><span class="mi">10</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                <span class="n">transform</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">bbox</span> <span class="o">=</span><span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="mf">0.6</span><span class="p">,</span>
                        <span class="s1">&#39;pad&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">});</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cmip</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mf">0.38</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">cmip</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span><span class="mi">10</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                <span class="n">transform</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">bbox</span> <span class="o">=</span><span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="mf">0.6</span><span class="p">,</span>
                        <span class="s1">&#39;pad&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">});</span>

<span class="c1"># save figure to png</span>
<span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6_ERA5_CloudSat/&#39;</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_season_1deg_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/plt_seasonal_mean_10_0.png" src="../_images/plt_seasonal_mean_10_0.png" />
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="plot-difference-between-era5-and-the-model-with-positive-negative-bias">
<h1>Plot difference between ERA5 and the model with positive/negative bias<a class="headerlink" href="#plot-difference-between-era5-and-the-model-with-positive-negative-bias" title="Permalink to this headline">¶</a></h1>
<p>calculate global mean to find the MAX and MIN</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmip</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_global_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmip</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">),</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_global_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">),</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="max">
<h2>MAX<a class="headerlink" href="#max" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot max</span>
<span class="n">idx_max</span> <span class="o">=</span> <span class="n">cmip</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_global_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>

<span class="n">fct</span><span class="o">.</span><span class="n">plt_diff_seasonal</span><span class="p">(</span><span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_mean&#39;</span><span class="p">],</span>
                      <span class="n">cmip</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="n">idx_max</span><span class="p">),</span> 
                        <span class="n">cbar_label</span><span class="p">,</span> 
                        <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;ERA5 - </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx_max</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">));</span>

<span class="c1"># save figure to png</span>
<span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6_ERA5_CloudSat/&#39;</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_season_max_</span><span class="si">{}</span><span class="s1">_1deg_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">idx_max</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/plt_seasonal_mean_15_0.png" src="../_images/plt_seasonal_mean_15_0.png" />
</div>
</div>
</div>
<div class="section" id="min">
<h2>MIN<a class="headerlink" href="#min" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot min</span>
<span class="n">idx_min</span> <span class="o">=</span> <span class="n">cmip</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_global_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>

<span class="n">fct</span><span class="o">.</span><span class="n">plt_diff_seasonal</span><span class="p">(</span><span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_mean&#39;</span><span class="p">],</span> 
                      <span class="n">cmip</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="n">idx_min</span><span class="p">),</span> 
                        <span class="n">cbar_label</span><span class="p">,</span> 
                        <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;ERA5 - </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx_min</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">));</span>

<span class="c1"># save figure to png</span>
<span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6_ERA5_CloudSat/&#39;</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_season_min_</span><span class="si">{}</span><span class="s1">_1deg_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">idx_min</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/plt_seasonal_mean_17_0.png" src="../_images/plt_seasonal_mean_17_0.png" />
</div>
</div>
</div>
<div class="section" id="individual-model">
<h2>Individual model<a class="headerlink" href="#individual-model" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot individual model difference</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">cmip</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>

    <span class="n">fct</span><span class="o">.</span><span class="n">plt_diff_seasonal</span><span class="p">(</span><span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_mean&#39;</span><span class="p">],</span> 
                        <span class="n">cmip</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">),</span> 
                            <span class="n">cbar_label</span><span class="p">,</span> 
                            <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;ERA5 - </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">));</span>

    <span class="c1"># save figure to png</span>
    <span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6_ERA5_CloudSat/&#39;</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_season_</span><span class="si">{}</span><span class="s1">_1deg_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/plt_seasonal_mean_19_0.png" src="../_images/plt_seasonal_mean_19_0.png" />
<img alt="../_images/plt_seasonal_mean_19_1.png" src="../_images/plt_seasonal_mean_19_1.png" />
<img alt="../_images/plt_seasonal_mean_19_2.png" src="../_images/plt_seasonal_mean_19_2.png" />
<img alt="../_images/plt_seasonal_mean_19_3.png" src="../_images/plt_seasonal_mean_19_3.png" />
<img alt="../_images/plt_seasonal_mean_19_4.png" src="../_images/plt_seasonal_mean_19_4.png" />
<img alt="../_images/plt_seasonal_mean_19_5.png" src="../_images/plt_seasonal_mean_19_5.png" />
<img alt="../_images/plt_seasonal_mean_19_6.png" src="../_images/plt_seasonal_mean_19_6.png" />
<img alt="../_images/plt_seasonal_mean_19_7.png" src="../_images/plt_seasonal_mean_19_7.png" />
<img alt="../_images/plt_seasonal_mean_19_8.png" src="../_images/plt_seasonal_mean_19_8.png" />
<img alt="../_images/plt_seasonal_mean_19_9.png" src="../_images/plt_seasonal_mean_19_9.png" />
<img alt="../_images/plt_seasonal_mean_19_10.png" src="../_images/plt_seasonal_mean_19_10.png" />
<img alt="../_images/plt_seasonal_mean_19_11.png" src="../_images/plt_seasonal_mean_19_11.png" />
<img alt="../_images/plt_seasonal_mean_19_12.png" src="../_images/plt_seasonal_mean_19_12.png" />
<img alt="../_images/plt_seasonal_mean_19_13.png" src="../_images/plt_seasonal_mean_19_13.png" />
<img alt="../_images/plt_seasonal_mean_19_14.png" src="../_images/plt_seasonal_mean_19_14.png" />
<img alt="../_images/plt_seasonal_mean_19_15.png" src="../_images/plt_seasonal_mean_19_15.png" />
<img alt="../_images/plt_seasonal_mean_19_16.png" src="../_images/plt_seasonal_mean_19_16.png" />
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="plot-the-seasonal-mean-zonally">
<h1>Plot the seasonal mean zonally<a class="headerlink" href="#plot-the-seasonal-mean-zonally" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmip</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_zonal_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmip</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_zonal_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_zonal_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fct</span><span class="o">.</span><span class="n">plt_zonal_seasonal</span><span class="p">(</span><span class="n">cmip</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_zonal_mean&#39;</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;High resolution (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">cbar_label</span><span class="p">)</span>

<span class="c1"># save figure to png</span>
<span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6/&#39;</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_season_zonal_mean_1deg_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/plt_seasonal_mean_22_0.png" src="../_images/plt_seasonal_mean_22_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">axs</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">plt_zonal_seasonal</span><span class="p">(</span><span class="n">cmip</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_zonal_mean&#39;</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;High resolution (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">cbar_label</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">era</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
    <span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_zonal_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ERA5&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span> 
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">era</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> 
                    <span class="p">(</span><span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_zonal_mean&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_zonal_std&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> 
                    <span class="p">(</span><span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_zonal_mean&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_zonal_std&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> 
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">cmip</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_season_zonal_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;CMIP6 mean&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
        <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">title</span><span class="o">=</span><span class="n">cbar_label</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">,</span>
        <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

<span class="c1"># save figure to png</span>
<span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6_ERA5_CloudSat/&#39;</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_season_zonal_mean_1deg_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/plt_seasonal_mean_23_0.png" src="../_images/plt_seasonal_mean_23_0.png" />
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="plot-global-mean-of-cmip6-and-era5-literature-values">
<h1>Plot global mean of CMIP6 and ERA5, literature values<a class="headerlink" href="#plot-global-mean-of-cmip6-and-era5-literature-values" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span>    
    
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Global mean (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">fct</span><span class="o">.</span><span class="n">plt_bar_area_mean</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">cmip</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_global_mean&#39;</span><span class="p">],</span> 
                               <span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_global_mean&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">cbar_label</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>


<span class="c1"># save figure to png</span>
<span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6_ERA5_CloudSat/&#39;</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_global_mean_1deg_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No handles with labels found to put in legend.
</pre></div>
</div>
<img alt="../_images/plt_seasonal_mean_25_1.png" src="../_images/plt_seasonal_mean_25_1.png" />
</div>
</div>
<div class="section" id="south-of-30-deg">
<h2>South of 30 deg<a class="headerlink" href="#south-of-30-deg" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lat_SH</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">30</span><span class="p">)</span>

<span class="c1"># lat: -90, -30</span>
<span class="n">_var_id</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_mean&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">lat_SH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_SH</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">)</span>
<span class="n">cmip</span><span class="p">[</span><span class="n">_var_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmip</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_SH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">lat_SH</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">),</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">_var_id</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_mean&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">lat_SH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_SH</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">)</span>
<span class="n">era</span><span class="p">[</span><span class="n">_var_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_SH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">lat_SH</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">),</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1">#####################################</span>
<span class="c1"># bar plot only south</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span>    
    
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;SH mean: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lat_SH</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">fct</span><span class="o">.</span><span class="n">plt_bar_area_mean</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_mean&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">lat_SH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_SH</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">)],</span> 
                               <span class="n">era</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_mean&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">lat_SH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_SH</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">)],</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bar_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">cbar_label</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>


<span class="c1"># save figure to png</span>
<span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6_ERA5_CloudSat/&#39;</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_mean_1deg_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">lat_SH</span><span class="p">),</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No handles with labels found to put in legend.
</pre></div>
</div>
<img alt="../_images/plt_seasonal_mean_27_1.png" src="../_images/plt_seasonal_mean_27_1.png" />
</div>
</div>
</div>
<div class="section" id="north-of-30-deg">
<h2>North of 30 deg<a class="headerlink" href="#north-of-30-deg" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lat_NH</span> <span class="o">=</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>

<span class="c1"># lat: 30, 90</span>
<span class="n">_var_id</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_mean&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">lat_NH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_NH</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">)</span>
<span class="n">cmip</span><span class="p">[</span><span class="n">_var_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmip</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_NH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_NH</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">),</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">_var_id</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_mean&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">lat_NH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_NH</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">)</span>
<span class="n">era</span><span class="p">[</span><span class="n">_var_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_NH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_NH</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">),</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1">#####################################</span>
<span class="c1"># bar plot only North</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span>    
    
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;NH mean: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lat_NH</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">fct</span><span class="o">.</span><span class="n">plt_bar_area_mean</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_mean&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">lat_NH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_NH</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">)],</span> 
                          <span class="n">era</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_mean&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">lat_NH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_NH</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">)],</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bar_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">cbar_label</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># save figure to png</span>
<span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6_ERA5_CloudSat/&#39;</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_mean_1deg_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">lat_NH</span><span class="p">),</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No handles with labels found to put in legend.
</pre></div>
</div>
<img alt="../_images/plt_seasonal_mean_29_1.png" src="../_images/plt_seasonal_mean_29_1.png" />
</div>
</div>
</div>
<div class="section" id="global-30n-s">
<h2>Global, 30N/S<a class="headerlink" href="#global-30n-s" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span>    
    
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Mean (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">fct</span><span class="o">.</span><span class="n">plt_bar_area_mean</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">cmip</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_global_mean&#39;</span><span class="p">],</span> 
                      <span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_global_mean&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Global&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">cbar_label</span><span class="p">)</span>
<span class="n">fct</span><span class="o">.</span><span class="n">plt_bar_area_mean</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_mean&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">lat_NH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_NH</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">)],</span> 
                        <span class="n">era</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_mean&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">lat_NH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_NH</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">)],</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;NH: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lat_NH</span><span class="p">)),</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">cbar_label</span><span class="p">)</span>
<span class="n">fct</span><span class="o">.</span><span class="n">plt_bar_area_mean</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_mean&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">lat_SH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_SH</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">)],</span> 
                        <span class="n">era</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_mean&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">lat_SH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_SH</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">)],</span> <span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;//&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SH: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lat_SH</span><span class="p">)),</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">cbar_label</span><span class="p">)</span>

<span class="c1"># save figure to png</span>
<span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6_ERA5_CloudSat/&#39;</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_global_</span><span class="si">{}</span><span class="s1">NS_mean_1deg_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">lat_NH</span><span class="p">),</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/plt_seasonal_mean_31_0.png" src="../_images/plt_seasonal_mean_31_0.png" />
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="plot-iwp-vs-snowfall-for-when-snowfall-occurs-rightarrow-snowfall-0">
<h1>Plot IWP vs. snowfall for when snowfall occurs <span class="math notranslate nohighlight">\(\rightarrow\)</span> snowfall&gt;0<a class="headerlink" href="#plot-iwp-vs-snowfall-for-when-snowfall-occurs-rightarrow-snowfall-0" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>is there a relationship?</p></li>
<li><p>if not - what else is going on?</p></li>
<li><p>then invastigate cloud phase processes</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">era</span><span class="p">[</span><span class="s1">&#39;iwp_sf&gt;25&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">era</span><span class="p">[</span><span class="s1">&#39;tciw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">era</span><span class="p">[</span><span class="s1">&#39;sf&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">era</span><span class="p">[</span><span class="s1">&#39;sf_sf&gt;25&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">era</span><span class="p">[</span><span class="s1">&#39;sf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">era</span><span class="p">[</span><span class="s1">&#39;sf&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.25</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;iwp_sf&gt;25&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;clivi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;prsn&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;sf_sf&gt;25&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;prsn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;prsn&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.25</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h2>South of -30 deg<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">step</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">iteration_SH</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">lat_SH</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lat_SH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">step</span><span class="p">)</span>
<span class="k">for</span> <span class="n">_lat</span> <span class="ow">in</span> <span class="n">iteration_SH</span><span class="p">:</span>
    <span class="n">era</span><span class="p">[</span><span class="s1">&#39;iwp_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">-</span><span class="n">step</span><span class="p">)]</span> <span class="o">=</span> <span class="n">era</span><span class="p">[</span><span class="s1">&#39;iwp_sf&gt;25&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">_lat</span><span class="o">-</span><span class="n">step</span><span class="p">,</span> <span class="n">_lat</span><span class="p">),)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">era</span><span class="p">[</span><span class="s1">&#39;sf_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">-</span><span class="n">step</span><span class="p">)]</span> <span class="o">=</span> <span class="n">era</span><span class="p">[</span><span class="s1">&#39;sf_sf&gt;25&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">_lat</span><span class="o">-</span><span class="n">step</span><span class="p">,</span> <span class="n">_lat</span><span class="p">),)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    
    <span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;iwp_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">-</span><span class="n">step</span><span class="p">)]</span> <span class="o">=</span> <span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;iwp_sf&gt;25&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">_lat</span><span class="o">-</span><span class="n">step</span><span class="p">,</span> <span class="n">_lat</span><span class="p">),)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;sf_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">-</span><span class="n">step</span><span class="p">)]</span> <span class="o">=</span> <span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;sf_sf&gt;25&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">_lat</span><span class="o">-</span><span class="n">step</span><span class="p">,</span> <span class="n">_lat</span><span class="p">),)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id2">
<h2>North of 30 deg<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iteration_NH</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">lat_NH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_NH</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
<span class="k">for</span> <span class="n">_lat</span> <span class="ow">in</span> <span class="n">iteration_NH</span><span class="p">:</span>
    <span class="n">era</span><span class="p">[</span><span class="s1">&#39;iwp_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span> <span class="o">=</span> <span class="n">era</span><span class="p">[</span><span class="s1">&#39;iwp_sf&gt;25&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">),)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">era</span><span class="p">[</span><span class="s1">&#39;sf_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span> <span class="o">=</span> <span class="n">era</span><span class="p">[</span><span class="s1">&#39;sf_sf&gt;25&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">),)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    
    <span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;iwp_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span> <span class="o">=</span> <span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;iwp_sf&gt;25&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">),)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;sf_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span> <span class="o">=</span> <span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;sf_sf&gt;25&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">),)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
</div>
<div class="section" id="calculate-linear-regression-and-create-dataset-from-latitudes">
<h3>Calculate linear regression and create dataset from latitudes<a class="headerlink" href="#calculate-linear-regression-and-create-dataset-from-latitudes" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">era_SH</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">return_ds_regression</span><span class="p">(</span><span class="n">era</span><span class="p">,</span> <span class="n">iteration_SH</span><span class="p">,</span> <span class="o">-</span><span class="n">step</span><span class="p">)</span>
<span class="n">era_NH</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">return_ds_regression</span><span class="p">(</span><span class="n">era</span><span class="p">,</span> <span class="n">iteration_NH</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
<span class="n">era_linreg</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">era_SH</span><span class="p">,</span> <span class="n">era_NH</span><span class="p">])</span>

<span class="k">del</span> <span class="n">era_SH</span><span class="p">,</span> <span class="n">era_NH</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmip_mm_SH</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">return_ds_regression</span><span class="p">(</span><span class="n">cmip</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span> <span class="n">iteration_SH</span><span class="p">,</span> <span class="o">-</span><span class="n">step</span><span class="p">)</span>
<span class="n">cmip_mm_NH</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">return_ds_regression</span><span class="p">(</span><span class="n">cmip</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span> <span class="n">iteration_NH</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
<span class="n">cmip_mm_linreg</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">cmip_mm_SH</span><span class="p">,</span> <span class="n">cmip_mm_NH</span><span class="p">])</span>

<span class="k">del</span> <span class="n">cmip_mm_SH</span><span class="p">,</span> <span class="n">cmip_mm_NH</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmip_SH</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">cmip_NH</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">cmip</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">cmip_SH</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">return_ds_regression</span><span class="p">(</span><span class="n">cmip</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">),</span> <span class="n">iteration_SH</span><span class="p">,</span> <span class="o">-</span><span class="n">step</span><span class="p">)</span>
    <span class="n">cmip_NH</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">return_ds_regression</span><span class="p">(</span><span class="n">cmip</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">),</span> <span class="n">iteration_NH</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>


<span class="n">cmip_linreg</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">objs</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">cmip_SH</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> 
                                  <span class="n">dim</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">cmip_SH</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> 
                                  <span class="n">coords</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;concat_dim&#39;</span><span class="p">:</span><span class="s1">&#39;model&#39;</span><span class="p">}),</span> 
                        <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">objs</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">cmip_NH</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> 
                                  <span class="n">dim</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">cmip_NH</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> 
                                  <span class="n">coords</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;concat_dim&#39;</span><span class="p">:</span><span class="s1">&#39;model&#39;</span><span class="p">})])</span>

<span class="k">del</span> <span class="n">cmip_SH</span><span class="p">,</span> <span class="n">cmip_NH</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="table-with-regression-values">
<h3>Table with regression values<a class="headerlink" href="#table-with-regression-values" title="Permalink to this headline">¶</a></h3>
<p>This step is not necessary as I could just use the <code class="docutils literal notranslate"><span class="pre">xarray.to_pandas()</span></code> function. But I want to have the table in the form as I want to use it in the paper, then I can use <code class="docutils literal notranslate"><span class="pre">pandas.to_latex()</span></code>. It can take any table output and make it LaTeX style for easy copy paste.</p>
<p>like so: <code class="docutils literal notranslate"><span class="pre">era_linreg_pd.round(3).to_latex()</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">era_linreg_pd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="n">era_linreg</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">da_sh</span><span class="p">,</span> <span class="n">idx_sh</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">return_pd_dataFrame_corr_coeff</span><span class="p">(</span><span class="n">era_linreg</span><span class="p">,</span> <span class="n">season</span><span class="p">,</span> <span class="n">iteration_SH</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="o">-</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">da_nh</span><span class="p">,</span> <span class="n">idx_nh</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">return_pd_dataFrame_corr_coeff</span><span class="p">(</span><span class="n">era_linreg</span><span class="p">,</span> <span class="n">season</span><span class="p">,</span> <span class="n">iteration_NH</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>

    <span class="n">da</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">da_sh</span><span class="p">,</span> <span class="n">da_nh</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">era_linreg_pd</span> <span class="o">=</span> <span class="n">era_linreg_pd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">era_linreg_pd</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">idx_sh</span><span class="p">,</span> <span class="n">idx_nh</span><span class="p">])]</span>
    
<span class="n">era_linreg_pd</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="s1">&#39;season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># era_linreg_pd.drop(labels=&#39;season&#39;).astype(float).round(3).to_latex()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>[-30,-45]</th>
      <th>[-45,-60]</th>
      <th>[-60,-75]</th>
      <th>[-75,-90]</th>
      <th>[30,45]</th>
      <th>[45,60]</th>
      <th>[60,75]</th>
      <th>[75,90]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>R**2</th>
      <td>-0.208</td>
      <td>-0.039</td>
      <td>0.723</td>
      <td>0.787</td>
      <td>0.285</td>
      <td>0.563</td>
      <td>0.839</td>
      <td>0.958</td>
    </tr>
    <tr>
      <th>a</th>
      <td>-0.004</td>
      <td>-0.004</td>
      <td>0.059</td>
      <td>0.051</td>
      <td>0.012</td>
      <td>0.044</td>
      <td>0.070</td>
      <td>0.073</td>
    </tr>
    <tr>
      <th>b</th>
      <td>0.626</td>
      <td>0.840</td>
      <td>-0.454</td>
      <td>-0.393</td>
      <td>0.403</td>
      <td>-0.367</td>
      <td>-1.004</td>
      <td>-0.977</td>
    </tr>
    <tr>
      <th>R**2</th>
      <td>0.103</td>
      <td>0.716</td>
      <td>0.936</td>
      <td>0.880</td>
      <td>-0.007</td>
      <td>0.194</td>
      <td>0.143</td>
      <td>0.499</td>
    </tr>
    <tr>
      <th>a</th>
      <td>0.007</td>
      <td>0.095</td>
      <td>0.070</td>
      <td>0.050</td>
      <td>-0.000</td>
      <td>0.005</td>
      <td>0.006</td>
      <td>0.041</td>
    </tr>
    <tr>
      <th>b</th>
      <td>0.331</td>
      <td>-2.561</td>
      <td>-1.070</td>
      <td>-0.617</td>
      <td>0.711</td>
      <td>0.361</td>
      <td>0.435</td>
      <td>-0.084</td>
    </tr>
    <tr>
      <th>R**2</th>
      <td>-0.198</td>
      <td>0.400</td>
      <td>0.903</td>
      <td>0.869</td>
      <td>0.193</td>
      <td>0.364</td>
      <td>0.722</td>
      <td>0.897</td>
    </tr>
    <tr>
      <th>a</th>
      <td>-0.008</td>
      <td>0.050</td>
      <td>0.074</td>
      <td>0.051</td>
      <td>0.009</td>
      <td>0.027</td>
      <td>0.053</td>
      <td>0.071</td>
    </tr>
    <tr>
      <th>b</th>
      <td>0.874</td>
      <td>-1.047</td>
      <td>-1.017</td>
      <td>-0.566</td>
      <td>0.450</td>
      <td>0.011</td>
      <td>-0.496</td>
      <td>-0.852</td>
    </tr>
    <tr>
      <th>R**2</th>
      <td>-0.203</td>
      <td>0.620</td>
      <td>0.912</td>
      <td>0.857</td>
      <td>0.017</td>
      <td>0.366</td>
      <td>0.587</td>
      <td>0.827</td>
    </tr>
    <tr>
      <th>a</th>
      <td>-0.009</td>
      <td>0.102</td>
      <td>0.071</td>
      <td>0.046</td>
      <td>0.001</td>
      <td>0.023</td>
      <td>0.043</td>
      <td>0.059</td>
    </tr>
    <tr>
      <th>b</th>
      <td>0.833</td>
      <td>-2.792</td>
      <td>-1.027</td>
      <td>-0.474</td>
      <td>0.629</td>
      <td>0.153</td>
      <td>-0.249</td>
      <td>-0.620</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmip_mm_linreg_pd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="n">cmip_mm_linreg</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">da_sh</span><span class="p">,</span> <span class="n">idx_sh</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">return_pd_dataFrame_corr_coeff</span><span class="p">(</span><span class="n">cmip_mm_linreg</span><span class="p">,</span> <span class="n">season</span><span class="p">,</span> <span class="n">iteration_SH</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="o">-</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">da_nh</span><span class="p">,</span> <span class="n">idx_nh</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">return_pd_dataFrame_corr_coeff</span><span class="p">(</span><span class="n">cmip_mm_linreg</span><span class="p">,</span> <span class="n">season</span><span class="p">,</span> <span class="n">iteration_NH</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>

    <span class="n">da</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">da_sh</span><span class="p">,</span> <span class="n">da_nh</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">cmip_mm_linreg_pd</span> <span class="o">=</span> <span class="n">cmip_mm_linreg_pd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">cmip_mm_linreg_pd</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">idx_sh</span><span class="p">,</span> <span class="n">idx_nh</span><span class="p">])]</span>
    
<span class="n">cmip_mm_linreg_pd</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="s1">&#39;season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># cmip_mm_linreg_pd.drop(labels=&#39;season&#39;).astype(float).round(3).to_latex()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>[-30,-45]</th>
      <th>[-45,-60]</th>
      <th>[-60,-75]</th>
      <th>[-75,-90]</th>
      <th>[30,45]</th>
      <th>[45,60]</th>
      <th>[60,75]</th>
      <th>[75,90]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>R**2</th>
      <td>-0.258</td>
      <td>-0.468</td>
      <td>0.617</td>
      <td>0.694</td>
      <td>-0.060</td>
      <td>0.190</td>
      <td>0.668</td>
      <td>0.905</td>
    </tr>
    <tr>
      <th>a</th>
      <td>-0.001</td>
      <td>-0.004</td>
      <td>0.032</td>
      <td>0.034</td>
      <td>-0.001</td>
      <td>0.005</td>
      <td>0.028</td>
      <td>0.048</td>
    </tr>
    <tr>
      <th>b</th>
      <td>0.435</td>
      <td>0.716</td>
      <td>0.132</td>
      <td>-0.054</td>
      <td>0.742</td>
      <td>0.896</td>
      <td>0.214</td>
      <td>-0.219</td>
    </tr>
    <tr>
      <th>R**2</th>
      <td>-0.096</td>
      <td>-0.306</td>
      <td>0.919</td>
      <td>0.866</td>
      <td>0.071</td>
      <td>0.079</td>
      <td>0.035</td>
      <td>0.307</td>
    </tr>
    <tr>
      <th>a</th>
      <td>-0.001</td>
      <td>-0.013</td>
      <td>0.057</td>
      <td>0.044</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.009</td>
    </tr>
    <tr>
      <th>b</th>
      <td>0.473</td>
      <td>1.693</td>
      <td>-0.321</td>
      <td>-0.207</td>
      <td>0.535</td>
      <td>0.481</td>
      <td>0.545</td>
      <td>0.487</td>
    </tr>
    <tr>
      <th>R**2</th>
      <td>-0.232</td>
      <td>-0.372</td>
      <td>0.769</td>
      <td>0.888</td>
      <td>-0.066</td>
      <td>-0.065</td>
      <td>0.551</td>
      <td>0.789</td>
    </tr>
    <tr>
      <th>a</th>
      <td>-0.001</td>
      <td>-0.007</td>
      <td>0.042</td>
      <td>0.047</td>
      <td>-0.001</td>
      <td>-0.002</td>
      <td>0.022</td>
      <td>0.040</td>
    </tr>
    <tr>
      <th>b</th>
      <td>0.458</td>
      <td>1.045</td>
      <td>0.027</td>
      <td>-0.240</td>
      <td>0.739</td>
      <td>0.963</td>
      <td>0.312</td>
      <td>-0.059</td>
    </tr>
    <tr>
      <th>R**2</th>
      <td>-0.047</td>
      <td>-0.448</td>
      <td>0.894</td>
      <td>0.838</td>
      <td>-0.237</td>
      <td>-0.170</td>
      <td>0.291</td>
      <td>0.671</td>
    </tr>
    <tr>
      <th>a</th>
      <td>-0.000</td>
      <td>-0.015</td>
      <td>0.054</td>
      <td>0.041</td>
      <td>-0.002</td>
      <td>-0.003</td>
      <td>0.010</td>
      <td>0.025</td>
    </tr>
    <tr>
      <th>b</th>
      <td>0.415</td>
      <td>1.631</td>
      <td>-0.243</td>
      <td>-0.173</td>
      <td>0.675</td>
      <td>1.037</td>
      <td>0.717</td>
      <td>0.295</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">cmip_linreg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>    
    <span class="n">cmip_linreg_pd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="n">cmip_linreg</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
        <span class="n">da_sh</span><span class="p">,</span> <span class="n">idx_sh</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">return_pd_dataFrame_corr_coeff</span><span class="p">(</span><span class="n">cmip_linreg</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">),</span> <span class="n">season</span><span class="p">,</span> <span class="n">iteration_SH</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="o">-</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">da_nh</span><span class="p">,</span> <span class="n">idx_nh</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">return_pd_dataFrame_corr_coeff</span><span class="p">(</span><span class="n">cmip_linreg</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">),</span> <span class="n">season</span><span class="p">,</span> <span class="n">iteration_NH</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>

        <span class="n">da</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">da_sh</span><span class="p">,</span> <span class="n">da_nh</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">cmip_linreg_pd</span> <span class="o">=</span> <span class="n">cmip_linreg_pd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">cmip_linreg_pd</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">idx_sh</span><span class="p">,</span> <span class="n">idx_nh</span><span class="p">])]</span>
        
    <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">cmip_linreg_pd</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="s1">&#39;season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

    <span class="c1"># print(model, cmip_linreg_pd.drop(labels=&#39;season&#39;).astype(float).round(3).to_latex())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BCC-CSM2-MR      [-30,-45] [-45,-60] [-60,-75] [-75,-90] [30,45] [45,60] [60,75] [75,90]
R**2       NaN    -0.196     0.654     0.945   0.394   0.546   0.757   0.699
a          NaN    -0.008     0.029     0.028   0.013   0.023   0.040   0.033
b          NaN     0.814    -0.229    -0.215   0.277  -0.025  -0.658  -0.537
R**2    -0.039     0.515     0.880     0.950  -0.001   0.406   0.423   0.846
a       -0.001     0.040     0.045     0.029  -0.000   0.010   0.018   0.048
b        0.454    -1.225    -0.599    -0.252   0.600   0.140  -0.011  -0.630
R**2    -0.053     0.343     0.834     0.931   0.286   0.333   0.723   0.732
a       -0.003     0.014     0.043     0.028   0.014   0.013   0.035   0.029
b        0.610    -0.173    -0.641    -0.204   0.263   0.287  -0.410  -0.366
R**2     0.306     0.159     0.826     0.957   0.281   0.446   0.629   0.888
a        0.005     0.011     0.041     0.030   0.011   0.017   0.035   0.049
b        0.330     0.115    -0.451    -0.280   0.306   0.102  -0.475  -0.963
CAMS-CSM1-0      [-30,-45] [-45,-60] [-60,-75] [-75,-90] [30,45] [45,60] [60,75] [75,90]
R**2       NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
a          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
b          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
R**2       NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
a          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
b          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
R**2       NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
a          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
b          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
R**2       NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
a          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
b          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
CIESM      [-30,-45] [-45,-60] [-60,-75] [-75,-90] [30,45] [45,60] [60,75] [75,90]
R**2       NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
a          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
b          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
R**2       NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
a          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
b          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
R**2       NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
a          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
b          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
R**2       NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
a          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
b          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
CMCC-CM2-HR4      [-30,-45] [-45,-60] [-60,-75] [-75,-90] [30,45] [45,60] [60,75] [75,90]
R**2       NaN     0.047     0.230     0.446   0.384   0.311   0.655   0.925
a          NaN     0.004     0.024     0.024   0.021   0.021   0.059   0.067
b          NaN     0.477     0.353    -0.208   0.208   0.271  -0.955  -1.208
R**2    -0.105     0.430     0.834     0.769  -0.295   0.141   0.348   0.685
a       -0.003     0.052     0.091     0.043  -0.022   0.006   0.023   0.044
b        0.636    -1.007    -1.909    -0.894   1.130   0.349   0.079  -0.096
R**2     0.168     0.119     0.792     0.801   0.259   0.354   0.543   0.779
a        0.004     0.010     0.083     0.044   0.023   0.019   0.037   0.052
b        0.377     0.304    -1.541    -0.878   0.203   0.170  -0.216  -0.677
R**2    -0.279    -0.020     0.692     0.766   0.275   0.451   0.373   0.616
a       -0.008    -0.002     0.072     0.039   0.018   0.025   0.032   0.037
b        0.851     0.836    -1.215    -0.759   0.283   0.040  -0.021  -0.175
CMCC-CM2-SR5      [-30,-45] [-45,-60] [-60,-75] [-75,-90] [30,45] [45,60] [60,75] [75,90]
R**2    -0.798    -0.305    -0.592    -0.273   0.112   0.114   0.197   0.736
a       -0.079    -0.049    -0.037    -0.004   0.003   0.004   0.012   0.030
b        1.240     1.317     1.690     0.495   0.736   1.044   0.941   0.495
R**2    -0.023    -0.074     0.487     0.719  -0.121  -0.059  -0.019   0.262
a       -0.001    -0.006     0.063     0.153  -0.004  -0.001  -0.001   0.046
b        0.680     1.413     0.884    -0.787   0.950   0.558   0.591   0.394
R**2    -0.049    -0.322     0.481     0.632   0.447  -0.097   0.095   0.689
a       -0.003    -0.024     0.063     0.141   0.012  -0.004   0.006   0.059
b        0.621     1.544     0.874    -0.537   0.531   1.012   0.869   0.352
R**2    -0.317    -0.313     0.407     0.560   0.237  -0.058  -0.195   0.016
a       -0.009    -0.024     0.063     0.105   0.008  -0.002  -0.012   0.000
b        0.685     1.672     0.856    -0.345   0.558   0.937   1.277   1.086
CMCC-ESM2      [-30,-45] [-45,-60] [-60,-75] [-75,-90] [30,45] [45,60] [60,75] [75,90]
R**2       NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
a          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
b          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
R**2       NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
a          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
b          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
R**2       NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
a          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
b          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
R**2       NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
a          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
b          NaN       NaN       NaN       NaN     NaN     NaN     NaN     NaN
E3SM-1-1      [-30,-45] [-45,-60] [-60,-75] [-75,-90] [30,45] [45,60] [60,75] [75,90]
R**2       NaN    -0.426     0.033     0.693   0.301   0.373   0.658   0.952
a          NaN    -0.021     0.003     0.090   0.011   0.021   0.030   0.049
b          NaN     0.846     0.810    -0.086   0.655   0.922   0.691   0.339
R**2    -0.193    -0.366     0.572     0.653  -0.294  -0.067  -0.146   0.242
a       -0.004    -0.032     0.068     0.207  -0.011  -0.002  -0.006   0.027
b        0.579     1.973     0.968    -0.309   0.776   0.511   0.613   0.503
R**2     0.024    -0.309     0.433     0.816   0.089  -0.042   0.471   0.886
a        0.001    -0.019     0.034     0.238   0.004  -0.002   0.020   0.045
b        0.468     1.255     1.067    -0.397   0.760   1.051   0.675   0.314
R**2    -0.047    -0.431     0.548     0.672   0.116   0.116   0.040   0.790
a       -0.001    -0.023     0.074     0.237   0.003   0.005   0.002   0.023
b        0.442     1.432     0.823    -0.387   0.586   0.902   1.042   0.658
E3SM-1-1-ECA      [-30,-45] [-45,-60] [-60,-75] [-75,-90] [30,45] [45,60] [60,75] [75,90]
R**2       NaN    -0.510    -0.029     0.752   0.301   0.413   0.686   0.949
a          NaN    -0.026    -0.003     0.090   0.011   0.022   0.035   0.056
b          NaN     0.927     0.880    -0.066   0.674   0.861   0.637   0.311
R**2    -0.287    -0.303     0.567     0.641  -0.258   0.002  -0.107   0.383
a       -0.005    -0.025     0.069     0.204  -0.010   0.000  -0.005   0.045
b        0.566     1.764     0.958    -0.289   0.718   0.516   0.628   0.447
R**2     0.459    -0.319     0.464     0.805   0.091   0.101   0.601   0.901
a        0.005    -0.021     0.037     0.252   0.004   0.005   0.027   0.054
b        0.321     1.304     1.029    -0.460   0.765   0.913   0.608   0.281
R**2     0.136    -0.455     0.546     0.725   0.126   0.139   0.135   0.813
a        0.002    -0.028     0.075     0.266   0.003   0.006   0.005   0.028
b        0.412     1.568     0.823    -0.498   0.565   0.873   0.990   0.597
EC-Earth3-AerChem      [-30,-45] [-45,-60] [-60,-75] [-75,-90] [30,45] [45,60] [60,75] [75,90]
R**2    -0.315    -0.163     0.484     0.918   0.217   0.527   0.876   0.946
a       -0.004    -0.003     0.022     0.049   0.005   0.024   0.047   0.055
b        0.377     0.614    -0.007    -0.609   0.562  -0.071  -0.883  -1.024
R**2     0.165     0.186     0.928     0.934  -0.145   0.133   0.194   0.657
a        0.006     0.010     0.048     0.036  -0.004   0.003   0.005   0.036
b        0.459     0.258    -0.872    -0.506   0.819   0.434   0.409  -0.207
R**2    -0.016     0.050     0.768     0.939   0.119   0.331   0.805   0.856
a       -0.000     0.001     0.042     0.045   0.003   0.015   0.038   0.053
b        0.576     0.450    -0.767    -0.658   0.596   0.238  -0.436  -0.827
R**2    -0.252    -0.035     0.856     0.933   0.035   0.383   0.610   0.847
a       -0.004    -0.002     0.046     0.040   0.001   0.013   0.027   0.042
b        0.796     0.787    -0.717    -0.566   0.618   0.253  -0.131  -0.583
FGOALS-f3-L      [-30,-45] [-45,-60] [-60,-75] [-75,-90] [30,45] [45,60] [60,75] [75,90]
R**2    -0.042    -0.147     0.494     0.610  -0.053   0.168   0.597   0.582
a       -0.000    -0.001     0.009     0.010  -0.000   0.001   0.008   0.008
b        0.361     0.488     0.118     0.064   0.705   0.700   0.150   0.026
R**2    -0.174    -0.328     0.861     0.518  -0.042   0.185   0.150   0.468
a       -0.002    -0.004     0.016     0.009  -0.000   0.001   0.002   0.010
b        0.907     1.220    -0.224     0.001   0.713   0.373   0.395   0.067
R**2    -0.231    -0.343     0.605     0.726   0.122   0.012   0.514   0.550
a       -0.002    -0.003     0.011     0.019   0.001   0.000   0.007   0.008
b        0.850     0.826     0.050    -0.379   0.518   0.704   0.189   0.086
R**2    -0.287    -0.439     0.873     0.571   0.080   0.013   0.412   0.714
a       -0.002    -0.005     0.016     0.010   0.001   0.000   0.006   0.016
b        0.795     1.114    -0.227     0.016   0.561   0.687   0.284  -0.210
GFDL-CM4      [-30,-45] [-45,-60] [-60,-75] [-75,-90] [30,45] [45,60] [60,75] [75,90]
R**2    -0.017    -0.078     0.498     0.911   0.270   0.492   0.863   0.919
a       -0.000    -0.001     0.008     0.025   0.003   0.008   0.024   0.035
b        0.331     0.557     0.438     0.060   0.519   0.567  -0.007  -0.237
R**2     0.189     0.210     0.941     0.897   0.165   0.240   0.036  -0.041
a        0.001     0.007     0.025     0.024   0.002   0.001   0.000  -0.001
b        0.336     0.615     0.068     0.038   0.616   0.328   0.468   0.648
R**2    -0.038     0.146     0.807     0.912   0.133   0.418   0.763   0.908
a       -0.000     0.003     0.020     0.025   0.002   0.006   0.016   0.026
b        0.416     0.485     0.200     0.040   0.565   0.418   0.152  -0.021
R**2     0.087     0.187     0.913     0.899  -0.078   0.180   0.652   0.878
a        0.000     0.008     0.022     0.023  -0.001   0.002   0.010   0.018
b        0.377     0.327     0.149     0.058   0.654   0.706   0.402   0.182
GFDL-ESM4      [-30,-45] [-45,-60] [-60,-75] [-75,-90] [30,45] [45,60] [60,75] [75,90]
R**2    -0.025    -0.014     0.442     0.902   0.210   0.389   0.840   0.925
a       -0.000    -0.000     0.007     0.021   0.002   0.006   0.022   0.040
b        0.369     0.452     0.456     0.097   0.585   0.700   0.063  -0.366
R**2     0.308     0.275     0.932     0.893   0.330   0.168  -0.002  -0.061
a        0.002     0.007     0.023     0.023   0.005   0.000  -0.000  -0.001
b        0.265     0.421     0.078     0.037   0.432   0.354   0.460   0.627
R**2     0.046     0.273     0.765     0.913   0.112   0.121   0.730   0.890
a        0.000     0.005     0.017     0.024   0.002   0.002   0.015   0.027
b        0.386     0.167     0.241     0.043   0.595   0.789   0.261  -0.075
R**2     0.281     0.153     0.860     0.905  -0.068   0.090   0.587   0.890
a        0.002     0.005     0.019     0.021  -0.001   0.001   0.009   0.018
b        0.287     0.412     0.196     0.076   0.688   0.820   0.443   0.153
MPI-ESM1-2-HR      [-30,-45] [-45,-60] [-60,-75] [-75,-90] [30,45] [45,60] [60,75] [75,90]
R**2    -0.460    -0.143     0.451     0.915   0.241   0.275   0.714   0.975
a       -0.001    -0.002     0.012     0.023   0.006   0.009   0.025   0.038
b        0.445     0.590     0.283     0.022   0.426   0.545  -0.033  -0.327
R**2     0.402    -0.023     0.881     0.905  -0.086   0.338   0.107   0.485
a        0.011    -0.001     0.034     0.026  -0.002   0.004   0.002   0.015
b        0.058     0.891    -0.261    -0.044   0.836   0.211   0.422   0.049
R**2     0.108     0.012     0.652     0.920   0.373   0.149   0.647   0.920
a        0.002     0.000     0.023     0.028   0.014   0.005   0.020   0.034
b        0.575     0.541     0.061    -0.067  -0.166   0.664   0.086  -0.274
R**2     0.261    -0.187     0.888     0.906   0.247   0.367   0.498   0.827
a        0.004    -0.010     0.032     0.024   0.005   0.011   0.014   0.025
b        0.359     1.449    -0.166    -0.014   0.354   0.202   0.269  -0.047
MRI-ESM2-0      [-30,-45] [-45,-60] [-60,-75] [-75,-90] [30,45] [45,60] [60,75] [75,90]
R**2    -0.423    -0.345     0.550     0.869   0.436   0.202   0.693   0.950
a       -0.002    -0.040     0.069     0.107   0.032   0.014   0.068   0.128
b        0.340     1.412    -0.020    -0.505   0.183   0.737  -0.066  -0.846
R**2     0.167     0.025     0.899     0.949  -0.376   0.059   0.183   0.601
a        0.012     0.004     0.117     0.085  -0.014   0.002   0.014   0.093
b        0.254     0.877    -0.737    -0.474   0.903   0.479   0.425  -0.068
R**2     0.066    -0.050     0.714     0.946   0.410  -0.019   0.602   0.928
a        0.002    -0.007     0.091     0.100   0.041  -0.001   0.052   0.117
b        0.628     0.879    -0.321    -0.597  -0.108   0.859   0.143  -0.606
R**2    -0.050    -0.385     0.876     0.951   0.318   0.146   0.331   0.801
a       -0.002    -0.062     0.121     0.090   0.021   0.009   0.028   0.074
b        0.551     2.419    -0.766    -0.513   0.313   0.705   0.548  -0.042
NorESM2-MM      [-30,-45] [-45,-60] [-60,-75] [-75,-90] [30,45] [45,60] [60,75] [75,90]
R**2    -1.000    -0.367     0.377     0.462   0.119   0.142   0.567   0.880
a       -0.002    -0.039     0.060     0.110   0.005   0.010   0.049   0.150
b        0.296     1.153     0.489    -0.206   0.620   0.942   0.321  -0.757
R**2    -0.062    -0.234     0.758     0.491   0.183   0.094  -0.101   0.414
a       -0.002    -0.027     0.117     0.088   0.009   0.002  -0.005   0.056
b        0.614     1.777    -0.254    -0.477   0.608   0.507   0.667   0.362
R**2     0.370    -0.348     0.639     0.407   0.582   0.003   0.383   0.810
a        0.015    -0.035     0.089     0.089   0.025   0.000   0.027   0.161
b        0.401     1.625     0.353    -0.299   0.109   0.883   0.554  -0.600
R**2     0.035    -0.304     0.717     0.347   0.207   0.108   0.255   0.867
a        0.001    -0.028     0.122     0.058   0.009   0.006   0.018   0.164
b        0.501     1.538    -0.254    -0.151   0.458   0.799   0.807  -0.561
SAM0-UNICON      [-30,-45] [-45,-60] [-60,-75] [-75,-90] [30,45] [45,60] [60,75] [75,90]
R**2    -0.190    -0.246     0.424     0.243  -0.047   0.013   0.299   0.801
a       -0.055    -0.068     0.172     0.075  -0.002   0.001   0.021   0.136
b        1.040     1.524     0.791     0.266   1.006   1.607   1.235   0.153
R**2    -0.275    -0.169     0.511     0.607  -0.047  -0.123  -0.198   0.377
a       -0.013    -0.022     0.128     0.246  -0.002  -0.007  -0.041   0.345
b        0.853     2.050     1.187    -0.708   0.953   0.772   1.062   0.404
R**2    -0.422    -0.368     0.401     0.460   0.318  -0.230   0.105   0.764
a       -0.027    -0.049     0.102     0.234   0.021  -0.016   0.008   0.232
b        0.935     1.989     1.587    -0.402   0.613   1.454   1.258  -0.089
R**2    -0.147    -0.397     0.547     0.452   0.064  -0.166  -0.098   0.634
a       -0.007    -0.063     0.187     0.185   0.006  -0.012  -0.008   0.216
b        0.666     2.572     0.778    -0.332   0.831   1.439   1.643   0.439
TaiESM1      [-30,-45] [-45,-60] [-60,-75] [-75,-90] [30,45] [45,60] [60,75] [75,90]
R**2     0.545    -0.383     0.121     0.337   0.120   0.100   0.285   0.782
a        0.012    -0.007     0.007     0.031   0.001   0.001   0.007   0.050
b        0.299     0.950     1.164     0.151   0.733   1.151   0.914   0.120
R**2    -0.210    -0.414     0.428     0.730   0.156  -0.031  -0.193   0.352
a       -0.002    -0.010     0.026     0.120   0.005  -0.000  -0.006   0.055
b        0.818     1.959     1.248    -0.683   0.631   0.565   0.735   0.406
R**2    -0.106    -0.496     0.255     0.509   0.137  -0.142   0.110   0.717
a       -0.001    -0.010     0.013     0.095   0.002  -0.002   0.003   0.069
b        0.665     1.529     1.456    -0.557   0.706   1.022   0.904   0.061
R**2    -0.327    -0.524     0.472     0.676   0.142  -0.101  -0.091   0.571
a       -0.004    -0.014     0.029     0.086   0.003  -0.001  -0.002   0.031
b        0.800     1.927     1.120    -0.375   0.602   1.021   1.208   0.544
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-iwp-snowfall-scatter-with-regression-lines">
<h3>Plot IWP-snowfall scatter with regression lines<a class="headerlink" href="#plot-iwp-snowfall-scatter-with-regression-lines" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for ERA5 SH</span>
<span class="n">fct</span><span class="o">.</span><span class="n">plt_scatter_iwp_sf_seasonal</span><span class="p">(</span><span class="n">era</span><span class="p">,</span> <span class="n">era_linreg</span><span class="p">,</span> <span class="n">iteration_SH</span><span class="p">,</span> <span class="o">-</span><span class="n">step</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;IWP vs. Snowfall: ERA5  </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lat_SH</span><span class="p">)),</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">15</span><span class="p">])</span>

<span class="c1"># save figure to png</span>
<span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/ERA5/&#39;</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;iwp_sf_</span><span class="si">{}</span><span class="s1">_season_1deg_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">lat_SH</span><span class="p">),</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1">############################################################</span>
<span class="c1"># for ERA5 NH</span>
<span class="n">fct</span><span class="o">.</span><span class="n">plt_scatter_iwp_sf_seasonal</span><span class="p">(</span><span class="n">era</span><span class="p">,</span> <span class="n">era_linreg</span><span class="p">,</span> <span class="n">iteration_NH</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;IWP vs. Snowfall: ERA5  </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lat_NH</span><span class="p">)),</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">15</span><span class="p">])</span>

<span class="c1"># save figure to png</span>
<span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/ERA5/&#39;</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;iwp_sf_</span><span class="si">{}</span><span class="s1">_season_1deg_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">lat_NH</span><span class="p">),</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/plt_seasonal_mean_48_0.png" src="../_images/plt_seasonal_mean_48_0.png" />
<img alt="../_images/plt_seasonal_mean_48_1.png" src="../_images/plt_seasonal_mean_48_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for CMIP6 model mean SH</span>
<span class="n">fct</span><span class="o">.</span><span class="n">plt_scatter_iwp_sf_seasonal</span><span class="p">(</span><span class="n">cmip</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span> <span class="n">cmip_mm_linreg</span><span class="p">,</span> <span class="n">iteration_SH</span><span class="p">,</span> <span class="o">-</span><span class="n">step</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;IWP vs. Snowfall: CMIP6 Model Mean  </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lat_SH</span><span class="p">)),</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">15</span><span class="p">])</span>

<span class="c1"># save figure to png</span>
<span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6/&#39;</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;iwp_sf_</span><span class="si">{}</span><span class="s1">_model_mean_season_1deg_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">lat_SH</span><span class="p">),</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1">############################################################</span>
<span class="c1"># for CMIP6 model mean NH</span>
<span class="n">fct</span><span class="o">.</span><span class="n">plt_scatter_iwp_sf_seasonal</span><span class="p">(</span><span class="n">cmip</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span> <span class="n">cmip_mm_linreg</span><span class="p">,</span> <span class="n">iteration_NH</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;IWP vs. Snowfall: CMIP6 Model Mean  </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lat_SH</span><span class="p">)),</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">15</span><span class="p">])</span>

<span class="c1"># save figure to png</span>
<span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6/&#39;</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;iwp_sf_</span><span class="si">{}</span><span class="s1">_model_mean_season_1deg_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">lat_NH</span><span class="p">),</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/plt_seasonal_mean_49_0.png" src="../_images/plt_seasonal_mean_49_0.png" />
<img alt="../_images/plt_seasonal_mean_49_1.png" src="../_images/plt_seasonal_mean_49_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">cmip</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="c1"># for CMIP6 individual model SH</span>
    <span class="n">fct</span><span class="o">.</span><span class="n">plt_scatter_iwp_sf_seasonal</span><span class="p">(</span><span class="n">cmip</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">),</span> <span class="n">cmip_linreg</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">),</span> <span class="n">iteration_SH</span><span class="p">,</span> <span class="o">-</span><span class="n">step</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;IWP vs. Snowfall: </span><span class="si">{}</span><span class="s1">  </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">lat_SH</span><span class="p">)),</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">15</span><span class="p">])</span>


    <span class="c1"># save figure to png</span>
    <span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6/&#39;</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;iwp_sf_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_season_1deg_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">lat_SH</span><span class="p">),</span> <span class="n">model</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1">############################################################</span>
    <span class="c1"># for CMIP6 individual model NH</span>
    <span class="n">fct</span><span class="o">.</span><span class="n">plt_scatter_iwp_sf_seasonal</span><span class="p">(</span><span class="n">cmip</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">),</span> <span class="n">cmip_linreg</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">),</span> <span class="n">iteration_NH</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;IWP vs. Snowfall: </span><span class="si">{}</span><span class="s1">  </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">lat_NH</span><span class="p">)),</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">15</span><span class="p">])</span>


    <span class="c1"># save figure to png</span>
    <span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6/&#39;</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;iwp_sf_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_season_1deg_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">lat_NH</span><span class="p">),</span> <span class="n">model</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/plt_seasonal_mean_50_0.png" src="../_images/plt_seasonal_mean_50_0.png" />
<img alt="../_images/plt_seasonal_mean_50_1.png" src="../_images/plt_seasonal_mean_50_1.png" />
<img alt="../_images/plt_seasonal_mean_50_2.png" src="../_images/plt_seasonal_mean_50_2.png" />
<img alt="../_images/plt_seasonal_mean_50_3.png" src="../_images/plt_seasonal_mean_50_3.png" />
<img alt="../_images/plt_seasonal_mean_50_4.png" src="../_images/plt_seasonal_mean_50_4.png" />
<img alt="../_images/plt_seasonal_mean_50_5.png" src="../_images/plt_seasonal_mean_50_5.png" />
<img alt="../_images/plt_seasonal_mean_50_6.png" src="../_images/plt_seasonal_mean_50_6.png" />
<img alt="../_images/plt_seasonal_mean_50_7.png" src="../_images/plt_seasonal_mean_50_7.png" />
<img alt="../_images/plt_seasonal_mean_50_8.png" src="../_images/plt_seasonal_mean_50_8.png" />
<img alt="../_images/plt_seasonal_mean_50_9.png" src="../_images/plt_seasonal_mean_50_9.png" />
<img alt="../_images/plt_seasonal_mean_50_10.png" src="../_images/plt_seasonal_mean_50_10.png" />
<img alt="../_images/plt_seasonal_mean_50_11.png" src="../_images/plt_seasonal_mean_50_11.png" />
<img alt="../_images/plt_seasonal_mean_50_12.png" src="../_images/plt_seasonal_mean_50_12.png" />
<img alt="../_images/plt_seasonal_mean_50_13.png" src="../_images/plt_seasonal_mean_50_13.png" />
<img alt="../_images/plt_seasonal_mean_50_14.png" src="../_images/plt_seasonal_mean_50_14.png" />
<img alt="../_images/plt_seasonal_mean_50_15.png" src="../_images/plt_seasonal_mean_50_15.png" />
<img alt="../_images/plt_seasonal_mean_50_16.png" src="../_images/plt_seasonal_mean_50_16.png" />
<img alt="../_images/plt_seasonal_mean_50_17.png" src="../_images/plt_seasonal_mean_50_17.png" />
<img alt="../_images/plt_seasonal_mean_50_18.png" src="../_images/plt_seasonal_mean_50_18.png" />
<img alt="../_images/plt_seasonal_mean_50_19.png" src="../_images/plt_seasonal_mean_50_19.png" />
<img alt="../_images/plt_seasonal_mean_50_20.png" src="../_images/plt_seasonal_mean_50_20.png" />
<img alt="../_images/plt_seasonal_mean_50_21.png" src="../_images/plt_seasonal_mean_50_21.png" />
<img alt="../_images/plt_seasonal_mean_50_22.png" src="../_images/plt_seasonal_mean_50_22.png" />
<img alt="../_images/plt_seasonal_mean_50_23.png" src="../_images/plt_seasonal_mean_50_23.png" />
<img alt="../_images/plt_seasonal_mean_50_24.png" src="../_images/plt_seasonal_mean_50_24.png" />
<img alt="../_images/plt_seasonal_mean_50_25.png" src="../_images/plt_seasonal_mean_50_25.png" />
<img alt="../_images/plt_seasonal_mean_50_26.png" src="../_images/plt_seasonal_mean_50_26.png" />
<img alt="../_images/plt_seasonal_mean_50_27.png" src="../_images/plt_seasonal_mean_50_27.png" />
<img alt="../_images/plt_seasonal_mean_50_28.png" src="../_images/plt_seasonal_mean_50_28.png" />
<img alt="../_images/plt_seasonal_mean_50_29.png" src="../_images/plt_seasonal_mean_50_29.png" />
<img alt="../_images/plt_seasonal_mean_50_30.png" src="../_images/plt_seasonal_mean_50_30.png" />
<img alt="../_images/plt_seasonal_mean_50_31.png" src="../_images/plt_seasonal_mean_50_31.png" />
<img alt="../_images/plt_seasonal_mean_50_32.png" src="../_images/plt_seasonal_mean_50_32.png" />
<img alt="../_images/plt_seasonal_mean_50_33.png" src="../_images/plt_seasonal_mean_50_33.png" />
</div>
</div>
</div>
</div>
<div class="section" id="difference-era5-cmip6-model-mean">
<h2>Difference ERA5 - CMIP6 model mean<a class="headerlink" href="#difference-era5-cmip6-model-mean" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">step</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">diff</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
<span class="k">for</span> <span class="n">_lat</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
    <span class="n">diff</span><span class="p">[</span><span class="s1">&#39;iwp_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span> <span class="o">=</span> <span class="n">era</span><span class="p">[</span><span class="s1">&#39;iwp_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span> <span class="o">-</span> <span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;iwp_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">diff</span><span class="p">[</span><span class="s1">&#39;sf_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span> <span class="o">=</span> <span class="n">era</span><span class="p">[</span><span class="s1">&#39;sf_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span> <span class="o">-</span> <span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;sf_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    
<span class="k">for</span> <span class="n">_lat</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
    <span class="n">diff</span><span class="p">[</span><span class="s1">&#39;iwp_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span> <span class="o">=</span> <span class="n">era</span><span class="p">[</span><span class="s1">&#39;iwp_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span> <span class="o">-</span> <span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;iwp_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">diff</span><span class="p">[</span><span class="s1">&#39;sf_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span> <span class="o">=</span> <span class="n">era</span><span class="p">[</span><span class="s1">&#39;sf_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span> <span class="o">-</span> <span class="n">cmip</span><span class="p">[</span><span class="s1">&#39;sf_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axsm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;IWP vs. Snowfall: ERA5 - CMIP6 model mean  </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lat_SH</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

<span class="n">axs</span> <span class="o">=</span> <span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">diff</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">_lat</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="n">step</span><span class="p">),</span> <span class="n">cm</span><span class="o">.</span><span class="n">romaO</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">256</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)))):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="s1">&#39;iwp_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> 
                   <span class="n">diff</span><span class="p">[</span><span class="s1">&#39;sf_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">),</span> 
                    <span class="n">color</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> 
                    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
        
        <span class="c1"># _mask = (~np.isnan(diff[&#39;sf_{}_{}&#39;.format(_lat, _lat+step)].sel(season=i).values.flatten()) &amp; ~np.isnan(diff[&#39;iwp_{}_{}&#39;.format(_lat, _lat+step)].sel(season=i).values.flatten()))</span>
        <span class="c1"># _x = np.linspace(0,100)</span>
        <span class="c1"># _y = _x*linregress(diff[&#39;iwp_{}_{}&#39;.format(_lat, _lat+step)].sel(season=i).values.flatten()[_mask],</span>
        <span class="c1">#                    diff[&#39;sf_{}_{}&#39;.format(_lat, _lat+step)].sel(season=i).values.flatten()[_mask]).slope + linregress(diff[&#39;iwp_{}_{}&#39;.format(_lat, _lat+step)].sel(season=i).values.flatten()[_mask], diff[&#39;sf_{}_{}&#39;.format(_lat, _lat+step)].sel(season=i).values.flatten()[_mask]).intercept</span>
    
        <span class="c1"># ax.plot(_x, _y, color = c, linewidth = &#39;2&#39;)</span>

    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Snowfall: ERA5 - CMIP6$_{model mean}$ (mm$\,$day$^{-1}$)&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Ice Water Path: ERA5 - CMIP5$_{model mean}$ (g$\,$m$^{-2}$)&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;season: </span><span class="si">{}</span><span class="s2">; lat: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">lat_SH</span><span class="p">)))</span>
    
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axsm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;IWP vs. Snowfall: ERA5 - CMIP6 model mean  </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lat_NH</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

<span class="n">axs</span> <span class="o">=</span> <span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">diff</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">_lat</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">step</span><span class="p">),</span> <span class="n">cm</span><span class="o">.</span><span class="n">romaO</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">256</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="s1">&#39;iwp_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> 
                    <span class="n">diff</span><span class="p">[</span><span class="s1">&#39;sf_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">)]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_lat</span><span class="p">,</span> <span class="n">_lat</span><span class="o">+</span><span class="n">step</span><span class="p">),</span> 
                    <span class="n">color</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> 
                    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
        
        <span class="c1"># _mask = (~np.isnan(diff[&#39;sf_{}_{}&#39;.format(_lat, _lat+step)].sel(season=i).values.flatten()) &amp; ~np.isnan(diff[&#39;iwp_{}_{}&#39;.format(_lat, _lat+step)].sel(season=i).values.flatten()))</span>
        <span class="c1"># _x = np.linspace(0,100)</span>
        <span class="c1"># _y = _x*linregress(diff[&#39;iwp_{}_{}&#39;.format(_lat, _lat+step)].sel(season=i).values.flatten()[_mask],</span>
        <span class="c1">#                    diff[&#39;sf_{}_{}&#39;.format(_lat, _lat+step)].sel(season=i).values.flatten()[_mask]).slope + linregress(diff[&#39;iwp_{}_{}&#39;.format(_lat, _lat+step)].sel(season=i).values.flatten()[_mask], diff[&#39;sf_{}_{}&#39;.format(_lat, _lat+step)].sel(season=i).values.flatten()[_mask]).intercept</span>
    
        <span class="c1"># ax.plot(_x, _y, color = c, linewidth = &#39;2&#39;)</span>

    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Snowfall: ERA5 - CMIP6$_{model mean}$ (mm$\,$day$^{-1}$)&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Ice Water Path: ERA5 - CMIP5$_{model mean}$ (g$\,$m$^{-2}$)&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;season: </span><span class="si">{}</span><span class="s2">; lat: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">lat_NH</span><span class="p">)))</span>
    
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cmip</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">cm</span><span class="o">.</span><span class="n">romaO</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">256</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmip</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">)))),):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axsm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;IWP vs. Snowfall  (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

        <span class="n">axs</span> <span class="o">=</span> <span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">era_where_snowfall</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">era_where_snowfall</span><span class="p">[</span><span class="s1">&#39;tciw_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lats</span><span class="p">,</span> <span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> 
                        <span class="n">era_where_snowfall</span><span class="p">[</span><span class="s1">&#39;sf_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lats</span><span class="p">,</span> <span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ERA5&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cmip_where_snowfall</span><span class="p">[</span><span class="s1">&#39;clivi_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lats</span><span class="p">,</span> <span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> 
                        <span class="n">cmip_where_snowfall</span><span class="p">[</span><span class="s1">&#39;prsn_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lats</span><span class="p">,</span> <span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="n">k</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Snowfall (mm$\,$day$^{-1}$)&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Ice Water Path (g$\,$m$^{-2}$)&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;season: </span><span class="si">{}</span><span class="s2">; lat: [30, 90]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>

        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="c1"># save figure to png</span>
        <span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6_ERA5_CloudSat/&#39;</span>
        <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;prsn_clivi_(30,90)_1deg_1985_2014_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">idx_iwc</span> <span class="o">=</span> <span class="p">(</span><span class="n">cmip_global_mean</span><span class="p">[</span><span class="s1">&#39;clivi&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">era_global_mean</span><span class="p">[</span><span class="s1">&#39;tciw&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
<span class="n">idx_sf</span> <span class="o">=</span> <span class="p">(</span><span class="n">cmip_global_mean</span><span class="p">[</span><span class="s1">&#39;prsn&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">era_global_mean</span><span class="p">[</span><span class="s1">&#39;sf&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">idx_sf</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axsm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;IWP vs. Snowfall  (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx_iwc</span><span class="p">,</span> <span class="n">idx_sf</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

<span class="n">axs</span> <span class="o">=</span> <span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">era_where_snowfall</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">era_where_snowfall</span><span class="p">[</span><span class="s1">&#39;tciw_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lats</span><span class="p">,</span> <span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> 
                        <span class="n">era_where_snowfall</span><span class="p">[</span><span class="s1">&#39;sf_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lats</span><span class="p">,</span> <span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ERA5&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cmip_where_snowfall</span><span class="p">[</span><span class="s1">&#39;clivi_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">idx_iwc</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lats</span><span class="p">,</span> <span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> 
                        <span class="n">cmip_where_snowfall</span><span class="p">[</span><span class="s1">&#39;prsn_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">idx_sf</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lats</span><span class="p">,</span> <span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx_iwc</span><span class="p">,</span> <span class="n">idx_sf</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Snowfall (mm$\,$day$^{-1}$)&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Ice Water Path (g$\,$m$^{-2}$)&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;season: </span><span class="si">{}</span><span class="s2">; lat: [30, 90]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># save figure to png</span>
<span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6_ERA5_CloudSat/&#39;</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;prsn_clivi_(30,90)_1deg_1985_2014_min.png&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lats</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axsm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;IWP vs. Snowfall  (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx_iwc</span><span class="p">,</span> <span class="n">idx_sf</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

<span class="n">axs</span> <span class="o">=</span> <span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">era_where_snowfall</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">era_where_snowfall</span><span class="p">[</span><span class="s1">&#39;tciw_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lats</span><span class="p">,</span> <span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> 
                        <span class="n">era_where_snowfall</span><span class="p">[</span><span class="s1">&#39;sf_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lats</span><span class="p">,</span> <span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ERA5&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cmip_where_snowfall</span><span class="p">[</span><span class="s1">&#39;clivi_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">idx_iwc</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lats</span><span class="p">,</span> <span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> 
                        <span class="n">cmip_where_snowfall</span><span class="p">[</span><span class="s1">&#39;prsn_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">idx_sf</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lats</span><span class="p">,</span> <span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx_iwc</span><span class="p">,</span> <span class="n">idx_sf</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Snowfall (mm$\,$day$^{-1}$)&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Ice Water Path (g$\,$m$^{-2}$)&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;season: </span><span class="si">{}</span><span class="s2">; lat: [-90, -30]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span><span class="c1"># save figure to png</span>
<span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6_ERA5_CloudSat/&#39;</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;prsn_clivi_(-90,-30)_1deg_1985_2014_min.png&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">era_where_snowfall</span><span class="p">[</span><span class="s1">&#39;tciw_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">),</span> <span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">era_where_snowfall</span><span class="p">[</span><span class="s1">&#39;tciw_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">),</span> <span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">era_where_snowfall</span><span class="p">[</span><span class="s1">&#39;sf_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">),</span> <span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">deg</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Plot scatter zonal mean</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmip</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">cfiles</span><span class="p">)</span>
<span class="n">era</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">efiles</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmip_zonal_season</span> <span class="o">=</span> <span class="n">cmip</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">era_zonal_season</span> <span class="o">=</span> <span class="n">era</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot zonal mean for each CMIP6 model</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axsm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;IWP vs. Snowfall (zonal, 1985 - 2014)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

<span class="n">axs</span> <span class="o">=</span> <span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">prsn_zonal_season</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="c1"># for k, c in zip(cmip.model.values, cm.romaO(range(0, 256, int(256/len(cmip.model.values))))):</span>
    <span class="c1">#     ax.scatter((cmip_zonal_season[&#39;clivi&#39;]*1000).sel(season=i, model=k), (cmip_zonal_season[&#39;prsn&#39;]*86400).sel(season=i, model=k), label=k, color =c )</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">((</span><span class="n">cmip_zonal_season</span><span class="p">[</span><span class="s1">&#39;clivi&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> <span class="p">(</span><span class="n">cmip_zonal_season</span><span class="p">[</span><span class="s1">&#39;prsn&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">86400</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span><span class="s1">&#39;CMIP6 mean&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;grey&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">((</span><span class="n">era_zonal_season</span><span class="p">[</span><span class="s1">&#39;tciw&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> <span class="p">(</span><span class="n">era_zonal_season</span><span class="p">[</span><span class="s1">&#39;sf&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ERA5&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Snowfall (mm$\,$day$^{-1}$)&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Ice Water Path (g$\,$m$^{-2}$)&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># save figure to png</span>
<span class="n">figdir</span> <span class="o">=</span> <span class="s1">&#39;/uio/kant/geo-metos-u1/franzihe/Documents/Figures/CMIP6_ERA5_CloudSat/&#39;</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;prsn_clivi_zonal_1deg_1985_2014.png&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figdir</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Calculate significance of ERA5-CMIP6 difference, with the help of two-sample t-test.</p>
<div class="section" id="hypothesis">
<h3>Hypothesis<a class="headerlink" href="#hypothesis" title="Permalink to this headline">¶</a></h3>
<p>When performing t-tests you typically have the following two hypotheses:</p>
<ul class="simple">
<li><p>Null hypotheses: Two group means are equal</p></li>
<li><p>Alternative hypotheses: Two group means are different (two-tailed)</p></li>
</ul>
</div>
<div class="section" id="assumptions">
<h3>Assumptions<a class="headerlink" href="#assumptions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Assumption 1: Are the two samples independent?</p>
<ul>
<li><p>yes</p></li>
</ul>
</li>
<li><p>Assumption 2: Are the data from each of the 2 groups following a normal distribution?</p></li>
<li><p>Assumption 3: Do the two samples have the same variances (Homogeneity of Variance)?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmip_file</span> <span class="o">=</span> <span class="s1">&#39;/scratch/franzihe/output/CMIP6_hist/1deg/</span><span class="si">{}</span><span class="s1">_Amon_1deg_198501_201412.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="n">era_file</span> <span class="o">=</span> <span class="s1">&#39;/scratch/franzihe/output/ERA5/monthly_means/1deg/</span><span class="si">{}</span><span class="s1">_Amon_1deg_198501_201412.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

<span class="n">cmip</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">cmip_file</span><span class="p">)</span>
<span class="n">cmip</span> <span class="o">=</span> <span class="n">cmip</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">era</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">era_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;clivi&#39;</span><span class="p">,</span> <span class="s1">&#39;tciw&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmip_file</span> <span class="o">=</span> <span class="s1">&#39;/scratch/franzihe/output/CMIP6_hist/1deg/*_Amon_1deg_198501_201412.nc&#39;</span>
<span class="n">ff</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">cmip_file</span><span class="p">)</span>
<span class="n">ff</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">ff</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_ds_cmip</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ff</span><span class="p">)):</span>
    <span class="n">_ds_cmip</span><span class="p">[</span><span class="n">ff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">ff</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">decode_times</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">_ds_cmip</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">_ds_cmip</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">variable_id</span> <span class="o">=</span> <span class="p">[</span>
               <span class="p">[</span><span class="s1">&#39;prsn&#39;</span><span class="p">,</span> <span class="s1">&#39;sf&#39;</span><span class="p">],</span>
               <span class="c1"># [&#39;clivi&#39;, &#39;tciw&#39;]</span>
            <span class="c1">#    [&#39;lwp&#39;, &#39;tclw&#39;],</span>
               <span class="c1"># [&#39;tas&#39;, &#39;2t&#39;]</span>
               <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">ff</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">ff</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">ff</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span>  <span class="s1">&#39;prsn&#39;</span><span class="p">:</span>
    <span class="c1"># kg m-2 s-1 to mm/day *86400</span>
    <span class="n">prsn</span> <span class="o">=</span> <span class="n">cmip</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">*</span><span class="mi">86400</span>

    <span class="c1"># m of water equivalent can be converted to kgm^2/day or mm/day by multiplying by 1000.</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">*</span><span class="mi">1000</span>
</pre></div>
</div>
</div>
</div>
<p>If our variable follows a normal distribution, the quantiles of our variable must be perfectly in line with the “theoretical” normal quantiles: a straight line on the QQ Plot tells us we have a normal distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">prsn</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">dist</span><span class="o">=</span><span class="s2">&quot;norm&quot;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span> <span class="n">plt</span><span class="p">);</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">dist</span><span class="o">=</span><span class="s2">&quot;norm&quot;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span> <span class="n">plt</span><span class="p">);</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">era</span><span class="p">[</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sf_stat</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span> <span class="o">=</span> <span class="s1">&#39;DJF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
<span class="n">prsn_stat</span> <span class="o">=</span> <span class="n">prsn</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span> <span class="o">=</span> <span class="s1">&#39;DJF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sf_stat</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prsn_stat</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sf_stat</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">sf_stat</span><span class="p">[</span><span class="mf">0.</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">prsn_stat</span><span class="p">[</span><span class="mf">0.</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">levene</span><span class="p">(</span><span class="n">sf_stat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">prsn_stat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;ERA5&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sf</span><span class="p">),</span> <span class="n">sf</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">sf</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">],</span> 
        <span class="p">[</span><span class="s1">&#39;CMIP6&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">prsn</span><span class="p">),</span> <span class="n">prsn</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">prsn</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">]]</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="s2">&quot;Sample Size (n)&quot;</span><span class="p">,</span> <span class="s2">&quot;Average (X-bar)&quot;</span><span class="p">,</span>	<span class="s2">&quot;Standard deviation (s)&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Without doing any testing, we can see that the averages for ERA5 and CMIP6 in our samples are almost the same for snowfall. We start by calculating our test statistic. This difference in our samples estimates the difference between the population means for the two groups. This calculation begins with finding the difference between the two averages:</p>
<p><span class="math notranslate nohighlight">\(M = \overline X - \overline Y\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diff_mean</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">prsn</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">diff_mean</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we calculate the pooled standard deviation. This builds a combined estimate of the overall standard deviation. The estimate adjusts for different group sizes. First, we calculate the pooled variance:</p>
<p><span class="math notranslate nohighlight">\(s_p^2 = \displaystyle\frac{(n_1 - 1)* s_1^2 + (n_2 - 1)* s_2^2}{n_1 + n_2 -2} \)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="o">=</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">sf</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prsn</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">prsn</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">prsn</span><span class="p">)</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="n">var</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we take the square root of the pooled variance to get the pooled standard deviation.</p>
<p><span class="math notranslate nohighlight">\(s_p = \sqrt{s_p^2}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
<span class="n">std</span>
</pre></div>
</div>
</div>
</div>
<p>We now have all the pieces for our test statistic. We have the difference of the averages, the pooled standard deviation and the sample sizes.  We calculate our test statistic as follows:</p>
<p><span class="math notranslate nohighlight">\(t = \displaystyle\frac{\text{difference of group averages}}{\text{standard error of difference}}\)</span></p>
<p><span class="math notranslate nohighlight">\(t = \displaystyle\frac{M}{s_p * \sqrt{\frac{1}{m} + \frac{1}{n}}}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">diff_mean</span><span class="o">/</span><span class="p">(</span><span class="n">std</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">prsn</span><span class="p">)))</span>
<span class="n">t</span>
</pre></div>
</div>
</div>
</div>
<p>To evaluate the difference between the means in order to make a decision about our datasets, we compare the test statistic to a theoretical value from the t-distribution. This activity involves four steps:</p>
<ol class="simple">
<li><p>We decide on the risk we are willing to take for declaring a significant difference. For the data, we decide that we are willing to take a 95% risk of saying that the unknown population means for ERA5 and CMIP6 are not equal when they really are. In statistics-speak, the significance level, denoted by <span class="math notranslate nohighlight">\(\alpha\)</span>, is set to 0.95. It is a good practice to make this decision before collecting the data and before calculating test statistics.</p></li>
<li><p>We calculate a test statistic. Our test statistic is 0.594 for snowfall.</p></li>
<li><p>We find the theoretical value from the t-distribution based on our null hypothesis which states that the means for ERA5 and CMIP6 are equal. Most statistics books have look-up tables for the t-distribution. You can also find tables online. The most likely situation is that you will use software and will not use printed tables.
To find this value, we need the significance level (<span class="math notranslate nohighlight">\(\alpha\)</span> = 0.95) and the degrees of freedom. The degrees of freedom (df) are based on the sample sizes of the two groups. For the snowfall data, this is:
<span class="math notranslate nohighlight">\(df = n_1 + n_2 - 2 = 718\)</span>
The t value with <span class="math notranslate nohighlight">\(\alpha\)</span> = 0.95 and 718 degrees of freedom is .</p></li>
<li><p>We compare the value of our statistic (0.594) to the t value. Since t &gt; T, we reject the null hypothesis that the snowfall for ERA5 and CMIP6 are equal, and conclude that we have evidence snowfall in the population is different between ERA5 and CMIP6.</p></li>
</ol>
<div class="section" id="statistical-details">
<h4>Statistical details<a class="headerlink" href="#statistical-details" title="Permalink to this headline">¶</a></h4>
<p>Let’s look at the snowfall data and the two-sample t-test using statistical terms.</p>
<ul class="simple">
<li><p>Our null hypothesis is that the underlying population means are the same. The null hypothesis is written as:
Ho: <span class="math notranslate nohighlight">\(\mu_1=\mu_2\)</span></p></li>
<li><p>The alternative hypothesis is that the means are not equal. This is written as:
Ho: <span class="math notranslate nohighlight">\(\mu_1 \neq \mu_2\)</span></p></li>
<li><p>We calculate the average for each group, and then calculate the difference between the two averages. This is written as:
<span class="math notranslate nohighlight">\(\overline x_1 - \overline x_2\)</span></p></li>
<li><p>We calculate the pooled standard deviation. This assumes that the underlying population variances are equal. The pooled variance formula is written as:
<span class="math notranslate nohighlight">\(s_p^2 = \displaystyle\frac{(n_1 - 1)* s_1^2 + (n_2 - 1)* s_2^2}{n_1 + n_2 -2} \)</span>
The formula shows the sample size for the first group as <span class="math notranslate nohighlight">\(n_1\)</span> and the second group as <span class="math notranslate nohighlight">\(n_2\)</span>. The standard deviations for the two groups are <span class="math notranslate nohighlight">\(s_1\)</span> and <span class="math notranslate nohighlight">\(s_2\)</span>. This estimate allows the two groups to have different numbers of observations. The pooled standard deviation is the square root of the variance and is written as <span class="math notranslate nohighlight">\(s_p\)</span>.</p></li>
</ul>
<p>What if your sample sizes for the two groups are the same? In this situation, the pooled estimate of variance is simply the average of the variances for the two groups:</p>
<p><span class="math notranslate nohighlight">\(s_p^2 = \displaystyle\frac{s_1^2 +  s_2^2}{2} \)</span></p>
<ul class="simple">
<li><p>The test statistic is calculated as:
<span class="math notranslate nohighlight">\(t = \displaystyle\frac{\overline x_1 - \overline x_2}{s_p * \sqrt{\frac{1}{n_1} + \frac{1}{n_2}}}\)</span></p></li>
</ul>
<p>The numerator of the test statistic is the difference between the two group averages. It estimates the difference between the two unknown population means. The denominator is an estimate of the standard error of the difference between the two unknown population means.</p>
<ul class="simple">
<li><p>We then compare the test statistic to a t value with our chosen alpha value and the degrees of freedom for our data. Using the snowfall data as an example, we set <span class="math notranslate nohighlight">\(\alpha\)</span> = 0.95. The degrees of freedom (df) are based on the group sizes and are calculated as:
<span class="math notranslate nohighlight">\(df = n_1 + n_2 - 2 \)</span></p></li>
</ul>
<p>The formula shows the sample size for the first group as <span class="math notranslate nohighlight">\(n_1\)</span> and the second group as <span class="math notranslate nohighlight">\(n_2\)</span>. Statisticians write the t value with <span class="math notranslate nohighlight">\(\alpha\)</span> = 0.95 and 718 degrees of freedom as:
<span class="math notranslate nohighlight">\(t_{0.95,718}\)</span></p>
<p>There are two possible results from our comparison:</p>
<ul class="simple">
<li><p>The test statistic is lower than the t value. You fail to reject the hypothesis of equal means. You conclude that the data support the assumption that the ERA5 and CMIP6 have the same average snowfall.</p></li>
<li><p>The test statistic is higher than the t value. You reject the hypothesis of equal means. You do not conclude that ERA5 and CMIP6 have the same average snowfall</p></li>
</ul>
<p><a class="reference external" href="https://www.jmp.com/en_ch/statistics-knowledge-portal/t-test/two-sample-t-test.html">Taken from the statisitcs knowledge portal</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="c1"># snowfall (ERA5)</span>
<span class="n">_sf</span> <span class="o">=</span> <span class="n">era</span><span class="o">.</span><span class="n">sf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span>

<span class="c1"># snowfall (CMIP6)</span>
<span class="n">_prsn</span> <span class="o">=</span> <span class="n">cmip</span><span class="o">.</span><span class="n">prsn</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">*</span><span class="mi">86400</span>

<span class="n">_stat</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">_sf</span><span class="p">,</span> <span class="n">_prsn</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Before the t-test can be conducted, one needs to test the assumptions. First to test for the homogeneity of variances. To do this, I will use Levene’s test for homogeneity of variance. The method to conduct this test is stats.levene().</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">levene</span><span class="p">(</span><span class="n">_sf</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">_prsn</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>Next to test the assumption of normality. This can be done visually with a histogram and/or as a q-q plot, and by using the Shapiro-Wilk test which is the stats.shaprio() method. First, I will check them visually.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_sf</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_prsn</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">_sf</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">dist</span><span class="o">=</span><span class="s2">&quot;norm&quot;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span> <span class="n">plt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">_prsn</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">dist</span><span class="o">=</span><span class="s2">&quot;norm&quot;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span> <span class="n">plt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To be sure, we can test it statistically using the Shapiro-Wilk test for normality which is the stats.shaprio() method. Unfortunately the output is not labeled. The first value is the W test statistic and the second value is the p-value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">_sf</span><span class="p">),</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">_prsn</span><span class="p">))</span> 
</pre></div>
</div>
</div>
</div>
<p>Neither of the tests for normality we significant meaning neither of the variables violates the assumption of normality. We can continue as planned. To conduct the Independent t-test, one needs to use the stats.ttest_ind() method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">_sf</span><span class="p">,</span> <span class="n">_prsn</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">])</span>
<span class="n">mean_diff</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>
<span class="n">s_std</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">mean_diff</span><span class="o">/</span> <span class="p">(</span><span class="n">s_std</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">.95</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sig_map</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">&gt;</span> <span class="n">T</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sig_map</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Source: Modern Mathematical Statistics with Applications by Devore &amp; Berk</span>
<span class="sd">    Assumptions:</span>
<span class="sd">    - data consists of independently selected pairs (X1,Y1)</span>
<span class="sd">    - Di=Xi-Yi are assumed to be normally distributed.</span>
<span class="sd">    :param da1:</span>
<span class="sd">    :param da2:</span>
<span class="sd">    :param avg_dim:</span>
<span class="sd">    :param ci:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">da1</span> <span class="o">-</span> <span class="n">da2</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">avg_dim</span><span class="p">])</span>
    <span class="n">mean_D</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_dim</span><span class="p">)</span>
    <span class="c1"># sample std:</span>
    <span class="c1"># population std= sqrt(sum((xi-mu)^2)/n)</span>
    <span class="c1"># sample std =  sqrt(sum((xi-mu)^2)/(n-1))</span>
    <span class="c1"># sample std = (population std)*(sqrt(n/(n-1))</span>
    <span class="n">s_std</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_dim</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">mean_D</span> <span class="o">/</span> <span class="p">(</span><span class="n">s_std</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="c1"># for small samples (&lt;50) we use t-statistics</span>
    <span class="c1"># n = 9, degree of freedom = 9-1 = 8</span>
    <span class="c1"># for 99% confidence interval, alpha = 1% = 0.01 and alpha/2 = 0.005</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ci</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># 99% CI, t8,0.005</span>
    <span class="n">sig_map</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">&gt;</span> <span class="n">T</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">T</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">T</span><span class="p">,</span> <span class="n">sig_map</span><span class="p">,</span> <span class="n">t</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_stat</span><span class="o">.</span><span class="n">statistic</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask_jja</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axsm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> 
                         <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> 
                         <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()})</span>

<span class="n">axsm</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">cmip</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">cmip</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">_t</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;xxx&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0</span> <span class="p">,</span><span class="n">transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_stat</span><span class="o">.</span><span class="n">pvalue</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diff</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span><span class="c1">#.where(diff &gt;= 0.95).plot()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hatch_area</span><span class="p">(</span><span class="n">TF</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span> <span class="n">hatches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hatch_lw</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;hatch.linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hatch_lw</span>
    <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
        <span class="n">TF</span><span class="o">=~</span><span class="n">TF</span>
    <span class="k">if</span> <span class="n">hatches</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hatches</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;....&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">TF</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span><span class="o">==</span><span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lev&#39;</span><span class="p">}:</span>
        <span class="n">x_coord</span> <span class="o">=</span> <span class="n">TF</span><span class="o">.</span><span class="n">lat</span>
        <span class="n">y_coord</span> <span class="o">=</span> <span class="n">TF</span><span class="o">.</span><span class="n">lev</span>
    <span class="k">elif</span> <span class="nb">set</span><span class="p">(</span><span class="n">TF</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span><span class="o">==</span><span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">}:</span>
        <span class="n">x_coord</span> <span class="o">=</span> <span class="n">TF</span><span class="o">.</span><span class="n">lon</span>
        <span class="n">y_coord</span> <span class="o">=</span> <span class="n">TF</span><span class="o">.</span><span class="n">lat</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_coord</span> <span class="o">=</span> <span class="n">TF</span><span class="p">[</span><span class="n">TF</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">y_coord</span> <span class="o">=</span> <span class="n">TF</span><span class="p">[</span><span class="n">TF</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1">#ax.contourf( x_coord,y_coord, TF.where(TF), hatches=hatches, transform=transform, alpha=0, extend=&#39;both&#39;)</span>
    <span class="n">plt_kwgs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">hatch</span><span class="o">=</span><span class="n">hatches</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">transform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt_kwgs</span><span class="p">[</span><span class="s1">&#39;transform&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">transform</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span> <span class="n">x_coord</span><span class="p">,</span><span class="n">y_coord</span><span class="p">,</span> <span class="n">TF</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">TF</span><span class="p">),</span> <span class="o">**</span><span class="n">plt_kwgs</span><span class="p">)</span><span class="c1">#hatch=hatches[0],rasterized=True, transform=transform, alpha=0)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># T_star_jja: T_star data on lon/lat grid
# make a mask of lon/lat cells following your significance criteria (in my case data_jja (also on the same lon/lat grid) is below 6)
mask_jja = np.ma.masked_less(data_jja, 6.0)# plotting on a polar plot of your data
cs = plt_var_polar(fig, axs[0], lon2d, lat2d, T_star_jja, ‘T_star JJA’, ‘N’, discrete_cmap(16, cm_crameri.oslo), vmin = 238, vmax = 270, n_cmap = 16)# overlay the hatching of the not significant data
cs2 = axs[0].pcolor(lon2d-2.5, lat2d-2.5, mask_jja, hatch=‘xxx’, color = ‘k’, zorder = 100000, alpha=0.0 ,transform = ccrs.PlateCarree())
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./CMIP6_ERA5_CloudSat"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../ERA5/ERA5_1985-2014.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Example with ERA5 high-resolution (~0.25deg) monthly means</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../cmip/CMIP6_hr_1985-2014.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Example with high-resolution CMIP6 models (~100 km) using Pangeo catalog</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Franziska Hellmuth<br/>
    
        &copy; Copyright 2022.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>