

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Example with ERA5 high-resolution (~0.25deg) monthly means &#8212; globalsnow</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ERA5/ERA5_1985-2014';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Analysis of CMIP6, ERA5, and CloudSat" href="../CMIP6_ERA5_CloudSat/plt_seasonal_mean.html" />
    <link rel="prev" title="Welcome to Global Snow project website" href="../intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="globalsnow - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="globalsnow - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to Global Snow project website
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Example with ERA5 high-resolution (~0.25deg) monthly means</a></li>






<li class="toctree-l1"><a class="reference internal" href="../CMIP6_ERA5_CloudSat/plt_seasonal_mean.html">Analysis of CMIP6, ERA5, and CloudSat</a></li>



<li class="toctree-l1"><a class="reference internal" href="../cmip/CMIP6_hr_1985-2014.html">Example with CMIP6 models (100 - 500 km)</a></li>








<li class="toctree-l1 has-children"><a class="reference internal" href="../cloudsat.html">Cloudsat</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../CloudSat/get_pressure_grid.html">Example to get CloudSat mean pressure level profile</a></li>



<li class="toctree-l2"><a class="reference internal" href="../CloudSat/read_2C_snow.html">Regrid CloudSat data to horizontal grid</a></li>



</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/franzihe/CloudSat_ERA5_CMIP6_analysis" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/franzihe/CloudSat_ERA5_CMIP6_analysis/issues/new?title=Issue%20on%20page%20%2FERA5/ERA5_1985-2014.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/ERA5/ERA5_1985-2014.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Example with ERA5 high-resolution (~0.25deg) monthly means</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Example with ERA5 high-resolution (~0.25deg) monthly means</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-a-id-introduction-a">1. Introduction <a id="introduction"></a></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-wrangling-a-id-data-wrangling-a">2. Data Wrangling <a id="data_wrangling"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#organize-my-data">Organize my data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-python-packages">Import python packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#open-era5-variables">Open ERA5 variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#change-attributes-matching-cmip6-data">Change attributes matching CMIP6 data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specific-ice-and-snow-water-content">Specific ice and snow water content</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#total-column-cloud-ice-water-and-total-column-cloud-snow-water">Total column cloud ice water and total column cloud snow water</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#total-column-cloud-liquid-water-total-column-supercooled-liquid-water-total-column-rain-water">Total column cloud liquid water, total column supercooled liquid water, total column rain water</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#save-era5-file">Save ERA5 file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regrid-era5-data-to-common-cmip6-model-grid-a-id-regrid-hz-a">Regrid ERA5 data to common CMIP6 model grid <a id="regrid_hz"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#count-the-days-in-one-season-over-year-range">Count the days in one season over year range</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#supercooled-liquid-water-fraction">Supercooled liquid water fraction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statistics">Statistics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-often-do-we-have-slc-with-thresholds-for-surface-snowfall-liquid-water-path-and-temperature">How often do we have SLC with thresholds for surface snowfall, liquid water path, and temperature</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#liquid-containing-cloud-frequency">Liquid containing cloud frequency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#masked-and-weighted-average">Masked and weighted average</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annual-cycle-of-frequency-of-liquid-containing-clouds">Annual cycle of frequency of liquid containing clouds</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#frequency-of-snowfall-from-lccs">Frequency of snowfall from LCCs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annual-cycle-of-frequency-of-snowfall-from-lccs">Annual cycle of frequency of snowfall from LCCs</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relative-snowfall-efficency">Relative snowfall efficency</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annual-cycle-of-relative-snowfall-efficency">Annual cycle of relative snowfall efficency</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relative-precipitation-efficency">Relative precipitation efficency</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annual-cycle-of-relative-supercooled-precipitation-efficency">Annual cycle of relative supercooled precipitation efficency</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#frequency-of-freezing-rain">Frequency of freezing rain</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#way-to-average-the-globe">Way to Average the Globe</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-bin-and-bin-sizes">Calculating bin and bin sizes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#snowfall-and-precipitation-efficency">Snowfall and Precipitation efficency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mask-atmopsheric-temperature">Mask atmopsheric temperature</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exploratory-data-analysis-a-id-exploratory-a">3. Exploratory Data Analysis <a id="exploratory"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-global-mean-and-seasonal-mean-spread-of-all-era5-data">Create global mean and seasonal mean/spread of all ERA5 data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#find-mixed-phase-clouds">Find mixed-phase clouds</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-seasonal-mean-of-each-variable">Plot the seasonal mean of each variable</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-latitude-band-mean-of-variables">Calculate latitude band mean of variables</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#references-a-id-references-a">References <a id="references"></a></a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># export PYTHONPATH=&quot;${PYTHONPATH}:/uio/kant/geo-geofag-u1/franzihe/Documents/Python/globalsnow/CloudSat_ERA5_CMIP6_analysis/utils/&quot;</span>
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="example-with-era5-high-resolution-0-25deg-monthly-means">
<h1>Example with ERA5 high-resolution (~0.25deg) monthly means<a class="headerlink" href="#example-with-era5-high-resolution-0-25deg-monthly-means" title="Permalink to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="table-of-contents">
<h1>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this heading">#</a></h1>
<ul>
<li><a href="#introduction">1. Introduction</a></li>
<li><a href="#data_wrangling">2. Data Wrangling</a></li>
<li><a href="#exploratory">3. Exploratory Data Analysis</a></li>
<li><a href="#conclusion">4. Conclusion</a></li>
<li><a href="#references">5. References</a></li>
</ul></section>
<section class="tex2jax_ignore mathjax_ignore" id="introduction-a-id-introduction-a">
<h1>1. Introduction <a id='introduction'></a><a class="headerlink" href="#introduction-a-id-introduction-a" title="Permalink to this heading">#</a></h1>
<p>Cloud feedbacks are a major contributor to the spread of climate sensitivity in global climate models (GCMs) (<a class="reference external" href="https://doi-org.ezproxy.uio.no/10.1029/2019GL085782">Zelinka et al. (2020)</a>]). Among the most poorly understood cloud feedbacks is the one associated with the cloud phase, which is expected to be modified with climate change (<a class="reference external" href="https://doi-org.ezproxy.uio.no/10.1038/s41561-020-00649-1">Bjordal et al. (2020)</a>). Cloud phase bias, in addition, has significant implications for the simulation of radiative properties and glacier and ice sheet mass balances in climate models.</p>
<p>In this context, this work aims to expand our knowledge on how the representation of the cloud phase affects snow formation in GCMs. Better understanding this aspect is necessary to develop climate models further and improve future climate predictions.</p>
<ul class="simple">
<li><p>Load ERA5 data previously downloaded locally via <a class="reference external" href="https://github.com/franzihe/download_ERA5">Jupyter Notebook - download ERA5</a></p></li>
<li><p>find clouds: liquid-only, ice-only, mixed-phase</p></li>
<li><p>Regridd the ERA5 variables to the same horizontal resolution as high-resolution CMIP6 models with <a class="reference external" href="https://xesmf.readthedocs.io/en/latest/"><code class="docutils literal notranslate"><span class="pre">xesmf</span></code></a></p></li>
<li><p>Calculate and plot the seasonal mean of the variable</p></li>
</ul>
<p><strong>Questions</strong></p>
<ul class="simple">
<li><p>How is the cloud phase and snowfall varying between 1985 and 2014?</p></li>
</ul>
<blockquote>
<div><p><strong><em>NOTE:</em></strong> We answer questions related to the comparison of CMIP models to ERA5 in another <a class="reference internal" href="../CMIP6_ERA5_CloudSat/plt_seasonal_mean.html"><span class="doc std std-doc">Jupyter Notebook</span></a>.</p>
</div></blockquote>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-wrangling-a-id-data-wrangling-a">
<h1>2. Data Wrangling <a id='data_wrangling'></a><a class="headerlink" href="#data-wrangling-a-id-data-wrangling-a" title="Permalink to this heading">#</a></h1>
<p>This study will compare surface snowfall, ice, and liquid water content from the Coupled Model Intercomparison Project Phase 6 (<a class="reference external" href="https://esgf-node.llnl.gov/projects/cmip6/">CMIP6</a>) climate models (accessed through <a class="reference external" href="https://pangeo.io/">Pangeo</a>) to the European Centre for Medium-Range Weather Forecast Re-Analysis 5 (<a class="reference external" href="https://www.ecmwf.int/en/forecasts/datasets/reanalysis-datasets/era5">ERA5</a>) data from <strong>2007 to 2010</strong>. We conduct statistical analysis at the annual and seasonal timescales to determine the biases in cloud phase and precipitation (liquid and solid) in the CMIP6 models and their potential connection between them. The CMIP6 data analysis can be found in the <a class="reference internal" href="../cmip/CMIP6_hr_1985-2014.html"><span class="doc std std-doc">Jupyter Notebook for CMIP6</span></a>.</p>
<ul class="simple">
<li><p>Time period: 2007 to 2010</p></li>
<li><p>horizonal resolution: ~0.25deg</p></li>
<li><p>time resolution: daily atmospheric data</p></li>
<li><p>Variables:</p></li>
</ul>
<p><span style="color:red">some <em>!!! Update table! with variables for daily mean values</em> text</span>.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>shortname</p></th>
<th class="head text-center"><p>Long name</p></th>
<th class="head text-right"><p>Units</p></th>
<th class="head text-right"><p>levels</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>sf</p></td>
<td class="text-center"><p>snowfall</p></td>
<td class="text-right"><p>[m of water eq]</p></td>
<td class="text-right"><p>surface</p></td>
</tr>
<tr class="row-odd"><td><p>2t</p></td>
<td class="text-center"><p>2 metre temperature</p></td>
<td class="text-right"><p>[K]</p></td>
<td class="text-right"><p>surface</p></td>
</tr>
<tr class="row-even"><td><p>tclw</p></td>
<td class="text-center"><p>Total column cloud liquid water</p></td>
<td class="text-right"><p>[kg m-2]</p></td>
<td class="text-right"><p>single</p></td>
</tr>
<tr class="row-odd"><td><p>tcrw</p></td>
<td class="text-center"><p>Total column rain water</p></td>
<td class="text-right"><p>[kg m-2]</p></td>
<td class="text-right"><p>single</p></td>
</tr>
<tr class="row-even"><td><p>tciw</p></td>
<td class="text-center"><p>Total column cloud ice water</p></td>
<td class="text-right"><p>[kg m-2]</p></td>
<td class="text-right"><p>single</p></td>
</tr>
<tr class="row-odd"><td><p>tcsw</p></td>
<td class="text-center"><p>Total column snow water</p></td>
<td class="text-right"><p>[kg m-2]</p></td>
<td class="text-right"><p>single</p></td>
</tr>
</tbody>
</table>
<section id="organize-my-data">
<h2>Organize my data<a class="headerlink" href="#organize-my-data" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Define a prefix for my project (you may need to adjust it for your own usage on your infrastructure).</p>
<ul>
<li><p>input folder where all the data used as input to my Jupyter Notebook is stored (and eventually shared)</p></li>
<li><p>output folder where all the results to keep are stored</p></li>
<li><p>tool folder where all the tools</p></li>
</ul>
</li>
</ul>
<p>The ERA5 0.25deg data is located in the folder <code class="docutils literal notranslate"><span class="pre">/input/ERA5/daily_means/</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="n">hostname</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>

<span class="n">abs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>
<span class="n">WORKDIR</span> <span class="o">=</span> <span class="n">abs_path</span><span class="p">[:</span><span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">abs_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">abs_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>


<span class="k">if</span> <span class="s2">&quot;mimi&quot;</span> <span class="ow">in</span> <span class="n">hostname</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
    <span class="n">DATA_DIR</span> <span class="o">=</span> <span class="s2">&quot;/mn/vann/franzihe/&quot;</span>
    <span class="c1"># FIG_DIR = &quot;/uio/kant/geo-geofag-u1/franzihe/Documents/Figures/ERA5/&quot;</span>
    <span class="n">FIG_DIR</span> <span class="o">=</span> <span class="s2">&quot;/uio/kant/geo-geofag-u1/franzihe/Documents/Python/globalsnow/CloudSat_ERA5_CMIP6_analysis/Figures/ERA5/&quot;</span>
<span class="k">elif</span> <span class="s2">&quot;glefsekaldt&quot;</span> <span class="ow">in</span> <span class="n">hostname</span><span class="p">:</span> 
    <span class="n">DATA_DIR</span> <span class="o">=</span> <span class="s2">&quot;/home/franzihe/Data/&quot;</span>
    <span class="n">FIG_DIR</span> <span class="o">=</span> <span class="s2">&quot;/home/franzihe/Documents/Figures/ERA5/&quot;</span>

<span class="n">INPUT_DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">)</span>
<span class="n">OUTPUT_DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">)</span>
<span class="n">UTILS_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">WORKDIR</span><span class="p">,</span> <span class="s1">&#39;utils&#39;</span><span class="p">)</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">UTILS_DIR</span><span class="p">)</span>
<span class="c1"># make figure directory</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">FIG_DIR</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mimi.uio.no
</pre></div>
</div>
</div>
</div>
</section>
<section id="import-python-packages">
<h2>Import python packages<a class="headerlink" href="#import-python-packages" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Python</span></code> environment requirements: file <a class="reference download internal" download="" href="../_downloads/06f3f4f78bf14ffb9f9cfdf395203c3c/requirements_globalsnow.txt"><span class="xref download myst">requirements_globalsnow.txt</span></a></p></li>
<li><p>load <code class="docutils literal notranslate"><span class="pre">python</span></code> packages from <a class="reference download internal" download="" href="../_downloads/5eb7796ec8541cded4dcee2282ad687a/imports.py"><span class="xref download myst">imports.py</span></a></p></li>
<li><p>load <code class="docutils literal notranslate"><span class="pre">functions</span></code> from <a class="reference download internal" download="" href="../_downloads/3afa0d66b1ce4f3999c315ad3a2e691d/functions.py"><span class="xref download myst">functions.py</span></a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># supress warnings</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span> <span class="c1"># don&#39;t output warnings</span>

<span class="c1"># import packages</span>
<span class="kn">from</span> <span class="nn">imports</span> <span class="kn">import</span><span class="p">(</span><span class="n">xr</span><span class="p">,</span> <span class="n">intake</span><span class="p">,</span> <span class="n">ccrs</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">plt</span><span class="p">,</span> <span class="n">glob</span><span class="p">,</span> <span class="n">cm</span><span class="p">,</span> <span class="n">fct</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">da</span><span class="p">,</span> <span class="n">LogNorm</span><span class="p">,</span> <span class="n">pd</span><span class="p">)</span>
<span class="n">xr</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">display_style</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.core.options.set_options at 0x7fd6db632800&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># reload imports</span>
<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The autoreload extension is already loaded. To reload it, use:
  %reload_ext autoreload
</pre></div>
</div>
</div>
</div>
</section>
<section id="open-era5-variables">
<h2>Open ERA5 variables<a class="headerlink" href="#open-era5-variables" title="Permalink to this heading">#</a></h2>
<p>Get the data requried for the analysis. Beforehand we downloaded the monthly averaged data on single levels and pressure levels via the Climate Data Store (CDS) infrastructure. The github repository <a class="reference external" href="https://github.com/franzihe/download_ERA5">Download ERA5</a> gives examples on how to download the data from the CDS. We use the Jupyter Notebooks <a class="reference external" href="https://github.com/franzihe/download_ERA5/blob/main/download_Amon_single_level.ipynb">download_Amon_single_level</a> and <a class="reference external" href="https://github.com/franzihe/download_ERA5/blob/main/download_Amon_pressure_level.ipynb">download_Amon_pressure_level</a>. Both, download the monthly means for the variables mentioned above between 1985 and 2014.</p>
<blockquote>
<div><p><strong><em>NOTE:</em></strong> To download from CDS a user has to have a CDS user account, please create the account <a class="reference external" href="https://cds.climate.copernicus.eu/user/register">here</a>.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">era_in</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;ERA5/daily_means/&#39;</span><span class="p">)</span>
<span class="n">era_out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;ERA5/common_grid/&#39;</span><span class="p">)</span>
<span class="c1"># make output data directory</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">era_out</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># needed for regridding ERA5 data to CMIP6 grids</span>
<span class="n">cmip_in</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;cmip6_hist/single_model&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">variable_id</span><span class="o">=</span><span class="p">[</span>
            <span class="s1">&#39;sf&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;tclw&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tcrw&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tciw&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tcsw&#39;</span><span class="p">,</span>
            <span class="s1">&#39;2t&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;tp&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mtpr&#39;</span><span class="p">,</span>
            <span class="s1">&#39;msr&#39;</span>
             <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>At the moment we have downloaded 30 years (1985-2014) for ERA5. We define start and end year to ensure to only extract the 30-year period between 1985 and 2014.</p>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> Define a start and end year</p>
<p>We will load all available variables into one xarray dataset with <code class="docutils literal notranslate"><span class="pre">xarray.open_mfdataset(file)</span></code> and select the time range <a class="reference external" href="https://xarray.pydata.org/en/stable/user-guide/indexing.html">by name</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># rsync -av --progress login.nird.sigma2.no:/projects/NS9600K/data/ERA5/monthly_means/0.25deg /scratch/franzihe/input/ERA5/monthly_means</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">starty</span> <span class="o">=</span> <span class="mi">2007</span>
<span class="n">endy</span> <span class="o">=</span> <span class="mi">2010</span>
<span class="n">year_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>


<span class="c1"># Uncomment the line below if you want to search for files matching the pattern in the directory specified by `era_in`</span>
<span class="c1"># era_file_in = glob(f&#39;{era_in}/*_ERA5_*.nc&#39;)</span>
<span class="c1"># era_file_in = sorted(glob(f&#39;{era_in}/40NS/*_ERA5_*.nc&#39;))</span>
<span class="n">era_file_in</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">var_id</span> <span class="ow">in</span> <span class="n">variable_id</span><span class="p">:</span>
    <span class="n">era_file_in</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">era_in</span><span class="si">}</span><span class="s1">/40NS/</span><span class="si">{</span><span class="n">var_id</span><span class="si">}</span><span class="s1">*_ERA5_*.nc&#39;</span><span class="p">)))</span>

<span class="n">ds_era</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">era_file_in</span><span class="p">,</span> <span class="p">)</span>
<span class="c1"># Uncomment the line below if you want to rename the variable `t2m` to `2t`</span>
<span class="n">ds_era</span> <span class="o">=</span> <span class="n">ds_era</span><span class="o">.</span><span class="n">rename_vars</span><span class="p">({</span><span class="s1">&#39;t2m&#39;</span><span class="p">:</span> <span class="s1">&#39;2t&#39;</span><span class="p">})</span>

<span class="n">ds_era</span> <span class="o">=</span> <span class="n">ds_era</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">ds_era</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">year_range</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

<span class="n">ds_era</span> <span class="o">=</span> <span class="n">ds_era</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="p">(((</span><span class="n">ds_era</span><span class="o">.</span><span class="n">lon</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span><span class="p">))</span><span class="o">.</span><span class="n">sortby</span><span class="p">([</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_era</span><span class="o">.</span><span class="n">time</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;time&#x27; (time: 1461)&gt;
array([&#x27;2007-01-01T00:00:00.000000000&#x27;, &#x27;2007-01-02T00:00:00.000000000&#x27;,
       &#x27;2007-01-03T00:00:00.000000000&#x27;, ..., &#x27;2010-12-29T00:00:00.000000000&#x27;,
       &#x27;2010-12-30T00:00:00.000000000&#x27;, &#x27;2010-12-31T00:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)
Coordinates:
  * time         (time) datetime64[ns] 2007-01-01 2007-01-02 ... 2010-12-31
    realization  int64 0
Attributes:
    long_name:         time
    standard_name:     time
    axis:              T
    stored_direction:  increasing
    type:              double</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'time'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 1461</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-107a63e3-bccf-44e9-90aa-da09dd0f34f9' class='xr-array-in' type='checkbox' checked><label for='section-107a63e3-bccf-44e9-90aa-da09dd0f34f9' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>2007-01-01 2007-01-02 2007-01-03 ... 2010-12-29 2010-12-30 2010-12-31</span></div><div class='xr-array-data'><pre>array([&#x27;2007-01-01T00:00:00.000000000&#x27;, &#x27;2007-01-02T00:00:00.000000000&#x27;,
       &#x27;2007-01-03T00:00:00.000000000&#x27;, ..., &#x27;2010-12-29T00:00:00.000000000&#x27;,
       &#x27;2010-12-30T00:00:00.000000000&#x27;, &#x27;2010-12-31T00:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></div></li><li class='xr-section-item'><input id='section-6781c7c6-e141-4cfa-928c-494b57904e7e' class='xr-section-summary-in' type='checkbox'  checked><label for='section-6781c7c6-e141-4cfa-928c-494b57904e7e' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2007-01-01 ... 2010-12-31</div><input id='attrs-1d91df81-b856-489a-bd1d-68a4576ffe8c' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-1d91df81-b856-489a-bd1d-68a4576ffe8c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-12e0a732-efc1-44a8-b78b-38e3ac35f8d9' class='xr-var-data-in' type='checkbox'><label for='data-12e0a732-efc1-44a8-b78b-38e3ac35f8d9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>time</dd><dt><span>standard_name :</span></dt><dd>time</dd><dt><span>axis :</span></dt><dd>T</dd><dt><span>stored_direction :</span></dt><dd>increasing</dd><dt><span>type :</span></dt><dd>double</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;2007-01-01T00:00:00.000000000&#x27;, &#x27;2007-01-02T00:00:00.000000000&#x27;,
       &#x27;2007-01-03T00:00:00.000000000&#x27;, ..., &#x27;2010-12-29T00:00:00.000000000&#x27;,
       &#x27;2010-12-30T00:00:00.000000000&#x27;, &#x27;2010-12-31T00:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>realization</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-a2c23f5e-5418-4114-a5ad-68d0c9b09e12' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-a2c23f5e-5418-4114-a5ad-68d0c9b09e12' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ab65b1e1-e953-4c2a-9f14-d9728d1d63b1' class='xr-var-data-in' type='checkbox'><label for='data-ab65b1e1-e953-4c2a-9f14-d9728d1d63b1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>realization</dd><dt><span>units :</span></dt><dd>1</dd><dt><span>standard_name :</span></dt><dd>realization</dd><dt><span>stored_direction :</span></dt><dd>increasing</dd><dt><span>type :</span></dt><dd>integer</dd></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-2773608d-324a-4aad-8eb4-eeb0d12e2977' class='xr-section-summary-in' type='checkbox'  checked><label for='section-2773608d-324a-4aad-8eb4-eeb0d12e2977' class='xr-section-summary' >Attributes: <span>(5)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>time</dd><dt><span>standard_name :</span></dt><dd>time</dd><dt><span>axis :</span></dt><dd>T</dd><dt><span>stored_direction :</span></dt><dd>increasing</dd><dt><span>type :</span></dt><dd>double</dd></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># remove leap day</span>
<span class="n">ds_era</span> <span class="o">=</span> <span class="n">ds_era</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=~</span><span class="p">((</span><span class="n">ds_era</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_era</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="mi">29</span><span class="p">)))</span>

<span class="c1"># Remove the &#39;realization&#39; dimension</span>
<span class="n">ds_era</span> <span class="o">=</span> <span class="n">ds_era</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;realization&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;msr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;long_name&#39;: &#39;Mean snowfall rate&#39;,
 &#39;units&#39;: &#39;kg m-2 s-1&#39;,
 &#39;standard_name&#39;: &#39;snowfall_flux&#39;,
 &#39;comment&#39;: &#39;at surface; includes precipitation of all forms of water in the solid phase&#39;,
 &#39;type&#39;: &#39;real&#39;}
</pre></div>
</div>
</div>
</div>
</section>
<section id="change-attributes-matching-cmip6-data">
<h2>Change attributes matching CMIP6 data<a class="headerlink" href="#change-attributes-matching-cmip6-data" title="Permalink to this heading">#</a></h2>
<p>We will assign the attributes to the variables to make CMIP6 and ERA5 variables comperable.</p>
<p>The data <a class="reference external" href="https://cds.climate.copernicus.eu/cdsapp#!/software/app-c3s-daily-era5-statistics?tab=doc">documentation of daily means</a> gives information about the accumulations in daily means. Compute daily statistics in local time (via the Time zone widget) of variables from a number of hourly ERA5 reanalysis datasets. Before computing the daily statistics the ERA5 hourly data can be subsampled in time (using the Frequency widget) and space (using the Grid and Area widget). Further details can be found in the application <a class="reference external" href="https://cds.climate.copernicus.eu/cdsapp#!/software/app-c3s-daily-era5-statistics?tab=overview">Overview</a> and <a class="reference external" href="https://cds.climate.copernicus.eu/cdsapp#!/software/app-c3s-daily-era5-statistics?tab=doc">Documentation</a></p>
<ul class="simple">
<li><p><a class="reference external" href="https://apps.ecmwf.int/codes/grib/param-db?id=144"><code class="docutils literal notranslate"><span class="pre">sf</span></code></a> is in <strong>m</strong> <span class="math notranslate nohighlight">\(\rightarrow\)</span>  multiply by <strong>1000</strong> to get <strong>kg m-2</strong> or <strong>mm</strong>.</p></li>
<li><p><a class="reference external" href="https://apps.ecmwf.int/codes/grib/param-db?id=228"><code class="docutils literal notranslate"><span class="pre">tp</span></code></a> is in <strong>m</strong> <span class="math notranslate nohighlight">\(\rightarrow\)</span>  multiply by <strong>1000</strong> to get <strong>kg m-2</strong> or <strong>mm</strong>.</p></li>
<li><p><a class="reference external" href="https://apps.ecmwf.int/codes/grib/param-db?id=235031"><code class="docutils literal notranslate"><span class="pre">msr</span></code></a> is in <strong>kg m-2 s-1</strong> <span class="math notranslate nohighlight">\(\rightarrow\)</span> multiply by <strong>3600s</strong> to get <strong>kg m-2 h-1</strong>.</p></li>
<li><p><a class="reference external" href="https://apps.ecmwf.int/codes/grib/param-db?id=235055"><code class="docutils literal notranslate"><span class="pre">mtpr</span></code></a> is in <strong>kg m-2 s-1</strong> <span class="math notranslate nohighlight">\(\rightarrow\)</span> multiply by <strong>3600s</strong> to get <strong>kg m-2 h-1</strong>.</p></li>
<li><p><a class="reference external" href="https://apps.ecmwf.int/codes/grib/param-db?id=79"><code class="docutils literal notranslate"><span class="pre">tciw</span></code></a> and <a class="reference external" href="https://apps.ecmwf.int/codes/grib/param-db?id=78"><code class="docutils literal notranslate"><span class="pre">tclw</span></code></a> is in <strong>kg m-2</strong></p></li>
</ul>
<p><strong>msr:</strong> 	This parameter is the rate of snowfall at the Earth’s surface. It is the sum of large-scale and convective snowfall. Large-scale snowfall is generated by the cloud scheme in the ECMWF Integrated Forecasting System (IFS). The cloud scheme represents the formation and dissipation of clouds and large-scale precipitation due to changes in atmospheric quantities (such as pressure, temperature and moisture) predicted directly at spatial scales of the grid box or larger. Convective snowfall is generated by the convection scheme in the IFS, which represents convection at spatial scales smaller than the grid box. In the IFS, precipitation is comprised of rain and snow. This parameter is a mean over a particular time period (the processing period) which depends on the data extracted. For the reanalysis, the processing period is over the 1 hour ending at the validity date and time. For the ensemble members, ensemble mean and ensemble spread, the processing period is over the 3 hours ending at the validity date and time. It is the rate the snowfall would have if it were spread evenly over the grid box. 1 kg of water spread over 1 square metre of surface is 1 mm deep (neglecting the effects of temperature on the density of water), therefore the units are equivalent to mm (of liquid water) per second. Care should be taken when comparing model parameters with observations, because observations are often local to a particular point in space and time, rather than representing averages over a model grid box.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># In this optimized version, you define a dictionary conversion_factors that maps each variable ID (var_id) </span>
<span class="c1"># to its corresponding conversion factor and attributes. The code then iterates over the keys of the dataset </span>
<span class="c1"># ds_era and checks if the variable ID exists in the conversion_factors dictionary. If it does, it retrieves </span>
<span class="c1"># the conversion factor and attributes for that variable and performs the necessary operations.</span>

<span class="n">conversion_factors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;sf&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;factor&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2&#39;</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Total Snowfall per day&#39;</span><span class="p">}},</span>
    <span class="s1">&#39;tp&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;factor&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2&#39;</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Total Snowfall per day&#39;</span><span class="p">}},</span>
    <span class="s1">&#39;msr&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;factor&#39;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span> <span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2 h-1&#39;</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Mean snowfall rate&#39;</span><span class="p">}},</span>
    <span class="s1">&#39;mtpr&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;factor&#39;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span> <span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2 h-1&#39;</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Mean total precipitation rate&#39;</span><span class="p">}}</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">var_id</span> <span class="ow">in</span> <span class="n">ds_era</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">var_id</span> <span class="ow">in</span> <span class="n">conversion_factors</span><span class="p">:</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="n">conversion_factors</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;factor&#39;</span><span class="p">]</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">conversion_factors</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;attrs&#39;</span><span class="p">]</span>

        <span class="n">ds_era</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_era</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span>
        <span class="n">ds_era</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span>
        <span class="n">ds_era</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_era</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_era</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">var_id</span> <span class="ow">in</span> <span class="n">ds_era</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">var_id</span><span class="p">,</span> <span class="n">ds_era</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="specific-ice-and-snow-water-content">
<h2>Specific ice and snow water content<a class="headerlink" href="#specific-ice-and-snow-water-content" title="Permalink to this heading">#</a></h2>
<p>To get all all frozen particles in the column we have to add the variables <code class="docutils literal notranslate"><span class="pre">specific</span> <span class="pre">cloud</span> <span class="pre">ice</span> <span class="pre">content</span></code> and <code class="docutils literal notranslate"><span class="pre">specific</span> <span class="pre">snow</span> <span class="pre">water</span> <span class="pre">content</span></code>.</p>
<div class="math notranslate nohighlight">
\[\sum clic + cswc = cisc\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ds_era[&#39;cisc&#39;] = ds_era[&#39;clic&#39;] + ds_era[&#39;cswc&#39;]</span>
<span class="c1"># ds_era[&#39;cisc&#39;].attrs = {&#39;units&#39;: &#39;kg kg-1&#39;, &#39;long_name&#39;:&#39;Specific cloud ice and snow water content&#39;}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="total-column-cloud-ice-water-and-total-column-cloud-snow-water">
<h2>Total column cloud ice water and total column cloud snow water<a class="headerlink" href="#total-column-cloud-ice-water-and-total-column-cloud-snow-water" title="Permalink to this heading">#</a></h2>
<p>To get all all frozen particles in the column we have to add the variables <code class="docutils literal notranslate"><span class="pre">total_column_cloud_ice_water</span></code> and <code class="docutils literal notranslate"><span class="pre">	total_column_snow_water</span></code>.</p>
<div class="math notranslate nohighlight">
\[\sum tciw + tcsw = iwp\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;iwp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;tciw&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;tcsw&#39;</span><span class="p">]</span>
<span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;iwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2&#39;</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Daily average total ice water path&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="total-column-cloud-liquid-water-total-column-supercooled-liquid-water-total-column-rain-water">
<h2>Total column cloud liquid water, total column supercooled liquid water, total column rain water<a class="headerlink" href="#total-column-cloud-liquid-water-total-column-supercooled-liquid-water-total-column-rain-water" title="Permalink to this heading">#</a></h2>
<p>To get all all liquid particles in the column we have to add the variables <code class="docutils literal notranslate"><span class="pre">total_column_cloud_liquid_water</span></code>, <code class="docutils literal notranslate"><span class="pre">total_column_supercooled_liquid_water</span></code>, and <code class="docutils literal notranslate"><span class="pre">total_column_rain_water</span></code>.</p>
<div class="math notranslate nohighlight">
\[\sum tclw + tcslw + tcrw = lwp\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;tclw&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;tcrw&#39;</span><span class="p">]</span> 
<span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2&#39;</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Daily average total liquid water path&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;iwp&#39;</span><span class="p">]</span> <span class="o">+</span><span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span>
<span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2&#39;</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Daily average total water path&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="save-era5-file">
<h2>Save ERA5 file<a class="headerlink" href="#save-era5-file" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">starty</span> <span class="o">=</span> <span class="mi">2006</span><span class="p">;</span> <span class="n">endy</span> <span class="o">=</span> <span class="mi">2009</span>
<span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Rename variables and drop unused variables</span>
<span class="n">ds_era</span> <span class="o">=</span> <span class="n">ds_era</span><span class="o">.</span><span class="n">rename_vars</span><span class="p">({</span><span class="s1">&#39;msr&#39;</span><span class="p">:</span> <span class="s1">&#39;prsn&#39;</span><span class="p">,</span> <span class="s1">&#39;mtpr&#39;</span><span class="p">:</span> <span class="s1">&#39;pr&#39;</span><span class="p">,</span> <span class="s1">&#39;2t&#39;</span><span class="p">:</span> <span class="s1">&#39;tas&#39;</span><span class="p">})</span>
<span class="n">ds_era</span> <span class="o">=</span> <span class="n">ds_era</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">((</span><span class="s1">&#39;sf&#39;</span><span class="p">,</span> <span class="s1">&#39;tciw&#39;</span><span class="p">,</span> <span class="s1">&#39;tclw&#39;</span><span class="p">,</span> <span class="s1">&#39;tcrw&#39;</span><span class="p">,</span> <span class="s1">&#39;tcslw&#39;</span><span class="p">,</span> <span class="s1">&#39;tcsw&#39;</span><span class="p">,</span> <span class="s1">&#39;tcw&#39;</span><span class="p">,</span> <span class="s1">&#39;tp&#39;</span><span class="p">),</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="n">ds_era</span>
<span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;daily_mean_40NS_ERA5_</span><span class="si">{</span><span class="n">starty</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">01_</span><span class="si">{</span><span class="n">endy</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">12.nc&#39;</span>
<span class="c1"># filename = f&#39;daily_mean_40NS_ERA5_{starty+1}01_{endy+1}12.nc&#39;</span>

    
<span class="n">era_file_out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">era_in</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;40NS/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># era_file_out = os.path.join(era_in, filename)</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">era_file_out</span><span class="p">):</span>
    <span class="n">ds_era</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">era_file_out</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;file written: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">era_file_out</span><span class="p">))</span>
        <span class="c1">#     print(f&#39;{era_file_out} is downloaded&#39;)</span>
        <span class="c1">#     counter += 1</span>
        <span class="c1">#     print(f&#39;Have regridded in total: {counter} files&#39;)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">ds_era</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">era_file_out</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;file written: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">era_file_out</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="regrid-era5-data-to-common-cmip6-model-grid-a-id-regrid-hz-a">
<h2>Regrid ERA5 data to common CMIP6 model grid <a id='regrid_hz'></a><a class="headerlink" href="#regrid-era5-data-to-common-cmip6-model-grid-a-id-regrid-hz-a" title="Permalink to this heading">#</a></h2>
<p>We want to conduct statistical analysis at the annual and seasonal timescales to determine the biases in cloud phase and precipitation (liquid and solid) for the CMIP6 models in comparison to ERA5.</p>
<p>The ERA5 data has a nominal resolution of 0.25 deg and has to be regridded to the same horizontal resolution as the CMIP6 model. Hence we will make use of the python package <code class="docutils literal notranslate"><span class="pre">xesmf</span></code> and <a class="reference external" href="https://xesmf.readthedocs.io/en/latest/notebooks/Compare_algorithms.html#Decreasing-resolution">decreasing resolution</a>, <a class="reference external" href="https://xesmf.readthedocs.io/en/latest/notebooks/Masking.html?highlight=conservative#Limitations-and-warnings">Limitations and warnings</a>.</p>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> Define CMIP6 model as the reference grid <code class="docutils literal notranslate"><span class="pre">ds_out</span></code>.</p>
<p>Save all variables in one file and each variable to a <code class="docutils literal notranslate"><span class="pre">netcdf</span></code> datasets between 2007 an 2010, locally.</p>
<blockquote>
<div><p><strong><em>NOTE:</em></strong> This can take a while, so be patient</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">year_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># source_id</span>
<span class="n">list_models</span> <span class="o">=</span> <span class="p">[</span>
               <span class="s1">&#39;ERA5&#39;</span><span class="p">,</span>
               <span class="s1">&#39;MIROC6&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;CanESM5&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;AWI-ESM-1-1-LR&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;MPI-ESM1-2-LR&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;UKESM1-0-LL&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;HadGEM3-GC31-LL&#39;</span><span class="p">,</span>
               <span class="s1">&#39;CNRM-CM6-1&#39;</span><span class="p">,</span>
               <span class="s1">&#39;CNRM-ESM2-1&#39;</span><span class="p">,</span>
               <span class="s1">&#39;IPSL-CM6A-LR&#39;</span><span class="p">,</span>
               <span class="s1">&#39;IPSL-CM5A2-INCA&#39;</span>
            <span class="p">]</span>

<span class="c1">## experiment</span>
<span class="n">experiment_id</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;historical&#39;</span><span class="p">]</span>

<span class="c1">## time resolution</span>
<span class="n">t_res</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">,]</span>

<span class="n">variable_id</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;areacella&#39;</span><span class="p">,</span> <span class="s1">&#39;prsn&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Search corresponding data, select Northern and Southern Hemisphere, regrid ERA5 data to CMIP6 models resolution</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">list_models</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;ERA5&#39;</span><span class="p">:</span>
        <span class="n">era_in_grid</span> <span class="o">=</span> <span class="n">ds_era</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ERA5_daily_mean_</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">starty</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">01_</span><span class="si">{</span><span class="n">endy</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">12.nc&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;UKESM1-0-LL&#39;</span><span class="p">,</span> <span class="s1">&#39;HadGEM3-GC31-LL&#39;</span><span class="p">]:</span>
            <span class="n">cmip_file_in</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cmip_in</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">_day_</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">*&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmip_file_in</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cmip_in</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">variable_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_fx_*</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">*&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmip_file_in</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">ds_cmip</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">cmip_file_in</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">drop_variables</span><span class="o">=</span><span class="n">variable_id</span><span class="p">)</span>
            
        <span class="c1"># Shift longitude to be from -180 to 180</span>
        <span class="n">ds_cmip</span> <span class="o">=</span> <span class="n">ds_cmip</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="p">(((</span><span class="n">ds_cmip</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span><span class="p">))</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span>
            
        <span class="c1"># Regrid data</span>
        <span class="n">SH</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">regrid_data</span><span class="p">(</span><span class="n">ds_era</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">)),</span> <span class="n">ds_cmip</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">)))</span>
        <span class="n">NH</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">regrid_data</span><span class="p">(</span><span class="n">ds_era</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="mi">90</span><span class="p">)),</span> <span class="n">ds_cmip</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="mi">90</span><span class="p">)))</span>
            
        <span class="n">era_in_grid</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">SH</span><span class="p">,</span> <span class="n">NH</span><span class="p">],</span> <span class="s1">&#39;lat&#39;</span><span class="p">)</span>
            
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ERA5_daily_mean_</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">starty</span><span class="si">}</span><span class="s1">01_</span><span class="si">{</span><span class="n">endy</span><span class="si">}</span><span class="s1">12.nc&#39;</span>
    
    <span class="n">era_file_out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">era_out</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;40NS/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">era_file_out</span><span class="p">):</span>
        <span class="n">era_in_grid</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">era_file_out</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;file written: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">era_file_out</span><span class="p">))</span>
        <span class="c1">#     print(f&#39;{era_file_out} is downloaded&#39;)</span>
        <span class="c1">#     counter += 1</span>
        <span class="c1">#     print(f&#39;Have regridded in total: {counter} files&#39;)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">era_in_grid</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">era_file_out</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;file written: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">era_file_out</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="count-the-days-in-one-season-over-year-range">
<h2>Count the days in one season over year range<a class="headerlink" href="#count-the-days-in-one-season-over-year-range" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">is_season</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="n">lower_val</span><span class="p">,</span> <span class="n">upper_val</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">month</span> <span class="o">&gt;=</span> <span class="n">lower_val</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">month</span> <span class="o">&lt;=</span> <span class="n">upper_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">days_season</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ds_era</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">ds_era</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
                                   <span class="n">ds_era</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
                                   <span class="n">ds_era</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
                                   <span class="n">ds_era</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],],</span> 
                           <span class="n">dims</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;season&#39;</span><span class="p">},</span> 
                           <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;season&#39;</span><span class="p">:[</span><span class="s1">&#39;DJF&#39;</span><span class="p">,</span> <span class="s1">&#39;JJA&#39;</span><span class="p">,</span> <span class="s1">&#39;MAM&#39;</span><span class="p">,</span> <span class="s1">&#39;SON&#39;</span><span class="p">]})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_days</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">):</span>
    <span class="n">_days</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds_era</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="n">month</span><span class="p">,</span> <span class="n">month</span><span class="p">))</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
    <span class="c1"># print(month, )</span>
<span class="n">days_month</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_days</span><span class="p">),</span>
                          <span class="n">dims</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;month&#39;</span><span class="p">},</span> 
                          <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;month&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">)}</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="supercooled-liquid-water-fraction">
<h2>Supercooled liquid water fraction<a class="headerlink" href="#supercooled-liquid-water-fraction" title="Permalink to this heading">#</a></h2>
<div class="math notranslate nohighlight">
\[SLF = \frac{\text{cloud liquid water content}}{\text{cloud liquid water content} + \text{cloud ice water content}}\]</div>
</section>
<section id="statistics">
<h2>Statistics<a class="headerlink" href="#statistics" title="Permalink to this heading">#</a></h2>
<p>For variables:</p>
<ul class="simple">
<li><p>Snowfall [sf]</p></li>
<li><p>Total column cloud liquid, supercooled liqid, and rain water [tclslrw]</p></li>
<li><p>Total column cloud ice, snow water [iwp]</p></li>
<li><p>2m-Temperature [2t]</p></li>
</ul>
<ol class="arabic simple">
<li><p>Find where liquid water path is <span class="math notranslate nohighlight">\(\ge\)</span> 5 g m-2</p></li>
<li><p>Find where 2m-temperature <span class="math notranslate nohighlight">\(\le\)</span> 0 <span class="math notranslate nohighlight">\(^o\)</span> C</p></li>
</ol>
<p>(3. Find where snowfall is <span class="math notranslate nohighlight">\(\ge\)</span> 0.01mm h-1)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. find where liquid water &gt;= 0.005 kgm-2 or &gt;= threshold</span>
<span class="n">th_lcc</span> <span class="o">=</span> <span class="mf">0.005</span>
<span class="n">ds_era_lcc</span> <span class="o">=</span> <span class="n">ds_era</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">th_lcc</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="c1"># find where 2m-temperature &lt;= 0C or &lt;= threshold</span>
<span class="c1"># This should automatically assume that it is already only snow, but it could include supercooled </span>
<span class="c1"># rain in the case of total precipitation</span>
<span class="n">th_2t</span> <span class="o">=</span> <span class="mf">273.15</span>
<span class="n">ds_era_lcc_2t</span> <span class="o">=</span> <span class="n">ds_era_lcc</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_era</span><span class="p">[</span><span class="s1">&#39;2t&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">th_2t</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

<span class="c1"># amount of freezing rain</span>
<span class="n">ds_era_lcc_2t</span><span class="p">[</span><span class="s1">&#39;mfrr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds_era_lcc_2t</span><span class="p">[</span><span class="s1">&#39;mtpr&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ds_era_lcc_2t</span><span class="p">[</span><span class="s1">&#39;msr&#39;</span><span class="p">])</span>
<span class="n">ds_era_lcc_2t</span><span class="p">[</span><span class="s1">&#39;mfrr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2 h-1&#39;</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Mean freezing rain rate&#39;</span><span class="p">}</span>

<span class="c1"># # if we want a precip or snowfall threshold apply here</span>
<span class="c1"># # find where total precipitation &gt;0 kgm-2h-1 threshold in these liquid containg clouds</span>
<span class="c1"># # th_tp = 0.01</span>
<span class="c1"># # ds_era_lcc_2t = ds_era_lcc_2t.where(ds_era[&#39;mtpr&#39;]&gt;=th_tp, other=np.nan) </span>
<span class="c1"># # 2.1 find where snowfall &gt;= 0.24 mmday-1 or &gt;= threshold in these liquid containing clouds, but not temperature threshold</span>
<span class="c1"># # multiply by 24 to make it comparable to McIllhattan et al. As they use 0.01mmh-1 as lower threshold</span>
<span class="c1"># # applying snowfall days, based on threshold (th_sf). Gives days where snowfall above th_sf and counts days in season and </span>
<span class="c1"># # devides by season days</span>
<span class="c1"># th_sf = 0.01</span>
<span class="c1"># ds_era_lcc_2t_sf = ds_era_lcc_2t.where(ds_era[&#39;msr&#39;]&gt;=th_sf, other=np.nan) </span>
<span class="c1"># # th_days = (ds_era_lcc_2t_sf[&#39;twp&#39;].groupby(&#39;time.season&#39;).count(dim=&#39;time&#39;,keep_attrs=False))/days_season</span>


<span class="c1"># create dataset to use for calculating the precipitation efficency. For the precipitation efficency we want to remove th_frac </span>
<span class="c1"># days where liquid water content and temperature requirements are met. </span>
<span class="c1"># assign percent of snowfall days, required in a pixle, which should be included in the statistics</span>
<span class="n">th_frac</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">th_days_lcc_2t</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds_era_lcc_2t</span><span class="p">[</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span><span class="o">/</span><span class="n">days_season</span>

<span class="n">ds_era_lcc_2t_season</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ds_era_lcc_2t_season</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t_season</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_lcc_2t</span><span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">)</span>

<span class="c1"># for all the other statistics we want to remove th_frac days where liquid content, temperature, and snowfall requirements are met</span>
<span class="c1"># which also means we have to apply the threshold for the total precipitation</span>
<span class="c1"># find where total precipitation &gt;= 0.01 kg m-2 h-1 in LCCs with T2&lt;0C</span>
<span class="n">th_tp</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">ds_era_lcc_2t_sf</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_era_lcc_2t</span><span class="p">[</span><span class="s1">&#39;mtpr&#39;</span><span class="p">]</span> <span class="o">&gt;=</span><span class="n">th_tp</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="c1"># find where snowfall &gt;= 0.01 kg m-2 h-1 or &gt;= threshold in these liquid containing clouds. </span>
<span class="n">th_sf</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">ds_era_lcc_2t_sf</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t_sf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_era_lcc_2t_sf</span><span class="p">[</span><span class="s1">&#39;msr&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">th_sf</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="c1"># applying snowfall days, based on threshold (th_sf). Gives days where snowfall above th_sf and counts days in season and devides </span>
<span class="c1"># by season days</span>
<span class="n">th_days_sf</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds_era_lcc_2t_sf</span><span class="p">[</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span><span class="o">/</span><span class="n">days_season</span>
<span class="n">ds_era_lcc_2t_sf_season</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t_sf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ds_era_lcc_2t_sf_season</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t_season</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_sf</span><span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">)</span>
<span class="n">ds_era_lcc_2t_sf_season</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now create daily dataset based on seasonal supercooled liquid containing cloud days above th_sf, and th_frac</span>
<span class="n">_mam</span> <span class="o">=</span> <span class="p">((</span><span class="n">ds_era_lcc_2t</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">ds_era_lcc_2t</span><span class="p">[</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_lcc_2t</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="s1">&#39;MAM&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>
<span class="n">_jja</span> <span class="o">=</span> <span class="p">((</span><span class="n">ds_era_lcc_2t</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">ds_era_lcc_2t</span><span class="p">[</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_lcc_2t</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="s1">&#39;JJA&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>
<span class="n">_son</span> <span class="o">=</span> <span class="p">((</span><span class="n">ds_era_lcc_2t</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">ds_era_lcc_2t</span><span class="p">[</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">)))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_lcc_2t</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="s1">&#39;SON&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>
<span class="n">_djf</span> <span class="o">=</span> <span class="p">((</span><span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ds_era_lcc_2t</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">ds_era_lcc_2t</span><span class="p">[</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> 
                  <span class="n">ds_era_lcc_2t</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">ds_era_lcc_2t</span><span class="p">[</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_lcc_2t</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="s1">&#39;DJF&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>

<span class="n">ds_era_lcc_2t_days</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">objects</span><span class="o">=</span><span class="p">[</span><span class="n">_djf</span><span class="p">,</span> <span class="n">_jja</span><span class="p">,</span> <span class="n">_mam</span><span class="p">,</span> <span class="n">_son</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now create daily dataset based on seasonal supercooled liquid containing cloud days above th_sf, and th_frac</span>
<span class="n">_mam</span> <span class="o">=</span> <span class="p">((</span><span class="n">ds_era_lcc_2t_sf</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">ds_era_lcc_2t_sf</span><span class="p">[</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_sf</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="s1">&#39;MAM&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>
<span class="n">_jja</span> <span class="o">=</span> <span class="p">((</span><span class="n">ds_era_lcc_2t_sf</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">ds_era_lcc_2t_sf</span><span class="p">[</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_sf</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="s1">&#39;JJA&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>
<span class="n">_son</span> <span class="o">=</span> <span class="p">((</span><span class="n">ds_era_lcc_2t_sf</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">ds_era_lcc_2t_sf</span><span class="p">[</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">)))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_sf</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="s1">&#39;SON&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>
<span class="n">_djf</span> <span class="o">=</span> <span class="p">((</span><span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ds_era_lcc_2t_sf</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">ds_era_lcc_2t_sf</span><span class="p">[</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> 
                  <span class="n">ds_era_lcc_2t_sf</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">is_season</span><span class="p">(</span><span class="n">ds_era_lcc_2t_sf</span><span class="p">[</span><span class="s1">&#39;time.month&#39;</span><span class="p">],</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">th_days_sf</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="s1">&#39;DJF&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="n">th_frac</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>

<span class="n">ds_era_lcc_2t_sf_days</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">objects</span><span class="o">=</span><span class="p">[</span><span class="n">_djf</span><span class="p">,</span> <span class="n">_jja</span><span class="p">,</span> <span class="n">_mam</span><span class="p">,</span> <span class="n">_son</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># def find_precip_cloud(dset):</span>
<span class="c1">#     # 1. find where liquid_water &gt;=0.005 kgm-2</span>
<span class="c1">#     snowfall = dset[&#39;sf&#39;].where(dset[&#39;lwp&#39;]&gt;=0.005, other= np.nan)</span>
<span class="c1">#     liquid_water = dset[&#39;lwp&#39;].where(dset[&#39;lwp&#39;]&gt;=0.005, other= np.nan)</span>
<span class="c1">#     ice_water = dset[&#39;iwp&#39;].where(dset[&#39;lwp&#39;]&gt;=0.005, other= np.nan)</span>
<span class="c1">#     total_water = dset[&#39;twp&#39;].where(dset[&#39;lwp&#39;]&gt;=0.005, other= np.nan)</span>
<span class="c1">#     temperature = dset[&#39;2t&#39;].where(dset[&#39;lwp&#39;]&gt;=0.005, other= np.nan)</span>
    
<span class="c1">#     # 2. find where snowfall &gt; 0.01mm h-1</span>
<span class="c1">#     unit_snowfall = dset[&#39;sf&#39;]</span>
<span class="c1">#     snowfall = snowfall.where(unit_snowfall&gt;=0.01*24, other= np.nan) # multiply by 24 to make it comparable to McIllhattan et al. As they use 0.01mmh-1 as lower threshold</span>
<span class="c1">#     liquid_water = liquid_water.where(unit_snowfall&gt;=0.01*24, other= np.nan)</span>
<span class="c1">#     ice_water = ice_water.where(unit_snowfall&gt;=0.01*24, other= np.nan)</span>
<span class="c1">#     total_water = total_water.where(unit_snowfall&gt;=0.01*24, other= np.nan)</span>
<span class="c1">#     temperature = temperature.where(unit_snowfall&gt;=0.01*24, other= np.nan)</span>
        
<span class="c1">#     # # 3. find where 2m-temperature &lt;= 0C</span>
<span class="c1">#     snowfall = snowfall.where(dset[&#39;2t&#39;]&lt;=273.15, other= np.nan)</span>
<span class="c1">#     liquid_water = liquid_water.where(dset[&#39;2t&#39;]&lt;=273.15, other= np.nan)</span>
<span class="c1">#     ice_water = ice_water.where(dset[&#39;2t&#39;]&lt;=273.15, other= np.nan)</span>
<span class="c1">#     total_water = total_water.where(dset[&#39;2t&#39;]&lt;=273.15, other= np.nan)</span>
<span class="c1">#     temperature = temperature.where(dset[&#39;2t&#39;]&lt;=273.15, other= np.nan)</span>
        
<span class="c1">#     snowfall_count = snowfall.groupby(&#39;time.season&#39;).count(dim=&#39;time&#39;,keep_attrs=True)</span>
<span class="c1">#     # liquid_water_count = liquid_water.groupby(&#39;time.season&#39;).count(dim=&#39;time&#39;,keep_attrs=True)</span>
<span class="c1">#     # ice_water_count = ice_water.groupby(&#39;time.season&#39;).count(dim=&#39;time&#39;, keep_attrs=True)</span>
<span class="c1">#     # temperature_count = temperature.groupby(&#39;time.season&#39;).count(dim=&#39;time&#39;, keep_attrs=True)</span>
    
<span class="c1">#     return(snowfall_count, snowfall, ice_water, liquid_water, total_water)</span>


<span class="c1"># ds_era[&#39;lcc_count&#39;],ds_era[&#39;sf_lcc&#39;],ds_era[&#39;iwp_lcc&#39;],ds_era[&#39;lwp_lcc&#39;], ds_era[&#39;twp_lcc&#39;] = find_precip_cloud(ds_era)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="how-often-do-we-have-slc-with-thresholds-for-surface-snowfall-liquid-water-path-and-temperature">
<h2>How often do we have SLC with thresholds for surface snowfall, liquid water path, and temperature<a class="headerlink" href="#how-often-do-we-have-slc-with-thresholds-for-surface-snowfall-liquid-water-path-and-temperature" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create dataset with all cumm</span>
<span class="n">cumm</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># count the days per season when there was a LCC, and 2t&lt;=0C, and where 10% per season a lcc cloud existed when also the surface temp was below freezing</span>
<span class="n">cumm</span><span class="p">[</span><span class="s1">&#39;lcc_days&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds_era_lcc_2t_days</span><span class="p">[</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span><span class="o">/</span><span class="n">days_season</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">cumm</span><span class="p">[</span><span class="s1">&#39;lcc_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
      <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">cumm</span><span class="p">[</span><span class="s1">&#39;lcc_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
      <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">cumm</span><span class="p">[</span><span class="s1">&#39;lcc_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
      <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">cumm</span><span class="p">[</span><span class="s1">&#39;lcc_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;cum_lcc_days_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">fct</span><span class="o">.</span><span class="n">plt_seasonal_NH_SH</span><span class="p">((</span><span class="n">cumm</span><span class="p">[</span><span class="s1">&#39;lcc_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cumm</span><span class="p">[</span><span class="s1">&#39;lcc_days&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">cbar_label</span><span class="o">=</span><span class="s1">&#39;Frequency of liquid containing cloud days (%)&#39;</span><span class="p">,</span> <span class="n">plt_title</span><span class="o">=</span><span class="s1">&#39;ERA5 (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">),</span> <span class="n">extend</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cumm</span><span class="p">[</span><span class="s1">&#39;sf_days&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds_era_lcc_2t_sf_days</span><span class="p">[</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span><span class="o">/</span><span class="n">days_season</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">cumm</span><span class="p">[</span><span class="s1">&#39;sf_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
      <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">cumm</span><span class="p">[</span><span class="s1">&#39;sf_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
      <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">cumm</span><span class="p">[</span><span class="s1">&#39;sf_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
      <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">cumm</span><span class="p">[</span><span class="s1">&#39;sf_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;cum_sf_days_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">fct</span><span class="o">.</span><span class="n">plt_seasonal_NH_SH</span><span class="p">((</span><span class="n">cumm</span><span class="p">[</span><span class="s1">&#39;sf_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cumm</span><span class="p">[</span><span class="s1">&#39;sf_days&#39;</span><span class="p">]</span> <span class="o">&gt;</span><span class="mf">0.</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">cbar_label</span><span class="o">=</span><span class="s1">&#39;Frequency of snowfall days from LCCs (%)&#39;</span><span class="p">,</span> <span class="n">plt_title</span><span class="o">=</span><span class="s1">&#39;ERA5 (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">),</span> <span class="n">extend</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="liquid-containing-cloud-frequency">
<h2>Liquid containing cloud frequency<a class="headerlink" href="#liquid-containing-cloud-frequency" title="Permalink to this heading">#</a></h2>
<p>Relative frequency</p>
<div class="math notranslate nohighlight">
\[RF = \frac{f}{n} = \frac{\text{number of times the data occurred in an observation}}{\text{total frequency}}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratios</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># relative frequency of liquid containing clouds per season</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t_days</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># number of times a super cooled liquid water cloud occured when the liquid water path is larger than 5gm-2, and temperature below 0degC</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">ds_era_lcc</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>         <span class="c1"># frequency of liquid clouds (only LWP threshold applied) when lwp is larger than 5gm-2</span>

<span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">n</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
      <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
      <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
      <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fct</span><span class="o">.</span><span class="n">plt_seasonal_NH_SH</span><span class="p">((</span><span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_season&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;Liquid containing cloud frequency (%)&#39;</span><span class="p">,</span> <span class="n">plt_title</span><span class="o">=</span><span class="s1">&#39;ERA5 (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">),</span> <span class="n">extend</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_rf_lcc_wo_snow_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ERA5&#39;</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># relative frequency of liquid containing clouds per month</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t_days</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># number of times a super cooled liquid water cloud occured when the liquid water path is larger than 5gm-2, and temperature below 0degC</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">ds_era_lcc</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>         <span class="c1"># frequency of liquid clouds (only LWP threshold applied) when lwp is larger than 5gm-2</span>

<span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">n</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
      <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
      <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
      <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="masked-and-weighted-average">
<h2>Masked and weighted average<a class="headerlink" href="#masked-and-weighted-average" title="Permalink to this heading">#</a></h2>
<p>Make use of the <code class="docutils literal notranslate"><span class="pre">xarray</span></code> function <code class="docutils literal notranslate"><span class="pre">weighted</span></code>, but calculate the weights with the code above from Luke Gloege.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NH_mean</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
<span class="n">SH_mean</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>

<span class="n">NH_std</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
<span class="n">SH_std</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>

<span class="c1"># Grid cells have different area, so when we do the global average, they have to be weigted by the area of each grid cell.</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">area_grid</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="n">NH_mean</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
<span class="n">SH_mean</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>

<span class="n">NH_std</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
<span class="n">SH_std</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for year in np.unique(ds_era[&#39;time.year&#39;]):</span>
<span class="c1">#     # print(year)</span>
<span class="c1">#     f = ds_era_lcc_2t_days[&#39;lwp&#39;].sel(time=slice(str(year))).groupby(&#39;time.month&#39;).count(dim=&#39;time&#39;,keep_attrs=False)</span>
<span class="c1">#     n = ds_era_lcc[&#39;lwp&#39;].sel(time=slice(str(year))).groupby(&#39;time.month&#39;).count(dim=&#39;time&#39;,keep_attrs=False)</span>

<span class="c1">#     _ratio = f/n</span>
    
<span class="c1">#     NH_mean[&#39;lcc_wo_snow_month_&#39;+str(year)] = _ratio.sel(lat=slice(45,90)).weighted(weights).mean((&#39;lat&#39;, &#39;lon&#39;))</span>
<span class="c1">#     SH_mean[&#39;lcc_wo_snow_month_&#39;+str(year)] = _ratio.sel(lat=slice(-90,-45)).weighted(weights).mean((&#39;lat&#39;, &#39;lon&#39;))</span>
    
<span class="c1">#     NH_std[&#39;lcc_wo_snow_month_&#39;+str(year)] = _ratio.sel(lat=slice(45,90)).weighted(weights).std((&#39;lat&#39;, &#39;lon&#39;))</span>
<span class="c1">#     SH_std[&#39;lcc_wo_snow_month_&#39;+str(year)] = _ratio.sel(lat=slice(-90,-45)).weighted(weights).std((&#39;lat&#39;, &#39;lon&#39;))</span>
</pre></div>
</div>
</div>
</div>
<section id="annual-cycle-of-frequency-of-liquid-containing-clouds">
<h3>Annual cycle of frequency of liquid containing clouds<a class="headerlink" href="#annual-cycle-of-frequency-of-liquid-containing-clouds" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fct</span><span class="o">.</span><span class="n">plt_annual_cycle</span><span class="p">(</span><span class="n">NH_mean</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">],</span> <span class="n">SH_mean</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">],</span> <span class="n">NH_std</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">],</span> <span class="n">SH_std</span><span class="p">[</span><span class="s1">&#39;lcc_wo_snow_month&#39;</span><span class="p">],</span> <span class="s1">&#39;Liquid containing cloud frequency&#39;</span><span class="p">,</span><span class="s1">&#39;ERA5 (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">))</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_rf_lcc_wo_snow_annual_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ERA5&#39;</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="frequency-of-snowfall-from-lccs">
<h2>Frequency of snowfall from LCCs<a class="headerlink" href="#frequency-of-snowfall-from-lccs" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># relative frequency of snowing liquid containing clouds per season</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t_sf_days</span><span class="p">[</span><span class="s1">&#39;msr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># number of times a super cooled liquid water cloud occured when the liquid water path is larger than 5gm-2, and temperature below 0degC</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t_days</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">n</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
      <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
      <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
      <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="c1"># </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fct</span><span class="o">.</span><span class="n">plt_seasonal_NH_SH</span><span class="p">((</span><span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_season&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;Frequency of snowfall from LCCs (%)&#39;</span><span class="p">,</span> <span class="n">plt_title</span><span class="o">=</span><span class="s1">&#39;ERA5 (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">),</span> <span class="n">extend</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_rf_lcc_w_snow_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ERA5&#39;</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># relative frequency of liquid containing clouds per month</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t_sf_days</span><span class="p">[</span><span class="s1">&#39;msr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># number of times a super cooled liquid water cloud occured when the liquid water path is larger than 5gm-2, and temperature below 0degC</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t_days</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>         <span class="c1"># frequency of liquid clouds (only LWP threshold applied) when lwp is larger than 5gm-2</span>

<span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">n</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
      <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
      <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
      <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid cells have different area, so when we do the global average, they have to be weigted by the area of each grid cell.</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">area_grid</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="n">NH_mean</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
<span class="n">SH_mean</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>

<span class="n">NH_std</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
<span class="n">SH_std</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<section id="annual-cycle-of-frequency-of-snowfall-from-lccs">
<h3>Annual cycle of frequency of snowfall from LCCs<a class="headerlink" href="#annual-cycle-of-frequency-of-snowfall-from-lccs" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fct</span><span class="o">.</span><span class="n">plt_annual_cycle</span><span class="p">(</span><span class="n">NH_mean</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">],</span> <span class="n">SH_mean</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">],</span> <span class="n">NH_std</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">],</span> <span class="n">SH_std</span><span class="p">[</span><span class="s1">&#39;lcc_w_snow_month&#39;</span><span class="p">],</span> <span class="s1">&#39;Frequency of snowfall from LCCs&#39;</span><span class="p">,</span><span class="s1">&#39;ERA5 (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">))</span>
<span class="c1"># figname = &#39;{}_rf_lcc_wo_snow_annual_{}_{}.png&#39;.format(&#39;ERA5&#39;,starty, endy)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="relative-snowfall-efficency">
<h2>Relative snowfall efficency<a class="headerlink" href="#relative-snowfall-efficency" title="Permalink to this heading">#</a></h2>
<p>The precipitation efficiency of convection is a measure of how much of the water that condenses in a rising column of air reaches the surface as precipitation [3].</p>
<p>In our case, we calculate the snowfall efficency by deviding the mean surface snowfall rate (sf, with units kg m-2 h-1) with the column integrated total water path (TWP, with units kg m-2). This leaves us with units of h-1, which means we get a daily mean relative snowfall efficency per hour.</p>
<div class="math notranslate nohighlight">
\[\eta = \frac{sf}{TWP}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># snowfall efficency per season</span>
<span class="c1"># first averavge over time and then fraction remove weighting only for spatial average</span>

<span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_eff_season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t_season</span><span class="p">[</span><span class="s1">&#39;msr&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">ds_era_lcc_2t_season</span><span class="p">[</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span>
<span class="c1"># plt_seasonal_NH_SH(ds_era_lcc_2t_sf_season[&#39;msr&#39;]/ds_era_lcc_2t_sf_season[&#39;twp&#39;], np.arange(0,1, 0.1),&#39;&#39;,&#39;&#39;)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
      <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
      <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
      <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="n">fct</span><span class="o">.</span><span class="n">plt_seasonal_NH_SH</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_eff_season&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="s1">&#39;relative snowfall eff. (h$^{-1}$)&#39;</span><span class="p">,</span> <span class="s1">&#39;ERA5 (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">),</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
<span class="c1"># save precip efficency from mixed-phase clouds figure</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_sf_twp_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ERA5&#39;</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="annual-cycle-of-relative-snowfall-efficency">
<h3>Annual cycle of relative snowfall efficency<a class="headerlink" href="#annual-cycle-of-relative-snowfall-efficency" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># shouldn&#39;t it be the mean not the sum?</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t</span><span class="p">[</span><span class="s1">&#39;msr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t</span><span class="p">[</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">n</span>
<span class="n">NH_mean</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
<span class="n">SH_mean</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>

<span class="n">NH_std</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
<span class="n">SH_std</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
      <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
      <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
      <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="c1"># for year in np.unique(ds_era[&#39;time.year&#39;]):</span>
<span class="c1">#     # print(year)</span>
<span class="c1">#     f = ds_era_lcc_2t[&#39;msr&#39;].sel(time=slice(str(year))).groupby(&#39;time.month&#39;).sum(dim=&#39;time&#39;, skipna=True, keep_attrs=False)</span>
<span class="c1">#     n = ds_era_lcc_2t[&#39;twp&#39;].sel(time=slice(str(year))).groupby(&#39;time.month&#39;).sum(dim=&#39;time&#39;, skipna=True, keep_attrs=False)</span>

<span class="c1">#     _ratio = f/n</span>
    
<span class="c1">#     NH_mean[&#39;sf_eff_month_&#39;+str(year)] = _ratio.sel(lat=slice(45,90)).weighted(weights).mean((&#39;lat&#39;, &#39;lon&#39;))</span>
<span class="c1">#     SH_mean[&#39;sf_eff_month_&#39;+str(year)] = _ratio.sel(lat=slice(-90,-45)).weighted(weights).mean((&#39;lat&#39;, &#39;lon&#39;))</span>
    
<span class="c1">#     NH_std[&#39;sf_eff_month_&#39;+str(year)] = _ratio.sel(lat=slice(45,90)).weighted(weights).std((&#39;lat&#39;, &#39;lon&#39;))</span>
<span class="c1">#     SH_std[&#39;sf_eff_month_&#39;+str(year)] = _ratio.sel(lat=slice(-90,-45)).weighted(weights).std((&#39;lat&#39;, &#39;lon&#39;))</span>

<span class="n">fct</span><span class="o">.</span><span class="n">plt_annual_cycle</span><span class="p">(</span><span class="n">NH_mean</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">],</span> <span class="n">SH_mean</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">],</span> <span class="n">NH_std</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">],</span> <span class="n">SH_std</span><span class="p">[</span><span class="s1">&#39;sf_eff_month&#39;</span><span class="p">],</span> <span class="s1">&#39;relative snowfall eff. (h$^{-1}$)&#39;</span><span class="p">,</span> <span class="s1">&#39;ERA5 (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">))</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_sf_twp_annual_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ERA5&#39;</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="relative-precipitation-efficency">
<h2>Relative precipitation efficency<a class="headerlink" href="#relative-precipitation-efficency" title="Permalink to this heading">#</a></h2>
<p>Use of total precipitation, but where LWP <span class="math notranslate nohighlight">\(\ge\)</span> 0.005 gm-2, 2-meter temperature <span class="math notranslate nohighlight">\(\le\)</span> 273.15K.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># supercooled precipitation efficency per season</span>
<span class="c1"># first averavge over time and then fraction remove weighting only for spatial average</span>

<span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;tp_eff_season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t_season</span><span class="p">[</span><span class="s1">&#39;mtpr&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">ds_era_lcc_2t_season</span><span class="p">[</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span>
<span class="c1"># plt_seasonal_NH_SH(ds_era_lcc_2t_tp_season[&#39;msr&#39;]/ds_era_lcc_2t_tp_season[&#39;twp&#39;], np.arange(0,1, 0.1),&#39;&#39;,&#39;&#39;)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;tp_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
      <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;tp_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
      <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;tp_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
      <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;tp_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="c1"># Plot precipitation efficency</span>

<span class="n">fct</span><span class="o">.</span><span class="n">plt_seasonal_NH_SH</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;tp_eff_season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;tp_eff_season&#39;</span><span class="p">]</span> <span class="o">&gt;</span><span class="mf">0.</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="s1">&#39;relative supercooled precipitation eff. (h$^{-1}$)&#39;</span><span class="p">,</span> <span class="s1">&#39;ERA5 (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">),</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
<span class="c1"># save precip efficency from mixed-phase clouds figure</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_tp_twp_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ERA5&#39;</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="annual-cycle-of-relative-supercooled-precipitation-efficency">
<h3>Annual cycle of relative supercooled precipitation efficency<a class="headerlink" href="#annual-cycle-of-relative-supercooled-precipitation-efficency" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t</span><span class="p">[</span><span class="s1">&#39;mtpr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t</span><span class="p">[</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">n</span>
<span class="n">NH_mean</span><span class="p">[</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
<span class="n">SH_mean</span><span class="p">[</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>

<span class="n">NH_std</span><span class="p">[</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
<span class="n">SH_std</span><span class="p">[</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
      <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
      <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
      <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="c1"># for year in np.unique(ds_era[&#39;time.year&#39;]):</span>
<span class="c1">#     # print(year)</span>
<span class="c1">#     f = ds_era_lcc_2t[&#39;mtpr&#39;].sel(time=slice(str(year))).groupby(&#39;time.month&#39;).sum(dim=&#39;time&#39;, skipna=True, keep_attrs=False)</span>
<span class="c1">#     n = ds_era_lcc_2t[&#39;twp&#39;].sel(time=slice(str(year))).groupby(&#39;time.month&#39;).sum(dim=&#39;time&#39;, skipna=True, keep_attrs=False)</span>

<span class="c1">#     _ratio = f/n</span>
    
<span class="c1">#     NH_mean[&#39;tp_eff_month_&#39;+str(year)] = _ratio.sel(lat=slice(45,90)).weighted(weights).mean((&#39;lat&#39;, &#39;lon&#39;))</span>
<span class="c1">#     SH_mean[&#39;tp_eff_month_&#39;+str(year)] = _ratio.sel(lat=slice(-90,-45)).weighted(weights).mean((&#39;lat&#39;, &#39;lon&#39;))</span>
    
<span class="c1">#     NH_std[&#39;tp_eff_month_&#39;+str(year)] = _ratio.sel(lat=slice(45,90)).weighted(weights).std((&#39;lat&#39;, &#39;lon&#39;))</span>
<span class="c1">#     SH_std[&#39;tp_eff_month_&#39;+str(year)] = _ratio.sel(lat=slice(-90,-45)).weighted(weights).std((&#39;lat&#39;, &#39;lon&#39;))</span>

<span class="n">fct</span><span class="o">.</span><span class="n">plt_annual_cycle</span><span class="p">(</span><span class="n">NH_mean</span><span class="p">[</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">],</span> <span class="n">SH_mean</span><span class="p">[</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">],</span> <span class="n">NH_std</span><span class="p">[</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">],</span> <span class="n">SH_std</span><span class="p">[</span><span class="s1">&#39;tp_eff_month&#39;</span><span class="p">],</span> <span class="s1">&#39;relative supercooled precipitation eff. (h$^{-1}$)&#39;</span><span class="p">,</span> <span class="s1">&#39;ERA5 (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">))</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_tp_twp_annual_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ERA5&#39;</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="frequency-of-freezing-rain">
<h2>Frequency of freezing rain<a class="headerlink" href="#frequency-of-freezing-rain" title="Permalink to this heading">#</a></h2>
<p>Use of the thresholds.</p>
<div class="math notranslate nohighlight">
\[RF = \frac{\text{total precipitation}(T\le273.15; LWP\ge0.005gm^{-2}) - \text{snowfall}(T\le273.15; LWP\ge0.005gm^{-2})}{\text{total precipitation}(T\le273.15; LWP\ge0.005gm^{-2})}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># first count the days where we have freezing rain per season and relate to total precipitation days</span>
<span class="n">fr_d</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t_days</span><span class="p">[</span><span class="s1">&#39;mfrr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_era_lcc_2t_days</span><span class="p">[</span><span class="s1">&#39;mfrr&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">tp_d</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t_days</span><span class="p">[</span><span class="s1">&#39;mtpr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_era_lcc_2t_days</span><span class="p">[</span><span class="s1">&#39;mtpr&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;mfrr_mtpr_days&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fr_d</span><span class="o">/</span><span class="n">tp_d</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;mfrr_mtpr_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
      <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;mfrr_mtpr_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
      <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;mfrr_mtpr_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
      <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;mfrr_mtpr_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="n">fct</span><span class="o">.</span><span class="n">plt_seasonal_NH_SH</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;mfrr_mtpr_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;mfrr_mtpr_days&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;Freezing rain days (%)&#39;</span><span class="p">,</span> <span class="s1">&#39;ERA5 (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">),</span> <span class="n">extend</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_mfrr_mtpr_days_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ERA5&#39;</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># then bring the amount of freezing rain into relation to the total precipitation (How many percent is freezing rain in comparison to total precipitation)</span>
<span class="n">fr</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t_days</span><span class="p">[</span><span class="s1">&#39;mfrr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_era_lcc_2t_days</span><span class="p">[</span><span class="s1">&#39;mfrr&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">)</span>
<span class="n">tp</span> <span class="o">=</span> <span class="n">ds_era_lcc_2t_days</span><span class="p">[</span><span class="s1">&#39;mtpr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_era_lcc_2t_days</span><span class="p">[</span><span class="s1">&#39;mtpr&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">)</span>

<span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;mfrr_mtpr_frac&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">fr</span><span class="o">/</span><span class="n">tp</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;mfrr_mtpr_frac&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
      <span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;mfrr_mtpr_frac&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  
      <span class="s1">&#39;std:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;mfrr_mtpr_frac&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
      <span class="s1">&#39;mean:&#39;</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;mfrr_mtpr_frac&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="n">fct</span><span class="o">.</span><span class="n">plt_seasonal_NH_SH</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;mfrr_mtpr_frac&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="s1">&#39;mfrr_mtpr_frac&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;Freezing rain fraction (%)&#39;</span><span class="p">,</span> <span class="s1">&#39;ERA5 (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">),</span> <span class="n">extend</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_mfrr_mtpr_amount_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ERA5&#39;</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="way-to-average-the-globe">
<h1>Way to Average the Globe<a class="headerlink" href="#way-to-average-the-globe" title="Permalink to this heading">#</a></h1>
<p>Code and text taken from Luke Gloege at <a class="reference external" href="https://towardsdatascience.com/the-correct-way-to-average-the-globe-92ceecd172b7">https://towardsdatascience.com/the-correct-way-to-average-the-globe-92ceecd172b7</a></p>
<p>“The average. It’s a simple enough calculation: add up all your data points and divide by the total number points. Does this simple equation work if you are, for instance, calculating the global average temperature? Not quite. This post outlines how to calculate the global average of a gridded dataset with dimensions: <code class="docutils literal notranslate"><span class="pre">time</span></code>, <code class="docutils literal notranslate"><span class="pre">latitude</span></code>, and <code class="docutils literal notranslate"><span class="pre">longitude</span></code>. In other words, calculating the mean across <code class="docutils literal notranslate"><span class="pre">latitude</span></code> and <code class="docutils literal notranslate"><span class="pre">longitude</span></code> at each <code class="docutils literal notranslate"><span class="pre">time</span></code> step. I first explain why it is not appropriate to calculate the spatial mean of a variable using the classic formula, I then show why a weighted-mean is appropriate, and finally give an example using a publicly available dataset.</p>
<p><strong>The traditional mean</strong>
The equation below is what probably comes to mind when we think of the mean of a dataset, <code class="docutils literal notranslate"><span class="pre">X</span></code>. This is the traditional mean. In the equation, i represents each <code class="docutils literal notranslate"><span class="pre">latitude</span></code>, <code class="docutils literal notranslate"><span class="pre">longitude</span></code> coordinate pair and <code class="docutils literal notranslate"><span class="pre">N</span></code> is the total number pairs.</p>
<p><span class="math notranslate nohighlight">\(mean = \frac{\sum_{i=1}^N X_i}{N}\)</span></p>
<p>I also call this the “flat Earth mean,” it assumes no curvature to the planet and data at each latitude and longitude location is treated equally. Why is that important? Because a 1º x 1º grid box occupies less area as it moves from the tropics to the pole. What this means is data near the equator has more influence on the mean than the arctic because it occupies more area. This suggests we should weight each data point by the area it occupies.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">xarray</span></code> notation, this traditional or “flat Earth” mean can be calculated like this: <code class="docutils literal notranslate"><span class="pre">traditional_mean</span> <span class="pre">=</span> <span class="pre">ds['temperature'].mean(['latitude','longitude'])</span></code></p>
<p><strong>The weighted mean</strong></p>
<p>This is the general equation for a weighted mean:</p>
<p><span class="math notranslate nohighlight">\(\text{weighted mean} = \frac{\sum_{i=1}^N w_i X_i}{\sum_{i=1}^N w_i}\)</span></p>
<p>This is similar to the traditional mean, except each data point has a weight, <code class="docutils literal notranslate"><span class="pre">wi</span></code>, and the denominator is the sum of all the weights. The traditional mean is just a special case of the weighted mean where each weight is equal to 1.</p>
<p><strong>Calculating the global area</strong></p>
<p>In Earth science, the preferred way is to weight the data by area, where you weight each data point by the area of each grid cell. Before we calculate the area-weighted mean, we first need to know the area of each grid cell. If the grid cell area is not provided the code below will facilitate calculating an area grid.</p>
<p>The shape of the Earth is an oblate spheroid, which is like “squashed” sphere. The code below calculates the grid cell area for Earth, with the radius as a function of latitude from <a class="reference external" href="https://earth-info.nga.mil/GandG/publications/tr8350.2/tr8350.2-a/Chapter%203.pdf">World Geodetic System 1984</a>. A derivation of the equation is <a class="reference external" href="https://planetcalc.com/7721/">here</a>.</p>
<p><strong>Area weighted global mean</strong></p>
<p>Now that we know what a weighted mean is and how to calculate an area map, let’s put all of this information together and calculate the global average mean temperature anomaly using the code below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># area dataArray</span>
<span class="n">da_area</span> <span class="o">=</span> <span class="n">area_grid</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span>

<span class="c1"># total area</span>
<span class="n">total_area</span> <span class="o">=</span> <span class="n">da_area</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span>

<span class="c1"># temperature weighted by grid-cell area</span>
<span class="n">temp_weighted</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">da_area</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_area</span>

<span class="c1"># area-weighted mean temperature</span>
<span class="n">temp_weighted_mean</span> <span class="o">=</span> <span class="n">temp_weighted</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p><strong>Final thoughts</strong></p>
<p>Weighting your data when calculating geospatial means is not just important, it is required in or order to honestly display the average and not overstate a conclusion.</p>
<p>Here are a few things to be mindful of when calculating global averages:</p>
<ol class="arabic simple">
<li><p>Be mindful of the total area. If you are calculating global average temperature just on land, then you need to mask out the ocean in your area dataset and normalize the weights by the total land area.</p></li>
<li><p>If the dataset is spatially incomplete, sophisticated methods [2] are more appropriate.</p></li>
</ol>
<p>In summary, area-weighting is the correct and best way to calculate global averages if you have a spatially complete gridded dataset. However, advanced techniques are required if the gridded data contains gaps. Finally, an alternative approach is to cosine weight your data, i.e. weighting your data by the cosine of latitude. The concept is the same, instead of using grid cell area, you would use the <code class="docutils literal notranslate"><span class="pre">cos('latitude')</span></code> as your weight matrix.</p>
<p>Hopefully this post provides some helpful guidance when calculating global averages.</p>
<section id="calculating-bin-and-bin-sizes">
<h2>Calculating bin and bin sizes<a class="headerlink" href="#calculating-bin-and-bin-sizes" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://www.statisticshowto.com/choose-bin-sizes-statistics/">https://www.statisticshowto.com/choose-bin-sizes-statistics/</a></p>
<p>Useful to plot TWP vs. Snowfall (precipitation efficency)</p>
<ol class="arabic simple">
<li><p>Find the smallest and largest data point</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Python program to print the data</span>

<span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;twp_NH&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">ds_era_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_era_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">ds_era_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_era_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;NH&#39;</span><span class="p">],</span>
     <span class="s1">&#39;sf_NH&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">ds_era_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;msr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_era_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">ds_era_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;msr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_era_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;NH&#39;</span><span class="p">],</span>
     <span class="s1">&#39;twp_SH&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">ds_era_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_era_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&lt;=-</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">ds_era_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_era_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&lt;=-</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;SH&#39;</span><span class="p">],</span>
     <span class="s1">&#39;sf_SH&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">ds_era_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;msr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_era_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&gt;=-</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">ds_era_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;msr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_era_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&lt;=-</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;SH&#39;</span><span class="p">],</span>  
<span class="p">}</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&lt;8}</span><span class="s2"> </span><span class="si">{:&lt;10}</span><span class="s2"> </span><span class="si">{:&lt;10}</span><span class="s2"> </span><span class="si">{:&lt;10}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Var&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;Hemisphere&#39;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">lang</span><span class="p">,</span> <span class="n">perc</span><span class="p">,</span> <span class="n">change</span> <span class="o">=</span> <span class="n">v</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&lt;8}</span><span class="s2"> </span><span class="si">{:&lt;10.4f}</span><span class="s2"> </span><span class="si">{:&lt;10.4f}</span><span class="s2"> </span><span class="si">{:&lt;10}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">lang</span><span class="p">,</span> <span class="n">perc</span><span class="p">,</span> <span class="n">change</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="2">
<li><p>Smallest and/or largest numbers are not whole numbers <span class="math notranslate nohighlight">\(\rightarrow\)</span> Lower the minimum a little and raise the maximum a little</p></li>
</ol>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head text-center"><p>Min</p></th>
<th class="head text-center"><p>Max</p></th>
<th class="head text-center"><p>Diff</p></th>
<th class="head text-right"><p>Hemisphere</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>TWP</p></td>
<td class="text-center"><p>0.006</p></td>
<td class="text-center"><p>7.1</p></td>
<td class="text-center"><p>7.1</p></td>
<td class="text-right"><p>NH</p></td>
</tr>
<tr class="row-odd"><td><p>sf</p></td>
<td class="text-center"><p>0.01</p></td>
<td class="text-center"><p>6.5</p></td>
<td class="text-center"><p>6.5</p></td>
<td class="text-right"><p>NH</p></td>
</tr>
<tr class="row-even"><td><p>—-</p></td>
<td class="text-center"><p>——-</p></td>
<td class="text-center"><p>——-</p></td>
<td class="text-center"><p>——-</p></td>
<td class="text-right"><p>———</p></td>
</tr>
<tr class="row-odd"><td><p>TWP</p></td>
<td class="text-center"><p>0.006</p></td>
<td class="text-center"><p>4.7</p></td>
<td class="text-center"><p>4.7</p></td>
<td class="text-right"><p>NH</p></td>
</tr>
<tr class="row-even"><td><p>sf</p></td>
<td class="text-center"><p>0.01</p></td>
<td class="text-center"><p>4.3</p></td>
<td class="text-center"><p>4.3</p></td>
<td class="text-right"><p>NH</p></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><p>Decide how many bins you need</p></li>
</ol>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head text-center"><p>Min</p></th>
<th class="head text-center"><p>Max</p></th>
<th class="head text-center"><p>Diff</p></th>
<th class="head text-center"><p>Bins</p></th>
<th class="head text-right"><p>Hemisphere</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>TWP</p></td>
<td class="text-center"><p>0.006</p></td>
<td class="text-center"><p>7.1</p></td>
<td class="text-center"><p>7.1</p></td>
<td class="text-center"><p>80</p></td>
<td class="text-right"><p>NH</p></td>
</tr>
<tr class="row-odd"><td><p>sf</p></td>
<td class="text-center"><p>0.01</p></td>
<td class="text-center"><p>6.5</p></td>
<td class="text-center"><p>6.5</p></td>
<td class="text-center"><p>70</p></td>
<td class="text-right"><p>NH</p></td>
</tr>
<tr class="row-even"><td><p>—-</p></td>
<td class="text-center"><p>——-</p></td>
<td class="text-center"><p>——-</p></td>
<td class="text-center"><p>——-</p></td>
<td class="text-center"><p>——-</p></td>
<td class="text-right"><p>———</p></td>
</tr>
<tr class="row-odd"><td><p>TWP</p></td>
<td class="text-center"><p>0.006</p></td>
<td class="text-center"><p>4.7</p></td>
<td class="text-center"><p>4.7</p></td>
<td class="text-center"><p>50</p></td>
<td class="text-right"><p>NH</p></td>
</tr>
<tr class="row-even"><td><p>sf</p></td>
<td class="text-center"><p>0.01</p></td>
<td class="text-center"><p>4.3</p></td>
<td class="text-center"><p>4.3</p></td>
<td class="text-center"><p>50</p></td>
<td class="text-right"><p>NH</p></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="4">
<li><p>Divide your range (the numbers in your data set) by the bin size chosen in Step 3. E.g. numbers range from 0 to 50 <span class="math notranslate nohighlight">\(\rightarrow\)</span> choose 5 bins <span class="math notranslate nohighlight">\(\rightarrow\)</span> bin size is 50/5=10.</p></li>
</ol>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head text-center"><p>Min</p></th>
<th class="head text-center"><p>Max</p></th>
<th class="head text-center"><p>Diff</p></th>
<th class="head text-center"><p>Bins</p></th>
<th class="head text-center"><p>Bin size</p></th>
<th class="head text-right"><p>Hemisphere</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>TWP</p></td>
<td class="text-center"><p>0.005</p></td>
<td class="text-center"><p>7.1</p></td>
<td class="text-center"><p>7.1</p></td>
<td class="text-center"><p>80</p></td>
<td class="text-center"><p>8/80=0.1</p></td>
<td class="text-right"><p>NH</p></td>
</tr>
<tr class="row-odd"><td><p>sf</p></td>
<td class="text-center"><p>0.01</p></td>
<td class="text-center"><p>6.5</p></td>
<td class="text-center"><p>6.5</p></td>
<td class="text-center"><p>70</p></td>
<td class="text-center"><p>7/70=0.1</p></td>
<td class="text-right"><p>NH</p></td>
</tr>
<tr class="row-even"><td><p>—-</p></td>
<td class="text-center"><p>——-</p></td>
<td class="text-center"><p>——-</p></td>
<td class="text-center"><p>——-</p></td>
<td class="text-center"><p>——-</p></td>
<td class="text-center"><p>———</p></td>
<td class="text-right"><p>———</p></td>
</tr>
<tr class="row-odd"><td><p>TWP</p></td>
<td class="text-center"><p>0.006</p></td>
<td class="text-center"><p>4.7</p></td>
<td class="text-center"><p>4.7</p></td>
<td class="text-center"><p>50</p></td>
<td class="text-center"><p>5/50=0.1</p></td>
<td class="text-right"><p>NH</p></td>
</tr>
<tr class="row-even"><td><p>sf</p></td>
<td class="text-center"><p>0.01</p></td>
<td class="text-center"><p>105</p></td>
<td class="text-center"><p>4.3</p></td>
<td class="text-center"><p>50</p></td>
<td class="text-center"><p>5/50=0.1</p></td>
<td class="text-right"><p>NH</p></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="5">
<li><p>Create the bin boundaries, starting with the smallest number (Step 1, 2) and adding the bin size from Step 4. E.g. smallest number is 0, bin size = 10 <span class="math notranslate nohighlight">\(\rightarrow\)</span> boundaries 0, 10,20,…</p></li>
</ol>
</section>
<section id="snowfall-and-precipitation-efficency">
<h2>Snowfall and Precipitation efficency<a class="headerlink" href="#snowfall-and-precipitation-efficency" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plt_seasonal_2dhist_wp_sf</span><span class="p">(</span><span class="n">da_x</span><span class="p">,</span> <span class="n">da_y</span><span class="p">,</span> <span class="n">plt_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">):</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">axsm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">ncols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># cmap = cm.batlow</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">hawaii_r</span>
    <span class="c1"># levels = np.arange(0.1,65000,5000)</span>
    <span class="c1"># norm = BoundaryNorm(levels, ncolors=cmap.N, )</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">50000</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>


    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:</span><span class="mi">4</span><span class="p">],</span> <span class="n">da_x</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;.6&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
        <span class="n">x_value</span> <span class="o">=</span> <span class="n">da_x</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>        
        <span class="n">y_value</span> <span class="o">=</span> <span class="n">da_y</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>   
        <span class="n">Z</span><span class="p">,</span> <span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">x_value</span><span class="p">[(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_value</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_value</span><span class="p">))],</span>
                                        <span class="n">y_value</span><span class="p">[(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_value</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_value</span><span class="p">))],</span>
                                        <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">],</span> 
                                        <span class="nb">range</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">]])</span>
        
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span><span class="p">,</span> <span class="n">Z</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,)</span>
        <span class="c1"># cbar = f.colorbar(im, ax=ax,)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span><span class="sa">r</span><span class="s1">&#39;lat$\geq 45^\circ$N; season = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        
        <span class="n">_corr</span> <span class="o">=</span> <span class="n">_corr</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">da_x</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">)),</span> 
                                <span class="n">da_y</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">)))</span>
        <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="s1">&#39;Corr: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">_corr</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">)</span>
        
        <span class="c1">#find line of best fit</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x_value</span><span class="p">[(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_value</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_value</span><span class="p">))],</span> <span class="n">y_value</span><span class="p">[(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_value</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_value</span><span class="p">))],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1">#add line of best fit to plot</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_value</span><span class="p">[(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_value</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_value</span><span class="p">))],</span> <span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">x_value</span><span class="p">[(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_value</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_value</span><span class="p">))])</span><span class="o">+</span><span class="n">b</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;steelblue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1">#add fitted regression equation to plot</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="s1">&#39;y = &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; + </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

        
        
    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">4</span><span class="p">:],</span> <span class="n">da_x</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;.6&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
        <span class="n">x_value</span> <span class="o">=</span> <span class="n">da_x</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">y_value</span> <span class="o">=</span> <span class="n">da_y</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">Z</span><span class="p">,</span> <span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">x_value</span><span class="p">[(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_value</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_value</span><span class="p">))],</span>
                                        <span class="n">y_value</span><span class="p">[(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_value</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_value</span><span class="p">))],</span>
                                        <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">],</span> 
                                        <span class="nb">range</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">]])</span>
        
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span><span class="p">,</span> <span class="n">Z</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,)</span>
        <span class="c1"># cbar = f.colorbar(im, ax=ax, )</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span><span class="sa">r</span><span class="s1">&#39;lat$\leq-45^\circ$S; season = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="p">))</span>
            
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span><span class="n">da_x</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        
        
        <span class="n">_corr</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">da_x</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">45</span><span class="p">)),</span>
                        <span class="n">da_y</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">45</span><span class="p">)))</span>
        <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="s1">&#39;Corr: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">_corr</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">)</span>
        
        <span class="c1">#find line of best fit</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x_value</span><span class="p">[(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_value</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_value</span><span class="p">))],</span> <span class="n">y_value</span><span class="p">[(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_value</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_value</span><span class="p">))],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1">#add line of best fit to plot</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_value</span><span class="p">[(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_value</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_value</span><span class="p">))],</span> <span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">x_value</span><span class="p">[(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_value</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_value</span><span class="p">))])</span><span class="o">+</span><span class="n">b</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;steelblue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1">#add fitted regression equation to plot</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="s1">&#39;y = &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; + </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

        
    <span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">da_y</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]))</span>
    <span class="n">axsm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">da_y</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]))</span>


    <span class="n">cbaxes</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">1.0125</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">])</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbaxes</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">plt_title</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">);</span>
        
        
        
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># precip efficency from ice</span>
<span class="n">da_x</span> <span class="o">=</span> <span class="n">seasonal_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;iwp&#39;</span><span class="p">]</span>
<span class="n">da_y</span> <span class="o">=</span> <span class="n">seasonal_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;msr&#39;</span><span class="p">]</span>
<span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Ice Water Path&#39;</span>
<span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Snowfall&#39;</span>
<span class="n">plt_title</span> <span class="o">=</span> <span class="s1">&#39;ERA5 (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">) Seasonal ice snowfall efficency&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">)</span>

<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;2dhist_iwp_sf_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">plt_seasonal_2dhist_wp_sf</span><span class="p">(</span><span class="n">da_x</span><span class="p">,</span> <span class="n">da_y</span><span class="p">,</span> <span class="n">plt_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1">######################################</span>
<span class="c1"># precip efficency from liquid</span>
<span class="n">da_x</span> <span class="o">=</span> <span class="n">seasonal_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span>
<span class="n">da_y</span> <span class="o">=</span> <span class="n">seasonal_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;msr&#39;</span><span class="p">]</span>
<span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Liquid Water Path&#39;</span>
<span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Snowfall&#39;</span>
<span class="n">plt_title</span> <span class="o">=</span> <span class="s1">&#39;ERA5 (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">) Seasonal liquid snowfall efficency&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">)</span>

<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;2dhist_lwp_sf_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">plt_seasonal_2dhist_wp_sf</span><span class="p">(</span><span class="n">da_x</span><span class="p">,</span> <span class="n">da_y</span><span class="p">,</span> <span class="n">plt_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1">######################################</span>
<span class="c1"># precip efficency from mixed-phase clouds</span>
<span class="n">da_x</span> <span class="o">=</span> <span class="n">seasonal_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span>
<span class="n">da_y</span> <span class="o">=</span> <span class="n">seasonal_lcc_sf_2t</span><span class="p">[</span><span class="s1">&#39;msr&#39;</span><span class="p">]</span>
<span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Total Water Path&#39;</span>
<span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Snowfall&#39;</span>
<span class="n">plt_title</span> <span class="o">=</span> <span class="s1">&#39;ERA5 (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">) Seasonal total snowfall efficency&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">)</span>

<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;2dhist_lwp_iwp_sf_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">plt_seasonal_2dhist_wp_sf</span><span class="p">(</span><span class="n">da_x</span><span class="p">,</span> <span class="n">da_y</span><span class="p">,</span> <span class="n">plt_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># precip efficency from ice</span>
<span class="n">da_x</span> <span class="o">=</span> <span class="n">seasonal_lcc_2t</span><span class="p">[</span><span class="s1">&#39;iwp&#39;</span><span class="p">]</span>
<span class="n">da_y</span> <span class="o">=</span> <span class="n">seasonal_lcc_2t</span><span class="p">[</span><span class="s1">&#39;mtpr&#39;</span><span class="p">]</span>
<span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Ice Water Path&#39;</span>
<span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Snowfall&#39;</span>
<span class="n">plt_title</span> <span class="o">=</span> <span class="s1">&#39;ERA5 (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">) Seasonal ice precipitation efficency&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">)</span>

<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;2dhist_iwp_tp_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">plt_seasonal_2dhist_wp_sf</span><span class="p">(</span><span class="n">da_x</span><span class="p">,</span> <span class="n">da_y</span><span class="p">,</span> <span class="n">plt_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1">######################################</span>
<span class="c1"># precip efficency from liquid</span>
<span class="n">da_x</span> <span class="o">=</span> <span class="n">seasonal_lcc_2t</span><span class="p">[</span><span class="s1">&#39;lwp&#39;</span><span class="p">]</span>
<span class="n">da_y</span> <span class="o">=</span> <span class="n">seasonal_lcc_2t</span><span class="p">[</span><span class="s1">&#39;mtpr&#39;</span><span class="p">]</span>
<span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Liquid Water Path&#39;</span>
<span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Snowfall&#39;</span>
<span class="n">plt_title</span> <span class="o">=</span> <span class="s1">&#39;ERA5 (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">) Seasonal liquid precipitation efficency&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">)</span>

<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;2dhist_lwp_tp_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">plt_seasonal_2dhist_wp_sf</span><span class="p">(</span><span class="n">da_x</span><span class="p">,</span> <span class="n">da_y</span><span class="p">,</span> <span class="n">plt_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1">######################################</span>
<span class="c1"># precip efficency from mixed-phase clouds</span>
<span class="n">da_x</span> <span class="o">=</span> <span class="n">seasonal_lcc_2t</span><span class="p">[</span><span class="s1">&#39;twp&#39;</span><span class="p">]</span>
<span class="n">da_y</span> <span class="o">=</span> <span class="n">seasonal_lcc_2t</span><span class="p">[</span><span class="s1">&#39;mtpr&#39;</span><span class="p">]</span>
<span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Total Water Path&#39;</span>
<span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Snowfall&#39;</span>
<span class="n">plt_title</span> <span class="o">=</span> <span class="s1">&#39;ERA5 (</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">) Seasonal total precipitation efficency&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span><span class="n">endy</span><span class="p">)</span>

<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;2dhist_lwp_iwp_tp_season_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">plt_seasonal_2dhist_wp_sf</span><span class="p">(</span><span class="n">da_x</span><span class="p">,</span> <span class="n">da_y</span><span class="p">,</span> <span class="n">plt_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">+</span> <span class="n">figname</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Regrid data</span>
<span class="n">SH</span> <span class="o">=</span> <span class="n">ds_era</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">))</span>
<span class="n">NH</span> <span class="o">=</span> <span class="n">ds_era</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span>
    
<span class="n">era_con</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">SH</span><span class="p">,</span> <span class="n">NH</span><span class="p">],</span> <span class="s1">&#39;lat&#39;</span><span class="p">)</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;ERA5_daily_mean_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">01_</span><span class="si">{}</span><span class="s1">12.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ERA5&#39;</span><span class="p">,</span><span class="n">starty</span><span class="p">,</span> <span class="n">endy</span><span class="p">)</span>
<span class="n">era_file_out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">era_out</span><span class="p">,</span> <span class="s1">&#39;model_grid/&#39;</span> <span class="o">+</span><span class="n">filename</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">era_out</span><span class="p">,</span> <span class="s1">&#39;model_grid&#39;</span><span class="p">))</span>
<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">era_file_out</span><span class="p">)</span>
<span class="k">if</span> <span class="n">era_file_out</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is downloaded&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">era_file_out</span><span class="p">))</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Have regridded in total: </span><span class="si">{:}</span><span class="s1"> files&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)))</span> 
<span class="k">else</span><span class="p">:</span> <span class="c1"># Save to netcdf file</span>
    <span class="n">era_con</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">era_file_out</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;file written: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">era_file_out</span><span class="p">))</span>
    
</pre></div>
</div>
</div>
</div>
</section>
<section id="mask-atmopsheric-temperature">
<h2>Mask atmopsheric temperature<a class="headerlink" href="#mask-atmopsheric-temperature" title="Permalink to this heading">#</a></h2>
<p>During the process of finding the SLF50, SLF30, SLF70 we encountered the problem, that the atmospheric temperature is too cold with <span class="math notranslate nohighlight">\(T&lt;175K\)</span>. To avoid cold temperatures we will mask the atmospheric temperature values. For this we will try a few thresholds and see how it looks on a spatial map, if we are masking too many temperatures then we know that our threshold is too warm.</p>
<p>Test for:</p>
<ul class="simple">
<li><p>150K = -123.15 <span class="math notranslate nohighlight">\(^oC\)</span></p></li>
<li><p>175K = -98.15 <span class="math notranslate nohighlight">\(^oC\)</span></p></li>
<li><p>200K = -73.15 <span class="math notranslate nohighlight">\(^oC\)</span></p></li>
<li><p>210K = -63.15 <span class="math notranslate nohighlight">\(^oC\)</span></p></li>
<li><p>220K = -53.15 <span class="math notranslate nohighlight">\(^oC\)</span></p></li>
<li><p>230K = -43.15 <span class="math notranslate nohighlight">\(^oC\)</span></p></li>
</ul>
<p>We have different possibilities to mask the temperature:</p>
<ol class="arabic simple">
<li><p>Mask t, but all the other vertical variables still keep their values where t&lt;threshold</p></li>
<li><p>Mask t, and all other vertical variables where t&lt;threshold</p></li>
<li><p>Mask t, find the lowest pressure level and t, if t==NaN then take the atmospheric pressure, temperature from the layer above</p></li>
</ol>
<blockquote>
<div><p>use Method 1. for now</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># var_id = &#39;t&#39;</span>
<span class="c1"># temp = (150, 175, 200, 210, 220, 230)</span>
<span class="c1"># for t in temp:</span>
<span class="c1">#     ds_era[&#39;{}_{}&#39;.format(var_id, t)] = ds_era[var_id].where(ds_era[var_id] &gt;= t)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># counter = 0</span>

<span class="c1"># keys = &#39;ERA5&#39;</span>

<span class="c1"># # Regrid data</span>
<span class="c1"># era_in_1deg = fct.regrid_data(ds_era, ds_out)</span>


<span class="c1"># filename = &#39;{}_Amon_1deg_{}01_{}12.nc&#39;.format(keys,starty, endy)</span>
<span class="c1"># era_file_out = os.path.join(era_out, filename)</span>
<span class="c1"># files = glob(era_file_out)</span>
<span class="c1"># if era_file_out in files:</span>
<span class="c1"># #     print(&#39;{} is downloaded&#39;.format(era_file_out))</span>
<span class="c1"># #     counter += 1</span>
<span class="c1"># #     print(&#39;Have regridded in total: {:} files&#39;.format(str(counter))) </span>
<span class="c1"># # else: # Save to netcdf file</span>
<span class="c1">#     era_in_1deg.to_netcdf(era_file_out)</span>
<span class="c1">#     print(&#39;file written: {}&#39;.format(era_file_out))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for var_id in era_in_1deg.data_vars:</span>
<span class="c1">#     if var_id.find(&#39;occurence&#39;)==-1:</span>
<span class="c1">#         # select where data should be saved</span>
<span class="c1">#         filename = &#39;{}_{}_Amon_1deg_{}01_{}12.nc&#39;.format(var_id, keys,starty, endy)</span>
<span class="c1">#         era_file_out = os.path.join(era_out, filename)</span>
<span class="c1">#         files = glob(era_file_out)</span>
<span class="c1">#         if era_file_out in files:</span>
<span class="c1">#         #     print(&#39;{} is downloaded&#39;.format(era_file_out))</span>
<span class="c1">#         #     counter += 1</span>
<span class="c1">#         #     print(&#39;Have regridded in total: {:} files&#39;.format(str(counter))) </span>
<span class="c1">#         # else: # Save to netcdf file</span>
<span class="c1">#             era_in_1deg[var_id].to_netcdf(era_file_out)</span>
<span class="c1">#             print(&#39;file written: {}&#39;.format(era_file_out))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ERA5 data</span>
<span class="c1"># rsync -av --progress /scratch/franzihe/output/ERA5/monthly_means/1deg/ login.nird.sigma2.no:/projects/NS9600K/data/ERA5/monthly_means/1deg/</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="exploratory-data-analysis-a-id-exploratory-a">
<h1>3. Exploratory Data Analysis <a id='exploratory'></a><a class="headerlink" href="#exploratory-data-analysis-a-id-exploratory-a" title="Permalink to this heading">#</a></h1>
<section id="create-global-mean-and-seasonal-mean-spread-of-all-era5-data">
<h2>Create global mean and seasonal mean/spread of all ERA5 data<a class="headerlink" href="#create-global-mean-and-seasonal-mean-spread-of-all-era5-data" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # 0.25 deg resolution data</span>
<span class="c1"># season_mean_025deg = ds_era.copy()</span>
<span class="c1"># for var_id in ds_era.data_vars:</span>
<span class="c1">#     if var_id.find(&#39;occurence&#39;)==-1:</span>
<span class="c1">#         season_mean_025deg = fct.seasonal_mean_std(season_mean_025deg, var_id)</span>
<span class="c1"># season_mean_025deg = season_mean_025deg.drop_dims(&#39;time&#39;)</span>

<span class="c1"># # 1 deg resolution data</span>
<span class="c1"># season_mean_1deg = era_in_1deg.copy()</span>
<span class="c1"># for var_id in era_in_1deg.data_vars:</span>
<span class="c1">#     if var_id.find(&#39;occurence&#39;)==-1:</span>
<span class="c1">#         season_mean_1deg = fct.seasonal_mean_std(season_mean_1deg, var_id)</span>
<span class="c1"># season_mean_1deg = season_mean_1deg.drop_dims(&#39;time&#39;)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-mixed-phase-clouds">
<h2>Find mixed-phase clouds<a class="headerlink" href="#find-mixed-phase-clouds" title="Permalink to this heading">#</a></h2>
<p>Calculate the IWC/LWC statistics given by the values. Setting the value to 0.5 will find the level in the atmosphere where IWC and LWC are 50/50. Setting it to a value of 0.7 will find the level where IWC is 70% while LWC is 30%.</p>
<ol class="arabic simple">
<li><p>find the fraction of IWC to LWC
$<span class="math notranslate nohighlight">\(SLF = \frac{LWC}{IWC + LWC}\)</span><span class="math notranslate nohighlight">\( 
\)</span><span class="math notranslate nohighlight">\(SLF: \text{Super-cooled liquid water fraction}\)</span>$</p></li>
<li><p>find the nearest value to given IWC-fraction</p></li>
<li><p>find atmospheric pressure levels where IWC/LWC fraction occurs</p></li>
<li><p>find the index of the first atmospheric pressure level</p></li>
<li><p>use the index to select variables</p></li>
</ol>
<p>Create dictionary from the list of datasets we want to use for the IWC/LWC statistics</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SLF = {&#39;SLF50&#39;:0.5, &#39;SLF70&#39;:0.7, &#39;SLF30&#39;:0.5}</span>


<span class="c1"># # find IWC/LWC levels</span>
<span class="c1"># ds_era_025deg = fct.dataset_IWC_LWC_level(ds_era, SLF, &#39;clwc&#39;, &#39;cisc&#39;, keys)</span>

<span class="c1"># ds_era_1deg = fct.dataset_IWC_LWC_level(era_in_1deg, SLF, &#39;clwc&#39;, &#39;cisc&#39;, keys)</span>

<span class="c1"># season_mean_025deg = fct.dataset_IWC_LWC_level(season_mean_025deg, SLF, &#39;clwc_mean&#39;, &#39;cisc_mean&#39;, keys)</span>

<span class="c1"># season_mean_1deg = fct.dataset_IWC_LWC_level(season_mean_1deg, SLF, &#39;clwc_mean&#39;, &#39;cisc_mean&#39;, keys)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-the-seasonal-mean-of-each-variable">
<h2>Plot the seasonal mean of each variable<a class="headerlink" href="#plot-the-seasonal-mean-of-each-variable" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>for the original dataset</p></li>
<li><p>and where the IWC/LWC level were found</p>
<ul>
<li><p>for IWC/LWC 50/50</p></li>
<li><p>for IWC/LWC 70/30</p></li>
<li><p>for IWC/LWC 30/70</p></li>
</ul>
</li>
</ul>
<p>All plots are for ERA resolution at 1 deg.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># stat = &#39;ERA5_SLF50&#39;</span>
<span class="c1"># var_id = &#39;t&#39;</span>
<span class="c1"># extend = &#39;both&#39;</span>
<span class="c1"># title = &#39;{} {} ({} - {})&#39;.format(stat, var_id, starty, endy)</span>

<span class="c1"># variable = season_mean_025deg[var_id+&#39;_mean&#39;].sel(statistic=stat).sum(&#39;level&#39;, skipna=True, keep_attrs=True)</span>
            
<span class="c1"># global_mean = ds_era_025deg[var_id].sel(statistic=stat).sum(&#39;level&#39;, skipna=True, keep_attrs=True).mean((&#39;latitude&#39;, &#39;longitude&#39;),skipna=True, keep_attrs=True).groupby(&quot;time.season&quot;).mean(&quot;time&quot;, skipna=True, keep_attrs=True)</span>


<span class="c1"># fg = variable.plot(</span>
<span class="c1">#         col=&quot;season&quot;,</span>
<span class="c1">#         col_wrap=2,</span>
<span class="c1">#         transform=ccrs.PlateCarree(),  # remember to provide this!</span>
<span class="c1">#         subplot_kws={</span>
<span class="c1">#             &quot;projection&quot;: ccrs.PlateCarree()</span>
<span class="c1">#         },</span>
<span class="c1">#         cbar_kwargs={&quot;orientation&quot;: &quot;vertical&quot;, &quot;shrink&quot;: 0.8, &quot;aspect&quot;: 40},</span>
<span class="c1">#         cmap=cm.devon_r, </span>
<span class="c1">#         figsize=[10, 7],</span>
<span class="c1">#         robust=True,</span>
<span class="c1">#         extend=extend,</span>
<span class="c1">#         # add_colorbar=False,</span>
<span class="c1">#         # vmin=fct.plt_dict[var_id][fct.plt_dict[&#39;header&#39;].index(&#39;vmin&#39;)],</span>
<span class="c1">#         # vmax=fct.plt_dict[var_id][fct.plt_dict[&#39;header&#39;].index(&#39;vmax&#39;)],</span>
<span class="c1">#         # levels=fct.plt_dict[var_id][fct.plt_dict[&#39;header&#39;].index(&#39;levels&#39;)],</span>
<span class="c1">#     )</span>
<span class="c1"># for ax, i in zip(fg.axes.flat, variable.season.values):</span>
<span class="c1">#         ax.set_title(&#39;season: {}, global mean: {:.3f}&#39;.format(i, global_mean.sel(season=i).values))</span>
    

<span class="c1"># fg.map(lambda: plt.gca().coastlines())</span>
<span class="c1"># fg.fig.suptitle(title, fontsize=16, fontweight=&quot;bold&quot;)</span>
<span class="c1"># # fg.add_colorbar(fraction=0.05, pad=0.04)</span>

<span class="c1"># # fg.cbar.set_label(label=&#39;{}&#39;.format(fct.plt_dict[var_id][fct.plt_dict[&#39;header&#39;].index(&#39;label&#39;)], weight=&#39;bold&#39;))</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for t in temp:</span>
<span class="c1">#     var_id = &#39;t_{}&#39;.format(t)</span>
<span class="c1">#     title = &#39;{} {} ({} - {})&#39;.format(stat, var_id, starty, endy)</span>

<span class="c1">#     variable = season_mean_025deg[var_id+&#39;_mean&#39;].sel(statistic=stat).sum(&#39;level&#39;, skipna=True, keep_attrs=True)</span>
                
<span class="c1">#     global_mean = ds_era_025deg[var_id].sel(statistic=stat).sum(&#39;level&#39;, skipna=True, keep_attrs=True).mean((&#39;latitude&#39;, &#39;longitude&#39;),skipna=True, keep_attrs=True).groupby(&quot;time.season&quot;).mean(&quot;time&quot;, skipna=True, keep_attrs=True)</span>


<span class="c1">#     fg = variable.plot(</span>
<span class="c1">#             col=&quot;season&quot;,</span>
<span class="c1">#             col_wrap=2,</span>
<span class="c1">#             transform=ccrs.PlateCarree(),  # remember to provide this!</span>
<span class="c1">#             subplot_kws={</span>
<span class="c1">#                 &quot;projection&quot;: ccrs.PlateCarree()</span>
<span class="c1">#             },</span>
<span class="c1">#             cbar_kwargs={&quot;orientation&quot;: &quot;vertical&quot;, &quot;shrink&quot;: 0.8, &quot;aspect&quot;: 40},</span>
<span class="c1">#             cmap=cm.devon_r, </span>
<span class="c1">#             figsize=[10, 7],</span>
<span class="c1">#             robust=True,</span>
<span class="c1">#             extend=extend,</span>
<span class="c1">#             # add_colorbar=False,</span>
<span class="c1">#             # vmin=fct.plt_dict[&#39;t&#39;][fct.plt_dict[&#39;header&#39;].index(&#39;vmin&#39;)],</span>
<span class="c1">#             # vmax=fct.plt_dict[&#39;t&#39;][fct.plt_dict[&#39;header&#39;].index(&#39;vmax&#39;)],</span>
<span class="c1">#             # levels=fct.plt_dict[&#39;t&#39;][fct.plt_dict[&#39;header&#39;].index(&#39;levels&#39;)],</span>
<span class="c1">#         )</span>

<span class="c1">#     for ax, i in zip(fg.axes.flat, variable.season.values):</span>
<span class="c1">#         ax.set_title(&#39;season: {}, global mean: {:.3f}&#39;.format(i, global_mean.sel(season=i).values))</span>
    

<span class="c1">#     fg.map(lambda: plt.gca().coastlines())</span>
<span class="c1">#     fg.fig.suptitle(title, fontsize=16, fontweight=&quot;bold&quot;)</span>
<span class="c1">#     # fg.add_colorbar(fraction=0.05, pad=0.04)</span>

<span class="c1">#     # fg.cbar.set_label(label=&#39;{}&#39;.format(fct.plt_dict[&#39;t&#39;][fct.plt_dict[&#39;header&#39;].index(&#39;label&#39;)], weight=&#39;bold&#39;))</span>
        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># var_id = &#39;t&#39;</span>
<span class="c1"># for t in temp:</span>
<span class="c1">#     title = &#39;{} {}_{}-{} ({} - {})&#39;.format(stat, var_id, t, var_id, starty, endy)</span>
<span class="c1">#     _diff = season_mean_025deg[&#39;{}_{}_mean&#39;.format(var_id,t)].sel(statistic=stat).sum(&#39;level&#39;, skipna=True, keep_attrs=True) - season_mean_025deg[var_id+&#39;_mean&#39;].sel(statistic=stat).sum(&#39;level&#39;, skipna=True, keep_attrs=True)</span>
    
<span class="c1">#     fg = _diff.plot(col=&quot;season&quot;,</span>
<span class="c1">#                 col_wrap=2,</span>
<span class="c1">#                 transform=ccrs.PlateCarree(),  # remember to provide this!</span>
<span class="c1">#                 subplot_kws={</span>
<span class="c1">#                     &quot;projection&quot;: ccrs.PlateCarree()</span>
<span class="c1">#                 },</span>
<span class="c1">#                 cbar_kwargs={&quot;orientation&quot;: &quot;vertical&quot;, &quot;shrink&quot;: 0.8, &quot;aspect&quot;: 40},</span>
<span class="c1">#                 cmap=cm.bam, </span>
<span class="c1">#                 figsize=[10, 7],</span>
<span class="c1">#                 robust=True,</span>
<span class="c1">#                 extend=extend,</span>
<span class="c1">#                 vmin=-0.4,</span>
<span class="c1">#                 vmax=0.4,</span>
<span class="c1">#                 levels=20,</span>
<span class="c1">#                 )</span>

<span class="c1">#     fg.map(lambda: plt.gca().coastlines())</span>
<span class="c1">#     fg.fig.suptitle(title, fontsize=16, fontweight=&quot;bold&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for stat in season_mean_1deg.statistic.values:</span>
<span class="c1">#     for var_id in ds_era.data_vars:</span>
<span class="c1">#         if var_id == &#39;2t&#39; or var_id==&#39;t&#39; or var_id==&#39;pressure&#39;:</span>
<span class="c1">#             extend=&#39;both&#39;</span>
<span class="c1">#         else:</span>
<span class="c1">#             extend=&#39;max&#39;</span>
<span class="c1">#         if stat == &#39;ERA5&#39; and var_id.find(&#39;occurence&#39;)==-1 and (len(ds_era[var_id].dims))==3:</span>
<span class="c1">#             # print(stat, var_id)</span>
            
<span class="c1">#             variable = season_mean_1deg[var_id+&#39;_mean&#39;].sel(statistic=stat, level=1000)#.sum(&#39;level&#39;, skipna=True, keep_attrs=True)</span>
            
<span class="c1">#             global_mean = ds_era_1deg[var_id].sel(statistic=stat, level=1000).mean((&#39;lat&#39;, &#39;lon&#39;),skipna=True, keep_attrs=True).groupby(&quot;time.season&quot;).mean(&quot;time&quot;, skipna=True, keep_attrs=True)</span>
            


<span class="c1">#             title = &#39;{} MEAN ({} - {})&#39;.format(stat, starty, endy)</span>
<span class="c1">#             fct.plt_spatial_seasonal_mean(variable, global_mean, title, var_id,extend)</span>
            
<span class="c1">#             # save seasonal mean + std figure to png</span>
<span class="c1">#             figname = &#39;{}_{}_season_mean_1deg_{}_{}.png&#39;.format(var_id,stat, starty, endy)</span>
<span class="c1">#             plt.savefig(FIG_DIR + figname, format = &#39;png&#39;, bbox_inches = &#39;tight&#39;, transparent = False)</span>


<span class="c1">#         elif stat!= &#39;ERA5&#39; and var_id.find(&#39;occurence&#39;)==-1:</span>
<span class="c1">#             # print(stat, var_id)</span>
<span class="c1">#             variable = season_mean_1deg[var_id+&#39;_mean&#39;].sel(statistic=stat).sum(&#39;level&#39;, skipna=True, keep_attrs=True)</span>
            
<span class="c1">#             global_mean = ds_era_1deg[var_id].sel(statistic=stat).sum(&#39;level&#39;, skipna=True, keep_attrs=True).mean((&#39;lat&#39;, &#39;lon&#39;),skipna=True, keep_attrs=True).groupby(&quot;time.season&quot;).mean(&quot;time&quot;, skipna=True, keep_attrs=True)</span>
            


<span class="c1">#             title = &#39;{} MEAN ({} - {})&#39;.format(stat, starty, endy)</span>
<span class="c1">#             fct.plt_spatial_seasonal_mean(variable, global_mean, title, var_id, extend)</span>

<span class="c1">#             # save seasonal mean + std figure to png</span>
<span class="c1">#             figname = &#39;{}_{}_season_mean_1deg_{}_{}.png&#39;.format(var_id,stat, starty, endy)</span>
<span class="c1">#             plt.savefig(FIG_DIR + figname, format = &#39;png&#39;, bbox_inches = &#39;tight&#39;, transparent = False)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># lat_SH = (-90, -40); lat_NH = (40,90); step = 5</span>
<span class="c1"># iteration_SH = range(lat_SH[1], lat_SH[0], -step)</span>
<span class="c1"># iteration_NH = range(lat_NH[0], lat_NH[1], step)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># markers = [&#39;o&#39;, &#39;v&#39;, &#39;s&#39;]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for _lat in iteration_SH:</span>
<span class="c1">#     print(_lat-step, _lat, ds_era_1deg.sel(statistic=stat, lat=slice(_lat-step, _lat)).lat.values)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ds_dict = {}</span>
<span class="c1"># for _lat in iteration_NH:</span>
<span class="c1">#     # print(_lat, _lat+step, ds_era_025deg.sel(statistic=stat, latitude=slice(_lat+step, _lat)).latitude.values)</span>
<span class="c1">#     ds_dict[&#39;{}_{}&#39;.format(_lat, _lat+step)] = ds_era_025deg.sel(latitude = slice(_lat+step, _lat), ).mean((&#39;longitude&#39;, &#39;latitude&#39;, &#39;level&#39;), skipna=True, keep_attrs=True).groupby(&#39;time.season&#39;).mean(&#39;time&#39;, skipna=True, keep_attrs=True)</span>

<span class="c1"># for _lat in iteration_SH:</span>
<span class="c1">#     ds_dict[&#39;{}_{}&#39;.format(_lat, _lat-step)] = ds_era_025deg.sel(latitude = slice(_lat, _lat-step), ).mean((&#39;longitude&#39;, &#39;latitude&#39;, &#39;level&#39;), skipna=True, keep_attrs=True).groupby(&#39;time.season&#39;).mean(&#39;time&#39;, skipna=True, keep_attrs=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># _ds = list(ds_dict.values())</span>
<span class="c1"># _coord = list(ds_dict.keys())</span>
<span class="c1"># ds_lat = xr.concat(objs=_ds, dim=_coord, coords=&quot;all&quot;).rename({&#39;concat_dim&#39;:&#39;lat&#39;})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ds_lat.sel(statistic=&#39;ERA5_SLF50&#39;,season=&#39;DJF&#39;).plot.scatter(x=&#39;pressure&#39;, y=&#39;t&#39;,hue=&#39;lat&#39;,hue_style=&#39;discrete&#39;, add_guide=True, cmap=cm.hawaii)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># season =&#39;DJF&#39;</span>
<span class="c1"># ds_lat.sel(statistic=&#39;ERA5_SLF50&#39;).plot.scatter(col=&quot;season&quot;,col_wrap=2,</span>
<span class="c1">#                                                 x=&#39;pressure&#39;, y=&#39;t&#39;, </span>
<span class="c1">#                                                 #size=[10, 7],</span>
<span class="c1">#                                                 cmap=cm.hawaii,)</span>
<span class="c1"># # ,lat=&#39;{}_{}&#39;.format(_lat, _lat-step) label=&#39;[{} : {})&#39;.format(_lat-step, _lat)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fig, axsm = plt.subplots(2,2, figsize=[10,7],sharex=True, sharey=True)</span>
<span class="c1"># axs = axsm.flatten()</span>
<span class="c1"># for ax, season in zip(axs, season_mean_1deg.season.values):</span>

<span class="c1">#     for _lat, c in zip(iteration_SH, cm.hawaii(range(0, 256, int(256/len(iteration_SH))))):</span>

<span class="c1">#         _season=ds_era_1deg.sum(&#39;level&#39;, skipna=True, keep_attrs=True).sel(lat = slice(_lat-step, _lat)).mean((&#39;lon&#39;, &#39;lat&#39;), skipna=True, keep_attrs=True).groupby(&#39;time.season&#39;).mean(&#39;time&#39;, skipna=True, keep_attrs=True)</span>
<span class="c1">#         _month=ds_era_1deg.sum(&#39;level&#39;, skipna=True, keep_attrs=True).sel(lat = slice(_lat-step, _lat)).mean((&#39;lon&#39;, &#39;lat&#39;), skipna=True, keep_attrs=True).groupby(&#39;time.month&#39;).mean(&#39;time&#39;, skipna=True, keep_attrs=True)</span>
       
<span class="c1">#         _season.sel(statistic=stat, season=season).plot.scatter(ax=ax, x=&#39;pressure&#39;, y=&#39;t&#39;, label=&#39;[{} : {})&#39;.format(_lat-step, _lat), color=c, marker=&#39;p&#39;)</span>
<span class="c1">#         # if season ==&#39;DJF&#39;:</span>
<span class="c1">#         #     for month, marker in zip(_month.sel(statistic=stat).month.values[11:], markers):</span>
<span class="c1">#         #         _month.sel(statistic=stat, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#         #                                                                   x=&#39;pressure&#39;, y=&#39;t&#39;,</span>
<span class="c1">#         #                                                                   label=&#39;[{} : {})&#39;.format(_lat-step, _lat),</span>
<span class="c1">#         #                                                                   color=c, marker=marker)</span>
<span class="c1">#         #     for month, marker in zip(_month.sel(statistic=stat).month.values[:2], markers[1:]):</span>
<span class="c1">#         #         _month.sel(statistic=stat, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#         #                                                                  x=&#39;pressure&#39;, y=&#39;t&#39;,</span>
<span class="c1">#         #                                                                  label=&#39;[{} : {})&#39;.format(_lat-step, _lat),</span>
<span class="c1">#         #                                                                  color=c, marker=marker)</span>
        
<span class="c1">#         # if season==&#39;MAM&#39;:</span>
<span class="c1">#         #     for month, marker in zip(_month.sel(statistic=stat).month.values[2:5], markers):</span>
<span class="c1">#         #         _month.sel(statistic=stat, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#         #                                                                  x=&#39;pressure&#39;, y=&#39;t&#39;,</span>
<span class="c1">#         #                                                                  label=&#39;[{} : {})&#39;.format(_lat-step, _lat),</span>
<span class="c1">#         #                                                                  color=c, marker=marker)</span>
        
<span class="c1">#         # if season==&#39;JJA&#39;:</span>
<span class="c1">#         #     for month, marker in zip(_month.sel(statistic=stat).month.values[5:8], markers):</span>
<span class="c1">#         #         _month.sel(statistic=stat, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#         #                                                                   x=&#39;pressure&#39;, y=&#39;t&#39;,</span>
<span class="c1">#         #                                                                   label=&#39;[{} : {})&#39;.format(_lat-step, _lat),</span>
<span class="c1">#         #                                                                   color=c, marker=marker)</span>

<span class="c1">#         # if season==&#39;SON&#39;:</span>
<span class="c1">#         #     for month, marker in zip(_month.sel(statistic=stat).month.values[8:11], markers):</span>
<span class="c1">#         #         _month.sel(statistic=stat, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#         #                                                                  x=&#39;pressure&#39;, y=&#39;t&#39;,</span>
<span class="c1">#         #                                                                  label=&#39;[{} : {})&#39;.format(_lat-step, _lat),</span>
<span class="c1">#         #                                                                  color=c, marker=marker)</span>


<span class="c1"># axs[1].legend(loc=&#39;upper left&#39;, bbox_to_anchor=(1, 1), fontsize=&quot;small&quot;, fancybox=True,)</span>
<span class="c1"># plt.grid()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fig, axsm = plt.subplots(2,2, figsize=[10,7],sharex=True, sharey=True)</span>
<span class="c1"># axs = axsm.flatten()</span>
<span class="c1"># for ax, season in zip(axs, season_mean_1deg.season.values):</span>

<span class="c1">#     for _lat, c in zip(iteration_SH, cm.hawaii(range(0, 256, int(256/len(iteration_SH))))):</span>

<span class="c1">#         _season=ds_era_1deg.sum(&#39;level&#39;).sel(lat = slice(_lat-step, _lat)).mean((&#39;lon&#39;, &#39;lat&#39;), skipna=True, keep_attrs=True).groupby(&#39;time.season&#39;).mean(&#39;time&#39;, skipna=True, keep_attrs=True)</span>
<span class="c1">#         _month=ds_era_1deg.sum(&#39;level&#39;).sel(lat = slice(_lat-step, _lat)).mean((&#39;lon&#39;, &#39;lat&#39;), skipna=True, keep_attrs=True).groupby(&#39;time.month&#39;).mean(&#39;time&#39;, skipna=True, keep_attrs=True)</span>
       
<span class="c1">#         _season.sel(statistic=stat, season=season).plot.scatter(ax=ax, x=&#39;pressure&#39;, y=&#39;t_220&#39;, label=&#39;[{} : {})&#39;.format(_lat-step, _lat), color=c, marker=&#39;p&#39;)</span>
<span class="c1">#         # if season ==&#39;DJF&#39;:</span>
<span class="c1">#         #     for month, marker in zip(_month.sel(statistic=stat).month.values[11:], markers):</span>
<span class="c1">#         #         _month.sel(statistic=stat, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#         #                                                                   x=&#39;pressure&#39;, y=&#39;t&#39;,</span>
<span class="c1">#         #                                                                   label=&#39;[{} : {})&#39;.format(_lat-step, _lat),</span>
<span class="c1">#         #                                                                   color=c, marker=marker)</span>
<span class="c1">#         #     for month, marker in zip(_month.sel(statistic=stat).month.values[:2], markers[1:]):</span>
<span class="c1">#         #         _month.sel(statistic=stat, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#         #                                                                  x=&#39;pressure&#39;, y=&#39;t&#39;,</span>
<span class="c1">#         #                                                                  label=&#39;[{} : {})&#39;.format(_lat-step, _lat),</span>
<span class="c1">#         #                                                                  color=c, marker=marker)</span>
        
<span class="c1">#         # if season==&#39;MAM&#39;:</span>
<span class="c1">#         #     for month, marker in zip(_month.sel(statistic=stat).month.values[2:5], markers):</span>
<span class="c1">#         #         _month.sel(statistic=stat, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#         #                                                                  x=&#39;pressure&#39;, y=&#39;t&#39;,</span>
<span class="c1">#         #                                                                  label=&#39;[{} : {})&#39;.format(_lat-step, _lat),</span>
<span class="c1">#         #                                                                  color=c, marker=marker)</span>
        
<span class="c1">#         # if season==&#39;JJA&#39;:</span>
<span class="c1">#         #     for month, marker in zip(_month.sel(statistic=stat).month.values[5:8], markers):</span>
<span class="c1">#         #         _month.sel(statistic=stat, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#         #                                                                   x=&#39;pressure&#39;, y=&#39;t&#39;,</span>
<span class="c1">#         #                                                                   label=&#39;[{} : {})&#39;.format(_lat-step, _lat),</span>
<span class="c1">#         #                                                                   color=c, marker=marker)</span>

<span class="c1">#         # if season==&#39;SON&#39;:</span>
<span class="c1">#         #     for month, marker in zip(_month.sel(statistic=stat).month.values[8:11], markers):</span>
<span class="c1">#         #         _month.sel(statistic=stat, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#         #                                                                  x=&#39;pressure&#39;, y=&#39;t&#39;,</span>
<span class="c1">#         #                                                                  label=&#39;[{} : {})&#39;.format(_lat-step, _lat),</span>
<span class="c1">#         #                                                                  color=c, marker=marker)</span>


<span class="c1"># axs[1].legend(loc=&#39;upper left&#39;, bbox_to_anchor=(1, 1), fontsize=&quot;small&quot;, fancybox=True,)</span>
<span class="c1"># plt.grid()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for _lat in iteration_NH:</span>
<span class="c1">#     print(_lat, _lat+step, ds_era_1deg.sel(statistic=&#39;ERA5_50&#39;, lat=slice(_lat, _lat+step)).lat.values)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fig, axsm = plt.subplots(2,2, figsize=[10,7],sharex=True, sharey=True)</span>
<span class="c1"># axs = axsm.flatten()</span>
<span class="c1"># for ax, season in zip(axs, season_mean_1deg.season.values):</span>

<span class="c1">#     for _lat, c in zip(iteration_NH, cm.hawaii(range(0, 256, int(256/len(iteration_NH))))):</span>

<span class="c1">#         _season=ds_era_1deg.sum(&#39;level&#39;).sel(lat = slice(_lat, _lat+step)).mean((&#39;lon&#39;, &#39;lat&#39;), skipna=True, keep_attrs=True).groupby(&#39;time.season&#39;).mean(&#39;time&#39;, skipna=True, keep_attrs=True)</span>
<span class="c1">#         _month=ds_era_1deg.sum(&#39;level&#39;).sel(lat = slice(_lat, _lat+step)).mean((&#39;lon&#39;, &#39;lat&#39;), skipna=True, keep_attrs=True).groupby(&#39;time.month&#39;).mean(&#39;time&#39;, skipna=True, keep_attrs=True)</span>
       
<span class="c1">#         _season.sel(statistic=&#39;ERA5_50&#39;, season=season).plot.scatter(ax=ax, x=&#39;t&#39;, y=&#39;clic&#39;, label=&#39;[{} : {})&#39;.format(_lat, _lat+step), color=c, marker=&#39;p&#39;)</span>
<span class="c1">#         if season ==&#39;DJF&#39;:</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[11:], markers):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                           x=&#39;t&#39;, y=&#39;clic&#39;,</span>
<span class="c1">#                                                                           label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                           color=c, marker=marker)</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[:2], markers[1:]):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                          x=&#39;t&#39;, y=&#39;clic&#39;,</span>
<span class="c1">#                                                                          label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                          color=c, marker=marker)</span>
        
<span class="c1">#         if season==&#39;MAM&#39;:</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[2:5], markers):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                          x=&#39;t&#39;, y=&#39;clic&#39;,</span>
<span class="c1">#                                                                          label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                          color=c, marker=marker)</span>
        
<span class="c1">#         if season==&#39;JJA&#39;:</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[5:8], markers):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                           x=&#39;t&#39;, y=&#39;clic&#39;,</span>
<span class="c1">#                                                                           label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                           color=c, marker=marker)</span>

<span class="c1">#         if season==&#39;SON&#39;:</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[8:11], markers):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                          x=&#39;t&#39;, y=&#39;clic&#39;,</span>
<span class="c1">#                                                                          label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                          color=c, marker=marker)</span>


<span class="c1"># axs[1].legend(loc=&#39;upper left&#39;, bbox_to_anchor=(1, 1), fontsize=&quot;small&quot;, fancybox=True,)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fig, axsm = plt.subplots(2,2, figsize=[10,7],sharex=True, sharey=True)</span>
<span class="c1"># axs = axsm.flatten()</span>
<span class="c1"># for ax, season in zip(axs, season_mean_1deg.season.values):</span>

<span class="c1">#     for _lat, c in zip(iteration_NH, cm.hawaii(range(0, 256, int(256/len(iteration_NH))))):</span>

<span class="c1">#         _season=ds_era_1deg.sum(&#39;level&#39;).sel(lat = slice(_lat, _lat+step)).mean((&#39;lon&#39;, &#39;lat&#39;), skipna=True, keep_attrs=True).groupby(&#39;time.season&#39;).mean(&#39;time&#39;, skipna=True, keep_attrs=True)</span>
<span class="c1">#         _month=ds_era_1deg.sum(&#39;level&#39;).sel(lat = slice(_lat, _lat+step)).mean((&#39;lon&#39;, &#39;lat&#39;), skipna=True, keep_attrs=True).groupby(&#39;time.month&#39;).mean(&#39;time&#39;, skipna=True, keep_attrs=True)</span>
       
<span class="c1">#         _season.sel(statistic=&#39;ERA5_50&#39;, season=season).plot.scatter(ax=ax, x=&#39;t&#39;, y=&#39;sf&#39;, label=&#39;[{} : {})&#39;.format(_lat, _lat+step), color=c, marker=&#39;p&#39;)</span>
<span class="c1">#         if season ==&#39;DJF&#39;:</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[11:], markers):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                           x=&#39;t&#39;, y=&#39;sf&#39;,</span>
<span class="c1">#                                                                           label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                           color=c, marker=marker)</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[:2], markers[1:]):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                          x=&#39;t&#39;, y=&#39;sf&#39;,</span>
<span class="c1">#                                                                          label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                          color=c, marker=marker)</span>
        
<span class="c1">#         if season==&#39;MAM&#39;:</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[2:5], markers):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                          x=&#39;t&#39;, y=&#39;sf&#39;,</span>
<span class="c1">#                                                                          label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                          color=c, marker=marker)</span>
        
<span class="c1">#         if season==&#39;JJA&#39;:</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[5:8], markers):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                           x=&#39;t&#39;, y=&#39;sf&#39;,</span>
<span class="c1">#                                                                           label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                           color=c, marker=marker)</span>

<span class="c1">#         if season==&#39;SON&#39;:</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[8:11], markers):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                          x=&#39;t&#39;, y=&#39;sf&#39;,</span>
<span class="c1">#                                                                          label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                          color=c, marker=marker)</span>


<span class="c1"># axs[1].legend(loc=&#39;upper left&#39;, bbox_to_anchor=(1, 1), fontsize=&quot;small&quot;, fancybox=True,)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fig, axsm = plt.subplots(2,2, figsize=[10,7],sharex=True, sharey=True)</span>
<span class="c1"># axs = axsm.flatten()</span>
<span class="c1"># for ax, season in zip(axs, season_mean_1deg.season.values):</span>

<span class="c1">#     for _lat, c in zip(iteration_NH, cm.hawaii(range(0, 256, int(256/len(iteration_NH))))):</span>

<span class="c1">#         _season=ds_era_1deg.sum(&#39;level&#39;).sel(lat = slice(_lat, _lat+step)).mean((&#39;lon&#39;, &#39;lat&#39;), skipna=True, keep_attrs=True).groupby(&#39;time.season&#39;).mean(&#39;time&#39;, skipna=True, keep_attrs=True)</span>
<span class="c1">#         _month=ds_era_1deg.sum(&#39;level&#39;).sel(lat = slice(_lat, _lat+step)).mean((&#39;lon&#39;, &#39;lat&#39;), skipna=True, keep_attrs=True).groupby(&#39;time.month&#39;).mean(&#39;time&#39;, skipna=True, keep_attrs=True)</span>
       
<span class="c1">#         _season.sel(statistic=&#39;ERA5_50&#39;, season=season).plot.scatter(ax=ax, x=&#39;pressure&#39;, y=&#39;sf&#39;, label=&#39;[{} : {})&#39;.format(_lat, _lat+step), color=c, marker=&#39;p&#39;)</span>
<span class="c1">#         if season ==&#39;DJF&#39;:</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[11:], markers):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                           x=&#39;pressure&#39;, y=&#39;sf&#39;,</span>
<span class="c1">#                                                                           label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                           color=c, marker=marker)</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[:2], markers[1:]):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                          x=&#39;pressure&#39;, y=&#39;sf&#39;,</span>
<span class="c1">#                                                                          label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                          color=c, marker=marker)</span>
        
<span class="c1">#         if season==&#39;MAM&#39;:</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[2:5], markers):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                          x=&#39;pressure&#39;, y=&#39;sf&#39;,</span>
<span class="c1">#                                                                          label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                          color=c, marker=marker)</span>
        
<span class="c1">#         if season==&#39;JJA&#39;:</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[5:8], markers):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                           x=&#39;pressure&#39;, y=&#39;sf&#39;,</span>
<span class="c1">#                                                                           label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                           color=c, marker=marker)</span>

<span class="c1">#         if season==&#39;SON&#39;:</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[8:11], markers):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                          x=&#39;pressure&#39;, y=&#39;sf&#39;,</span>
<span class="c1">#                                                                          label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                          color=c, marker=marker)</span>


<span class="c1"># axs[1].legend(loc=&#39;upper left&#39;, bbox_to_anchor=(1, 1), fontsize=&quot;small&quot;, fancybox=True,)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fig, axsm = plt.subplots(2,2, figsize=[10,7],sharex=True, sharey=True)</span>
<span class="c1"># axs = axsm.flatten()</span>
<span class="c1"># for ax, season in zip(axs, season_mean_1deg.season.values):</span>

<span class="c1">#     for _lat, c in zip(iteration_NH, cm.hawaii(range(0, 256, int(256/len(iteration_NH))))):</span>

<span class="c1">#         _season=ds_era_1deg.sum(&#39;level&#39;).sel(lat = slice(_lat, _lat+step)).mean((&#39;lon&#39;, &#39;lat&#39;), skipna=True, keep_attrs=True).groupby(&#39;time.season&#39;).mean(&#39;time&#39;, skipna=True, keep_attrs=True)</span>
<span class="c1">#         _month=ds_era_1deg.sum(&#39;level&#39;).sel(lat = slice(_lat, _lat+step)).mean((&#39;lon&#39;, &#39;lat&#39;), skipna=True, keep_attrs=True).groupby(&#39;time.month&#39;).mean(&#39;time&#39;, skipna=True, keep_attrs=True)</span>
       
<span class="c1">#         _season.sel(statistic=&#39;ERA5_50&#39;, season=season).plot.scatter(ax=ax, x=&#39;pressure&#39;, y=&#39;t&#39;, label=&#39;[{} : {})&#39;.format(_lat, _lat+step), color=c, marker=&#39;p&#39;)</span>
<span class="c1">#         if season ==&#39;DJF&#39;:</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[11:], markers):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                           x=&#39;pressure&#39;, y=&#39;t&#39;,</span>
<span class="c1">#                                                                           label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                           color=c, marker=marker)</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[:2], markers[1:]):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                          x=&#39;pressure&#39;, y=&#39;t&#39;,</span>
<span class="c1">#                                                                          label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                          color=c, marker=marker)</span>
        
<span class="c1">#         if season==&#39;MAM&#39;:</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[2:5], markers):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                          x=&#39;pressure&#39;, y=&#39;t&#39;,</span>
<span class="c1">#                                                                          label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                          color=c, marker=marker)</span>
        
<span class="c1">#         if season==&#39;JJA&#39;:</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[5:8], markers):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                           x=&#39;pressure&#39;, y=&#39;t&#39;,</span>
<span class="c1">#                                                                           label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                           color=c, marker=marker)</span>

<span class="c1">#         if season==&#39;SON&#39;:</span>
<span class="c1">#             for month, marker in zip(_month.sel(statistic=&#39;ERA5_50&#39;).month.values[8:11], markers):</span>
<span class="c1">#                 _month.sel(statistic=&#39;ERA5_50&#39;, month=month).plot.scatter(ax=ax, </span>
<span class="c1">#                                                                          x=&#39;pressure&#39;, y=&#39;t&#39;,</span>
<span class="c1">#                                                                          label=&#39;[{} : {})&#39;.format(_lat, _lat+step),</span>
<span class="c1">#                                                                          color=c, marker=marker)</span>


<span class="c1"># axs[1].legend(loc=&#39;upper left&#39;, bbox_to_anchor=(1, 1), fontsize=&quot;small&quot;, fancybox=True,)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculate-latitude-band-mean-of-variables">
<h2>Calculate latitude band mean of variables<a class="headerlink" href="#calculate-latitude-band-mean-of-variables" title="Permalink to this heading">#</a></h2>
<p>We will only use high latitudes and the extratropics the latitude bands are as follow:</p>
<ol class="arabic simple">
<li><p>Southern Hemispher:</p>
<ul class="simple">
<li><p>[-30, -45)</p></li>
<li><p>[-45, -60)</p></li>
<li><p>[-60, -75)</p></li>
<li><p>[-75, -90)</p></li>
</ul>
</li>
<li><p>Northern Hemisphere:</p>
<ul class="simple">
<li><p>[30, 45)</p></li>
<li><p>[45, 60)</p></li>
<li><p>[60, 75)</p></li>
<li><p>[75, 90)</p></li>
</ul>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># lat_SH = (-90, -30); lat_NH = (30,90); step = 15</span>
<span class="c1"># iteration_SH = range(lat_SH[1], lat_SH[0], -step)</span>
<span class="c1"># iteration_NH = range(lat_NH[0], lat_NH[1], step)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for var_id in ds_era.keys():</span>
<span class="c1">#     for _lat in iteration_SH:</span>

<span class="c1">#         # ERA5 original resolution</span>
<span class="c1">#         ds_era_025deg[var_id + &#39;_season_{}_{}&#39;.format(_lat, _lat-step)] = ds_era_025deg[var_id + &#39;_season_mean&#39;].sel(lat = slice(_lat, _lat-step)).mean((&#39;lat&#39;,), keep_attrs=True, skipna=True)</span>

<span class="c1">#         # ERA5 regridded resolution</span>
<span class="c1">#         ds_era_1deg[var_id + &#39;_season_{}_{}&#39;.format(_lat, _lat-step)] = ds_era_1deg[var_id + &#39;_season_mean&#39;].sel(lat = slice(_lat-step, _lat)).mean((&#39;lat&#39;,), keep_attrs=True, skipna=True)</span>

<span class="c1">#     for _lat in iteration_NH:</span>
<span class="c1">#         # ERA5 original resolution</span>
<span class="c1">#         ds_era_025deg[var_id + &#39;_season_{}_{}&#39;.format(_lat, _lat+step)] = ds_era_025deg[var_id + &#39;_season_mean&#39;].sel(lat = slice(_lat+step, _lat)).mean((&#39;lat&#39;,), keep_attrs=True, skipna=True)</span>

<span class="c1">#         # ERA5 regridded resolution</span>
<span class="c1">#         ds_era_1deg[var_id + &#39;_season_{}_{}&#39;.format(_lat, _lat+step)] = ds_era_1deg[var_id + &#39;_season_mean&#39;].sel(lat = slice(_lat, _lat+step)).mean((&#39;lat&#39;,), keep_attrs=True, skipna=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for stat in ds_era_1deg.statistic.values:</span>
<span class="c1">#     # Southern Hemisphere</span>
<span class="c1">#     fig, axsm = plt.subplots(2, 2, figsize=[10,7], sharex=True, sharey=True)</span>
<span class="c1">#     fig.suptitle(&#39;{}&#39;.format(stat), fontsize=16, fontweight=&quot;bold&quot;)</span>

<span class="c1">#     axs = axsm.flatten()</span>
<span class="c1">#     for ax, i in zip(axs, ds_era_1deg.season):</span>
<span class="c1">#         for _lat, c in zip(iteration_SH, cm.romaO(range(0, 256, int(256 / 4)))):</span>
<span class="c1">#             ax.scatter( x=ds_era_1deg[&#39;t_season_{}_{}&#39;.format(_lat, _lat-step)].sel(statistic=stat).sum(&#39;level&#39;, skipna=True).sel(season=i), </span>
<span class="c1">#                         y=ds_era_1deg[&#39;sf_season_{}_{}&#39;.format(_lat, _lat-step)].sel(statistic=stat).sel(season=i), </span>
<span class="c1">#                         label=&quot;{}, {}&quot;.format(_lat, _lat - step), </span>
<span class="c1">#                         color=c, </span>
<span class="c1">#                         alpha=0.5)</span>

<span class="c1">#     axs[1].legend(</span>
<span class="c1">#             loc=&quot;upper left&quot;,</span>
<span class="c1">#             bbox_to_anchor=(1, 1),</span>
<span class="c1">#             fontsize=&quot;small&quot;,</span>
<span class="c1">#             fancybox=True,</span>
<span class="c1">#         );</span>

<span class="c1">#     # Northern Hemisphere</span>
<span class="c1">#     fig, axsm = plt.subplots(2, 2, figsize=[10,7], sharex=True, sharey=True)</span>
<span class="c1">#     fig.suptitle(&#39;{}&#39;.format(stat), fontsize=16, fontweight=&quot;bold&quot;)</span>

<span class="c1">#     axs = axsm.flatten()</span>
<span class="c1">#     for ax, i in zip(axs, ds_era_1deg.season):</span>
<span class="c1">#         for _lat, c in zip(iteration_NH, cm.romaO(range(0, 256, int(256 / 4)))):</span>
<span class="c1">#             ax.scatter( x=ds_era_1deg[&#39;t_season_{}_{}&#39;.format(_lat, _lat+step)].sel(statistic=stat).sum(&#39;level&#39;, skipna=True).sel(season=i), </span>
<span class="c1">#                         y=ds_era_1deg[&#39;sf_season_{}_{}&#39;.format(_lat, _lat+step)].sel(statistic=stat).sel(season=i), </span>
<span class="c1">#                         label=&quot;{}, {}&quot;.format(_lat, _lat + step), </span>
<span class="c1">#                         color=c, </span>
<span class="c1">#                         alpha=0.5)</span>

<span class="c1">#     axs[1].legend(</span>
<span class="c1">#             loc=&quot;upper left&quot;,</span>
<span class="c1">#             bbox_to_anchor=(1, 1),</span>
<span class="c1">#             fontsize=&quot;small&quot;,</span>
<span class="c1">#             fancybox=True,</span>
<span class="c1">#         );</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="references-a-id-references-a">
<h1>References <a id='references'></a><a class="headerlink" href="#references-a-id-references-a" title="Permalink to this heading">#</a></h1>
<p>[1] Zelinka, M. D., Myers, T. A., McCoy, D. T., Po-Chedley, S., Caldwell, P. M., Ceppi, P., et al. (2020). Causes of higher climate sensitivity in CMIP6 models. Geophysical Research Letters, 47, e2019GL085782. <a class="reference external" href="https://doi-org.ezproxy.uio.no/10.1029/2019GL085782">https://doi-org.ezproxy.uio.no/10.1029/2019GL085782</a></p>
<p>[2] Bjordal, J., Storelvmo, T., Alterskjær, K. et al. Equilibrium climate sensitivity above 5 °C plausible due to state-dependent cloud feedback. Nat. Geosci. 13, 718–721 (2020). <a class="reference external" href="https://doi-org.ezproxy.uio.no/10.1038/s41561-020-00649-1">https://doi-org.ezproxy.uio.no/10.1038/s41561-020-00649-1</a></p>
<img src="https://drive.google.com/uc?id=1zb0LHvipx8JOXLLrCxzYToJM7eNK4eaw"  height="100" />
<img src="https://reliance.rohub.org/static/media/Reliance-logo.433dc2e9.png"  height="100" />
<img src="https://www.uio.no/vrtx/decorating/resources/dist/src2/images/footer/uio-logo-en.svg"  height="100" />
<img src="https://erc.europa.eu/sites/default/files/logo_0.png"  height="100" />
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./ERA5"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Welcome to Global Snow project website</p>
      </div>
    </a>
    <a class="right-next"
       href="../CMIP6_ERA5_CloudSat/plt_seasonal_mean.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Analysis of CMIP6, ERA5, and CloudSat</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Example with ERA5 high-resolution (~0.25deg) monthly means</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-a-id-introduction-a">1. Introduction <a id="introduction"></a></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-wrangling-a-id-data-wrangling-a">2. Data Wrangling <a id="data_wrangling"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#organize-my-data">Organize my data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-python-packages">Import python packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#open-era5-variables">Open ERA5 variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#change-attributes-matching-cmip6-data">Change attributes matching CMIP6 data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specific-ice-and-snow-water-content">Specific ice and snow water content</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#total-column-cloud-ice-water-and-total-column-cloud-snow-water">Total column cloud ice water and total column cloud snow water</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#total-column-cloud-liquid-water-total-column-supercooled-liquid-water-total-column-rain-water">Total column cloud liquid water, total column supercooled liquid water, total column rain water</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#save-era5-file">Save ERA5 file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regrid-era5-data-to-common-cmip6-model-grid-a-id-regrid-hz-a">Regrid ERA5 data to common CMIP6 model grid <a id="regrid_hz"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#count-the-days-in-one-season-over-year-range">Count the days in one season over year range</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#supercooled-liquid-water-fraction">Supercooled liquid water fraction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statistics">Statistics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-often-do-we-have-slc-with-thresholds-for-surface-snowfall-liquid-water-path-and-temperature">How often do we have SLC with thresholds for surface snowfall, liquid water path, and temperature</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#liquid-containing-cloud-frequency">Liquid containing cloud frequency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#masked-and-weighted-average">Masked and weighted average</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annual-cycle-of-frequency-of-liquid-containing-clouds">Annual cycle of frequency of liquid containing clouds</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#frequency-of-snowfall-from-lccs">Frequency of snowfall from LCCs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annual-cycle-of-frequency-of-snowfall-from-lccs">Annual cycle of frequency of snowfall from LCCs</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relative-snowfall-efficency">Relative snowfall efficency</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annual-cycle-of-relative-snowfall-efficency">Annual cycle of relative snowfall efficency</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relative-precipitation-efficency">Relative precipitation efficency</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annual-cycle-of-relative-supercooled-precipitation-efficency">Annual cycle of relative supercooled precipitation efficency</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#frequency-of-freezing-rain">Frequency of freezing rain</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#way-to-average-the-globe">Way to Average the Globe</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-bin-and-bin-sizes">Calculating bin and bin sizes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#snowfall-and-precipitation-efficency">Snowfall and Precipitation efficency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mask-atmopsheric-temperature">Mask atmopsheric temperature</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exploratory-data-analysis-a-id-exploratory-a">3. Exploratory Data Analysis <a id="exploratory"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-global-mean-and-seasonal-mean-spread-of-all-era5-data">Create global mean and seasonal mean/spread of all ERA5 data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#find-mixed-phase-clouds">Find mixed-phase clouds</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-seasonal-mean-of-each-variable">Plot the seasonal mean of each variable</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-latitude-band-mean-of-variables">Calculate latitude band mean of variables</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#references-a-id-references-a">References <a id="references"></a></a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Franziska Hellmuth
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>